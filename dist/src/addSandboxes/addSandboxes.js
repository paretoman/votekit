let e,t,n,r;function i(e,t,n,r){Object.defineProperty(e,t,{get:n,set:r,enumerable:!0,configurable:!0})}function o(e){return e&&e.__esModule?e.default:e}var a=globalThis,s={},l={},c=a.parcelRequirede6b;null==c&&((c=function(e){if(e in s)return s[e].exports;if(e in l){var t=l[e];delete l[e];var n={id:e,exports:{}};return s[e]=n,t.call(n.exports,n,n.exports),n.exports}var r=Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}).register=function(e,t){l[e]=t},a.parcelRequirede6b=c);var h=c.register;h("cmoHh",function(e,t){!function(e,t,n){function r(e){var t,n=this,r=(t=4022871197,function(e){e=String(e);for(var n=0;n<e.length;n++){var r=.02519603282416938*(t+=e.charCodeAt(n));t=r>>>0,r-=t,r*=t,t=r>>>0,r-=t,t+=4294967296*r}return(t>>>0)*23283064365386963e-26});n.next=function(){var e=2091639*n.s0+23283064365386963e-26*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(e),n.s0<0&&(n.s0+=1),n.s1-=r(e),n.s1<0&&(n.s1+=1),n.s2-=r(e),n.s2<0&&(n.s2+=1)}function i(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var n=new r(e),o=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+(2097152*a()|0)*11102230246251565e-32},a.quick=a,o&&("object"==typeof o&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o}(0,e,"function"==typeof define&&define)}),h("euRi5",function(e,t){!function(e,t,n){function r(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function i(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var n=new r(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,r=(e+t)/2097152;while(0===r)return r},a.int32=n.next,a.quick=a,o&&("object"==typeof o&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o}(0,e,"function"==typeof define&&define)}),h("hDsEw",function(e,t){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^(e^e<<1))|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function i(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var n=new r(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,r=(e+t)/2097152;while(0===r)return r},a.int32=n.next,a.quick=a,o&&("object"==typeof o&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o}(0,e,"function"==typeof define&&define)}),h("3J2Zm",function(e,t){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.x,i=t.i;return e=r[i],e^=e>>>7,n=e^e<<24^((e=r[i+1&7])^e>>>10)^((e=r[i+3&7])^e>>>3)^((e=r[i+4&7])^e<<7),e=r[i+7&7],e^=e<<13,n^=e^e<<9,r[i]=n,t.i=i+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(n=0,t=""+t;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function i(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var n=new r(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,r=(e+t)/2097152;while(0===r)return r},a.int32=n.next,a.quick=a,o&&(o.x&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o}(0,e,"function"==typeof define&&define)}),h("6Px8M",function(e,t){!function(e,t,n){function r(e){var t=this;t.next=function(){var e,n,r=t.w,i=t.X,o=t.i;return t.w=r=r+1640531527|0,n=i[o+34&127],e=i[o=o+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=i[o]=n^e,t.i=o,n+(r^r>>>16)|0},function(e,t){var n,r,i,o,a,s=[],l=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,l=Math.max(l,t.length)),i=0,o=-32;o<l;++o)t&&(r^=t.charCodeAt((o+32)%t.length)),0===o&&(a=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,o>=0&&(a=a+1640531527|0,i=0==(n=s[127&o]^=r+a)?i+1:0);for(i>=128&&(s[127&(t&&t.length||0)]=-1),i=127,o=512;o>0;--o)r=s[i+34&127],n=s[i=i+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[i]=r^n;e.w=a,e.X=s,e.i=i}(t,e)}function i(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var n=new r(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,r=(e+t)/2097152;while(0===r)return r},a.int32=n.next,a.quick=a,o&&(o.X&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o}(0,e,"function"==typeof define&&define)}),h("lDm0S",function(e,t){!function(e,t,n){function r(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,i=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^i,i=i-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^i,t.a=i-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function i(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var n=new r(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,r=(e+t)/2097152;while(0===r)return r},a.int32=n.next,a.quick=a,o&&("object"==typeof o&&i(o,n),a.state=function(){return i(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o}(0,e,"function"==typeof define&&define)}),h("kjyEk",function(e,t){}),h("8PNKb",function(e,t){i(e.exports,"Group",()=>l),i(e.exports,"Tween",()=>p);var n,r,o=c("hPtJY"),a={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return .5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((e-.1)*5*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin((e-1.1)*5*Math.PI)+1}},Back:{In:function(e){return e*e*(2.70158*e-1.70158)},Out:function(e){return--e*e*(2.70158*e+1.70158)+1},InOut:function(e){return(e*=2)<1?e*e*(3.5949095*e-2.5949095)*.5:.5*((e-=2)*e*(3.5949095*e+2.5949095)+2)}},Bounce:{In:function(e){return 1-a.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*a.Bounce.In(2*e):.5*a.Bounce.Out(2*e-1)+.5}}};"undefined"==typeof self&&void 0!==o&&o.hrtime?r=function(){var e=o.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?r=self.performance.now.bind(self.performance):r=void 0!==Date.now?Date.now:function(){return new Date().getTime()};var s=r,l=function(){function e(){this._tweens={},this._tweensAddedDuringUpdate={}}return e.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},e.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},e.prototype.update=function(e,t){void 0===e&&(e=s()),void 0===t&&(t=!1);var n=Object.keys(this._tweens);if(0===n.length)return!1;for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var r=0;r<n.length;r++){var i=this._tweens[n[r]],o=!t;i&&!1===i.update(e,o)&&!t&&delete this._tweens[n[r]]}n=Object.keys(this._tweensAddedDuringUpdate)}return!0},e}(),h={Linear:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),o=h.Utils.Linear;return t<0?o(e[0],e[1],r):t>1?o(e[n],e[n-1],n-r):o(e[i],e[i+1>n?n:i+1],r-i)},Bezier:function(e,t){for(var n=0,r=e.length-1,i=Math.pow,o=h.Utils.Bernstein,a=0;a<=r;a++)n+=i(1-t,r-a)*i(t,a)*e[a]*o(r,a);return n},CatmullRom:function(e,t){var n=e.length-1,r=n*t,i=Math.floor(r),o=h.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(i=Math.floor(r=n*(1+t))),o(e[(i-1+n)%n],e[i],e[(i+1)%n],e[(i+2)%n],r-i)):t<0?e[0]-(o(e[0],e[0],e[1],e[1],-r)-e[0]):t>1?e[n]-(o(e[n],e[n],e[n-1],e[n-1],r-n)-e[n]):o(e[i?i-1:0],e[i],e[n<i+1?n:i+1],e[n<i+2?n:i+2],r-i)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=h.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:(n=[1],function(e){var t=1;if(n[e])return n[e];for(var r=e;r>1;r--)t*=r;return n[e]=t,t}),CatmullRom:function(e,t,n,r,i){var o=(n-e)*.5,a=(r-t)*.5,s=i*i;return i*s*(2*t-2*n+o+a)+(-3*t+3*n-2*o-a)*s+o*i+t}}},u=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),d=new l,p=function(){function e(e,t){void 0===t&&(t=d),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=a.Linear.None,this._interpolationFunction=h.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=u.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.to=function(e,t){return this._valuesEnd=Object.create(e),void 0!==t&&(this._duration=t),this},e.prototype.duration=function(e){return this._duration=e,this},e.prototype.start=function(e){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var t in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==e?"string"==typeof e?s()+parseFloat(e):e:s(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},e.prototype._setupProperties=function(e,t,n,r){for(var i in n){var o=e[i],a=Array.isArray(o),s=a?"array":typeof o,l=!a&&Array.isArray(n[i]);if("undefined"!==s&&"function"!==s){if(l){var c=n[i];if(0===c.length)continue;c=c.map(this._handleRelativeValue.bind(this,o)),n[i]=[o].concat(c)}if(("object"===s||a)&&o&&!l){for(var h in t[i]=a?[]:{},o)t[i][h]=o[h];r[i]=a?[]:{},this._setupProperties(o,t[i],n[i],r[i])}else void 0===t[i]&&(t[i]=o),a||(t[i]*=1),l?r[i]=n[i].slice().reverse():r[i]=t[i]||0}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying&&(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object)),this},e.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},e.prototype.pause=function(e){return void 0===e&&(e=s()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this)),this},e.prototype.resume=function(e){return void 0===e&&(e=s()),this._isPaused&&this._isPlaying&&(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this)),this},e.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},e.prototype.group=function(e){return this._group=e,this},e.prototype.delay=function(e){return this._delayTime=e,this},e.prototype.repeat=function(e){return this._initialRepeat=e,this._repeat=e,this},e.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},e.prototype.yoyo=function(e){return this._yoyo=e,this},e.prototype.easing=function(e){return this._easingFunction=e,this},e.prototype.interpolation=function(e){return this._interpolationFunction=e,this},e.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},e.prototype.onStart=function(e){return this._onStartCallback=e,this},e.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},e.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},e.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},e.prototype.onStop=function(e){return this._onStopCallback=e,this},e.prototype.update=function(e,t){if(void 0===e&&(e=s()),void 0===t&&(t=!0),this._isPaused)return!0;var n,r,i=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>i)return!1;t&&this.start(e)}if(this._goToEnd=!1,e<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),r=(e-this._startTime)/this._duration,r=0===this._duration||r>1?1:r;var o=this._easingFunction(r);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,o),this._onUpdateCallback&&this._onUpdateCallback(this._object,r),1===r){if(this._repeat>0){for(n in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[n]||(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo&&this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object)}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var a=0,l=this._chainedTweens.length;a<l;a++)this._chainedTweens[a].start(this._startTime+this._duration);return this._isPlaying=!1,!1}}return!0},e.prototype._updateProperties=function(e,t,n,r){for(var i in n)if(void 0!==t[i]){var o=t[i]||0,a=n[i],s=Array.isArray(e[i]),l=Array.isArray(a);!s&&l?e[i]=this._interpolationFunction(a,r):"object"==typeof a&&a?this._updateProperties(e[i],o,a,r):"number"==typeof(a=this._handleRelativeValue(o,a))&&(e[i]=o+(a-o)*r)}},e.prototype._handleRelativeValue=function(e,t){return"string"!=typeof t?t:"+"===t.charAt(0)||"-"===t.charAt(0)?e+parseFloat(t):parseFloat(t)},e.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],n=this._valuesEnd[e];"string"==typeof n?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(n):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},e}();u.nextId,d.getAll.bind(d),d.removeAll.bind(d),d.add.bind(d),d.remove.bind(d),d.update.bind(d)}),h("hPtJY",function(e,t){var n,r,i,o=e.exports={};function a(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function l(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var c=[],h=!1,u=-1;function d(){h&&i&&(h=!1,i.length?c=i.concat(c):u=-1,c.length&&p())}function p(){if(!h){var e=l(d);h=!0;for(var t=c.length;t;){for(i=c,c=[];++u<t;)i&&i[u].run();u=-1,t=c.length}i=null,h=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||h||l(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}}),h("426T3",function(e,t){var n=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={};function i(e,t){if(!r[e]){r[e]={};for(var n=0;n<e.length;n++)r[e][e.charAt(n)]=n}return r[e][t]}var o={compressToBase64:function(e){if(null==e)return"";var n=o._compress(e,6,function(e){return t.charAt(e)});switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:o._decompress(e.length,32,function(n){return i(t,e.charAt(n))})},compressToUTF16:function(t){return null==t?"":o._compress(t,15,function(t){return e(t+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:o._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32})},compressToUint8Array:function(e){for(var t=o.compress(e),n=new Uint8Array(2*t.length),r=0,i=t.length;r<i;r++){var a=t.charCodeAt(r);n[2*r]=a>>>8,n[2*r+1]=a%256}return n},decompressFromUint8Array:function(t){if(null==t)return o.decompress(t);for(var n=Array(t.length/2),r=0,i=n.length;r<i;r++)n[r]=256*t[2*r]+t[2*r+1];var a=[];return n.forEach(function(t){a.push(e(t))}),o.decompress(a.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":o._compress(e,6,function(e){return n.charAt(e)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),o._decompress(e.length,32,function(t){return i(n,e.charAt(t))}))},compress:function(t){return o._compress(t,16,function(t){return e(t)})},_compress:function(e,t,n){if(null==e)return"";var r,i,o,a={},s={},l="",c="",h="",u=2,d=3,p=2,f=[],m=0,g=0;for(o=0;o<e.length;o+=1)if(l=e.charAt(o),Object.prototype.hasOwnProperty.call(a,l)||(a[l]=d++,s[l]=!0),c=h+l,Object.prototype.hasOwnProperty.call(a,c))h=c;else{if(Object.prototype.hasOwnProperty.call(s,h)){if(256>h.charCodeAt(0)){for(r=0;r<p;r++)m<<=1,g==t-1?(g=0,f.push(n(m)),m=0):g++;for(r=0,i=h.charCodeAt(0);r<8;r++)m=m<<1|1&i,g==t-1?(g=0,f.push(n(m)),m=0):g++,i>>=1}else{for(r=0,i=1;r<p;r++)m=m<<1|i,g==t-1?(g=0,f.push(n(m)),m=0):g++,i=0;for(r=0,i=h.charCodeAt(0);r<16;r++)m=m<<1|1&i,g==t-1?(g=0,f.push(n(m)),m=0):g++,i>>=1}0==--u&&(u=Math.pow(2,p),p++),delete s[h]}else for(r=0,i=a[h];r<p;r++)m=m<<1|1&i,g==t-1?(g=0,f.push(n(m)),m=0):g++,i>>=1;0==--u&&(u=Math.pow(2,p),p++),a[c]=d++,h=String(l)}if(""!==h){if(Object.prototype.hasOwnProperty.call(s,h)){if(256>h.charCodeAt(0)){for(r=0;r<p;r++)m<<=1,g==t-1?(g=0,f.push(n(m)),m=0):g++;for(r=0,i=h.charCodeAt(0);r<8;r++)m=m<<1|1&i,g==t-1?(g=0,f.push(n(m)),m=0):g++,i>>=1}else{for(r=0,i=1;r<p;r++)m=m<<1|i,g==t-1?(g=0,f.push(n(m)),m=0):g++,i=0;for(r=0,i=h.charCodeAt(0);r<16;r++)m=m<<1|1&i,g==t-1?(g=0,f.push(n(m)),m=0):g++,i>>=1}0==--u&&(u=Math.pow(2,p),p++),delete s[h]}else for(r=0,i=a[h];r<p;r++)m=m<<1|1&i,g==t-1?(g=0,f.push(n(m)),m=0):g++,i>>=1;0==--u&&(u=Math.pow(2,p),p++)}for(r=0,i=2;r<p;r++)m=m<<1|1&i,g==t-1?(g=0,f.push(n(m)),m=0):g++,i>>=1;for(;;){if(m<<=1,g==t-1){f.push(n(m));break}g++}return f.join("")},decompress:function(e){return null==e?"":""==e?null:o._decompress(e.length,32768,function(t){return e.charCodeAt(t)})},_decompress:function(t,n,r){var i,o,a,s,l,c,h,u=[],d=4,p=4,f=3,m="",g=[],y={val:r(0),position:n,index:1};for(i=0;i<3;i+=1)u[i]=i;for(a=0,l=4,c=1;c!=l;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*c,c<<=1;switch(a){case 0:for(a=0,l=256,c=1;c!=l;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*c,c<<=1;h=e(a);break;case 1:for(a=0,l=65536,c=1;c!=l;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*c,c<<=1;h=e(a);break;case 2:return""}for(u[3]=h,o=h,g.push(h);;){if(y.index>t)return"";for(a=0,l=Math.pow(2,f),c=1;c!=l;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*c,c<<=1;switch(h=a){case 0:for(a=0,l=256,c=1;c!=l;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*c,c<<=1;u[p++]=e(a),h=p-1,d--;break;case 1:for(a=0,l=65536,c=1;c!=l;)s=y.val&y.position,y.position>>=1,0==y.position&&(y.position=n,y.val=r(y.index++)),a|=(s>0?1:0)*c,c<<=1;u[p++]=e(a),h=p-1,d--;break;case 2:return g.join("")}if(0==d&&(d=Math.pow(2,f),f++),u[h])m=u[h];else{if(h!==p)return null;m=o+o.charAt(0)}g.push(m),u[p++]=o+m.charAt(0),d--,o=m,0==d&&(d=Math.pow(2,f),f++)}}};return o}();"function"==typeof define&&define.amd?define(function(){return n}):null!=e?e.exports=n:"undefined"!=typeof angular&&null!=angular&&angular.module("LZString",[]).factory("LZString",function(){return n})});const u=1/Math.sqrt(2*Math.PI);function d(e,t,n){return u/n*Math.exp(-.5*((e-t)/n)**2)}function p(e,t,n){return e===1/0?1:e===-1/0?0:.5*function(e){let t=e**2;return Math.sqrt(1-Math.exp(-((4/Math.PI+.147*t)/(1+.147*t))*t))*Math.sign(e)}((e-t)/(n*Math.sqrt(2)))+.5}function f(e){let t=m(e),n=[];return t.reduce((e,t,r)=>{let i=e+t;return n[r]=i,i},0),n}function m(e){let t=e.reduce((e,t)=>e+t);return e.map(e=>e/t)}function g(e,t){let n=t();return e.findIndex(e=>e>=n)}function y(e){let t=Array(e);for(let n=0;n<e;n++)t[n]=n;return t}function v(e){let t=1/0,n=null;for(let r=0;r<e.length;r++){let i=e[r];i<t&&(t=i,n=r)}return n}function w(e){let t=-1/0,n=null;for(let r=0;r<e.length;r++){let i=e[r];i>t&&(t=i,n=r)}return n}function x(e){let t=e[0],n=e[0];for(let r=0;r<e.length;r++){let i=e[r];i<t&&(t=i),i>n&&(n=i)}return[t,n]}function _(e){return JSON.parse(JSON.stringify(e))}function b(e){let t=e.length,n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}function C(){let e=["init"];this.add=t=>{t.forEach(t=>e.push(t))},this.check=t=>{let n=0;return t.forEach(t=>{n+=e.includes(t)?1:0}),n>0},this.checkNone=()=>0===e.length,this.checkAny=()=>0!==e.length,this.clear=()=>{e.splice(0,e.length)},this.numChanges=()=>e.length,this.getChanges=()=>_(e)}function S(e){let t=[];this.addSender=n=>{let{name:r,action:i,props:o}=n;t[r]=i;let a=e=>({name:r,value:e,props:o});return{command:a,go:t=>e.do(a(t)),load:t=>e.loadCommands([a(t)])}},this.addSenderForList=n=>{let{name:r,action:i,props:o}=n;t[r]=i;let a=(e,t,n)=>({name:r,id:e,value:t,props:o,currentValue:n});return{command:a,go:(t,n,r)=>e.do(a(t,n,r)),load:(t,n,r)=>e.loadCommands([a(t,n,r)])}},this.execute=e=>{let{name:n,id:r,value:i}=e,o=t[n];void 0!==r?o(r,i):o(i)}}class P{constructor(){this.linked=!0,this.commanders=[],this.protect=!1}setLinked(e){this.linked=e}addCommander(e){this.commanders.push(e)}broadcastDo(e,t){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach(t=>t.passDo(e)),this.protect=!1):t.passDo(e)}broadcastDoCommands(e,t){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach(t=>t.passDoCommands(e)),this.protect=!1):t.passDoCommands(e)}broadcastLoadConfig(e,t){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach(t=>t.passLoadConfig(e)),this.protect=!1):t.passLoadConfig(e)}broadCastLoadCommands(e,t){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach(t=>t.passLoadCommands(e)),this.protect=!1):t.passLoadCommands(e)}}function k(e){let t=this,n={},r=[];t.addSender=e=>{let{name:t,currentValue:i,props:o}=e;void 0!==o&&o.isFirstAction&&(r[t]=!0),n[t]=i},t.addSenderForList=e=>{let{name:t,props:i}=e;return void 0!==i&&i.isFirstAction&&(r[t]=!0),n[t]=[],e=>n[t][e]},t.execute=e=>{let{name:t,id:r,value:i}=e;void 0!==r?n[t][r]=i:n[t]=i},t.makeUndo=e=>{let t;let{name:r,id:i,props:o}=e;return void 0===i?t=n[r]:void 0===(t=n[r][i])&&(t=e.currentValue),{name:r,id:i,value:t,props:o}},t.passLoadConfig=e=>{t.loadConfigPriority(e,"high"),t.loadConfigPriority(e,"low")},t.loadConfigPriority=(t,n)=>{Object.keys(t).forEach(i=>{let o=void 0!==r[i];if("low"===n&&o||"high"===n&&!o)return;let a=t[i];a instanceof Array?a.forEach((t,n)=>{e.execute({name:i,id:n,value:t})}):e.execute({name:i,value:a})})},t.passLoadCommands=t=>{t.forEach(t=>{e.execute(t)})},t.getConfig=()=>structuredClone(n)}function M(e){let t=this,n=[],r=-1;t.clearHistory=()=>{n.splice(0,n.length),r=-1},t.passDo=t=>{let i=e.makeUndo(t);n.splice(r+1,n.length-(r+1)),e.execute(t),t.props&&t.props.combineWithCurrentCommand&&r>-1?n[r].push({command:t,undoCommand:i}):(n.push([{command:t,undoCommand:i}]),r+=1)},t.passDoCommands=t=>{n.splice(r+1,n.length-(r+1));let i=[];t.forEach(t=>{let n=e.makeUndo(t);i.push({command:t,undoCommand:n}),e.execute(t)}),n.push(i),r+=1};let i=setTimeout(()=>null,30);t.undo=()=>{if(-1===r)return;let o=n[r];o.forEach(t=>{e.execute(t.undoCommand)}),r-=1;let{undoCommand:a}=o[0];if(void 0===a.props||!0!==a.props.isChain||-1===r)return;let s=n[r][0];!0===s.undoCommand.props.isChain&&s.undoCommand.name===a.name&&(void 0===a.id||s.undoCommand.id===a.id)&&(clearTimeout(i),i=setTimeout(t.undo,30))},t.redo=()=>{if(r===n.length-1)return;let o=n[r+1];o.forEach(t=>e.execute(t.command)),r+=1;let{command:a}=o[0];if(void 0===a.props||!0!==a.props.isChain||r===n.length-1)return;let s=n[r+1][0];!0===s.command.props.isChain&&s.command.name===a.name&&(void 0===a.id||s.command.id===a.id)&&(clearTimeout(i),i=setTimeout(t.redo,30))}}function A(e){let t=this,n=new S(t),r=new k(t),i=new M(t),o=e||new P;o.addCommander(t),t.addSender=e=>(r.addSender(e),n.addSender(e)),t.addSenderForList=e=>{let t=n.addSenderForList(e);return t.getCurrentValue=r.addSenderForList(e),t},t.execute=e=>{r.execute(e),n.execute(e)},t.makeUndo=r.makeUndo,t.passLoadConfig=r.passLoadConfig,t.passLoadCommands=r.passLoadCommands,t.getConfig=r.getConfig,t.loadConfig=e=>{o.broadcastLoadConfig(e,t)},t.loadCommands=e=>{o.broadCastLoadCommands(e,t)},t.do=e=>{o.broadcastDo(e,t)},t.doCommands=e=>{o.broadcastDoCommands(e,t)},t.passDo=i.passDo,t.passDoCommands=i.passDoCommands,t.undo=i.undo,t.redo=i.redo,t.clearHistory=i.clearHistory}function E(e,t){let n=this;n.init=()=>{n.setMode("one"),n.setDimensions(2),n.seeds=[0],n.setSeedRandom(!0)},n.setMode=t.addSender({name:"mode",currentValue:n.mode,action(t){n.mode=t,e.add(["mode"])}}).go,n.setDimensions=t.addSender({name:"dimensions",currentValue:n.dimensions,action(t){n.dimensions=t,e.add(["dimensions"])}}).go,n.setSeeds=t.addSenderForList({name:"seeds",action(t,r){n.seeds[t]=r,e.add(["seeds"])},props:{combineWithCurrentCommand:!0}}).go,n.setSeedRandom=t.addSender({name:"seedRandom",currentValue:n.seedRandom,action(t){n.seedRandom=t,e.add(["seedRandom"])}}).go,n.resultsPhaseBySeq={general:"general",closedPrimary:"general",nonpartisanOpenPrimary:"general"},n.setResultsPhase=(t,r)=>{n.resultsPhaseBySeq[t]=r,e.add(["resultsPhase"])},n.resultsPartyBySeq={general:void 0,closedPrimary:0,nonpartisanOpenPrimary:void 0},n.setResultsParty=(t,r)=>{n.resultsPartyBySeq[t]=r,e.add(["resultsParty"])},n.init()}function T(e,t,n){let r={usr:4,verbosity:2};this.update=()=>{(e.check(["mode"])||e.check(["numTracts"]))&&("one"===t.mode?1===n.numTracts?(r.verbosity=2,r.usr=4):(r.verbosity=1,r.usr=32):(r.verbosity=0,1===n.numTracts?r.usr=16:r.usr=32))},this.getOptions=()=>({...r})}function N(e,t,n){let r;let{seats:i,threshold:o,seatLimits:a}=t,{voteFractionsByCan:s}=e.candidateTallies,l=s.map(e=>e<o?0:e),c=Array(l.length);for(let e=0;e<l.length;e++)c[e]=0===l[e]?0:1;let h=c.reduce((e,t)=>e+t),u=0===h;if(void 0!==a&&c.map((e,t)=>e*a[t]).reduce((e,t)=>e+t)<i&&(u=!0),u&&(h=(c=(l=b(s)).map(e=>0===e?0:1)).reduce((e,t)=>e+t)),"Huntington-Hill"===n&&(h>i||0===h)){let e=[...l].sort((e,t)=>t-e)[i-1];return{allocation:s.map(t=>t>=e?1:0)}}"huntingtonHill"===n?r=(e,t)=>Math.sqrt(t*(t+1)):"sainteLague"===n?r=(e,t)=>t+.5:"dHondt"===n&&(r=(e,t)=>t+1);let d=Array(i).fill().map(r),p=[],f=[],m=0;for(let e=0;e<l.length;e++){let t=l[e];if(0===t)continue;let n=void 0===a?i:Math.min(a[e],i);for(let r=0;r<n;r++)p[m]=d[r]/t,f[m]=e,m+=1}let g=y(f.length).sort((e,t)=>p[e]-p[t]),v=Array(l.length).fill(0);for(let e=0;e<i;e++){let t=f[g[e]];v[t]+=1}return{allocation:v}}function D(e,t){return N(e,t,"sainteLague")}function O(e,t){let{voteFractionsByCan:n}=e.candidateTallies,{seats:r}=t,i=n.length;if(r>=i)return{allocation:Array(i).fill(1)};let o=y(i).sort((e,t)=>n[t]-n[e]),a=Array(i).fill(0);for(let e=0;e<r;e++)a[o[e]]=1;return{allocation:a}}const L=[{name:"Plurality",shortName:"Plurality",functionName:"plurality",voteCasterName:"plurality",socialChoiceType:"singleWinner",elect:function(e){let{voteFractionsByCan:t}=e.candidateTallies;return{iWinner:w(t)}}},{name:"Random Candidate",shortName:"Rand Cand",functionName:"randomCandidate",voteCasterName:"plurality",socialChoiceType:"singleWinner",elect:function(e){let{voteFractionsByCan:t}=e.candidateTallies;return{iWinner:Math.floor(Math.random()*t.length)}}},{name:"Huntington Hill",shortName:"Huntington",functionName:"huntingtonHill",voteCasterName:"plurality",socialChoiceType:"allocation",elect:function(e,t){return N(e,t,"huntingtonHill")}},{name:"Score",shortName:"Score",functionName:"score",voteCasterName:"score",socialChoiceType:"singleWinner",elect:function(e){let{scoreFractionAverageByCan:t}=e.candidateTallies;return{iWinner:t.indexOf(Math.max(...t))}}},{name:"Single Transferable Vote",shortName:"STV",functionName:"stv",voteCasterName:"ranking",socialChoiceType:"multiWinner",elect:function(e,t){let{firstPreferenceFractions:n}=e.candidateTallies,{voteFractions:r}=e.preferenceTallies,{cansByRankList:i}=e.preferenceLists,{seats:o}=t,a=n.length,s=r.length;if(o>=a)return{allocation:Array(a).fill(1)};let l=1/(o+1),c=!1,h=0,u=[],d=b(n),p=Array(a).fill(!0),f=y(a),m=Array(s).fill(0),g=Array(s).fill(1),x=Array(s).fill(!1);for(;!c&&h<a;){let e;if(0!==h){d=Array(a).fill(0);for(let e=0;e<i.length;e++){if(x[e])continue;let t=m[e],n=i[e][t];for(let t=0;t<n.length;t++){let i=n[t];d[i]+=r[e]*g[e]}}d=d.filter((e,t)=>p[t]),f=y(a).filter(e=>p[e])}let t=w(d),n=f[t],s=d[t],_=1;s>=l?(e=n,_=1-l/s,u.push(n),c=u.length===o):e=f[v(d)],p[e]=!1;for(let t=0;t<i.length;t++){if(x[t])continue;let n=m[t];if(i[t][n].includes(e)){1!==_&&(g[t]*=_);let e=!x[t];for(;e;){m[t]+=1;let n=m[t];if(n===a){x[t]=!0;break}let r=i[t][n];for(let t=0;t<r.length;t++){let n=r[t];e=e&&!p[n]}}}}h+=1}c||console.warn("warning: STV ran over - eliminated all candidates.");let _=Array(a).fill(0);for(let e=0;e<u.length;e++){let t=u[e];_[t]+=1}return{allocation:_}}},{name:"Minimax",shortName:"Minimax",functionName:"minimax",voteCasterName:"pairwise",socialChoiceType:"singleWinner",elect:function(e){let{winFractionPairwise:t}=e.pairwiseTallies,n=t.length,r=Array(n).fill(0),i=.5*n*(n-1),o=Array(n),a=Array(i),s=0;for(let e=0;e<n-1;e++)for(let i=e+1;i<n;i++){let n=t[e][i]-t[i][e];o[s]=Math.abs(n);let l=n<0;r[e]+=l?1:0,r[i]+=l?0:1,a[s]=l?e:i,s+=1}let l=y(i).sort((e,t)=>o[e]-o[t]),c=r.findIndex(e=>0===e),h=0;for(;-1===c;){let e=a[l[h]];r[e]-=1,c=r.findIndex(e=>0===e),h+=1}return{iWinner:c}}},{name:"Open List Proportional Representation",shortName:"OLPR A",functionName:"olprA",voteCasterName:"plurality",socialChoiceType:"multiWinner",elect:function(e,t){let{voteFractionsByCan:n}=e.candidateTallies,{parties:r}=e,{partiesByCan:i,numParties:o}=r,a=n.length,s=Array(o).fill(0),l=Array(o).fill(0);for(let e=0;e<a;e++){let t=i[e];s[t]+=n[e],l[t]+=1}let c={...t};c.seatLimits=l;let h=D({candidateTallies:{voteFractionsByCan:s},numCans:a},c).allocation,u=Array(a).fill(0);for(let e=0;e<o;e++){let t={seats:h[e]},r=y(a).filter(t=>i[t]===e),o=r.map(e=>n[e]),s=o.reduce((e,t)=>e+t,0),l=O({candidateTallies:{voteFractionsByCan:o.map(e=>e/s)},numCans:a},t).allocation;for(let e=0;e<r.length;e++)u[r[e]]=l[e]}return{allocation:u}}},{name:"d'Hondt",shortName:"d'Hondt",functionName:"dHondt",voteCasterName:"plurality",socialChoiceType:"allocation",elect:function(e,t){return N(e,t,"dHondt")}},{name:"Sainte-Lague",shortName:"Sainte-Lague",functionName:"sainteLague",voteCasterName:"plurality",socialChoiceType:"allocation",elect:D},{name:"Allocated Score",shortName:"AllocScore",functionName:"allocatedScore",voteCasterName:"scoreFull",socialChoiceType:"multiWinner",elect:function(e,t){let{voteFractions:n}=e.preferenceTallies,{scoreVotes:r}=e.preferenceLists,{seats:i}=t,o=r[0].length,a=r.length,s=1/i,l=Array(a).fill(1),c=Array(o).fill(0),h=0;for(let e=0;e<o&&!(h>=i);e++){let e=Array(o).fill(0);for(let t=0;t<o;t++)if(1!==c[t])for(let i=0;i<a;i++)e[t]+=l[i]*n[i]*r[i][t];let t=Math.max(...e),i=e.indexOf(t);c[i]=1,h+=1;let u=y(a).sort((e,t)=>r[t][i]-r[e][i]),d=0;for(let e=0;e<a;e++){let t=u[e];if(d+=r[t][i]*l[t]*n[e],l[t]=0,d>=s)break}}return{allocation:c}}},{name:"Method of Equal Shares",shortName:"MES",functionName:"methodOfEqualShares",voteCasterName:"scoreFull",socialChoiceType:"multiWinner",elect:function(e,t){let{voteFractions:n}=e.preferenceTallies,{scoreVotes:r}=e.preferenceLists,{seats:i}=t,o=r[0].length,a=r.length,s=1/i,l=Array(a).fill(1),c=Array(o).fill(0),h=[],u=[],d=0;for(let e=0;e<o&&!(d>=i);e++){let t=Array(o).fill(0);for(let e=0;e<o;e++)if(1!==c[e])for(let i=0;i<a;i++)t[e]+=n[i]*r[i][e];let p=y(o).sort((e,n)=>t[n]-t[e]),f=null,m=1/0;for(let e=0;e<o;e++){let i=p[e];if(1===c[i])continue;let o=s/t[i],h=!0;for(let e=0;e<a;e++){let t=r[e][i];if(l[e]<o*t){h=!1;break}}if(h&&o<m){m=o,f=i;break}let u=[],d=0,g=[];for(let e=0,t=0;e<a;e++){let o=l[e],a=r[e][i];u[e]=o/a,a>0&&(d+=o*n[e],g[t]=e,t+=1)}if(d+1e-4-s<0)continue;let y=g.sort((e,t)=>u[e]-u[t]),v=y.length,w=s,x=t[i],_=null;for(let e=0;e<v;e++){let t=y[e];if(w<x*(_=u[t]))break;w-=n[t]*l[t],x-=n[t]*r[t][i]}w>1e-4&&x>1e-4&&(_=w/x),_<m&&(f=i,m=_)}if(null===f){for(let e=0;e<o;e++){let t=p[e];if(1!==c[t]&&(c[t]=1,(d+=1)>=i))break}break}c[f]=1,d+=1,h[e]=f,u[e]=m;for(let e=0;e<a;e++){let t=m*r[e][f];l[e]=Math.max(0,l[e]-t)}}return{allocation:c,explanation:{winnersByRound:h,winnerMaxCostPerScoreByRound:u,socialChoiceOptions:t}}}},{name:"Random Voter",explain:"Random Voter: Pick a voter and their choice is the winning candidate.",shortName:"Rand Vote",functionName:"randomVoter",voteCasterName:"plurality",socialChoiceType:"singleWinner",elect:function(e){let{voteFractionsByCan:t}=e.candidateTallies;return{iWinner:g(f(t),Math.random)}}},{name:"Single Non-Transferable Vote",shortName:"SNTV",functionName:"sntv",voteCasterName:"plurality",socialChoiceType:"multiWinner",elect:O}],R={},B={};function F(e,t){let n={seats:1,threshold:.1};this.update=()=>{if(e.check(["socialChoiceMethod"])){let{socialChoiceType:e}=t;"allocation"===e?n.seats=5:"multiWinner"===e?n.seats=3:n.seats=1}},this.getOptions=()=>({...n})}function V(e,t,n,r){let i=this,o={socialChoiceMethod:"plurality",voteCasterName:"plurality",socialChoiceType:"singleWinner",socialChoiceOptions:{seats:1,threshold:.1}};i.socialChoiceOptionsMan=new F(n,o),i.setSocialChoiceMethod=r.addSender({name:`socialChoiceMethod-sequence-${e}-phase-${t}`,currentValue:o.socialChoiceMethod,action(e){o.socialChoiceMethod=e;let t=B[e];o.voteCasterName=t.voteCasterName,o.socialChoiceType=t.socialChoiceType,n.add(["socialChoiceMethod"])}}).go,i.init=()=>{i.setSocialChoiceMethod("plurality")},i.update=()=>{i.socialChoiceOptionsMan.update(),o.socialChoiceOptions=i.socialChoiceOptionsMan.getOptions()},i.getOptions=()=>{let e={...o};return e.socialChoiceOptions=i.socialChoiceOptionsMan.getOptions(),e}}function q(e,t){let n=this;n.sequences={general:{phases:{general:new V("general","general",e,t)}},closedPrimary:{phases:{closedPrimary:new V("closedPrimary","closedPrimary",e,t),general:new V("closedPrimary","general",e,t)}},nonpartisanOpenPrimary:{phases:{nonpartisanOpenPrimary:new V("nonpartisanOpenPrimary","nonpartisanOpenPrimary",e,t),general:new V("nonpartisanOpenPrimary","general",e,t)}}},n.finalPhaseBySequence={general:"general",closedPrimary:"general",nonpartisanOpenPrimary:"general"};let r=[];Object.keys(n.sequences).forEach(e=>{let{phases:t}=n.sequences[e];Object.keys(t).forEach(e=>{r.push(t[e])})});let i={};n.init=()=>{n.setSequenceName("general"),r.forEach(e=>{e.init()})},n.setSequenceName=t.addSender({name:"sequenceName",currentValue:i.sequenceName,action(t){i.sequenceName=t,e.add(["sequenceName"])}}).go,n.update=()=>{r.forEach(e=>{e.update()})},n.getOptions=()=>{let e={...i};return e.sequences={},Object.keys(n.sequences).forEach(t=>{e.sequences[t]={phases:{}};let{phases:r}=n.sequences[t];Object.keys(r).forEach(r=>{e.sequences[t].phases[r]=n.sequences[t].phases[r].getOptions()})}),e}}function G(e,t,n){let r=this,i={pollCount:5,numSampleCandidates:5};r.castOptionsMan=new T(e,t,i),r.sequenceOptionsMan=new q(e,n),r.init=()=>{r.sequenceOptionsMan.init(),r.setNumTracts(1),r.setNumDistricts(1)},r.setNumDistricts=n.addSender({name:"numDistricts",currentValue:i.numDistricts,action(t){i.numDistricts=t;let n=t>1,r=i.numTracts>1;i.useGeography=r||n,e.add(["numDistricts"])}}).go,r.setNumTracts=n.addSender({name:"numTracts",currentValue:i.numTracts,action(t){i.numTracts=t;let n=t>1,r=i.numDistricts>1;i.useGeography=n||r,e.add(["numTracts"])}}).go,r.update=()=>{if(r.castOptionsMan.update(),r.sequenceOptionsMan.update(),e.check(["socialChoiceMethod"])){let e=r.sequenceOptionsMan.getOptions(),{sequenceName:t}=e,{finalPhaseBySequence:n}=r.sequenceOptionsMan,o=n[t],{socialChoiceType:a}=e.sequences[t].phases[o];"allocation"===a?i.numSampleCandidates=10:"multiWinner"===a?i.numSampleCandidates=10:i.numSampleCandidates=5}},r.getOptions=()=>{let e={...i};return e.castOptions=r.castOptionsMan.getOptions(),e.sequenceOptions=r.sequenceOptionsMan.getOptions(),e},r.init()}function I(){let e=[],t=0;this.new=function(n){e.push(n);let r=t;return t+=1,r},this.num=()=>t,this.get=t=>e[t],this.getList=()=>e}function j(e,t,n,r,i,o,a,s){let l=this;function c(e){l.strategyRules=e,o.add(["voters","strategyRules"])}l.shape1={},l.shape2={},l.color="#88888888",l.strategyRules=n,l.shape1.densityMax=1,l.shape2.densityMax=1,l.setAction={exists(e){l.exists=e,o.add(["voters","draggables"])},shape2p(e){l.shape2.x=e.x,l.shape2.y=e.y,o.add(["voters","draggables"])},shape1x(e){l.shape1.x=e,o.add(["voters","draggables"])},shape2w(e){l.shape2.w=e,o.add(["voters","width"])},shape1w(e){l.shape1.w=e,o.add(["voters","width"])},shape1densityProfile(e){l.shape1.densityProfile=e,o.add(["voters","densityProfile"])},shape2densityProfile(e){l.shape2.densityProfile=e,o.add(["voters","densityProfile"])},strategy(e){c(e)},actionOptionThreshold(e){c(e)},actionWeight(e){c(e)},party(e){l.party=e,o.add(["party"])}};let h=r.new(l);l.doSetCommand={},Object.keys(l.setAction).forEach(e=>{l.doSetCommand[e]=t=>{let n=s[e].getCurrentValue(h);s[e].go(h,t,n)}});let u={x:e.x,y:e.y},d=[s.exists.command(h,1,0),s.shape2p.command(h,u,u),s.shape1x.command(h,t.x,t.x),s.shape2w.command(h,e.w,e.w),s.shape1w.command(h,t.w,t.w),s.shape1densityProfile.command(h,t.densityProfile,t.densityProfile),s.shape2densityProfile.command(h,e.densityProfile,e.densityProfile),s.strategy.command(h,l.strategyRules,l.strategyRules),s.party.command(h,[h],[h])];a?i.loadCommands(d):i.doCommands(d)}function W(e,t,n,r,i){let o=this;i.forEach(i=>(function(i,a,s){o[i]=t.addSenderForList({action:(t,r)=>{n.setNumberEntities(t+1),e.get(t).setAction[i](r)},name:`${r}-${a}`,props:{isChain:s}})})(...i))}function $(e,t){return 1===t?e.map(e=>e.shape1.x):e.map(e=>[e.shape2.x,e.shape2.y])}function U(e,t,n){let r=this,i=[];r.attachNewE=e=>{i.push(e)};let o=e=>{i.forEach(t=>t.updateNewE(e))};r.addEntity=e=>{o(e);let t=n.num();r.setNumberEntities(t)},r.addEntityPressed=()=>{let e=n.num()+1;r.setNumberEntities(e)},r.setNumberEntities=e.addSender({currentValue:0,name:`${t}-setNumberAtLeast`,props:{isFirstAction:!0},action:e=>{for(;n.num()<e;)r.addDefaultEntity()}}).load,r.getEntities=()=>n.getList().filter(e=>e.exists),r.getGeoms=e=>{var t;return t=r.getEntities(),1===e?t.map(e=>e.shape1):t.map(e=>e.shape2)},r.getPoints=e=>$(r.getEntities(),e)}L.forEach(e=>{R[e.functionName]=e.elect,B[e.functionName]=e});var z=[{condition:{voteCasterName:"score"},strategy:[{actionName:"normalize",actionWeight:1,actionOptions:{threshold:{type:"step",mean:.5,radius:.1}}},{actionName:"normalizeOverFrontrunners",actionWeight:0,actionOptions:{threshold:{type:"step",mean:.5,radius:.1}}}]},{condition:{voteCasterName:"plurality"},strategy:[{actionName:"closest",actionWeight:1,actionOptions:{threshold:{type:"step",mean:.5,radius:.1}}},{actionName:"lesserEvil",actionWeight:0,actionOptions:{threshold:{type:"step",mean:.5,radius:.1}}}]},{condition:{voteCasterName:"ranking"},strategy:[{actionName:"closest",actionWeight:1,actionOptions:{}}]},{condition:{voteCasterName:"pairwise"},strategy:[{actionName:"closest",actionWeight:1,actionOptions:{}}]},{condition:{voteCasterName:"scoreFull"},strategy:[{actionName:"normalize",actionWeight:1,actionOptions:{}}]}];function H(e,t){let n=this,r="voters",i=new I;U.call(n,t,r,i);let o=new W(i,t,n,r,[["exists","exists",!1],["shape2p","shape2D-point",!0],["shape1x","shape1D-x",!0],["shape2w","shape2D-width",!0],["shape1w","shape1D-width",!0],["shape1densityProfile","shape1D-densityProfile",!1],["shape2densityProfile","shape2D-densityProfile",!1],["actionWeight","strategyRules",!0],["strategy","strategyRules",!1],["actionOptionThreshold","strategyRules",!0],["party","party",!1]]);n.addVoterCircle=({shape2:r,shape1:a,strategyRules:s,doLoad:l})=>{let c=new j(r,a,s,i,t,e,l,o);n.addEntity(c)},n.addDefaultEntity=()=>{n.addVoterCircle({shape2:{x:50,y:50,w:200,densityProfile:"step",densityMax:1},shape1:{x:50,w:200,densityProfile:"gaussian",densityMax:1},strategyRules:z,doLoad:!1})},n.getVoterStrategyListByPhase=e=>{let{sequenceName:t,sequences:r}=e,{phases:i}=r[t],o={};return Object.keys(i).forEach(e=>{let{voteCasterName:t}=i[e],r=function(e,t){let r=[],i=n.getEntities();for(let n=0;n<i.length;n+=1){let o=X(i[n].strategyRules,e,t),a=f(m(o.map(e=>e.actionWeight)));r.push({strategy:o,strategyCDF:a})}return r}(t,e);o[e]=r}),o},n.getParties=()=>n.getEntities().map(e=>e.party[0])}function X(e,t,n){for(let r=0;r<e.length;r+=1){let i=e[r];if((void 0===i.condition.phaseName||i.condition.phaseName===n)&&(void 0===i.condition.voteCasterName||i.condition.voteCasterName===t))return i.strategy}}const Y=Math.round;function J(e,t,n,r,i,o,a,s,l){s.save(),s.globalAlpha=a,s.textAlign=l||"center",s.font=`${r}px Sans-serif`,s.lineWidth=i,s.fillStyle=o,s.fillText(e,t,n),s.restore()}function K(e){return void 0===e?"":(100*e).toFixed(0)}function Z(e,t,n,r,i,o,a,s){let l=this;l.shape1={},l.shape2={},l.setAction={exists(e){l.exists=e,o.add(["draggables"])},shape2p(e){l.shape2.x=e.x,l.shape2.y=e.y,o.add(["draggables"])},shape1x(e){l.shape1.x=e,o.add(["draggables"])},color(e){l.color=e,l.colorRGBA=function(e){let t=e.length,n=[,,,,].fill();if("rgb"===e.slice(0,3).toLowerCase()){let t=e.replace(" ","").split(",");n[0]=parseInt(t[0].slice("a"===t[3].toLowerCase()?5:4),10),n[1]=parseInt(t[1],10),n[2]=parseInt(t[2],10),n[3]=t[3]?parseFloat(t[3]):-1}else{let r;r=t<6?parseInt(String(e[1])+e[1]+e[2]+e[2]+e[3]+e[3]+(t>4?String(e[4])+e[4]:""),16):parseInt(e.slice(1),16),n[0]=r>>16&255,n[1]=r>>8&255,n[2]=255&r,n[3]=9===t||5===t?Y((r>>24&255)/255*1e4)/1e4:-1}return n}(e),o.add(["color"])},party(e){l.party=e,o.add(["party"])}};let c=r.new(l);l.doSetCommand={},Object.keys(l.setAction).forEach(e=>{l.doSetCommand[e]=t=>{let n=s[e].getCurrentValue(c);s[e].go(c,t,n)}});let h={x:e.x,y:e.y},u=[s.exists.command(c,1,0),s.shape2p.command(c,h,h),s.shape1x.command(c,t.x,t.x),s.color.command(c,n,n),s.party.command(c,[c],[c])];a?i.loadCommands(u):i.doCommands(u)}function Q(e,t){let n=this,r="candidates",i=new I;U.call(n,t,r,i);let o=new W(i,t,n,r,[["exists","exists",!1],["shape2p","shape2D-point",!0],["shape1x","shape1D-x",!0],["color","color",!1],["party","party",!1]]);n.addCandidate=({shape2:r,shape1:a,color:s,doLoad:l})=>{let c=new Z(r,a,s,i,t,e,l,o);n.addEntity(c)},n.addDefaultEntity=()=>{n.addCandidate({shape2:{x:50,y:50},shape1:{x:50},color:"#e0e020",doLoad:!1})},n.getParties=()=>({partiesByCan:n.getEntities().map(e=>e.party[0]),numParties:10}),n.getRGBAList=()=>n.getEntities().map(e=>e.colorRGBA)}function ee(e,t,n,r,i,o,a){let s=this;s.shape2={},s.shape1={},s.color="#ccc",s.darkModeColor="#333",s.setAction={exists(e){s.exists=e,i.add(["draggables"])},shape2p(e){s.shape2.x=e.x,s.shape2.y=e.y,i.add(["draggables"])},shape1x(e){s.shape1.x=e,i.add(["draggables"])},shape2w(e){s.shape2.w=e,i.add(["width"])},shape1w(e){s.shape1.w=e,i.add(["width"])},shape1densityProfile(e){s.shape1.densityProfile=e,i.add(["densityProfile"])},shape2densityProfile(e){s.shape2.densityProfile=e,i.add(["densityProfile"])},party(e){s.party=e,i.add(["party"])}};let l=n.new(s);s.doSetCommand={},Object.keys(s.setAction).forEach(e=>{s.doSetCommand[e]=t=>{let n=a[e].getCurrentValue(l);a[e].go(l,t,n)}});let c={x:e.x,y:e.y},h=[a.exists.command(l,1,0),a.shape2p.command(l,c,c),a.shape1x.command(l,t.x,t.x),a.shape2w.command(l,e.w,e.w),a.shape1w.command(l,t.w,t.w),a.shape1densityProfile.command(l,t.densityProfile,t.densityProfile),a.shape2densityProfile.command(l,e.densityProfile,e.densityProfile),a.party.command(l,[l],[l])];o?r.loadCommands(h):r.doCommands(h)}function et(e,t){let n=this,r="candidateDns",i=new I;U.call(n,t,r,i);let o=new W(i,t,n,r,[["exists","exists",!1],["shape2p","shape2D-point",!0],["shape1x","shape1D-x",!0],["shape2w","shape2D-width",!0],["shape1w","shape1D-width",!0],["shape1densityProfile","shape1D-densityProfile",!1],["shape2densityProfile","shape2D-densityProfile",!1],["party","party",!1]]);n.addCandidateDistribution=({shape2:r,shape1:a,doLoad:s})=>{let l=new ee(r,a,i,t,e,s,o);n.addEntity(l)},n.addDefaultEntity=()=>{n.addCandidateDistribution({shape2:{x:50,y:50,w:200,densityProfile:"step"},shape1:{x:50,w:200,densityProfile:"gaussian"},doLoad:!1})},n.getParties=()=>({partiesByCan:n.getEntities().map(e=>e.party[0]),numParties:10})}function en(e,t){this.candidateList=new Q(e,t,this),this.voterShapeList=new H(e,t,this),this.candidateDnList=new et(e,t,this)}function er(e){let t={};return Object.keys(e).forEach(n=>{let r=e[n].some(e=>e.strategy.some(e=>"closest"!==e.actionName&&0!==e.actionWeight));t[n]=r}),t}var ei={},eo=c("cmoHh"),ea=c("euRi5"),es=c("hDsEw"),el=c("3J2Zm"),ec=c("6Px8M"),eh=c("lDm0S"),eu={};function ed(e,t){let{canPoints:n,canBorders:r}=t,i=r.voronoiIntervals1D,o="gaussian"===e.densityProfile?ef:ep,a=n.length,s=Array(a),l=0;for(let t=0;t<a;t++){let n=o(e,i[t]);s[t]=n,l+=n}return{countByCan:s,totalVotes:l}}function ep(e,t){let{lower:n,upper:r}=t,{x:i,w:o,densityMax:a}=e,s=.5*o,l=Math.max(n,i-s);return Math.max(0,Math.min(r,i+s)-l)*a}function ef(e,t){let{lower:n,upper:r}=t,{x:i,w:o,densityMax:a}=e,s=o/Math.sqrt(2*Math.PI);return o*(p(r,i,s)-p(n,i,s))*a}function em(e,t){let n=t.canBorders.voronoiLines2D,{densityMax:r}=e,i=n.length,o=Array(i),a=0;for(let t=0;t<i;t++){let i=function(e,t){let n=0,r=e.x,i=e.y,{w:o}=e,a=.5*o;for(let e=r-a;e<r+a;e+=2){let o;let s=a**2-(e-r)**2,l=i+(o=s>0?Math.sqrt(s):0),c=i-o;for(let n=0;n<t.length;n++){let[r,i,o]=t[n];if(0===i)r*e<-o||(c=1/0);else{let t=-(o+r*e)/i;i<0?c=Math.max(c,t):l=Math.min(l,t)}}let h=l-c;h>0&&(n+=2*h)}return n}(e,n[t])*r;o[t]=i,a+=i}return{countByCan:o,totalVotes:a}}function eg(e,t,n,r,i,o,a){let s=1===n?ey:ev,l=e.length,c=Array(l);for(let n=0;n<l;n++)c[n]=s(e[n],t);let h=function(e,t,n,r){if(void 0===n)return v(e);let{strategyCDF:i,strategy:o}=n,{actionName:a,actionOptions:s}=o[g(i,r[0])];if("lesserEvil"!==a)return v(e);let{mean:l,radius:c}=s.threshold,h=r[1](),{voteFractionsByCan:u,highestScore:d}=t.polling;if(void 0===d)return v(e);let p=(l+c*(2*h-1))*d,f=y(e.length).filter(e=>u[e]>=p),m=e.filter((e,t)=>u[t]>=p);return m.length<=1?v(e):f[v(m)]}(c,i,o,a);if(r<2)return{pluralityVote:h};let u=Array(l).fill(0);return u[h]=1,{pluralityAllocation:u,pluralityVote:h}}function ey(e,t){return(e-t)**2}function ev(e,t){return(e[0]-t[0])**2+(e[1]-t[1])**2}function ew(e){let{gridX:t,voterPoints:n,gridPointLength:r}=function(e){let t="gaussian"===e.densityProfile,n=Math.round(e.w*(t?2:1)),r=Array(n),i=Array(n);for(let t=0;t<n;t++){let o=t+.5-.5*n+e.x;r[t]=o,i[t]=o}return{gridX:r,voterPoints:i,gridPointLength:1}}(e),{density:i,voteCounts:o,totalVotes:a}=function(e,t,n){let{x:r,w:i,densityProfile:o,densityMax:a}=e,s=Array(t.length),l=Array(t.length);if("gaussian"!==o){s.fill(a),l.fill(a);let e=l.length*a;return{density:s,voteCounts:l,totalVotes:e}}let c=i/Math.sqrt(2*Math.PI),h=1/d(0,0,c),u=0;for(let e=0;e<t.length;e++){let i=d(t[e],r,c)*h*a;s[e]=i;let o=i*n;l[e]=o,u+=o}return{density:s,voteCounts:l,totalVotes:u}}(e,t,r);return{x:t,density:i,voterPoints:n,voteCounts:o,totalVotes:a,voterGeom:e}}function ex(e,t){let{x:n,y:r,w:i,densityProfile:o}=e,a="gaussian"===o,s=i*(a?2:1),{usr:l}=t,c=Math.round(s/l),h=y(c),u=y(c),p=h.map(e=>(e+.5)*l-.5*s+n),f=u.map(e=>(e+.5)*l-.5*s+r),m=h.length,g=u.length,v=m*g,w=Array(v),x=Array(v),_=Array(v),b=0;for(let e=0;e<u.length;e++)for(let t=0;t<h.length;t++){let n=p[t],r=f[e];w[b]=n,x[b]=r,_[b]=[n,r],b+=1}let{density:C,voteCounts:S,totalVotes:P}=(a?function(e,t,n,r){let{x:i,y:o,w:a,densityMax:s}=e,l=a*e_,c=(1/d(0,0,l))**2,h=t.length,u=Array(h),p=Array(h),f=0;for(let e=0;e<h;e++){let a=t[e],h=n[e],m=d(a,i,l)*d(h,o,l)*c*s;u[e]=m;let g=m*r;p[e]=g,f+=g}return{density:u,voteCounts:p,totalVotes:f}}:function(e,t,n,r){let{x:i,y:o,w:a,densityMax:s}=e,l=t.length,c=Array(l).fill(0),h=Array(l).fill(0),u=0;for(let e=0;e<l;e++)if((t[e]-i)**2+(n[e]-o)**2<(.5*a)**2){c[e]=s;let t=r*s;h[e]=t,u+=t}return{density:c,voteCounts:h,totalVotes:u}})(e,w,x,l*l);return{x:w,y:x,nx:m,ny:g,width:s,voterPoints:_,density:C,voteCounts:S,totalVotes:P,voterGeom:e}}!function(e,t,n){var r,i="random",o=n.pow(256,6),a=n.pow(2,52),s=2*a;function l(l,c,f){var m=[],g=d(function e(t,n){var r,i=[],o=typeof t;if(n&&"object"==o)for(r in t)try{i.push(e(t[r],n-1))}catch(e){}return i.length?i:"string"==o?t:t+"\0"}((c=!0==c?{entropy:!0}:c||{}).entropy?[l,p(t)]:null==l?function(){try{var n;return r&&(n=r.randomBytes)?n=n(256):(n=new Uint8Array(256),(e.crypto||e.msCrypto).getRandomValues(n)),p(n)}catch(n){var i=e.navigator,o=i&&i.plugins;return[+new Date,e,o,e.screen,p(t)]}}():l,3),m),y=new h(m),v=function(){for(var e=y.g(6),t=o,n=0;e<a;)e=(e+n)*256,t*=256,n=y.g(1);for(;e>=s;)e/=2,t/=2,n>>>=1;return(e+n)/t};return v.int32=function(){return 0|y.g(4)},v.quick=function(){return y.g(4)/4294967296},v.double=v,d(p(y.S),t),(c.pass||f||function(e,t,r,o){return(o&&(o.S&&u(o,y),e.state=function(){return u(y,{})}),r)?(n[i]=e,t):e})(v,g,"global"in c?c.global:this==n,c.state)}function h(e){var t,n=e.length,r=this,i=0,o=r.i=r.j=0,a=r.S=[];for(n||(e=[n++]);i<256;)a[i]=i++;for(i=0;i<256;i++)a[i]=a[o=255&o+e[i%n]+(t=a[i])],a[o]=t;(r.g=function(e){for(var t,n=0,i=r.i,o=r.j,a=r.S;e--;)t=a[i=255&i+1],n=256*n+a[255&(a[i]=a[o=255&o+t])+(a[o]=t)];return r.i=i,r.j=o,n})(256)}function u(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function d(e,t){for(var n,r=e+"",i=0;i<r.length;)t[255&i]=255&(n^=19*t[255&i])+r.charCodeAt(i++);return p(t)}function p(e){return String.fromCharCode.apply(0,e)}if(d(n.random(),t),eu){eu=l;try{r=c("kjyEk")}catch(e){}}else"function"==typeof define&&define.amd?define(function(){return l}):n["seed"+i]=l}("undefined"!=typeof self?self:eu,[],Math),eu.alea=eo,eu.xor128=ea,eu.xorwow=es,eu.xorshift7=el,eu.xor4096=ec,eu.tychei=eh,ei=eu;const e_=1/Math.sqrt(8);function eb(e,t,n,r,i){let{canPoints:o,dimensions:a,information:s}=t,{verbosity:l}=n,c=(1===a?ew:ex)(e,n),h=Array(o.length).fill(0),u=0,d=c.x.length,p=Array(d);for(let e=0;e<d;e++){let t=c.voteCounts[e],n=eg(o,c.voterPoints[e],a,l,s,i,r),{pluralityVote:d}=n;h[d]+=t,u+=t,l<2||(p[e]=n)}return l<2?{countByCan:h,totalVotes:u}:{grid:c,voteSet:p,countByCan:h,totalVotes:u}}function eC(e,t,n,r,i,o,a){let s=1===n?eS:eP,l=e.length,c=Array(l);for(let n=0;n<l;n++)c[n]=s(e[n],t);let[h,u]=function(e,t,n,r){if(void 0===n)return x(e);let{strategyCDF:i,strategy:o}=n,{actionName:a,actionOptions:s}=o[g(i,r[0])];if("normalizeOverFrontrunners"!==a)return x(e);let{mean:l,radius:c}=s.threshold,h=r[1](),{scoreFractionAverageByCan:u,highestScore:d}=t.polling;if(void 0===d)return x(e);let p=(l+c*(2*h-1))*d,f=e.filter((e,t)=>u[t]>=p);return f.length<=1?x(e):x(f)}(c,i,o,a),d=Array(l).fill(0);for(let e=0;e<l;e++){let t=c[e];if(t<=h)d[e]=1;else if(t>=u)d[e]=0;else{let n=(t-h)/(u-h);d[e]=0+1*(1-n)}}return{scoreVote:d}}function eS(e,t){return Math.abs(e-t)}function eP(e,t){return Math.sqrt((e[0]-t[0])**2+(e[1]-t[1])**2)}function ek(e,t,n,r){let i=1===n?eM:eA,o=e.length,a=Array(o);for(let n=0;n<o;n++)a[n]=i(e[n],t);let s=y(o).sort((e,t)=>a[e]-a[t]),l=Array(o);for(let e=0;e<o;e++){let t=s[e];l[e]=[t]}if(0===r)return{cansByRank:l};let c=Array(o),h=Array(o),u=Array(o);for(let e=0;e<o;e++){let t=s[e];c[t]=e+1,h[t]=o-e-1,u[t]=(o-e-1)/(o-1)}let d=Array(o);for(let e=0;e<o;e++){d[e]=Array(o).fill(0);for(let t=0;t<o;t++)a[e]!==a[t]&&(d[e][t]=a[e]<a[t]?1:-1)}return{cansByRank:l,ranking:c,netWinsPairwise:d,bordaFractions:u,bordaScores:h}}function eM(e,t){return(e-t)**2}function eA(e,t){return(e[0]-t[0])**2+(e[1]-t[1])**2}function eE(e,t,n){let r,i,o;let{canPoints:a,dimensions:s}=t,{verbosity:l}=n,c=(1===s?ew:ex)(e,n),{voteCounts:h,totalVotes:u,voterPoints:d}=c,p=a.length,f=Array(p);l>=2&&(r=Array(p).fill(0),i=Array(p),o=Array(h.length));for(let e=0;e<h.length;e++){let t=h[e],n=ek(a,d[e],s,l);if(f[e]=n.cansByRank,l<2)continue;o[e]=n,i[e]=n.ranking;let{bordaScores:c}=n;for(let e=0;e<p;e++)r[e]+=c[e]*t}if(l<2)return{voteCounts:h,totalVotes:u,cansByRankList:f};let m=r.map(e=>e/(p-1)/u);return{grid:c,voteSet:o,voteCounts:h,totalVotes:u,bordaFractionAverageByCan:m,rankings:i,cansByRankList:f}}function eT(e,t,n){let{intervalBorders:r,rankings:i,cansByRankList:o}=t.canBorders.rankingIntervals1D,{verbosity:a}=n,s=r.length-1,l=Array(s),c=0;for(let t=0;t<s;t++){var h,u;let n=(h=r[t],u=r[t+1],"gaussian"===e.densityProfile?ef(e,{lower:h,upper:u}):ep(e,{lower:h,upper:u}));l[t]=n,c+=n}return a<2?{voteCounts:l,totalVotes:c,cansByRankList:o}:{voteCounts:l,totalVotes:c,cansByRankList:o,rankings:i,intervalBorders:r}}function eN(e){for(var t,n=-1,r=e.length,i=e[r-1],o=0;++n<r;)t=i,i=e[n],o+=t[1]*i[0]-t[0]*i[1];return o/2}function eD(e,t){let[n,r]=e,[i,o]=t,a=i-n,s=o-r;return[a,s,-((n+i)*.5*a+(r+o)*.5*s)]}function eO(e,t){return(e[0]*t[0]+e[1]*t[1]+e[2])/Math.sqrt(e[0]**2+e[1]**2)}function eL(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]<0}function eR(e,t,n){let r;let i=[function(e){let{x:t,y:n,w:r}=e,i=r/2,o=Array(100);for(let e=0;e<100;e++){let r=2*Math.PI*(e/99),a=t+i*Math.cos(r),s=n+i*Math.sin(r);o[e]=[a,s]}return o}(e)],o=t.length,a=[Array(o).fill(0)];for(let e=0;e<o-1;e++)for(let n=e+1;n<o;n++){let r=i.length,o=Array(r),s=Array(r),l=0;for(let c=0;c<r;c++){let r=function(e,t){let n=e.length,r=[],i=[],o=0,a=0,s=e[n-1],l=eL(t,s);for(let c=0;c<n;c++){let n=e[c],h=eL(t,n);if(l&&!h||!l&&h){let e=eO(t,s),l=eO(t,n),c=function(e,t,n,r){let i=-r/(n-r);return i<0&&(i=0),i>1&&(i=1),[i*e[0]+(1-i)*t[0],i*e[1]+(1-i)*t[1]]}(s,n,e,l);r[o]=c,i[a]=c,o+=1,a+=1}h?(i[a]=n,a+=1):(r[o]=n,o+=1),s=n,l=h}return{positive:r,negative:i}}(i[c],eD(t[e],t[n])),h=r.positive;void 0!==h&&h.length>2&&(o[l]=h,s[l]=b(a[c]),s[l][n]+=1,l+=1);let u=r.negative;void 0!==u&&u.length>2&&(o[l]=u,s[l]=b(a[c]),s[l][e]+=1,l+=1)}i=o,a=s}let s=i.length,l=Array(s);if(n>=2){r=Array(s);for(let e=0;e<s;e++)r[e]=Array(o)}for(let e=0;e<s;e++){l[e]=Array(o);for(let t=0;t<o;t++)l[e][t]=[];for(let t=0;t<o;t++){let i=o-a[e][t];l[e][i-1].push(t),n<2||(r[e][t]=i)}}return n<2?{cells:i,cansByRankList:l}:{cells:i,rankings:r,cansByRankList:l}}function eB(e,t,n){let{canPoints:r}=t,{verbosity:i}=n,{densityMax:o}=e,{cells:a,rankings:s,cansByRankList:l}=eR(e,r,i),c=a.length,h=Array(c),u=Array(c),d=0;for(let e=0;e<c;e++){let t=-eN(a[e]);h[e]=t;let n=t*o;u[e]=n,d+=n}return(l=l.filter((e,t)=>Math.abs(h[t])>1e-6),u=u.filter((e,t)=>Math.abs(h[t])>1e-6),i<2)?{voteCounts:u,totalVotes:d,cansByRankList:l}:{voteCounts:u,totalVotes:d,cansByRankList:l,rankings:s=s.filter((e,t)=>Math.abs(h[t])>1e-6),cells:a=a.filter((e,t)=>Math.abs(h[t])>1e-6)}}function eF(e,t){let{canPoints:n}=t,r=Math.PI*(e.w/2)**2,i=n.length,o=Array(i).fill(0);for(let e=0;e<i;e++)o[e]=Array(i).fill(0);for(let t=0;t<i-1;t++)for(let s=t+1;s<i;s++){var a;let i=function(e,t,n){let r=t.w/2;if(e>r)return 0;if(e<-r)return n;let i=e/r;return r**2*(Math.acos(i)-i*Math.sqrt(1-i**2))}(((a=eD(n[t],n[s]))[0]*e.x+a[1]*e.y+a[2])/Math.sqrt(a[0]**2+a[1]**2),e,r),l=r-i;o[t][s]=i,o[s][t]=l}return{winsPairwise:o,totalVotes:r}}function eV(e,t){let{canPoints:n,canBorders:r}=t,{midpoints:i,iLower:o}=r.pairwiseIntervals1D,a=n.length,s=eq(-1/0,1/0,e),l=Array(a).fill(0);for(let e=0;e<a;e++)l[e]=Array(a).fill(0);for(let t=0;t<a-1;t++)for(let n=t+1;n<a;n++){let r=eq(-1/0,i[t][n],e),a=o[t][n]?r:s-r,c=s-a;l[t][n]=a,l[n][t]=c}return{winsPairwise:l,totalVotes:s}}function eq(e,t,n){return"gaussian"===n.densityProfile?ef(n,{lower:e,upper:t}):ep(n,{lower:e,upper:t})}function eG(e,t,n,r){let i=1===n?eI:ej,o=e.length,a=Array(o);for(let n=0;n<o;n++)a[n]=i(e[n],t);let s=Array(o);for(let e=0;e<o;e++){s[e]=Array(o).fill(0);for(let t=0;t<o;t++)a[e]!==a[t]&&(s[e][t]=a[e]<a[t]?1:-1)}if(0===r)return{netWinsPairwise:s};let l=y(o).sort((e,t)=>a[e]-a[t]),c=Array(o),h=Array(o),u=Array(o),d=Array(o);for(let e=0;e<o;e++){let t=l[e];c[t]=e+1,h[t]=o-e-1,u[t]=(o-e-1)/(o-1),d[e]=[t]}return{cansByRank:d,ranking:c,netWinsPairwise:s,bordaFractions:u,bordaScores:h}}function eI(e,t){return(e-t)**2}function ej(e,t){return(e[0]-t[0])**2+(e[1]-t[1])**2}function eW(e,t,n){let r,i;let{canPoints:o,dimensions:a}=t,{verbosity:s}=n,l=(1===a?ew:ex)(e,n),{voteCounts:c,totalVotes:h,voterPoints:u}=l,d=c.length,p=o.length,f=Array(p);for(let e=0;e<p;e++)f[e]=Array(p).fill(0);s>=1&&(r=Array(p).fill(0)),s>=2&&(i=Array(d));for(let e=0;e<d;e++){let t=c[e],n=eG(o,u[e],a),{netWinsPairwise:l}=n;for(let n=0;n<p;n++)for(let r=0;r<p;r++)e!==r&&(f[n][r]+=l[n][r]*t);if(s<1)continue;let{bordaScores:h}=n;for(let e=0;e<p;e++)r[e]+=h[e]*t;s<2||(i[e]=n)}let m=f.map(e=>e.map(e=>(e+h)*.5));if(s<1)return{voteCounts:c,totalVotes:h,winsPairwise:m};let g=r.map(e=>e/(p-1)/h);return{grid:l,voteSet:i,winsPairwise:m,totalVotes:h,bordaFractionAverageByCan:g}}function e$(e){let t=e.length,n=y(t).sort((t,n)=>e[t]-e[n]),r=.5*t*(t-1),i=Array(r),o=Array(r),a=0;for(let r=0;r<t-1;r++)for(let s=r+1;s<t;s++){let t=n[r],l=n[s],c=(e[t]+e[l])*.5;i[a]=c,o[a]=[t,l],a+=1}let s=y(r).sort((e,t)=>i[e]-i[t]),l=s.map(e=>i[e]),c=s.map(e=>o[e]),h=Array(t);for(let e=0;e<t;e++)h[n[e]]=e+1;let u=Array(r+1);u[0]=b(h);for(let e=0;e<r;e++){let[t,n]=c[e];h[t]+=1,h[n]-=1,u[e+1]=b(h)}let d=Array(r+1);for(let e=0;e<r+1;e++){d[e]=Array(t);for(let n=0;n<t;n++)d[e][n]=[];let n=u[e];for(let r=0;r<t;r++){let t=n[r];d[e][t-1].push(r)}}let p=b(l);return p.unshift(-1/0),p.push(1/0),{intervalBorders:p,rankings:u,cansByRankList:d}}const eU={plurality:{cast:function(e,t){let{canPoints:n,voterGeoms:r,dimensions:i,parties:a,strategySeed:s,voterStrategyList:l}=e,{verbosity:c}=t,h=r.some(e=>"gaussian"===e.densityProfile)&&2===i,u=l.some(e=>e.strategy.some(e=>"closest"!==e.actionName&&0!==e.actionWeight)),d=h||u?eb:1===i?ed:em,p=n.length,f=[],m=Array(p).fill(0),g=0,y=[o(ei)(`green${s}`),o(ei)(`orange${s}`)];for(let n=0;n<r.length;n++){let i=d(r[n],e,t,y,l[n]),{countByCan:o,totalVotes:a}=i;for(let e=0;e<p;e++)m[e]+=o[e];g+=a,c<2||(f[n]=i)}let v={candidateTallies:{voteFractionsByCan:m.map(e=>e/g)},parties:a,numCans:n.length};return c<2||(v.votesByGeom=f),v},castPoint:eg,makeCanBorders:function(e,t,n){return t.some(e=>"gaussian"===e.densityProfile)&&2===n?{}:1===n?{voronoiIntervals1D:function(e){let t=e.length,n=y(t).sort((t,n)=>e[t]-e[n]),r=Array(t-1);for(let i=0;i<t-1;i++)r[i]=(e[n[i]]+e[n[i+1]])*.5;let i=Array(t);for(let e=0;e<t;e++){let o=0===e?-1/0:r[e-1],a=e===t-1?1/0:r[e];i[n[e]]={lower:o,upper:a}}return i}(e)}:{voronoiLines2D:function(e){let t=e.length,n=Array(t);for(let r=0;r<t;r++){n[r]=[];for(let i=0;i<t;i++){if(r===i)continue;let t=e[r],o=e[i];n[r].push(eD(t,o))}}return n}(e)}}},score:{cast:function(e,t){let{canPoints:n,voterGeoms:r,parties:i,strategySeed:a,voterStrategyList:s}=e,{verbosity:l}=t,c=n.length,h=[],u=Array(c).fill(0),d=0,p=[o(ei)(`green${a}`),o(ei)(`orange${a}`)];for(let n=0;n<r.length;n++){let i=function(e,t,n,r,i){let{canPoints:o,dimensions:a,information:s}=t,{verbosity:l}=n,c=(1===a?ew:ex)(e,n),{voteCounts:h,totalVotes:u,voterPoints:d}=c,p=o.length,f=Array(p).fill(0),m=c.x.length,g=Array(m);for(let e=0;e<m;e++){let t=h[e],n=eC(o,d[e],a,l,s,i,r);g[e]=n;let{scoreVote:c}=n;for(let e=0;e<p;e++)f[e]+=c[e]*t}return l<2?{scoreSumByCan:f,totalVotes:u}:{grid:c,voteSet:g,scoreSumByCan:f,totalVotes:u,voterGeom:e}}(r[n],e,t,p,s[n]);h[n]=i;let{totalVotes:o,scoreSumByCan:a}=i;for(let e=0;e<c;e++)u[e]+=a[e];d+=o}let f={candidateTallies:{scoreFractionAverageByCan:u.map(e=>e/(1*d))},parties:i,numCans:n.length};return l<2||(f.votesByGeom=h),f},castPoint:eC},scoreFull:{cast:function(e,t){let{canPoints:n,voterGeoms:r,parties:i}=e,{verbosity:o}=t,a=n.length,s=0,l=[];for(let n=0;n<r.length;n++){let i=function(e,t,n){let{canPoints:r,dimensions:i}=t,{verbosity:o}=n,a=(1===i?ew:ex)(e,n),{voteCounts:s,totalVotes:l,voterPoints:c}=a,h=r.length,u=Array(h).fill(0),d=a.x.length,p=Array(d);for(let e=0;e<d;e++){let t=s[e],n=eC(r,c[e],i);p[e]=n;let{scoreVote:o}=n;for(let e=0;e<h;e++)u[e]+=o[e]*t}return o<2?{voteCounts:s,voteSet:p,scoreSumByCan:u,totalVotes:l}:{grid:a,voteCounts:s,voteSet:p,scoreSumByCan:u,totalVotes:l,voterGeom:e}}(r[n],e,t);l[n]=i;let{totalVotes:o}=i;s+=o}let c=1/s,h=Array(a).fill(0),u=[],d=[],p=0;for(let e=0;e<r.length;e++){let{voteCounts:t,voteSet:n,scoreSumByCan:r}=l[e],i=[];for(let e=0;e<n.length;e++)u[p]=n[e].scoreVote,i[e]=p,d[p]=t[e]*c,p+=1;l[e].voteIndex=i;for(let e=0;e<a;e++)h[e]+=r[e]}let f={preferenceLists:{scoreVotes:u},preferenceTallies:{voteFractions:d},candidateTallies:{scoreFractionAverageByCan:h.map(e=>e/(1*s))},parties:i,numCans:n.length};return o<2||(f.votesByGeom=l),f},castPoint:eC},ranking:{cast:function(e,t){let{canPoints:n,voterGeoms:r,dimensions:i,parties:o}=e,{verbosity:a}=t,s=r.some(e=>"gaussian"===e.densityProfile)&&2===i?eE:1===i?eT:eB,l=n.length,c=[],h=[],u=[],d=Array(l).fill(0),p=0,f=[];r.forEach((n,r)=>{let i=s(n,e,t),{rankings:o,cansByRankList:l,voteCounts:m,totalVotes:g}=i,y=c.length,v=m.length;c.length+=v;for(let e=0;e<v;e++)c[y+e]=m[e],u[y+e]=l[e];p+=g;for(let e=0;e<l.length;e++){let t=l[e][0];for(let n=0;n<t.length;n++){let r=t[n];d[r]+=m[e]}}if(!(a<2)){for(let e=0;e<v;e++)h[y+e]=o[e];f[r]=i}});let m=c.map(e=>e/p),g=d.map(e=>e/p),y={cansByRankList:u},v={preferenceLists:y,preferenceTallies:{voteFractions:m},candidateTallies:{firstPreferenceFractions:g},parties:o,numCans:n.length};return a<2||(y.rankings=h,v.votesByGeom=f),v},castPoint:ek,makeCanBorders:function(e,t,n){return t.some(e=>"gaussian"===e.densityProfile)&&2===n||2===n?{}:{rankingIntervals1D:e$(e)}}},pairwise:{cast:function(e,t){let{canPoints:n,voterGeoms:r,dimensions:i,parties:o}=e,{verbosity:a}=t,s=r.some(e=>"gaussian"===e.densityProfile)&&2===i?eW:1===i?eV:eF,l=0,c=n.length,h=Array(c).fill(0);for(let e=0;e<c;e++)h[e]=Array(c).fill(0);let u=[];r.forEach((n,r)=>{let i=s(n,e,t),{winsPairwise:o,totalVotes:d}=i;for(let e=0;e<c;e++)for(let t=0;t<c;t++)h[e][t]+=o[e][t];l+=d,a<2||(u[r]=i)});let d=1/l,p={pairwiseTallies:{winFractionPairwise:h.map(e=>e.map(e=>e*d))},parties:o,numCans:n.length};if(a<1)return p;let f=Array(c).fill(0),m=Array(c),g=d/(c-1);for(let e=0;e<c;e++){for(let t=0;t<c;t++)f[e]+=h[e][t];m[e]=f[e]*g}return p.candidateTallies={bordaFractionAverageByCan:m},a<2||(p.votesByGeom=u),p},castPoint:eG,makeCanBorders:function(e,t,n){let r=t.some(e=>"gaussian"===e.densityProfile)&&2===n;return 2===n||r?{}:{pairwiseIntervals1D:function(e){let t=e.length,n=Array(t-1),r=Array(t-1);for(let i=0;i<t-1;i++){n[i]=Array(t-i-1),r[i]=Array(t-i-1);for(let o=i+1;o<t;o++){let t=e[i],a=e[o],s=.5*(t+a);n[i][o]=s,r[i][o]=t<a}}return{midpoints:n,iLower:r}}(e)}}}};function ez(e,t,n,r){let{makeCanBorders:i}=eU[r];return void 0!==i?i(e,t,n):{}}function eH(e,t){let{socialChoiceOptions:n,socialChoiceMethod:r}=t,i=(0,R[r])(e,n);return void 0===i.allocation&&(i.allocation=function(e,t){let{numCans:n}=e,{iWinner:r}=t,i=Array(n).fill(0);return i[r]=1,i}(e,i)),i}function eX(e,t,n){let r=function(e,t,n){let{voteCasterName:r}=t,{canPoints:i,voterGeoms:o,dimensions:a}=e,s={...e},l=ez(i,o,a,r);return s.canBorders=l,eU[r].cast(s,n)}(e,t,n),i=eH(r,t);return{geometry:e,electionOptions:t,votes:r,socialChoiceResults:i}}function eY(e,t,n){let{castOptions:r}=n,{usePolls:i}=e;return i?function(e,t,n){let{pollCount:r}=n,i=null;for(let o=0;o<r+1;o++){let r={...e},o=function(e){if(null===e||void 0===e.votes.candidateTallies)return{};let{scoreFractionAverageByCan:t}=e.votes.candidateTallies,{voteFractionsByCan:n}=e.votes.candidateTallies;return void 0!==t?{highestScore:Math.max(...t),scoreFractionAverageByCan:t}:void 0!==n?{highestScore:Math.max(...n),voteFractionsByCan:n}:{}}(i);r.information={polling:o};let{castOptions:a}=n;i=eX(r,t,a)}return i}(e,t,n):eX(e,t,r)}function eJ(e,t){let n={...t};return n.voterStrategyList=t.voterStrategyListByPhase[e],n.usePolls=t.usePollsByPhase[e],delete n.voterStrategyListByPhase,delete n.usePollsByPhase,n}function eK(e,t,n){return n.sequenceOptions.sequences[e].phases[t]}function eZ(e){let t=[];return e.forEach((e,n)=>{e&&t.push(n)}),t}function eQ(e,t){let{canPoints:n,voterGeoms:r}=e;if(0===r.length)return{error:"No Voters"};if(0===n.length)return{error:"No Candidates"};let{sequenceName:i}=t.sequenceOptions;return"closedPrimary"===i?function(e,t){let{numParties:n}=e.parties,r=[],i=eK("closedPrimary","closedPrimary",t);for(let o=0;o<n;o++){let{primaryGeometry:n}=function(e,t){let n=eJ("closedPrimary",e),r={...n},{voterParties:i}=n;r.voterGeoms=n.voterGeoms.filter((e,n)=>i[n]===t),r.voterStrategyList=n.voterStrategyList.filter((e,n)=>i[n]===t),r.voterParties=n.voterParties.filter((e,n)=>i[n]===t);let{partiesByCan:o}=n.parties,a=y(o.length);return r.canLabels=a.filter((e,n)=>o[n]===t),r.canPoints=n.canPoints.filter((e,n)=>o[n]===t),r.parties={...n.parties},r.parties.numParties=1,r.parties.partiesByCan=r.parties.partiesByCan.filter((e,n)=>o[n]===t),{primaryGeometry:r}}(e,o),{voterGeoms:a,canPoints:s}=n;if(0===a.length||0===s.length)continue;let l=eY(n,i,t);r[o]=l}let{generalGeometry:o,primaryWinners:a}=function(e,t,n){let r=eJ("general",e),i={...r},o=[];for(let e=0;e<n;e++){let n=t[e];if(void 0===n)continue;let{allocation:r}=n.socialChoiceResults,{canLabels:i}=n.geometry;if(void 0!==i&&0!==i.length){for(let e=0;e<r.length;e++)if(r[e]){let t=i[e];o.push(t)}}}return i.canPoints=o.map(e=>r.canPoints[e]),i.canLabels=o,{generalGeometry:i,primaryWinners:o}}(e,r,n);return function(e,t,n,r,i){let o=(function(e){let t=[];return e.forEach((e,n)=>{e&&t.push(n)}),t})(t.socialChoiceResults.allocation).map(e=>n[e]),a=Array(r.canPoints.length).fill(0);return o.forEach(e=>{a[e]=1}),{phases:{closedPrimary:e,general:t},phaseNames:["closedPrimary","general"],geometry:r,optionsBag:i,socialChoiceResults:{allocation:a}}}(r,eY(o,eK("closedPrimary","general",t),t),a,e,t)}(e,t):"nonpartisanOpenPrimary"===i?function(e,t){let n=eJ("nonpartisanOpenPrimary",e),r=y(e.canPoints.length);n.canLabels=r;let i=eY(n,eK("nonpartisanOpenPrimary","nonpartisanOpenPrimary",t),t),{generalGeometry:o,primaryWinners:a}=function(e,t){let n=eJ("general",e),r={...n},{allocation:i}=t.socialChoiceResults,o=eZ(i);return r.canPoints=o.map(e=>n.canPoints[e]),r.canLabels=o,r.parties={...n.parties},r.parties.partiesByCan=o.map(e=>n.parties.partiesByCan[e]),{generalGeometry:r,primaryWinners:o}}(e,i);return function(e,t,n,r,i){let o=eZ(t.socialChoiceResults.allocation).map(e=>n[e]),a=Array(r.canPoints.length).fill(0);return o.forEach(e=>{a[e]=1}),{phases:{nonpartisanOpenPrimary:e,general:t},phaseNames:["nonpartisanOpenPrimary","general"],geometry:r,optionsBag:i,socialChoiceResults:{allocation:a}}}(i,eY(o,eK("nonpartisanOpenPrimary","general",t),t),a,e,t)}(e,t):function(e,t){let n=eJ("general",e),r=y(e.canPoints.length);n.canLabels=r;let i=eY(n,eK("general","general",t),t),{socialChoiceResults:o}=i;return{phases:{general:i},phaseNames:["general"],geometry:e,optionsBag:t,socialChoiceResults:o}}(e,t)}const e0=1/Math.sqrt(Math.PI/2),e1=1/Math.sqrt(2);function e2(){let e,t,n;let r=this;r.update=function(e,t,n){return t.checkAny()&&r.startSim(e),r.addSim(e,n)},r.startSim=function(r){t=0,e=Array(10).fill(0);let i=`watermelon${r.samplingSeed}`;n=o(ei)(i)},r.addSim=function(r,i){if(t>5e3)return{pointsChanged:!1};let o=function(e,t,n,r){let{voterGeoms:i,voterParties:o,canDnGeoms:a,dimensions:s,geography:l,canDnCDF:c,strategySeed:h,voterStrategyListByPhase:u,information:d,usePollsByPhase:p}=e,{partiesByCan:f}=e.parties;if(0===i.length||0===a.length)return{pointsChanged:!1};let m=[],y=[],v=Array(10).fill(0);for(let e=0;e<1;e++){let{numSampleCandidates:e}=t,n=[],x=[];for(let t=0;t<e;t++){var w;let e=g(c,r),t=f[e],i=(w=a[e],1===s?function(e,t){let{x:n,w:r,densityProfile:i}=e;return("gaussian"===i?function(e,t,n){var r;return t*e0*(Math.sqrt(-2*Math.log((r=n)()))*Math.cos(2*Math.PI*r()))+e}:function(e,t,n){return(2*n()-1)*t+e})(n,.5*r,t)}(w,r):function(e,t){let{x:n,y:r,w:i,densityProfile:o}=e;return("gaussian"===o?function(e,t,n,r){let[i,o]=function(e){let t,n,r;do r=(t=2*e()-1)*t+(n=2*e()-1)*n;while(r>1||0===r)let i=Math.sqrt(-(Math.log(r)/r*2));return[i*t,i*n]}(r),a=n*e1;return[e+a*i,t+a*o]}:function(e,t,n,r){let[i,o]=function(e){let t,n,r;do r=(t=2*e()-1)*t+(n=2*e()-1)*n;while(r>1||0===r)return[t,n]}(r);return[e+n*i,t+n*o]})(n,r,.5*i,t)}(w,r));n.push(i),x.push(t)}let{allocation:_}=eQ({voterGeoms:i,voterParties:o,canPoints:n,parties:{partiesByCan:x,numParties:10},dimensions:s,geography:l,strategySeed:h,voterStrategyListByPhase:u,information:d,usePollsByPhase:p},t).socialChoiceResults;for(let e=0;e<_.length;e++){let t=_[e];if(0===t)continue;let r=n[e],i=1===s?[r]:r,o=x[e];m.push(i),y.push(t),v[o]+=t}}return{samplingPointsList:m,samplingPointsCount:y,partyWins:v}}(r,i,0,n),{samplingPointsList:a,samplingPointsCount:s,partyWins:l,error:c}=o;if(void 0!==c||!1===o.pointsChanged)return{pointsChanged:!1};let h=s.reduce((e,t)=>e+t);t+=h;for(let t=0;t<l.length;t++)e[t]+=l[t];return{pointsChanged:!0,samplingPointsList:a,samplingPointsCount:s,partyWinFraction:e.map(e=>e/t)}}}function e5(e,t,n,r,i,a){let{candidateDnList:s,voterShapeList:l}=t,c=new e2;this.update=()=>{a.update();let t=a.getOptions();r.update(),function(e,t){if(!t.checkAny()||!e.seedRandom||t.check(["init","seeds"]))return;let n=Math.floor(1e4*o(ei)()());e.setSeeds(0,n)}(i,n);let h=function(e,t,n,r,i){let{dimensions:o,seeds:a}=n,{geography:s}=i,{sequenceOptions:l}=r,c=e.getGeoms(o),h=e.getParties(),u=e.getVoterStrategyListByPhase(l),d=er(u),p=t.getGeoms(o),m=t.getParties(),g=f(1===o?p.map(e=>e.w):p.map(e=>e.w**2));return{voterGeoms:c,voterParties:h,canDnGeoms:p,parties:m,dimensions:o,geography:s,canDnCDF:g,samplingSeed:`apple${a[0]}`,strategySeed:`pumpkin${a[0]}`,voterStrategyListByPhase:u,usePollsByPhase:d}}(l,s,i,t,r),u=c.update(h,n,t);(!0===u.pointsChanged||n.checkAny())&&e.update({samplingResult:u}),n.clear()}}function e3(e){return 1/(e.length*e[0].length)}function e4(e){let t=0;for(let n=0;n<e.length;n++){let[,,r]=e[n];t+=r}return 1/t}function e6(e,t,n,r,i,o){let{voterShapeList:a,candidateList:s}=t;this.update=()=>{if(n.checkNone())return;o.update();let t=o.getOptions();r.update();let l=function(e,t){if(!0===t.useGeography){let{sequenceName:n}=t.sequenceOptions,r="general",i=t.sequenceOptions.sequences[n].phases[r],{castOptions:o}=t;return function(e,t,n){let{canPoints:r,geography:i}=e,o=function(e,t,n){let{canPoints:r,parties:i,dimensions:o,geography:a,strategySeed:s,voterStrategyList:l,information:c}=e,{voterGeomsByTract:h}=a,u=h[0][0],{voteCasterName:d}=t,p=ez(r,u,o,d);return h.map(e=>e.map(e=>eU[d].cast({voterGeoms:e,canPoints:r,parties:i,dimensions:o,canBorders:p,strategySeed:s,voterStrategyList:l,information:c},n)))}(e,t,n),a=function(e,t){let n=t.length,r={};return void 0!==e[0][0].candidateTallies&&(r.candidateTallies=function(e,t){let n=Object.keys(e[0][0].candidateTallies),r={};for(let i=0;i<n.length;i++){let o=n[i],a=function(e,t,n){let r=Array(n).fill(0);t.forEach(t=>t.forEach(t=>{let i=t.candidateTallies[e];for(let e=0;e<n;e++)r[e]+=i[e]}));let i=e3(t);return r.map(e=>e*i)}(o,e,t);r[o]=a}return r}(e,n)),void 0!==e[0][0].pairwiseTallies&&(r.pairwiseTallies=function(e,t){let n=Object.keys(e[0][0].pairwiseTallies),r={};for(let i=0;i<n.length;i++){let o=n[i],a=function(e,t,n){let r=Array(n);for(let e=0;e<n;e++)r[e]=Array(n).fill(0);t.forEach(t=>t.forEach(t=>{let i=t.pairwiseTallies[e];for(let e=0;e<n;e++)for(let t=0;t<n;t++)r[e][t]+=i[e][t]}));let i=e3(t);return r.map(e=>e.map(e=>e*i))}(o,e,t);r[o]=a}return r}(e,n)),void 0!==e[0][0].preferenceLists&&(r.preferenceLists=function(e){let t=Object.keys(e[0][0].preferenceLists),n={};for(let r=0;r<t.length;r++){let i=t[r],o=function(e,t){let n=[];return t.forEach(t=>t.forEach(t=>{let r=t.preferenceLists[e],i=n.length,o=r.length;n.length+=r.length;for(let e=0;e<o;e++)n[i+e]=r[e]})),n}(i,e);n[i]=o}return n}(e),r.preferenceTallies=function(e){let t=Object.keys(e[0][0].preferenceTallies),n={};for(let r=0;r<t.length;r++){let i=t[r],o=function(e,t){let n=[];t.forEach(t=>t.forEach(t=>{let r=t.preferenceTallies[e],i=n.length,o=r.length;n.length+=r.length;for(let e=0;e<o;e++)n[i+e]=r[e]}));let r=e3(t);return n=n.map(e=>e*r)}(i,e);n[i]=o}return n}(e)),r.parties=e[0][0].parties,r}(o,r),s=function(e,t,n){let{census:r}=n,{nd:i}=n.districtMap,o=t.length;return y(i).map(t=>{let n=r[t],i={};return void 0!==e[0][0].candidateTallies&&(i.candidateTallies=function(e,t,n){let r=Object.keys(e[0][0].candidateTallies),i={};for(let o=0;o<r.length;o++){let a=r[o],s=function(e,t,n,r){let i=Array(r).fill(0);for(let o=0;o<n.length;o++){let[a,s,l]=n[o],c=t[a][s].candidateTallies[e];for(let e=0;e<r;e++)i[e]+=c[e]*l}let o=e4(n);return i.map(e=>e*o)}(a,e,t,n);i[a]=s}return i}(e,n,o)),void 0!==e[0][0].pairwiseTallies&&(i.pairwiseTallies=function(e,t,n){let r=Object.keys(e[0][0].pairwiseTallies),i={};for(let o=0;o<r.length;o++){let a=r[o],s=function(e,t,n,r){let i=Array(r);for(let e=0;e<r;e++)i[e]=Array(r).fill(0);for(let o=0;o<n.length;o++){let[a,s,l]=n[o],c=t[a][s].pairwiseTallies[e];for(let e=0;e<r;e++)for(let t=0;t<r;t++)i[e][t]+=c[e][t]*l}let o=e4(n);return i.map(e=>e.map(e=>e*o))}(a,e,t,n);i[a]=s}return i}(e,n,o)),void 0!==e[0][0].preferenceLists&&(i.preferenceLists=function(e,t){let n=Object.keys(e[0][0].preferenceLists),r={};for(let i=0;i<n.length;i++){let o=n[i],a=function(e,t,n){let r=[];for(let i=0;i<n.length;i++){let[o,a]=n[i],s=t[o][a].preferenceLists[e],l=r.length,c=s.length;r.length+=s.length;for(let e=0;e<c;e++)r[l+e]=s[e]}return r}(o,e,t);r[o]=a}return r}(e,n),i.preferenceTallies=function(e,t){let n=Object.keys(e[0][0].preferenceTallies),r={};for(let i=0;i<n.length;i++){let o=n[i],a=function(e,t,n){let r=[],i=e4(n);for(let o=0;o<n.length;o++){let[a,s,l]=n[o],c=t[a][s].preferenceTallies[e].map(e=>e*l*i),h=r.length,u=c.length;r.length+=c.length;for(let e=0;e<u;e++)r[h+e]=c[e]}return r}(o,e,t);r[o]=a}return r}(e,n)),i.parties=e[0][0].parties,i.numCans=o,i})}(o,r,i),l=s.map(e=>eH(e,t)),c=function(e,t,n){let r=t.length,i=Array(r).fill(0);return"singleWinner"===n.socialChoiceType?e.map(e=>e.iWinner).forEach(e=>{i[e]+=1}):e.forEach(e=>{let{allocation:t}=e;for(let e=0;e<r;e++)i[e]+=t[e]}),i}(l,r,t);return{electionOptions:t,geometry:e,votes:a,votesByTract:o,votesByDistrict:s,scResultsByDistrict:l,socialChoiceResults:{allocation:c}}}(eJ(r,e),i,o)}return function(e,t){let{canPoints:n,parties:r,voterParties:i,dimensions:o,geography:a,strategySeed:s,usePollsByPhase:l,voterStrategyListByPhase:c,information:h}=e,{voterGeomsByDistrict:u}=a,{nd:d}=a.districtMap;return{scResultsByDistrict:y(d).map(e=>eQ({voterGeoms:u[e],voterParties:i,canPoints:n,parties:r,dimensions:o,strategySeed:s,information:h,usePollsByPhase:l,voterStrategyListByPhase:c},t)),geometry:e}}(e,t)}(function(e,t,n,r,i){let{dimensions:o,seeds:a}=n,{geography:s}=i,{sequenceOptions:l}=r,c=e.getGeoms(o),h=e.getParties(),u=e.getVoterStrategyListByPhase(l),d=er(u),p=t.getPoints(o);return{voterGeoms:c,voterParties:h,canPoints:p,parties:t.getParties(),dimensions:o,geography:s,strategySeed:`pumpkin${a[0]}`,voterStrategyListByPhase:u,information:null,usePollsByPhase:d}}(a,s,i,t,r),t);l.colorRGBAOfCandidates=s.getRGBAList(),e.update({geoResults:l}),n.clear()}}function e8(e,t,n,r,i,o){let a=this;a.modes={one:new e6(e,t,r,n,i,o),sample:new e5(e,t,r,n,i,o)},a.update=()=>{a.modes[i.mode].update()}}function e9(){let e=[];this.attach=t=>{e.push(t)},this.update=t=>{e.forEach(e=>e.update(t))}}function e7([e,t],[n,r],[i,o]){return(i-n)*(t-r)<(o-r)*(e-n)}function te([e,t],[n,r],[i,o],[a,s]){let l=n-e,c=r-t,h=a-i,u=s-o,d=(l*(o-t)-c*(i-e))/(c*h-l*u);return[i+d*h,o+d*u]}function tt(e){let[t,n]=e[0],[r,i]=e[e.length-1];return t===r&&n===i}function tn(e,t,n){let{nd:r,polygons:i}=e,o=Array(r).fill().map(()=>[]),a=1/t,s=1/n;for(let e=0;e<t;e++)for(let t=0;t<n;t++){var l,c;let n=[[l=e*a,c=t*s],[l,c+s],[l+a,c+s],[l+a,c]];y(r).forEach(r=>{let a=function(e,t){let n=tt(t),r=e.length-tt(e),i=t.slice();for(let t=0,o=e[r-1],a,s,l;t<r;++t){let r=i.slice(),c=r.length-n;i.length=0,a=e[t],s=r[c-1];for(let e=0;e<c;++e)e7(l=r[e],o,a)?(e7(s,o,a)||i.push(te(s,l,o,a)),i.push(l)):e7(s,o,a)&&i.push(te(s,l,o,a)),s=l;n&&i.push(i[0]),o=a}return i.length?i:null}(_(i[r]).reverse(),n);if(null!==a){let n=eN(a);o[r].push([e,t,n])}})}return o}function tr(e){for(var t,n,r=-1,i=e.length,o=0,a=0,s=e[i-1],l=0;++r<i;)t=s,s=e[r],l+=n=t[0]*s[1]-s[0]*t[1],o+=(t[0]+s[0])*n,a+=(t[1]+s[1])*n;return[o/(l*=3),a/l]}function ti(e,t,n,r,i){let o,a,s,l;let c=t[0],h=r[0],u=0,d=0;h>c==h>-c?(o=c,c=t[++u]):(o=h,h=r[++d]);let p=0;if(u<e&&d<n)for(h>c==h>-c?(a=c+o,s=o-(a-c),c=t[++u]):(a=h+o,s=o-(a-h),h=r[++d]),o=a,0!==s&&(i[p++]=s);u<e&&d<n;)h>c==h>-c?(l=(a=o+c)-o,s=o-(a-l)+(c-l),c=t[++u]):(l=(a=o+h)-o,s=o-(a-l)+(h-l),h=r[++d]),o=a,0!==s&&(i[p++]=s);for(;u<e;)l=(a=o+c)-o,s=o-(a-l)+(c-l),c=t[++u],o=a,0!==s&&(i[p++]=s);for(;d<n;)l=(a=o+h)-o,s=o-(a-l)+(h-l),h=r[++d],o=a,0!==s&&(i[p++]=s);return(0!==o||0===p)&&(i[p++]=o),p}function to(e){return new Float64Array(e)}const ta=to(4),ts=to(8),tl=to(12),tc=to(16),th=to(4);function tu(e,t,n,r,i,o){let a=(t-o)*(n-i),s=(e-i)*(r-o),l=a-s,c=Math.abs(a+s);return Math.abs(l)>=33306690738754716e-32*c?l:-function(e,t,n,r,i,o,a){let s,l,c,h,u,d,p,f,m,g,y,v,w,x,_,b,C,S;let P=e-i,k=n-i,M=t-o,A=r-o;x=P*A,p=(d=134217729*P)-(d-P),f=P-p,m=(d=134217729*A)-(d-A),_=f*(g=A-m)-(x-p*m-f*m-p*g),b=M*k,p=(d=134217729*M)-(d-M),f=M-p,m=(d=134217729*k)-(d-k),y=_-(C=f*(g=k-m)-(b-p*m-f*m-p*g)),u=_-y,ta[0]=_-(y+u)+(u-C),u=(v=x+y)-x,y=(w=x-(v-u)+(y-u))-b,u=w-y,ta[1]=w-(y+u)+(u-b),u=(S=v+y)-v,ta[2]=v-(S-u)+(y-u),ta[3]=S;let E=function(e,t){let n=t[0];for(let e=1;e<4;e++)n+=t[e];return n}(0,ta),T=22204460492503146e-32*a;if(E>=T||-E>=T||(u=e-P,s=e-(P+u)+(u-i),u=n-k,c=n-(k+u)+(u-i),u=t-M,l=t-(M+u)+(u-o),u=r-A,h=r-(A+u)+(u-o),0===s&&0===l&&0===c&&0===h)||(T=11093356479670487e-47*a+33306690738754706e-32*Math.abs(E),(E+=P*h+A*s-(M*c+k*l))>=T||-E>=T))return E;x=s*A,p=(d=134217729*s)-(d-s),f=s-p,m=(d=134217729*A)-(d-A),_=f*(g=A-m)-(x-p*m-f*m-p*g),b=l*k,p=(d=134217729*l)-(d-l),f=l-p,m=(d=134217729*k)-(d-k),y=_-(C=f*(g=k-m)-(b-p*m-f*m-p*g)),u=_-y,th[0]=_-(y+u)+(u-C),u=(v=x+y)-x,y=(w=x-(v-u)+(y-u))-b,u=w-y,th[1]=w-(y+u)+(u-b),u=(S=v+y)-v,th[2]=v-(S-u)+(y-u),th[3]=S;let N=ti(4,ta,4,th,ts);x=P*h,p=(d=134217729*P)-(d-P),f=P-p,m=(d=134217729*h)-(d-h),_=f*(g=h-m)-(x-p*m-f*m-p*g),b=M*c,p=(d=134217729*M)-(d-M),f=M-p,m=(d=134217729*c)-(d-c),y=_-(C=f*(g=c-m)-(b-p*m-f*m-p*g)),u=_-y,th[0]=_-(y+u)+(u-C),u=(v=x+y)-x,y=(w=x-(v-u)+(y-u))-b,u=w-y,th[1]=w-(y+u)+(u-b),u=(S=v+y)-v,th[2]=v-(S-u)+(y-u),th[3]=S;let D=ti(N,ts,4,th,tl);x=s*h,p=(d=134217729*s)-(d-s),f=s-p,m=(d=134217729*h)-(d-h),_=f*(g=h-m)-(x-p*m-f*m-p*g),b=l*c,p=(d=134217729*l)-(d-l),f=l-p,m=(d=134217729*c)-(d-c),y=_-(C=f*(g=c-m)-(b-p*m-f*m-p*g)),u=_-y,th[0]=_-(y+u)+(u-C),u=(v=x+y)-x,y=(w=x-(v-u)+(y-u))-b,u=w-y,th[1]=w-(y+u)+(u-b),u=(S=v+y)-v,th[2]=v-(S-u)+(y-u),th[3]=S;let O=ti(D,tl,4,th,tc);return tc[O-1]}(e,t,n,r,i,o,c)}to(4),to(4),to(4),to(4),to(4),to(4),to(4),to(4),to(4),to(8),to(8),to(8),to(4),to(8),to(8),to(8),to(12),to(192),to(192),to(4),to(4),to(4),to(4),to(4),to(4),to(4),to(4),to(8),to(8),to(8),to(8),to(8),to(8),to(8),to(8),to(8),to(4),to(4),to(4),to(8),to(16),to(16),to(16),to(32),to(32),to(48),to(64),to(1152),to(1152),to(4),to(4),to(4),to(4),to(4),to(4),to(4),to(4),to(4),to(4),to(24),to(24),to(24),to(24),to(24),to(24),to(24),to(24),to(24),to(24),to(1152),to(1152),to(1152),to(1152),to(1152),to(2304),to(2304),to(3456),to(5760),to(8),to(8),to(8),to(16),to(24),to(48),to(48),to(96),to(192),to(384),to(384),to(384),to(768),to(96),to(96),to(96),to(1152);const td=new Uint32Array(512);class tp{static from(e,t=ty,n=tv){let r=e.length,i=new Float64Array(2*r);for(let o=0;o<r;o++){let r=e[o];i[2*o]=t(r),i[2*o+1]=n(r)}return new tp(i)}constructor(e){let t=e.length>>1;if(t>0&&"number"!=typeof e[0])throw Error("Expected coords to contain numbers.");this.coords=e;let n=Math.max(2*t-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){let e,t,n;let{coords:r,_hullPrev:i,_hullNext:o,_hullTri:a,_hullHash:s}=this,l=r.length>>1,c=1/0,h=1/0,u=-1/0,d=-1/0;for(let e=0;e<l;e++){let t=r[2*e],n=r[2*e+1];t<c&&(c=t),n<h&&(h=n),t>u&&(u=t),n>d&&(d=n),this._ids[e]=e}let p=(c+u)/2,f=(h+d)/2;for(let t=0,n=1/0;t<l;t++){let i=tf(p,f,r[2*t],r[2*t+1]);i<n&&(e=t,n=i)}let m=r[2*e],g=r[2*e+1];for(let n=0,i=1/0;n<l;n++){if(n===e)continue;let o=tf(m,g,r[2*n],r[2*n+1]);o<i&&o>0&&(t=n,i=o)}let y=r[2*t],v=r[2*t+1],w=1/0;for(let i=0;i<l;i++){if(i===e||i===t)continue;let o=function(e,t,n,r,i,o){let a=n-e,s=r-t,l=i-e,c=o-t,h=a*a+s*s,u=l*l+c*c,d=.5/(a*c-s*l),p=(c*h-s*u)*d,f=(a*u-l*h)*d;return p*p+f*f}(m,g,y,v,r[2*i],r[2*i+1]);o<w&&(n=i,w=o)}let x=r[2*n],_=r[2*n+1];if(w===1/0){for(let e=0;e<l;e++)this._dists[e]=r[2*e]-r[0]||r[2*e+1]-r[1];tm(this._ids,this._dists,0,l-1);let e=new Uint32Array(l),t=0;for(let n=0,r=-1/0;n<l;n++){let i=this._ids[n],o=this._dists[i];o>r&&(e[t++]=i,r=o)}this.hull=e.subarray(0,t),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(0>tu(m,g,y,v,x,_)){let e=t,r=y,i=v;t=n,y=x,v=_,n=e,x=r,_=i}let b=function(e,t,n,r,i,o){let a=n-e,s=r-t,l=i-e,c=o-t,h=a*a+s*s,u=l*l+c*c,d=.5/(a*c-s*l);return{x:e+(c*h-s*u)*d,y:t+(a*u-l*h)*d}}(m,g,y,v,x,_);this._cx=b.x,this._cy=b.y;for(let e=0;e<l;e++)this._dists[e]=tf(r[2*e],r[2*e+1],b.x,b.y);tm(this._ids,this._dists,0,l-1),this._hullStart=e;let C=3;o[e]=i[n]=t,o[t]=i[e]=n,o[n]=i[t]=e,a[e]=0,a[t]=1,a[n]=2,s.fill(-1),s[this._hashKey(m,g)]=e,s[this._hashKey(y,v)]=t,s[this._hashKey(x,_)]=n,this.trianglesLen=0,this._addTriangle(e,t,n,-1,-1,-1);for(let l=0,c,h;l<this._ids.length;l++){let u=this._ids[l],d=r[2*u],p=r[2*u+1];if(l>0&&2220446049250313e-31>=Math.abs(d-c)&&2220446049250313e-31>=Math.abs(p-h)||(c=d,h=p,u===e||u===t||u===n))continue;let f=0;for(let e=0,t=this._hashKey(d,p);e<this._hashSize&&(-1===(f=s[(t+e)%this._hashSize])||f===o[f]);e++);let m=f=i[f],g;for(;g=o[m],tu(d,p,r[2*m],r[2*m+1],r[2*g],r[2*g+1])>=0;)if((m=g)===f){m=-1;break}if(-1===m)continue;let y=this._addTriangle(m,u,o[m],-1,-1,a[m]);a[u]=this._legalize(y+2),a[m]=y,C++;let v=o[m];for(;g=o[v],0>tu(d,p,r[2*v],r[2*v+1],r[2*g],r[2*g+1]);)y=this._addTriangle(v,u,g,a[u],-1,a[v]),a[u]=this._legalize(y+2),o[v]=v,C--,v=g;if(m===f)for(;0>tu(d,p,r[2*(g=i[m])],r[2*g+1],r[2*m],r[2*m+1]);)y=this._addTriangle(g,u,m,-1,a[m],a[g]),this._legalize(y+2),a[g]=y,o[m]=m,C--,m=g;this._hullStart=i[u]=m,o[m]=i[v]=u,o[u]=v,s[this._hashKey(d,p)]=u,s[this._hashKey(r[2*m],r[2*m+1])]=m}this.hull=new Uint32Array(C);for(let e=0,t=this._hullStart;e<C;e++)this.hull[e]=t,t=o[t];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(function(e,t){let n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){let{_triangles:t,_halfedges:n,coords:r}=this,i=0,o=0;for(;;){let a=n[e],s=e-e%3;if(o=s+(e+2)%3,-1===a){if(0===i)break;e=td[--i];continue}let l=a-a%3,c=s+(e+1)%3,h=l+(a+2)%3,u=t[o],d=t[e],p=t[c],f=t[h];if(function(e,t,n,r,i,o,a,s){let l=e-a,c=t-s,h=n-a,u=r-s,d=i-a,p=o-s,f=h*h+u*u,m=d*d+p*p;return l*(u*m-f*p)-c*(h*m-f*d)+(l*l+c*c)*(h*p-u*d)<0}(r[2*u],r[2*u+1],r[2*d],r[2*d+1],r[2*p],r[2*p+1],r[2*f],r[2*f+1])){t[e]=f,t[a]=u;let r=n[h];if(-1===r){let t=this._hullStart;do{if(this._hullTri[t]===h){this._hullTri[t]=e;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(e,r),this._link(a,n[o]),this._link(o,h);let s=l+(a+1)%3;i<td.length&&(td[i++]=s)}else{if(0===i)break;e=td[--i]}}return o}_link(e,t){this._halfedges[e]=t,-1!==t&&(this._halfedges[t]=e)}_addTriangle(e,t,n,r,i,o){let a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=t,this._triangles[a+2]=n,this._link(a,r),this._link(a+1,i),this._link(a+2,o),this.trianglesLen+=3,a}}function tf(e,t,n,r){let i=e-n,o=t-r;return i*i+o*o}function tm(e,t,n,r){if(r-n<=20)for(let i=n+1;i<=r;i++){let r=e[i],o=t[r],a=i-1;for(;a>=n&&t[e[a]]>o;)e[a+1]=e[a--];e[a+1]=r}else{let i=n+r>>1,o=n+1,a=r;tg(e,i,o),t[e[n]]>t[e[r]]&&tg(e,n,r),t[e[o]]>t[e[r]]&&tg(e,o,r),t[e[n]]>t[e[o]]&&tg(e,n,o);let s=e[o],l=t[s];for(;;){do o++;while(t[e[o]]<l)do a--;while(t[e[a]]>l)if(a<o)break;tg(e,o,a)}e[n+1]=e[a],e[a]=s,r-o+1>=a-n?(tm(e,t,o,r),tm(e,t,n,a-1)):(tm(e,t,n,a-1),tm(e,t,o,r))}}function tg(e,t,n){let r=e[t];e[t]=e[n],e[n]=r}function ty(e){return e[0]}function tv(e){return e[1]}class tw{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,n){e=+e,t=+t;let r=e+(n=+n),i=t;if(n<0)throw Error("negative radius");null===this._x1?this._+=`M${r},${i}`:(Math.abs(this._x1-r)>1e-6||Math.abs(this._y1-i)>1e-6)&&(this._+="L"+r+","+i),n&&(this._+=`A${n},${n},0,1,1,${e-n},${t}A${n},${n},0,1,1,${this._x1=r},${this._y1=i}`)}rect(e,t,n,r){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+n}v${+r}h${-n}Z`}value(){return this._||null}}class tx{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class t_{constructor(e,[t,n,r,i]=[0,0,960,500]){if(!((r=+r)>=(t=+t))||!((i=+i)>=(n=+n)))throw Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(2*e.points.length),this.vectors=new Float64Array(2*e.points.length),this.xmax=r,this.xmin=t,this.ymax=i,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){let e,t;let{delaunay:{points:n,hull:r,triangles:i},vectors:o}=this,a=this.circumcenters=this._circumcenters.subarray(0,i.length/3*2);for(let o=0,s=0,l=i.length,c,h;o<l;o+=3,s+=2){let l=2*i[o],u=2*i[o+1],d=2*i[o+2],p=n[l],f=n[l+1],m=n[u],g=n[u+1],y=n[d],v=n[d+1],w=m-p,x=g-f,_=y-p,b=v-f,C=(w*b-x*_)*2;if(1e-9>Math.abs(C)){if(void 0===e){for(let i of(e=t=0,r))e+=n[2*i],t+=n[2*i+1];e/=r.length,t/=r.length}let i=1e9*Math.sign((e-p)*b-(t-f)*_);c=(p+y)/2-i*b,h=(f+v)/2+i*_}else{let e=1/C,t=w*w+x*x,n=_*_+b*b;c=p+(b*t-x*n)*e,h=f+(w*n-_*t)*e}a[s]=c,a[s+1]=h}let s=r[r.length-1],l,c=4*s,h,u=n[2*s],d,p=n[2*s+1];o.fill(0);for(let e=0;e<r.length;++e)s=r[e],l=c,h=u,d=p,c=4*s,u=n[2*s],p=n[2*s+1],o[l+2]=o[c]=d-p,o[l+3]=o[c+1]=u-h}render(e){let t=null==e?e=new tw:void 0,{delaunay:{halfedges:n,inedges:r,hull:i},circumcenters:o,vectors:a}=this;if(i.length<=1)return null;for(let t=0,r=n.length;t<r;++t){let r=n[t];if(r<t)continue;let i=2*Math.floor(t/3),a=2*Math.floor(r/3),s=o[i],l=o[i+1],c=o[a],h=o[a+1];this._renderSegment(s,l,c,h,e)}let s,l=i[i.length-1];for(let t=0;t<i.length;++t){s=l;let n=2*Math.floor(r[l=i[t]]/3),c=o[n],h=o[n+1],u=4*s,d=this._project(c,h,a[u+2],a[u+3]);d&&this._renderSegment(c,h,d[0],d[1],e)}return t&&t.value()}renderBounds(e){let t=null==e?e=new tw:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){let n=null==t?t=new tw:void 0,r=this._clip(e);if(null===r||!r.length)return;t.moveTo(r[0],r[1]);let i=r.length;for(;r[0]===r[i-2]&&r[1]===r[i-1]&&i>1;)i-=2;for(let e=2;e<i;e+=2)(r[e]!==r[e-2]||r[e+1]!==r[e-1])&&t.lineTo(r[e],r[e+1]);return t.closePath(),n&&n.value()}*cellPolygons(){let{delaunay:{points:e}}=this;for(let t=0,n=e.length/2;t<n;++t){let e=this.cellPolygon(t);e&&(e.index=t,yield e)}}cellPolygon(e){let t=new tx;return this.renderCell(e,t),t.value()}_renderSegment(e,t,n,r,i){let o;let a=this._regioncode(e,t),s=this._regioncode(n,r);0===a&&0===s?(i.moveTo(e,t),i.lineTo(n,r)):(o=this._clipSegment(e,t,n,r,a,s))&&(i.moveTo(o[0],o[1]),i.lineTo(o[2],o[3]))}contains(e,t,n){return(t=+t)==t&&(n=+n)==n&&this.delaunay._step(e,t,n)===e}*neighbors(e){let t=this._clip(e);if(t)for(let n of this.delaunay.neighbors(e)){let e=this._clip(n);if(e){e:for(let r=0,i=t.length;r<i;r+=2)for(let o=0,a=e.length;o<a;o+=2)if(t[r]===e[o]&&t[r+1]===e[o+1]&&t[(r+2)%i]===e[(o+a-2)%a]&&t[(r+3)%i]===e[(o+a-1)%a]){yield n;break e}}}}_cell(e){let{circumcenters:t,delaunay:{inedges:n,halfedges:r,triangles:i}}=this,o=n[e];if(-1===o)return null;let a=[],s=o;do{let n=Math.floor(s/3);if(a.push(t[2*n],t[2*n+1]),i[s=s%3==2?s-2:s+1]!==e)break;s=r[s]}while(s!==o&&-1!==s)return a}_clip(e){if(0===e&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];let t=this._cell(e);if(null===t)return null;let{vectors:n}=this,r=4*e;return this._simplify(n[r]||n[r+1]?this._clipInfinite(e,t,n[r],n[r+1],n[r+2],n[r+3]):this._clipFinite(e,t))}_clipFinite(e,t){let n=t.length,r=null,i,o,a=t[n-2],s=t[n-1],l,c=this._regioncode(a,s),h,u=0;for(let d=0;d<n;d+=2)if(i=a,o=s,a=t[d],s=t[d+1],l=c,c=this._regioncode(a,s),0===l&&0===c)h=u,u=0,r?r.push(a,s):r=[a,s];else{let t,n,d,p,f;if(0===l){if(null===(t=this._clipSegment(i,o,a,s,l,c)))continue;[n,d,p,f]=t}else{if(null===(t=this._clipSegment(a,s,i,o,c,l)))continue;[p,f,n,d]=t,h=u,u=this._edgecode(n,d),h&&u&&this._edge(e,h,u,r,r.length),r?r.push(n,d):r=[n,d]}h=u,u=this._edgecode(p,f),h&&u&&this._edge(e,h,u,r,r.length),r?r.push(p,f):r=[p,f]}if(r)h=u,u=this._edgecode(r[0],r[1]),h&&u&&this._edge(e,h,u,r,r.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return r}_clipSegment(e,t,n,r,i,o){let a=i<o;for(a&&([e,t,n,r,i,o]=[n,r,e,t,o,i]);;){if(0===i&&0===o)return a?[n,r,e,t]:[e,t,n,r];if(i&o)return null;let s,l,c=i||o;8&c?(s=e+(n-e)*(this.ymax-t)/(r-t),l=this.ymax):4&c?(s=e+(n-e)*(this.ymin-t)/(r-t),l=this.ymin):2&c?(l=t+(r-t)*(this.xmax-e)/(n-e),s=this.xmax):(l=t+(r-t)*(this.xmin-e)/(n-e),s=this.xmin),i?(e=s,t=l,i=this._regioncode(e,t)):(n=s,r=l,o=this._regioncode(n,r))}}_clipInfinite(e,t,n,r,i,o){let a=Array.from(t),s;if((s=this._project(a[0],a[1],n,r))&&a.unshift(s[0],s[1]),(s=this._project(a[a.length-2],a[a.length-1],i,o))&&a.push(s[0],s[1]),a=this._clipFinite(e,a))for(let t=0,n=a.length,r,i=this._edgecode(a[n-2],a[n-1]);t<n;t+=2)r=i,i=this._edgecode(a[t],a[t+1]),r&&i&&(t=this._edge(e,r,i,a,t),n=a.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(e,t,n,r,i){for(;t!==n;){let n,o;switch(t){case 5:t=4;continue;case 4:t=6,n=this.xmax,o=this.ymin;break;case 6:t=2;continue;case 2:t=10,n=this.xmax,o=this.ymax;break;case 10:t=8;continue;case 8:t=9,n=this.xmin,o=this.ymax;break;case 9:t=1;continue;case 1:t=5,n=this.xmin,o=this.ymin}(r[i]!==n||r[i+1]!==o)&&this.contains(e,n,o)&&(r.splice(i,0,n,o),i+=2)}return i}_project(e,t,n,r){let i=1/0,o,a,s;if(r<0){if(t<=this.ymin)return null;(o=(this.ymin-t)/r)<i&&(s=this.ymin,a=e+(i=o)*n)}else if(r>0){if(t>=this.ymax)return null;(o=(this.ymax-t)/r)<i&&(s=this.ymax,a=e+(i=o)*n)}if(n>0){if(e>=this.xmax)return null;(o=(this.xmax-e)/n)<i&&(a=this.xmax,s=t+(i=o)*r)}else if(n<0){if(e<=this.xmin)return null;(o=(this.xmin-e)/n)<i&&(a=this.xmin,s=t+(i=o)*r)}return[a,s]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}_simplify(e){if(e&&e.length>4){for(let t=0;t<e.length;t+=2){let n=(t+2)%e.length,r=(t+4)%e.length;(e[t]===e[n]&&e[n]===e[r]||e[t+1]===e[n+1]&&e[n+1]===e[r+1])&&(e.splice(n,2),t-=2)}e.length||(e=null)}return e}}const tb=2*Math.PI,tC=Math.pow;function tS(e){return e[0]}function tP(e){return e[1]}class tk{static from(e,t=tS,n=tP,r){return new tk("length"in e?function(e,t,n,r){let i=e.length,o=new Float64Array(2*i);for(let a=0;a<i;++a){let i=e[a];o[2*a]=t.call(r,i,a,e),o[2*a+1]=n.call(r,i,a,e)}return o}(e,t,n,r):Float64Array.from(function*(e,t,n,r){let i=0;for(let o of e)yield t.call(r,o,i,e),yield n.call(r,o,i,e),++i}(e,t,n,r)))}constructor(e){this._delaunator=new tp(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){let e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&function(e){let{triangles:t,coords:n}=e;for(let e=0;e<t.length;e+=3){let r=2*t[e],i=2*t[e+1],o=2*t[e+2];if((n[o]-n[r])*(n[i+1]-n[r+1])-(n[i]-n[r])*(n[o+1]-n[r+1])>1e-10)return!1}return!0}(e)){this.collinear=Int32Array.from({length:t.length/2},(e,t)=>t).sort((e,n)=>t[2*e]-t[2*n]||t[2*e+1]-t[2*n+1]);let e=this.collinear[0],i=this.collinear[this.collinear.length-1],o=[t[2*e],t[2*e+1],t[2*i],t[2*i+1]],a=1e-8*Math.hypot(o[3]-o[1],o[2]-o[0]);for(let e=0,i=t.length/2;e<i;++e){var n,r;let i=[(n=t[2*e])+Math.sin(n+(r=t[2*e+1]))*a,r+Math.cos(n-r)*a];t[2*e]=i[0],t[2*e+1]=i[1]}this._delaunator=new tp(t)}else delete this.collinear;let i=this.halfedges=this._delaunator.halfedges,o=this.hull=this._delaunator.hull,a=this.triangles=this._delaunator.triangles,s=this.inedges.fill(-1),l=this._hullIndex.fill(-1);for(let e=0,t=i.length;e<t;++e){let t=a[e%3==2?e-2:e+1];(-1===i[e]||-1===s[t])&&(s[t]=e)}for(let e=0,t=o.length;e<t;++e)l[o[e]]=e;o.length<=2&&o.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=o[0],s[o[0]]=1,2===o.length&&(s[o[1]]=0,this.triangles[1]=o[1],this.triangles[2]=o[1]))}voronoi(e){return new t_(this,e)}*neighbors(e){let{inedges:t,hull:n,_hullIndex:r,halfedges:i,triangles:o,collinear:a}=this;if(a){let t=a.indexOf(e);t>0&&(yield a[t-1]),t<a.length-1&&(yield a[t+1]);return}let s=t[e];if(-1===s)return;let l=s,c=-1;do{if(yield c=o[l],o[l=l%3==2?l-2:l+1]!==e)return;if(-1===(l=i[l])){let t=n[(r[e]+1)%n.length];t!==c&&(yield t);return}}while(l!==s)}find(e,t,n=0){let r;if((e=+e)!=e||(t=+t)!=t)return -1;let i=n;for(;(r=this._step(n,e,t))>=0&&r!==n&&r!==i;)n=r;return r}_step(e,t,n){let{inedges:r,hull:i,_hullIndex:o,halfedges:a,triangles:s,points:l}=this;if(-1===r[e]||!l.length)return(e+1)%(l.length>>1);let c=e,h=tC(t-l[2*e],2)+tC(n-l[2*e+1],2),u=r[e],d=u;do{let r=s[d],u=tC(t-l[2*r],2)+tC(n-l[2*r+1],2);if(u<h&&(h=u,c=r),s[d=d%3==2?d-2:d+1]!==e)break;if(-1===(d=a[d])){if((d=i[(o[e]+1)%i.length])!==r&&tC(t-l[2*d],2)+tC(n-l[2*d+1],2)<h)return d;break}}while(d!==u)return c}render(e){let t=null==e?e=new tw:void 0,{points:n,halfedges:r,triangles:i}=this;for(let t=0,o=r.length;t<o;++t){let o=r[t];if(o<t)continue;let a=2*i[t],s=2*i[o];e.moveTo(n[a],n[a+1]),e.lineTo(n[s],n[s+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t){void 0!==t||e&&"function"==typeof e.moveTo||(t=e,e=null),t=void 0==t?2:+t;let n=null==e?e=new tw:void 0,{points:r}=this;for(let n=0,i=r.length;n<i;n+=2){let i=r[n],o=r[n+1];e.moveTo(i+t,o),e.arc(i,o,t,0,tb)}return n&&n.value()}renderHull(e){let t=null==e?e=new tw:void 0,{hull:n,points:r}=this,i=2*n[0],o=n.length;e.moveTo(r[i],r[i+1]);for(let t=1;t<o;++t){let i=2*n[t];e.lineTo(r[i],r[i+1])}return e.closePath(),t&&t.value()}hullPolygon(){let e=new tx;return this.renderHull(e),e.value()}renderTriangle(e,t){let n=null==t?t=new tw:void 0,{points:r,triangles:i}=this,o=2*i[e*=3],a=2*i[e+1],s=2*i[e+2];return t.moveTo(r[o],r[o+1]),t.lineTo(r[a],r[a+1]),t.lineTo(r[s],r[s+1]),t.closePath(),n&&n.value()}*trianglePolygons(){let{triangles:e}=this;for(let t=0,n=e.length/3;t<n;++t)yield this.trianglePolygon(t)}trianglePolygon(e){let t=new tx;return this.renderTriangle(e,t),t.value()}}function tM(e){let[t,n,r]=function(e,t,n,r){let i,o,a=Array(n).fill().map(()=>[1*Math.random(),1*Math.random()]),s=!1,l=.01;for(let e=0;e<1e3;e++)if([a,s,i,o]=function(e,t,n,r){let i=tk.from(e).voronoi([0,0,t,n]),o=[...Array(e.length).keys()].map(e=>i.cellPolygon(e)),a=o.map(tr),s=e.every((e,t)=>e**2+a[t]**2<r);return[a,s,i,o]}(a,1,1,l),s)return a;return[a,i,o]}(1,1,e,0),i=r.map(eN).map(e=>-e);return{nd:e,centroids:t,voronoi:n,polygons:r,polygonAreas:i}}const tA=.5*(Math.sqrt(3)-1),tE=(3-Math.sqrt(3))/6,tT=1/3,tN=1/6,tD=(Math.sqrt(5)-1)/4,tO=(5-Math.sqrt(5))/20,tL=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),tR=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class tB{constructor(e=Math.random){let t="function"==typeof e?e:function(e){let t,n=0,r=0,i=0,o=1,a=(t=4022871197,function(e){e=e.toString();for(let n=0;n<e.length;n++){let r=.02519603282416938*(t+=e.charCodeAt(n));t=r>>>0,r-=t,r*=t,t=r>>>0,r-=t,t+=4294967296*r}return(t>>>0)*23283064365386963e-26});return n=a(" "),r=a(" "),i=a(" "),(n-=a(e))<0&&(n+=1),(r-=a(e))<0&&(r+=1),(i-=a(e))<0&&(i+=1),function(){let e=2091639*n+23283064365386963e-26*o;return n=r,r=i,i=e-(o=0|e)}}(e);this.p=function(e){let t=new Uint8Array(256);for(let e=0;e<256;e++)t[e]=e;for(let n=0;n<255;n++){let r=n+~~(e()*(256-n)),i=t[n];t[n]=t[r],t[r]=i}return t}(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let e=0;e<512;e++)this.perm[e]=this.p[255&e],this.permMod12[e]=this.perm[e]%12}noise2D(e,t){let n,r;let i=this.permMod12,o=this.perm,a=0,s=0,l=0,c=(e+t)*tA,h=Math.floor(e+c),u=Math.floor(t+c),d=(h+u)*tE,p=e-(h-d),f=t-(u-d);p>f?(n=1,r=0):(n=0,r=1);let m=p-n+tE,g=f-r+tE,y=p-1+2*tE,v=f-1+2*tE,w=255&h,x=255&u,_=.5-p*p-f*f;if(_>=0){let e=3*i[w+o[x]];_*=_,a=_*_*(tL[e]*p+tL[e+1]*f)}let b=.5-m*m-g*g;if(b>=0){let e=3*i[w+n+o[x+r]];b*=b,s=b*b*(tL[e]*m+tL[e+1]*g)}let C=.5-y*y-v*v;if(C>=0){let e=3*i[w+1+o[x+1]];C*=C,l=C*C*(tL[e]*y+tL[e+1]*v)}return 70*(a+s+l)}noise3D(e,t,n){let r,i,o,a,s,l,c,h,u,d;let p=this.permMod12,f=this.perm,m=(e+t+n)*tT,g=Math.floor(e+m),y=Math.floor(t+m),v=Math.floor(n+m),w=(g+y+v)*tN,x=e-(g-w),_=t-(y-w),b=n-(v-w);x>=_?_>=b?(s=1,l=0,c=0,h=1,u=1,d=0):(x>=b?(s=1,l=0,c=0):(s=0,l=0,c=1),h=1,u=0,d=1):_<b?(s=0,l=0,c=1,h=0,u=1,d=1):x<b?(s=0,l=1,c=0,h=0,u=1,d=1):(s=0,l=1,c=0,h=1,u=1,d=0);let C=x-s+tN,S=_-l+tN,P=b-c+tN,k=x-h+2*tN,M=_-u+2*tN,A=b-d+2*tN,E=x-1+3*tN,T=_-1+3*tN,N=b-1+3*tN,D=255&g,O=255&y,L=255&v,R=.6-x*x-_*_-b*b;if(R<0)r=0;else{let e=3*p[D+f[O+f[L]]];R*=R,r=R*R*(tL[e]*x+tL[e+1]*_+tL[e+2]*b)}let B=.6-C*C-S*S-P*P;if(B<0)i=0;else{let e=3*p[D+s+f[O+l+f[L+c]]];B*=B,i=B*B*(tL[e]*C+tL[e+1]*S+tL[e+2]*P)}let F=.6-k*k-M*M-A*A;if(F<0)o=0;else{let e=3*p[D+h+f[O+u+f[L+d]]];F*=F,o=F*F*(tL[e]*k+tL[e+1]*M+tL[e+2]*A)}let V=.6-E*E-T*T-N*N;if(V<0)a=0;else{let e=3*p[D+1+f[O+1+f[L+1]]];V*=V,a=V*V*(tL[e]*E+tL[e+1]*T+tL[e+2]*N)}return 32*(r+i+o+a)}noise4D(e,t,n,r){let i,o,a,s,l;let c=this.perm,h=(e+t+n+r)*tD,u=Math.floor(e+h),d=Math.floor(t+h),p=Math.floor(n+h),f=Math.floor(r+h),m=(u+d+p+f)*tO,g=e-(u-m),y=t-(d-m),v=n-(p-m),w=r-(f-m),x=0,_=0,b=0,C=0;g>y?x++:_++,g>v?x++:b++,g>w?x++:C++,y>v?_++:b++,y>w?_++:C++,v>w?b++:C++;let S=x>=3?1:0,P=_>=3?1:0,k=b>=3?1:0,M=C>=3?1:0,A=x>=2?1:0,E=_>=2?1:0,T=b>=2?1:0,N=C>=2?1:0,D=x>=1?1:0,O=_>=1?1:0,L=b>=1?1:0,R=C>=1?1:0,B=g-S+tO,F=y-P+tO,V=v-k+tO,q=w-M+tO,G=g-A+2*tO,I=y-E+2*tO,j=v-T+2*tO,W=w-N+2*tO,$=g-D+3*tO,U=y-O+3*tO,z=v-L+3*tO,H=w-R+3*tO,X=g-1+4*tO,Y=y-1+4*tO,J=v-1+4*tO,K=w-1+4*tO,Z=255&u,Q=255&d,ee=255&p,et=255&f,en=.6-g*g-y*y-v*v-w*w;if(en<0)i=0;else{let e=c[Z+c[Q+c[ee+c[et]]]]%32*4;en*=en,i=en*en*(tR[e]*g+tR[e+1]*y+tR[e+2]*v+tR[e+3]*w)}let er=.6-B*B-F*F-V*V-q*q;if(er<0)o=0;else{let e=c[Z+S+c[Q+P+c[ee+k+c[et+M]]]]%32*4;er*=er,o=er*er*(tR[e]*B+tR[e+1]*F+tR[e+2]*V+tR[e+3]*q)}let ei=.6-G*G-I*I-j*j-W*W;if(ei<0)a=0;else{let e=c[Z+A+c[Q+E+c[ee+T+c[et+N]]]]%32*4;ei*=ei,a=ei*ei*(tR[e]*G+tR[e+1]*I+tR[e+2]*j+tR[e+3]*W)}let eo=.6-$*$-U*U-z*z-H*H;if(eo<0)s=0;else{let e=c[Z+D+c[Q+O+c[ee+L+c[et+R]]]]%32*4;eo*=eo,s=eo*eo*(tR[e]*$+tR[e+1]*U+tR[e+2]*z+tR[e+3]*H)}let ea=.6-X*X-Y*Y-J*J-K*K;if(ea<0)l=0;else{let e=c[Z+1+c[Q+1+c[ee+1+c[et+1]]]]%32*4;ea*=ea,l=ea*ea*(tR[e]*X+tR[e+1]*Y+tR[e+2]*J+tR[e+3]*K)}return 27*(i+o+a+s+l)}}function tF(e,t){return function(e,t,n,r,i,o){let a=new tB("s"),s=new tB("seed"),l=Array(e).fill().map(()=>Array(t).fill().map(()=>[,,].fill(0))),c=0,h=0;tV(e).forEach(n=>{tV(t).forEach(r=>{let i=n/e*2,o=r/t*2,u=a.noise2D(i,o),d=s.noise2D(i,o);l[n][r][0]=u-.5,l[n][r][1]=d-.5,c+=u,h+=d})});let u=c/(e*t)-.5,d=h/(e*t)-.5;return l.forEach(e=>{e.forEach(e=>{e[0]=(e[0]-u)*100,e[1]=(e[1]-d)*100})}),l}(e,t,0,0,0,0)}function tV(e){return[...Array(e).keys()]}function tq(e,t){let n=e.length,r=[];for(let i=0;i<n;i++){let n=e[i],o=[];for(let e=0;e<n.length;e++){let[r,i,a]=n[e],s=t[r][i];for(let e=0;e<s.length;e++){let t={...s[e]};t.densityMax*=a,o.push(t)}}r.push(o)}return r}function tG(e,t,n){return 1===n?t.map(t=>t.map(t=>e.map(e=>{let[n]=t,r={...e};return r.x+=n,r}))):t.map(t=>t.map(t=>e.map(e=>{let[n,r]=t,i={...e};return i.x+=n,i.y+=r,i})))}function tI(e,t,n,r){let i=this;i.init=()=>{let{numTracts:t,numDistricts:o}=n.getOptions(),{dimensions:a}=r,s=e.getGeoms(a);i.geography=function(e,t,n,r){let i=tF(e,e),o=tM(t),a=tn(o,e,e),s=tG(n,i,r),l=tq(a,s);return{nx:e,ny:e,tractNoise:i,districtMap:o,census:a,voterGeomsByTract:s,voterGeomsByDistrict:l}}(t,o,s,a)};let o=!0;i.update=()=>{if(t.checkNone())return;if(o){o=!1,i.init();return}let a=n.getOptions();if(t.check(["numTracts"])){let{numTracts:e}=a;i.geography=function(e,t){let n={...e},r=tF(t,t);return n.nx=t,n.ny=t,n.tractNoise=r,n}(i.geography,e)}if(t.check(["numDistricts"])){let{numDistricts:e}=a;i.geography=function(e,t){let n={...e};return n.districtMap=tM(t),n}(i.geography,e)}if(t.check(["numDistricts","numTracts"])&&(i.geography=function(e){let t={...e},{districtMap:n,nx:r,ny:i}=t;return t.census=tn(n,r,i),t}(i.geography)),t.check(["voters","dimensions","numTracts"])){let{dimensions:t}=r,n=e.getGeoms(t);i.geography=function(e,t,n){let r={...e},{tractNoise:i}=r;return r.voterGeomsByTract=tG(t,i,n),r}(i.geography,n,t)}t.check(["voters","dimensions","numTracts","numDistricts"])&&(i.geography=function(e){let t={...e},{census:n,voterGeomsByTract:r}=t;return t.voterGeomsByDistrict=tq(n,r),t}(i.geography))}}var tj=function(e){let t=new C,n=new A(e),r=new E(t,n),i=new G(t,r,n),o=new en(t,n),a=new tI(o.voterShapeList,t,i,r),s=new e9,l=new e8(s,o,a,t,r,i);return{changes:t,commander:n,simOptions:r,electionOptionsMan:i,entities:o,districts:a,simMode:l,pub:s,init:function(e){o.candidateList.addCandidate({shape2:{x:50,y:100},shape1:{x:50},color:"#e05020",doLoad:!0}),o.candidateList.addCandidate({shape2:{x:100,y:50},shape1:{x:100},color:"#50e020",doLoad:!0}),o.candidateList.addCandidate({shape2:{x:200,y:250},shape1:{x:200},color:"#2050e0",doLoad:!0}),o.candidateDnList.addCandidateDistribution({shape2:{x:150,y:150,w:200,densityProfile:"step"},shape1:{x:150,w:200,densityProfile:"gaussian"},doLoad:!0}),o.voterShapeList.addVoterCircle({shape2:{x:150,y:150,w:200,densityProfile:"step",densityMax:1},shape1:{x:150,w:200,densityProfile:"gaussian",densityMax:1},strategyRules:z,doLoad:!0}),n.loadConfig(e),n.clearHistory()},update:function(){l.update()}}},tW=["menu","darkModeSwitch","simControlsLabel","addEntities","undo","redo","warning","viz","vizMini","maps","budget","name","resultsPhaseSelector","saveConfigToLink","saveConfigToShortLink","saveConfigToText","loadConfigText","saveData","svgSwitch","showDownloadScreenLink"];function t$(e){let t={},n=[];this.newElement=(r,i)=>{e.includes(r)?t[r]=i:n.push(i)},this.makeComponent=()=>{let r=document.createElement("div");return r.className="sandbox",e.forEach(e=>{let n=t[e];void 0!==n&&r.appendChild(n)}),n.forEach(e=>{r.appendChild(e)}),r}}function tU(){let e=[];this.attach=t=>{e.push(t)},this.enter=()=>{e.forEach(e=>e.enter())},this.exit=()=>{e.forEach(e=>e.exit())},this.update=t=>{e.forEach(e=>e.update(t))},this.render=()=>{e.forEach(e=>{e.render&&e.render()})},this.renderForeground=()=>{e.forEach(e=>{e.renderForeground&&e.renderForeground()})},this.clear=()=>{e.forEach(e=>{e.clear&&e.clear()})},this.clearForeground=()=>{e.forEach(e=>{e.clearForeground&&e.clearForeground()})}}function tz(e,t,n){let r=this;e.attach(r),r.viewModes={one:new tU,sample:new tU};let i=r.viewModes[t.mode];r.update=e=>{n.check(["mode"])&&(i.exit(),(i=r.viewModes[t.mode]).enter()),i.update(e)},r.render=()=>{i.render()},r.renderForeground=()=>{i.renderForeground()},r.clear=()=>{i.clear()},r.clearForeground=()=>{i.clearForeground()},r.rerender=()=>{r.clear(),r.clearForeground(),r.render(),r.renderForeground()}}var tH=c("8PNKb");function tX(){let e=this;e.handlers={start:()=>{},move:()=>{},end:()=>{},touchmove:()=>{},touchstart:()=>{},touchend:()=>{}},e.set=t=>{Object.assign(e.handlers,t)}}function tY(){let e=this;e.background=document.createElement("canvas"),e.background.setAttribute("class","background"),e.ctx=e.background.getContext("2d"),e.foreground=document.createElement("canvas"),e.foreground.setAttribute("class","foreground"),e.fctx=e.foreground.getContext("2d"),e.setSize=(t,n)=>{let r=`${t}px`,i=`${n}px`,o=e.pixelRatio,a=t*o,s=n*o;e.background.width=a,e.background.height=s,e.background.style.width=r,e.background.style.height=i,e.foreground.width=a,e.foreground.height=s,e.foreground.style.width=r,e.foreground.style.height=i,e.ctx.scale(o,o),e.fctx.scale(o,o)},e.setDisplayStyle=t=>{e.background.style.display=t,e.foreground.style.display=t},e.setStrokeStyle=t=>{e.ctx.strokeStyle=t,e.fctx.strokeStyle=t},e.pixelRatio=function(e){let t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/t}(e.ctx)}function tJ(e,t){this.div=document.createElement("div");let n=document.createElement("button");n.className="button2",n.innerText="Make SVG",n.onclick=function(){e.setFCtx(e.svg.ctx),t.clear(),t.render(),t.renderForeground();let n=e.svg.ctx.getSerializedSvg(!0),i=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(n)}`;r.href=i,e.setFCtx(e.svg.fctx),t.rerender()};let r=document.createElement("a");r.innerText="vote.svg",r.download="vote.svg",r.style.margin="4px",this.div.append(n),this.div.appendChild(r),this.setShowDownloadScreenLink=e=>{e?(n.hidden=!1,r.hidden=!1):(n.hidden=!0,r.hidden=!0)},this.setShowDownloadScreenLink(e.common.showDownloadScreenLink)}function tK(e,t){var n,r=Object.keys(t);for(n=0;n<r.length;n++)e=e.replace(RegExp("\\{"+r[n]+"\\}","gi"),t[r[n]]);return e}function tZ(e){var t,n,r;if(!e)throw Error("cannot create a random attribute name for an undefined object");t="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",n="";do for(r=0,n="";r<12;r++)n+=t[Math.floor(Math.random()*t.length)];while(e[n])return n}rr=function(e,t){var n,r,i,o={};for(n=0,e=e.split(","),t=t||10;n<e.length;n+=2)r="&"+e[n+1]+";",i=parseInt(e[n],t),o[r]="&#"+i+";";return o["\\xa0"]="&#160;",o}("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),n7={strokeStyle:{svgAttr:"stroke",canvas:"#000000",svg:"none",apply:"stroke"},fillStyle:{svgAttr:"fill",canvas:"#000000",svg:null,apply:"fill"},lineCap:{svgAttr:"stroke-linecap",canvas:"butt",svg:"butt",apply:"stroke"},lineJoin:{svgAttr:"stroke-linejoin",canvas:"miter",svg:"miter",apply:"stroke"},miterLimit:{svgAttr:"stroke-miterlimit",canvas:10,svg:4,apply:"stroke"},lineWidth:{svgAttr:"stroke-width",canvas:1,svg:1,apply:"stroke"},globalAlpha:{svgAttr:"opacity",canvas:1,svg:1,apply:"fill stroke"},font:{canvas:"10px sans-serif"},shadowColor:{canvas:"#000000"},shadowOffsetX:{canvas:0},shadowOffsetY:{canvas:0},shadowBlur:{canvas:0},textAlign:{canvas:"start"},textBaseline:{canvas:"alphabetic"},lineDash:{svgAttr:"stroke-dasharray",canvas:[],svg:null,apply:"stroke"}},(rt=function(e,t){this.__root=e,this.__ctx=t}).prototype.addColorStop=function(e,t){var n,r=this.__ctx.__createElement("stop");r.setAttribute("offset",e),-1!==t.indexOf("rgba")?(n=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(t),r.setAttribute("stop-color",tK("rgb({r},{g},{b})",{r:n[1],g:n[2],b:n[3]})),r.setAttribute("stop-opacity",n[4])):r.setAttribute("stop-color",t),this.__root.appendChild(r)},rn=function(e,t){this.__root=e,this.__ctx=t},(re=function(e){var t,n={width:500,height:500,enableMirroring:!1};if(arguments.length>1?((t=n).width=arguments[0],t.height=arguments[1]):t=e||n,!(this instanceof re))return new re(t);this.width=t.width||n.width,this.height=t.height||n.height,this.enableMirroring=void 0!==t.enableMirroring?t.enableMirroring:n.enableMirroring,this.canvas=this,this.__document=t.document||document,t.ctx?this.__ctx=t.ctx:(this.__canvas=this.__document.createElement("canvas"),this.__ctx=this.__canvas.getContext("2d")),this.__setDefaultStyles(),this.__stack=[this.__getStyleState()],this.__groupStack=[],this.__root=this.__document.createElementNS("http://www.w3.org/2000/svg","svg"),this.__root.setAttribute("version",1.1),this.__root.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.__root.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.__root.setAttribute("width",this.width),this.__root.setAttribute("height",this.height),this.__ids={},this.__defs=this.__document.createElementNS("http://www.w3.org/2000/svg","defs"),this.__root.appendChild(this.__defs),this.__currentElement=this.__document.createElementNS("http://www.w3.org/2000/svg","g"),this.__root.appendChild(this.__currentElement)}).prototype.__createElement=function(e,t,n){void 0===t&&(t={});var r,i,o=this.__document.createElementNS("http://www.w3.org/2000/svg",e),a=Object.keys(t);for(n&&(o.setAttribute("fill","none"),o.setAttribute("stroke","none")),r=0;r<a.length;r++)i=a[r],o.setAttribute(i,t[i]);return o},re.prototype.__setDefaultStyles=function(){var e,t,n=Object.keys(n7);for(e=0;e<n.length;e++)this[t=n[e]]=n7[t].canvas},re.prototype.__applyStyleState=function(e){var t,n,r=Object.keys(e);for(t=0;t<r.length;t++)this[n=r[t]]=e[n]},re.prototype.__getStyleState=function(){var e,t,n={},r=Object.keys(n7);for(e=0;e<r.length;e++)n[t=r[e]]=this[t];return n},re.prototype.__applyStyleToCurrentElement=function(e){var t=this.__currentElement,n=this.__currentElementsToStyle;n&&(t.setAttribute(e,""),t=n.element,n.children.forEach(function(t){t.setAttribute(e,"")}));var r,i,o,a,s,l=Object.keys(n7);for(r=0;r<l.length;r++)if(i=n7[l[r]],o=this[l[r]],i.apply){if(o instanceof rn){if(o.__ctx)for(;o.__ctx.__defs.childNodes.length;)a=o.__ctx.__defs.childNodes[0].getAttribute("id"),this.__ids[a]=a,this.__defs.appendChild(o.__ctx.__defs.childNodes[0]);t.setAttribute(i.apply,tK("url(#{id})",{id:o.__root.getAttribute("id")}))}else if(o instanceof rt)t.setAttribute(i.apply,tK("url(#{id})",{id:o.__root.getAttribute("id")}));else if(-1!==i.apply.indexOf(e)&&i.svg!==o){if(("stroke"===i.svgAttr||"fill"===i.svgAttr)&&-1!==o.indexOf("rgba")){s=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(o),t.setAttribute(i.svgAttr,tK("rgb({r},{g},{b})",{r:s[1],g:s[2],b:s[3]}));var c=s[4],h=this.globalAlpha;null!=h&&(c*=h),t.setAttribute(i.svgAttr+"-opacity",c)}else{var u=i.svgAttr;if("globalAlpha"===l[r]&&(u=e+"-"+i.svgAttr,t.getAttribute(u)))continue;t.setAttribute(u,o)}}}},re.prototype.__closestGroupOrSvg=function(e){return"g"===(e=e||this.__currentElement).nodeName||"svg"===e.nodeName?e:this.__closestGroupOrSvg(e.parentNode)},re.prototype.getSerializedSvg=function(e){var t,n,r,i,o,a=new XMLSerializer().serializeToString(this.__root);if(/xmlns="http:\/\/www\.w3\.org\/2000\/svg".+xmlns="http:\/\/www\.w3\.org\/2000\/svg/gi.test(a)&&(a=a.replace('xmlns="http://www.w3.org/2000/svg','xmlns:xlink="http://www.w3.org/1999/xlink')),e)for(n=0,t=Object.keys(rr);n<t.length;n++)i=rr[r=t[n]],(o=RegExp(r,"gi")).test(a)&&(a=a.replace(o,i));return a},re.prototype.getSvg=function(){return this.__root},re.prototype.save=function(){var e=this.__createElement("g"),t=this.__closestGroupOrSvg();this.__groupStack.push(t),t.appendChild(e),this.__currentElement=e,this.__stack.push(this.__getStyleState())},re.prototype.restore=function(){this.__currentElement=this.__groupStack.pop(),this.__currentElementsToStyle=null,this.__currentElement||(this.__currentElement=this.__root.childNodes[1]);var e=this.__stack.pop();this.__applyStyleState(e)},re.prototype.__addTransform=function(e){var t=this.__closestGroupOrSvg();if(t.childNodes.length>0){"path"===this.__currentElement.nodeName&&(this.__currentElementsToStyle||(this.__currentElementsToStyle={element:t,children:[]}),this.__currentElementsToStyle.children.push(this.__currentElement),this.__applyCurrentDefaultPath());var n=this.__createElement("g");t.appendChild(n),this.__currentElement=n}var r=this.__currentElement.getAttribute("transform");r?r+=" ":r="",r+=e,this.__currentElement.setAttribute("transform",r)},re.prototype.scale=function(e,t){void 0===t&&(t=e),this.__addTransform(tK("scale({x},{y})",{x:e,y:t}))},re.prototype.rotate=function(e){this.__addTransform(tK("rotate({angle},{cx},{cy})",{angle:180*e/Math.PI,cx:0,cy:0}))},re.prototype.translate=function(e,t){this.__addTransform(tK("translate({x},{y})",{x:e,y:t}))},re.prototype.transform=function(e,t,n,r,i,o){this.__addTransform(tK("matrix({a},{b},{c},{d},{e},{f})",{a:e,b:t,c:n,d:r,e:i,f:o}))},re.prototype.beginPath=function(){var e;this.__currentDefaultPath="",this.__currentPosition={},e=this.__createElement("path",{},!0),this.__closestGroupOrSvg().appendChild(e),this.__currentElement=e},re.prototype.__applyCurrentDefaultPath=function(){var e=this.__currentElement;"path"===e.nodeName?e.setAttribute("d",this.__currentDefaultPath):console.error("Attempted to apply path command to node",e.nodeName)},re.prototype.__addPathCommand=function(e){this.__currentDefaultPath+=" ",this.__currentDefaultPath+=e},re.prototype.moveTo=function(e,t){"path"!==this.__currentElement.nodeName&&this.beginPath(),this.__currentPosition={x:e,y:t},this.__addPathCommand(tK("M {x} {y}",{x:e,y:t}))},re.prototype.closePath=function(){this.__currentDefaultPath&&this.__addPathCommand("Z")},re.prototype.lineTo=function(e,t){this.__currentPosition={x:e,y:t},this.__currentDefaultPath.indexOf("M")>-1?this.__addPathCommand(tK("L {x} {y}",{x:e,y:t})):this.__addPathCommand(tK("M {x} {y}",{x:e,y:t}))},re.prototype.bezierCurveTo=function(e,t,n,r,i,o){this.__currentPosition={x:i,y:o},this.__addPathCommand(tK("C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}",{cp1x:e,cp1y:t,cp2x:n,cp2y:r,x:i,y:o}))},re.prototype.quadraticCurveTo=function(e,t,n,r){this.__currentPosition={x:n,y:r},this.__addPathCommand(tK("Q {cpx} {cpy} {x} {y}",{cpx:e,cpy:t,x:n,y:r}))};var tQ=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);return[e[0]/t,e[1]/t]};re.prototype.arcTo=function(e,t,n,r,i){var o=this.__currentPosition&&this.__currentPosition.x,a=this.__currentPosition&&this.__currentPosition.y;if(void 0!==o&&void 0!==a){if(i<0)throw Error("IndexSizeError: The radius provided ("+i+") is negative.");if(o===e&&a===t||e===n&&t===r||0===i){this.lineTo(e,t);return}var s=tQ([o-e,a-t]),l=tQ([n-e,r-t]);if(s[0]*l[1]==s[1]*l[0]){this.lineTo(e,t);return}var c=Math.acos(Math.abs(s[0]*l[0]+s[1]*l[1])),h=tQ([s[0]+l[0],s[1]+l[1]]),u=i/Math.sin(c/2),d=e+u*h[0],p=t+u*h[1],f=[-s[1],s[0]],m=[l[1],-l[0]],g=function(e){var t=e[0];return e[1]>=0?Math.acos(t):-Math.acos(t)},y=g(f),v=g(m);this.lineTo(d+f[0]*i,p+f[1]*i),this.arc(d,p,i,y,v)}},re.prototype.stroke=function(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","fill stroke markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("stroke")},re.prototype.fill=function(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","stroke fill markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("fill")},re.prototype.rect=function(e,t,n,r){"path"!==this.__currentElement.nodeName&&this.beginPath(),this.moveTo(e,t),this.lineTo(e+n,t),this.lineTo(e+n,t+r),this.lineTo(e,t+r),this.lineTo(e,t),this.closePath()},re.prototype.fillRect=function(e,t,n,r){var i;i=this.__createElement("rect",{x:e,y:t,width:n,height:r},!0),this.__closestGroupOrSvg().appendChild(i),this.__currentElement=i,this.__applyStyleToCurrentElement("fill")},re.prototype.strokeRect=function(e,t,n,r){var i;i=this.__createElement("rect",{x:e,y:t,width:n,height:r},!0),this.__closestGroupOrSvg().appendChild(i),this.__currentElement=i,this.__applyStyleToCurrentElement("stroke")},re.prototype.__clearCanvas=function(){for(var e=this.__closestGroupOrSvg().getAttribute("transform"),t=this.__root.childNodes[1],n=t.childNodes,r=n.length-1;r>=0;r--)n[r]&&t.removeChild(n[r]);this.__currentElement=t,this.__groupStack=[],e&&this.__addTransform(e)},re.prototype.clearRect=function(e,t,n,r){if(0===e&&0===t&&n===this.width&&r===this.height){this.__clearCanvas();return}var i,o=this.__closestGroupOrSvg();i=this.__createElement("rect",{x:e,y:t,width:n,height:r,fill:"#FFFFFF"},!0),o.appendChild(i)},re.prototype.createLinearGradient=function(e,t,n,r){var i=this.__createElement("linearGradient",{id:tZ(this.__ids),x1:e+"px",x2:n+"px",y1:t+"px",y2:r+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(i),new rt(i,this)},re.prototype.createRadialGradient=function(e,t,n,r,i,o){var a=this.__createElement("radialGradient",{id:tZ(this.__ids),cx:r+"px",cy:i+"px",r:o+"px",fx:e+"px",fy:t+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(a),new rt(a,this)},re.prototype.__parseFont=function(){var e=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\'\"\sa-z0-9]+?)\s*$/i.exec(this.font),t={style:e[1]||"normal",size:e[4]||"10px",family:e[6]||"sans-serif",weight:e[3]||"normal",decoration:e[2]||"normal",href:null};return"underline"===this.__fontUnderline&&(t.decoration="underline"),this.__fontHref&&(t.href=this.__fontHref),t},re.prototype.__wrapTextLink=function(e,t){if(e.href){var n=this.__createElement("a");return n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e.href),n.appendChild(t),n}return t},re.prototype.__applyText=function(e,t,n,r){var i,o,a,s,l=this.__parseFont(),c=this.__closestGroupOrSvg(),h=this.__createElement("text",{"font-family":l.family,"font-size":l.size,"font-style":l.style,"font-weight":l.weight,"text-decoration":l.decoration,x:t,y:n,"text-anchor":(i=this.textAlign,(o={left:"start",right:"end",center:"middle",start:"start",end:"end"})[i]||o.start),"dominant-baseline":(a=this.textBaseline,(s={alphabetic:"alphabetic",hanging:"hanging",top:"text-before-edge",bottom:"text-after-edge",middle:"central"})[a]||s.alphabetic)},!0);h.appendChild(this.__document.createTextNode(e)),this.__currentElement=h,this.__applyStyleToCurrentElement(r),c.appendChild(this.__wrapTextLink(l,h))},re.prototype.fillText=function(e,t,n){this.__applyText(e,t,n,"fill")},re.prototype.strokeText=function(e,t,n){this.__applyText(e,t,n,"stroke")},re.prototype.measureText=function(e){return this.__ctx.font=this.font,this.__ctx.measureText(e)},re.prototype.arc=function(e,t,n,r,i,o){if(r!==i){(r%=2*Math.PI)==(i%=2*Math.PI)&&(i=(i+2*Math.PI-.001*(o?-1:1))%(2*Math.PI));var a=e+n*Math.cos(i),s=t+n*Math.sin(i),l=e+n*Math.cos(r),c=t+n*Math.sin(r),h=0,u=i-r;u<0&&(u+=2*Math.PI),h=o?u>Math.PI?0:1:u>Math.PI?1:0,this.lineTo(l,c),this.__addPathCommand(tK("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:n,ry:n,xAxisRotation:0,largeArcFlag:h,sweepFlag:o?0:1,endX:a,endY:s})),this.__currentPosition={x:a,y:s}}},re.prototype.clip=function(){var e=this.__closestGroupOrSvg(),t=this.__createElement("clipPath"),n=tZ(this.__ids),r=this.__createElement("g");this.__applyCurrentDefaultPath(),e.removeChild(this.__currentElement),t.setAttribute("id",n),t.appendChild(this.__currentElement),this.__defs.appendChild(t),e.setAttribute("clip-path",tK("url(#{id})",{id:n})),e.appendChild(r),this.__currentElement=r},re.prototype.drawImage=function(){var e,t,n,r,i,o,a,s,l,c,h,u,d,p,f=Array.prototype.slice.call(arguments),m=f[0],g=0,y=0;if(3===f.length)e=f[1],t=f[2],i=m.width,o=m.height,n=i,r=o;else if(5===f.length)e=f[1],t=f[2],n=f[3],r=f[4],i=m.width,o=m.height;else if(9===f.length)g=f[1],y=f[2],i=f[3],o=f[4],e=f[5],t=f[6],n=f[7],r=f[8];else throw Error("Inavlid number of arguments passed to drawImage: "+arguments.length);a=this.__closestGroupOrSvg(),this.__currentElement;var v="translate("+e+", "+t+")";if(m instanceof re){if((s=m.getSvg().cloneNode(!0)).childNodes&&s.childNodes.length>1){for(l=s.childNodes[0];l.childNodes.length;)p=l.childNodes[0].getAttribute("id"),this.__ids[p]=p,this.__defs.appendChild(l.childNodes[0]);if(c=s.childNodes[1]){var w,x=c.getAttribute("transform");w=x?x+" "+v:v,c.setAttribute("transform",w),a.appendChild(c)}}}else"IMG"===m.nodeName?((h=this.__createElement("image")).setAttribute("width",n),h.setAttribute("height",r),h.setAttribute("preserveAspectRatio","none"),(g||y||i!==m.width||o!==m.height)&&((u=this.__document.createElement("canvas")).width=n,u.height=r,(d=u.getContext("2d")).drawImage(m,g,y,i,o,0,0,n,r),m=u),h.setAttribute("transform",v),h.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===m.nodeName?m.toDataURL():m.getAttribute("src")),a.appendChild(h)):"CANVAS"===m.nodeName&&((h=this.__createElement("image")).setAttribute("width",n),h.setAttribute("height",r),h.setAttribute("preserveAspectRatio","none"),(u=this.__document.createElement("canvas")).width=n,u.height=r,(d=u.getContext("2d")).imageSmoothingEnabled=!1,d.mozImageSmoothingEnabled=!1,d.oImageSmoothingEnabled=!1,d.webkitImageSmoothingEnabled=!1,d.drawImage(m,g,y,i,o,0,0,n,r),m=u,h.setAttribute("transform",v),h.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",m.toDataURL()),a.appendChild(h))},re.prototype.drawImageSvg=function(){var e,t,n,r,i,o,a,s,l,c,h=Array.prototype.slice.call(arguments),u=h[0];if(3===h.length)e=h[1],t=h[2],i=u.width,o=u.height,n=i,r=o;else if(5===h.length)e=h[1],t=h[2],n=h[3],r=h[4],i=u.width,o=u.height;else if(9===h.length)h[1],h[2],i=h[3],o=h[4],e=h[5],t=h[6],n=h[7],r=h[8];else throw Error("Inavlid number of arguments passed to drawImage: "+arguments.length);a=this.__closestGroupOrSvg(),this.__currentElement;var d="translate("+e+", "+t+")";if(u instanceof SVGSVGElement&&u.childNodes&&u.childNodes.length>1){var p=parseFloat(u.getAttribute("width")),f=parseFloat(u.getAttribute("height"));u.setAttribute("width",n),u.setAttribute("height",r);var m=n/p,g=r/f;for(s=u.childNodes[0];s.childNodes.length;)c=s.childNodes[0].getAttribute("id"),this.__ids[c]=c,this.__defs.appendChild(s.childNodes[0]);if(l=u.childNodes[1]){var y,v=l.getAttribute("transform");y=v?v+" "+d:d,l.setAttribute("transform",y+" scale("+m+", "+g+")"),a.appendChild(l)}}},re.prototype.createPattern=function(e,t){var n,r=this.__document.createElementNS("http://www.w3.org/2000/svg","pattern"),i=tZ(this.__ids);return r.setAttribute("id",i),r.setAttribute("width",e.width),r.setAttribute("height",e.height),"CANVAS"===e.nodeName||"IMG"===e.nodeName?((n=this.__document.createElementNS("http://www.w3.org/2000/svg","image")).setAttribute("width",e.width),n.setAttribute("height",e.height),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===e.nodeName?e.toDataURL():e.getAttribute("src")),r.appendChild(n),this.__defs.appendChild(r)):e instanceof re&&(r.appendChild(e.__root.childNodes[1]),this.__defs.appendChild(r)),new rn(r,this)},re.prototype.setLineDash=function(e){e&&e.length>0?this.lineDash=e.join(","):this.lineDash=null},re.prototype.drawFocusRing=function(){},re.prototype.createImageData=function(){},re.prototype.getImageData=function(){},re.prototype.putImageData=function(){},re.prototype.globalCompositeOperation=function(){},re.prototype.setTransform=function(){};var t0=re;function t1(){let e=this;e.ctx=new t0,e.background=e.ctx.getSvg(),e.background.setAttribute("class","background"),e.fctx=new t0,e.foreground=e.fctx.getSvg(),e.foreground.setAttribute("class","foreground"),e.setSize=(t,n)=>{let r=`${t}px`,i=`${n}px`;e.ctx.width=t,e.ctx.height=n,e.background.style.width=r,e.background.style.height=i,e.fctx.width=t,e.fctx.height=n,e.foreground.style.width=r,e.foreground.style.height=i},e.setDisplayStyle=t=>{e.background.style.display=t,e.foreground.style.display=t},e.setStrokeStyle=t=>{e.ctx.strokeStyle=t,e.fctx.strokeStyle=t}}function t2(e,t,n,r){let i=this;i.common=e,i.common.attach(i),i.canvas=new tY,i.svg=new t1,i.download=new tJ(i,t),i.setShowDownloadScreenLink=i.download.setShowDownloadScreenLink,i.tweenGroup=new tH.Group,i.tooltips=document.createElement("div"),i.tooltips.setAttribute("class","tooltips");let o=document.createElement("div");i.wrap=document.createElement("div"),i.wrap.setAttribute("class","screenWrap"),i.wrap.appendChild(o),i.wrap.appendChild(i.canvas.background),i.wrap.appendChild(i.canvas.foreground),i.wrap.appendChild(i.svg.background),i.wrap.appendChild(i.svg.foreground),i.wrap.appendChild(i.tooltips),i.outer=document.createElement("div"),i.outer.appendChild(i.wrap),i.outer.appendChild(i.download.div),n.newElement(r,i.outer),i.setSize=(e,t)=>{let n=`${e}px`,r=`${t}px`;i.width=e,i.height=t,i.tooltips.style.width=n,i.tooltips.style.height=r,i.wrap.style.width=n,i.wrap.style.height=r,i.svg.setSize(e,t),i.canvas.setSize(e,t)},i.setWidth=e=>{i.setSize(e,i.height)},i.setHeight=e=>{i.setSize(i.width,e)};let{width:a,height:s}=e;i.setSize(a,s),i.setFCtx=e=>{i.fctx=e},i.clear=function(){i.ctx.clearRect(0,0,i.width,i.height),i.common.darkMode&&i.noBuffers&&(i.ctx.fillStyle="#222",i.ctx.fillRect(0,0,i.width,i.height),i.ctx.fillStyle="white")},i.clearForeground=function(){i.fctx.clearRect(0,0,i.width,i.height)},i.switchToSVG=()=>{i.ctx=i.svg.ctx,i.fctx=i.svg.fctx,i.canvas.setDisplayStyle("none"),i.svg.setDisplayStyle("block"),i.noBuffers=!0},i.switchToCanvas=()=>{i.ctx=i.canvas.ctx,i.fctx=i.canvas.fctx,i.canvas.setDisplayStyle("block"),i.svg.setDisplayStyle("none"),i.noBuffers=!1},i.setSvgMode=e=>{e?i.switchToSVG():i.switchToCanvas()},i.setSvgMode(!1),i.show=()=>{i.outer.style.display="block"},i.hide=()=>{i.outer.style.display="none"},i.setDarkMode=e=>{let t=e?"#ddd":"#222";i.canvas.setStrokeStyle(t),i.svg.setStrokeStyle(t)},i.setDarkMode(e.darkMode),i.eventHandlers=new tX;let{handlers:l}=i.eventHandlers;i.wrap.onmousedown=e=>l.start(e),i.wrap.onmousemove=e=>l.move(e),i.wrap.onmouseup=e=>l.end(e),i.wrap.addEventListener("touchmove",e=>l.touchmove(e)),i.wrap.addEventListener("touchstart",e=>l.touchstart(e)),i.wrap.addEventListener("touchend",e=>l.touchend(e));let c=document.onmouseup;document.onmouseup=e=>{c&&c(e),i.wrap.onmouseup(e)}}function t5(e,t){let n=this;n.config=e,n.name=e.name,n.nameIsHTML=e.nameIsHTML||!1,n.dom=document.createElement("div"),n.dom.setAttribute("class","button button2");let r=e.margin;r=Math.max(r=r||0,4),n.dom.style.marginRight=`${r}px`,n.draw=function(){n.nameIsHTML?n.dom.innerHTML=n.name:n.dom.innerText=n.name},n.draw(),n.dom.setAttribute("title",e.explain||""),n.onClick=function(){t(n,e)},n.dom.onclick=n.onClick,n.turnOff=function(){n.isOn=!1,n.config.isOn=!1,n.dom.setAttribute("on","no")},n.turnOn=function(){n.isOn=!0,n.config.isOn=!0,n.dom.setAttribute("on","yes")},n.turnOff()}function t3(e){let t=this;t.config=e,void 0===e.data&&(e.data=[],void 0===e.makeData&&(e.makeData=()=>[]),t.makeData=e.makeData,t.buttonConfigs=t.makeData(),t.doMakeData=!0),t.buttonConfigs=e.data,t.labelName=e.label,t.labelIsHTML=e.labelIsHTML||!1,t.onChoose=e.onChoose,t.isCheckbox=e.isCheckbox||!1,t.isCheckboxBool=e.isCheckboxBool||!1,t.justButton=e.justButton||!1,t.buttonHidden=e.buttonHidden||{},t.dom=document.createElement("div"),t.dom.setAttribute("class","button-group"),t.buttonDOMByValue=[],t.init=function(){t.doMakeData&&(t.buttonConfigs=t.makeData()),t.dom.innerHTML="",t.buttons=[],t.buttonsByName={},t.labelDOM=document.createElement("div"),t.labelDOM.setAttribute("class","button-group-label"),t.labelDOM.setAttribute("title",e.explain||""),t.labelTip=document.createElement("div"),t.labelTip.setAttribute("class","label-tip"),t.labelTip.innerText=e.explain||"";let n=!0;t.labelTip.hidden=n,t.labelDOM.onclick=()=>{n=!n,void 0===e.explain&&(n=!0),t.labelTip.hidden=n},t.dom.appendChild(t.labelDOM),t.dom.appendChild(t.labelTip),t.draw(),t.buttonContainer=document.createElement("div"),t.buttonContainer.setAttribute("class","button-group-button-container"),t.dom.appendChild(t.buttonContainer);for(let n=0;n<t.buttonConfigs.length;n++){let r=t.buttonConfigs[n],i=new t5(r,t.onToggle);t.buttonsByName[r.name]=i,i.dom.style.width=`${e.width}px`,r.width&&(i.dom.style.width=`${r.width}px`),t.buttons.push(i),t.buttonContainer.appendChild(i.dom),t.buttonDOMByValue[r.value]=i.dom}for(let e=0;e<t.buttons.length;e++){let n=t.buttons[e];if(n.config.selected){n.turnOn();break}}t.draw()},t.updateNames=function(){let e=t.makeData();for(let n=0;n<t.buttonConfigs.length;n++)t.buttonConfigs[n].name=e[n].name,t.buttons[n].name=t.buttonConfigs[n].name},t.redraw=function(){t.updateNames(),t.draw()},t.draw=function(){for(let e of(t.labelIsHTML?t.labelDOM.innerHTML=t.labelName:t.labelDOM.innerText=t.labelName,t.buttons))e.draw()},t.configureHidden=function(){for(let[e,n]of Object.entries(t.buttonHidden))t.buttonsByName[e].dom.hidden=n},t.onToggle=function(e,n){if(t.isCheckbox||t.isCheckboxBool)e.isOn?e.turnOff():e.turnOn();else{for(let e=0;e<t.buttons.length;e++)t.buttons[e].turnOff();e.turnOn(),t.justButton&&setTimeout(()=>e.turnOff(),800)}t.onChoose(n)},t.highlight=function(e,n){if(0!==t.buttons.length){for(let e=0;e<t.buttons.length;e++)t.buttons[e].turnOff();if(t.isCheckbox)for(let r in t.buttons){let i=t.buttons[r];n.includes(i.config[e])&&i.turnOn()}else if(t.isCheckboxBool)for(let r in t.buttons){let i=t.buttons[r],o=i.config[e];o in n&&n[o]&&i.turnOn()}else{let r=t.buttons.filter(t=>t.config[e]===n)[0];void 0!==r&&r.turnOn()}}},t.init()}function t4(e,t,n){let{label:r,options:i,changeList:o,getValue:a,onChoose:s,explain:l,checkShow:c}=n,h=this;e.attach(h),h.choose=new t3({label:r,explain:l,width:t6(3),data:i,onChoose:s}),h.update=()=>{t.check(o)&&h.select(),void 0!==c&&(c()?h.choose.dom.hidden=!1:h.choose.dom.hidden=!0)},h.select=function(){h.choose.highlight("value",a())}}function t6(e){return(302-18*(e-1)-10)/e}function t8(e){let t=this;t.setShowNonExistingEntities=n=>{t.showGhosts=n,e.add(["showGhosts"])}}function t9(){this.enter=()=>{},this.exit=()=>{},this.update=function(){},this.render=function(){}}function t7(e,t){let n=e.length,r=[0,0,0],i=0;for(let o=0;o<n;o++){for(let n=0;n<3;n++)r[n]+=e[o]*t[o][n]**2;i+=e[o]}return r.map(e=>Math.round(Math.sqrt(e/i)))}function ne(e){return`rgb(${e[0]},${e[1]},${e[2]})`}function nt(e){let t;let n=!1;this.enter=()=>{e.show()},this.exit=()=>{e.hide()},this.update=function(r,i,o){let{error:a}=i;if(void 0!==a){n=!0;return}n=!1;let s=function(e,t){let{socialChoiceResults:n,votes:r}=t,{colorRGBAOfCandidates:i}=e,{winnersByRound:o,winnerMaxCostPerScoreByRound:a}=n.explanation,{scoreVotes:s}=r.preferenceLists,{votesByGeom:l}=r,c=o.length,h=l.length,u=[],d=[],p=[];for(let e=0;e<h;e++){let{voteIndex:t}=l[e],n=t.length,r=[];r[0]=Array(n).fill(1);let h=[],f=[];for(let e=0;e<c;e++){let l=r[e],u=Array(n),d=Array(n),p=o[e],m=a[e];for(let e=0;e<n;e++){let n=m*s[t[e]][p];d[e]=Math.min(l[e],n),u[e]=Math.max(0,l[e]-n)}h[e]=d,f[e]=i[p],e<c-1&&(r[e+1]=u)}p[e]=f,u[e]=h,d[e]=r}return{costsByGeom:u,budgetsByGeom:d,colorRGBAByGeom:p}}(r,o);t=function(e,t,n){let{socialChoiceResults:r,votes:i}=e,{winnersByRound:o}=r.explanation,{costsByGeom:a,budgetsByGeom:s,colorRGBAByGeom:l}=n,{votesByGeom:c}=i,h=o.length,u=c.length,d=-t.width/3,p=t.width/3,f=[],m=[];for(let e=0;e<u;e++){let{grid:n,voteIndex:r,voterGeom:i}=c[e],{w:o,densityProfile:l}=i,u=i.x,g=n.x,y="gaussian"===l,v=o/Math.sqrt(2*Math.PI),w=r.length,x=s[e],_=a[e],b=[],C=[];for(let e=0;e<h;e++){let n=x[e],r=_[e],i=[],o=[],a=e%3*p,s=(Math.floor(e/3)+1)*p,l=0,c=0*d+s,h=.3333333333333333*Math.max(-1,g[0])+a;i[l]=[h,c],o[l]=[h,c],l+=1;for(let e=0;e<w;e++){let c=g[e];if(c<-1||c>t.width+1)continue;let h=y?Math.exp(-.5*((c-u)/v)**2):1,p=r[e]*h,f=n[e]*h,m=.3333333333333333*c+a,w=f*d+s;i[l]=[m,w];let x=.3333333333333333*c+a,_=p*d+s;o[l]=[x,_],l+=1}let f=.3333333333333333*Math.min(t.width+1,g[w-1])+a;i[l]=[f,c],o[l]=[f,c],i[l+=1]=[h,c],o[l]=[h,c],l+=1,C[e]=o,b[e]=i}f[e]=C,m[e]=b}return{costShapesbyGeom:f,budgetShapesbyGeom:m,colorRGBAByGeom:l}}(o,e,s)},this.render=function(){n||function(e,t){let{costShapesbyGeom:n,budgetShapesbyGeom:r,colorRGBAByGeom:i}=t,o=n.length,{ctx:a}=e;a.save(),a.globalAlpha=.7;for(let e=0;e<o;e++){let t=n[e],o=r[e],s=i[e],l=t.length;for(let e=0;e<l;e++){let n=t[e],r=o[e],i=s[e];a.fillStyle="#cccccc",a.strokeStyle="#555555",a.beginPath(),a.moveTo(r[0][0],r[0][1]);for(let e=1;e<r.length;e++)a.lineTo(r[e][0],r[e][1]);a.fill(),a.stroke(),a.fillStyle=ne(i),a.strokeStyle=ne(t7([.5,.5],[i,[0,0,0]])),a.beginPath(),a.moveTo(n[0][0],n[0][1]);for(let e=1;e<n.length;e++)a.lineTo(n[e][0],n[e][1]);a.fill(),a.stroke()}}a.restore()}(e,t)}}function nn(e,t){let{sequenceName:n,sequences:r}=e.sequenceOptions,{resultsPhaseBySeq:i}=t,o=i[n];return r[n].phases[o]}function nr(e,t){if(e.error)return e;let{sequenceName:n}=e.optionsBag.sequenceOptions,{resultsPhaseBySeq:r}=t,i=r[n];if("closedPrimary"===n&&"closedPrimary"===i){let{resultsPartyBySeq:n}=t,r=n[i],o=e.phases[i][r];return void 0===o?{error:!0}:o}return e.phases[i]}function ni(e,t,n,r,i,o,a){let s;let l=this;a.viewModes.one.attach(l);let c=new t2(e,a,t,"budget"),{height:h}=e;function u(){let e=o.getOptions(),{useGeography:t}=e,{socialChoiceMethod:n}=nn(e,i),{dimensions:r}=i;s=new("methodOfEqualShares"!==n||t||1!==r?t9:nt)(c)}c.setHeight(h/3),c.hide(),u(),l.enter=()=>{u(),s.enter()},l.exit=()=>{s.exit()},l.update=e=>{if(!r.checkNone()){if(r.check(["numDistricts","numTracts","dimensions","socialChoiceMethod"])&&(l.exit(),l.enter()),!0===o.getOptions().useGeography);else{let{geoResults:t}=e,n=t.scResultsByDistrict[0],r=nr(n,i);s.update(t,n,r)}l.clear(),l.render()}},l.render=()=>{s.render()},l.clear=()=>{c.clear()},l.draw=()=>{l.clear(),l.render()}}function no(e){let t,n;this.update=e=>{t=e.geometry.geography.voterGeomsByTract,n=e.geometry.dimensions},this.render=()=>{let{ctx:o}=e,{svgMode:a}=e.common;o.save(),1===n?(o.globalAlpha=.3,t.forEach(e=>{e.forEach(e=>{e.forEach(e=>{let{x:t}=e;o.beginPath(),o.moveTo(t,0),o.lineTo(t,100),o.stroke()})})})):t.forEach(e=>{e.forEach(e=>{e.forEach(e=>{let{x:t,y:n}=e;(function(e,t,n,o){if(t){i(e,n,o);return}e.drawImage(r,n-5,o-5,10,10)})(o,a,t,n)})})}),o.restore()};let r=document.createElement("canvas");function i(e,t,n){e.beginPath(),e.fillStyle="#555",e.arc(t,n,1,0,2*Math.PI),e.fill()}r.width=10,r.height=10,i(r.getContext("2d"),5,5)}function na(e,t){let n=this;n.render=function(){let{ctx:n}=t,{darkMode:r}=t.common,{x:i,w:o,densityProfile:a}=e.shape1;n.save(),n.strokeStyle="#555",r&&(n.strokeStyle="#ddd"),n.beginPath(),"gaussian"===a?function(){let e=o/Math.sqrt(2*Math.PI);n.moveTo(0,200);let r=[];for(let o=0;o<=t.width;o+=1){let t=200-100*Math.exp(-(.5*((o-i)/e)**2));r.push(t),n.lineTo(o,t)}n.lineTo(t.width,200),n.lineTo(0,200)}():n.rect(i-.5*o,100,o,100),n.stroke(),n.restore()},n.renderAt=()=>{n.render()}}function ns(e,t){this.render=function(){let{ctx:n}=t,{darkMode:r}=t.common,{x:i,y:o,w:a,densityProfile:s}=e.shape2;n.save(),"gaussian"===s&&(n.setLineDash([1,9]),n.lineWidth=10),n.beginPath(),n.strokeStyle="#555",r&&(n.strokeStyle="#ddd"),n.arc(i,o,.5*a,0,2*Math.PI),n.stroke(),n.restore()},this.renderAt=function(n,r){let{ctx:i}=t,{darkMode:o}=t.common,{w:a}=e.shape2;i.beginPath(),i.strokeStyle="#555",o&&(i.strokeStyle="#ddd"),i.arc(n,r,.5*a,0,2*Math.PI),i.stroke()},this.renderCenterAt2=function(e,n){let{ctx:r}=t,{darkMode:i}=t.common;r.beginPath(),r.fillStyle="#555",i&&(r.fillStyle="#bbb"),r.arc(e,n,1,0,2*Math.PI),r.fill()}}function nl(e,t,n,r,i){let{dimensions:o}=i,a=1===o?na:ns;e.setRenderer(e=>new a(e,n));let s=new no(n);this.enter=()=>{},this.exit=()=>{},this.update=e=>{s.update(e)},this.render=()=>{e.render(),s.render()}}function nc(e,t,n){let r,i;this.update=function(){if(void 0===(i=t.getEntities()))return;let e=i.map(e=>[e.shape1.x,0]);r=tk.from(e).voronoi([0,0,n.width,n.height])},this.render=function(){if(void 0===i)return;let{ctx:t}=n,{x:o,w:a,densityProfile:s}=e.shape1;t.save(),t.beginPath(),c(),t.clip();let l=i.length;for(let e=0;e<l;e++)t.beginPath(),r.renderCell(e,t),t.fillStyle=i[e].color,t.fill(),t.stroke();function c(){"gaussian"===s?function(){let e=a/Math.sqrt(2*Math.PI);t.moveTo(0,200);let r=[];for(let i=0;i<=n.width;i+=1){let n=200-100*Math.exp(-(.5*((i-o)/e)**2));r.push(n),t.lineTo(i,n)}t.lineTo(n.width,200),t.lineTo(0,200)}():t.rect(o-.5*a,100,a,100)}t.beginPath(),c(),t.stroke(),t.restore()}}function nh(e,t,n){let r,i;this.update=function(){let e=(i=t.getEntities()).map(e=>[e.shape2.x,e.shape2.y]);r=tk.from(e).voronoi([0,0,n.width,n.height])},this.render=function(){let{ctx:t}=n,{x:o,y:a,w:s}=e.shape2;t.save(),t.beginPath(),t.arc(o,a,.5*s,0,2*Math.PI),t.clip();let l=i.length;for(let e=0;e<l;e++)t.beginPath(),r.renderCell(e,t),t.fillStyle=i[e].color,t.fill(),t.stroke();t.beginPath(),t.arc(o,a,.5*s,0,2*Math.PI),t.stroke(),t.restore()}}function nu(e,t,n,r,i){let{dimensions:o}=i,a=1===o?nc:nh;e.setRenderer(e=>new a(e,t,n)),this.enter=()=>{},this.exit=()=>{},this.update=function(t){let{error:n}=t;void 0===n&&e.updateGraphic()},this.render=function(){e.render()}}const nd=1/Math.PI,np=1/Math.sqrt(8);function nf(e){return[...Array(e).keys()]}function nm(e,t,n){return Array.from(Array(e),()=>Array.from(Array(t),()=>Array(n)))}function ng(){let e;let t=[.1,.2,.3,.4,.5,.6,.7,.8,.9];this.update=function(n,r){r.map(e=>ne(e.colorRGBA));let i=r.map(e=>e.shape2.x),o=r.map(e=>e.shape2.y),{voterGeoms:a}=n.geometry,s=a.map(e=>e.x),l=a.map(e=>e.y),c=a.map(e=>e.w),h={step:1,gaussian:2};e=function(e,t,n,r,i,o,a,s){let l=s.length,c=o.length,h=e.length,u={x:nm(c,l,200),y:nm(c,l,200)};for(let d=0;d<200;d++){let f=d/200*Math.PI*2,m=Math.cos(f),g=Math.sin(f),y=Array(h);for(let n=0;n<h;n++)y[n]=m*e[n]+g*t[n];for(let e=0;e<l;e++){let t=function(e,t,n,r,i){let o=e.length,a=function(e){let t=e.length,n=0;for(let r=0;r<t;r++)n+=e[r];return n}(r),s=nf(o).map(n=>e[n]+t[n]*np*3);return function(e,t,n,r,i){let o;if(t>e(r))return console.log("out of bounds"),r;if(t<e(n))return console.log("out of bounds"),n;let a=0;for(;n<=r&&a<30;){a+=1;let i=e(o=(n+r)*.5);if(t+.001<i)r=o;else if(t-.001>i)n=o;else break}return o}(i=>{let s=0;for(let a=0;a<o;a++)2===n[a]?s+=p(i,e[a],t[a]*np)*r[a]:s+=function(e,t,n){let r=(e-t)/n;return r>1?1:r<-1?0:(r*Math.sqrt(1-r*r)+Math.asin(r))*nd+.5}(i,e[a],.5*t[a])*r[a];return s/a},i,Math.min(...nf(o).map(n=>e[n]-t[n]*np*3)),Math.max(...s),0)}(y,r,n,i,s[e]);for(let n=0;n<c;n++){let r=2*Math.min(0,t-(m*o[n]+g*a[n]));u.x[n][e][d]=o[n]+m*r,u.y[n][e][d]=a[n]+g*r}}}return u}(s,l,a.map(e=>h[e.densityProfile]),c,a.map(e=>e.densityMax),i,o,t)},this.render=function(n){let r=e.x.length;n.save(),n.fillStyle="rgb(0 0 0)",n.fillRect(0,0,n.canvas.width,n.canvas.height),n.restore();for(let i=0;i<t.length;i++){n.save(),n.lineWidth=1;let o=Math.round(255*t[i]);n.fillStyle=`rgb(${o} ${o} ${o})`;for(let t=0;t<r;t++){let r=e.x[t][i],o=e.y[t][i],a=new Path2D;a.moveTo(r[0],o[0]);for(let e=1;e<r.length;e++)a.lineTo(r[e],o[e]);a.closePath(),n.clip(a)}n.fillRect(0,0,n.canvas.width,n.canvas.height),n.restore()}}}function ny(e,t,n){let r,i,o;this.update=function(e){let{rankings:n}=e,{intervalBorders:a}=e;if(void 0===n||void 0===a){let e=e$((r=t.getEntities()).map(e=>e.shape1.x));n=e.rankings,a=e.intervalBorders}let s=(r=t.getEntities()).length,l=r.map(e=>e.colorRGBA),c=a.length-1;o=Array(c),i=Array(c);for(let e=0;e<c;e++){o[e]=[a[e],a[e+1]];let t=n[e].map(e=>s-e);i[e]=ne(t7(t,l))}},this.render=function(){let{ctx:t}=n,{x:r,w:a,densityProfile:s}=e.shape1;t.save(),t.beginPath(),c(),t.clip();let l=o.length;for(let e=0;e<l;e++)(function(e,t,n,r){let i=Math.max(0,e[0]),o=Math.min(r.width,e[1]),a=r.height;n.beginPath(),n.rect(i,0,o-i,a),n.fillStyle=t,n.fill(),n.stroke()})(o[e],i[e],t,n);function c(){"gaussian"===s?function(){let e=a/Math.sqrt(2*Math.PI);t.moveTo(0,200);let i=[];for(let o=0;o<=n.width;o+=1){let n=200-100*Math.exp(-(.5*((o-r)/e)**2));i.push(n),t.lineTo(o,n)}t.lineTo(n.width,200),t.lineTo(0,200)}():t.rect(r-.5*a,100,a,100)}t.beginPath(),c(),t.stroke(),t.restore()}}function nv(e,t,n){let r,i,o;this.update=function(n){let{rankings:a}=n;if(o=n.cells,void 0===a||void 0===o){let n=(r=t.getEntities()).map(e=>[e.shape2.x,e.shape2.y]),i=eR(e.shape2,n,3);a=i.rankings,o=i.cells}let s=(r=t.getEntities()).length,l=o.length;i=Array(l);let c=r.map(e=>e.colorRGBA);for(let e=0;e<l;e++){let t=a[e].map(e=>s-e);i[e]=ne(t7(t,c))}},this.render=function(){let{ctx:t}=n,{x:r,y:a,w:s}=e.shape2;t.save();let l=o.length;for(let e=0;e<l;e++)t.beginPath(),function(e,t){let n=t.length,r=t[n-1];e.moveTo(r[0],r[1]);for(let r=0;r<n;r++){let n=t[r];e.lineTo(n[0],n[1])}}(t,o[e]),t.fillStyle=i[e],t.strokeStyle=i[e],t.fill(),t.stroke();t.strokeStyle="#222",t.beginPath(),t.arc(r,a,.5*s,0,2*Math.PI),t.stroke(),t.restore()}}function nw(e,t,n,r,i){let o;let{dimensions:a}=i,s=1===a?ny:nv;e.setRenderer(e=>new s(e,t,n));let l=new ng;this.enter=()=>{},this.exit=()=>{},this.update=function(n){let{error:r}=n;if(void 0!==r)return;let{votesByGeom:i}=n.votes;e.updateGraphic(i);let{socialChoiceMethod:a}=n.electionOptions;if(o="minimax"===a){let e=t.getEntities();l.update(n,e)}},this.render=function(){if(o){let{ctx:e}=n;l.render(e)}e.render()}}function nx(e){return e.scoreVote?"scoreVote":e.bordaFractions?"bordaFractions":e.pluralityAllocation?"pluralityAllocation":null}function n_(e,t){let n,r;function i(e,i,o){let{grid:a,voteSet:s}=n,{x:l,w:c,densityProfile:h}=a.voterGeom,u=r.length,d="gaussian"===h,p=a.x,f=c/Math.sqrt(2*Math.PI),m=200/u,g=200-i*m,y=Math.max(-1,p[0]);e.moveTo(y,g);let v=p.length,w=nx(s[0]);for(let n=0;n<v;n+=1){let r=p[n];if(r<-1||r>t.width)continue;let a=g-m*(d?Math.exp(-.5*((r-l)/f)**2):1)*(o?1:s[n][w][i]);e.lineTo(r,a)}let x=Math.min(t.width,p[v-1]);e.lineTo(x,g),e.lineTo(y,g)}this.update=t=>{n=t,r=e.getEntities()},this.renderBackground=function(){let{ctx:e}=t;e.save(),e.globalAlpha=.7;let n=r.length;for(let t=0;t<n;t++)e.strokeStyle="#dddddd",e.beginPath(),i(e,t,!0),e.stroke();e.restore()},this.render=function(){let{ctx:e}=t;e.save(),e.globalAlpha=.7;let n=r.length;for(let t=0;t<n;t++){e.fillStyle=r[t].color;let{colorRGBA:n}=r[t];e.strokeStyle=ne(t7([.5,.5],[n,[0,0,0]])),e.beginPath(),i(e,t,!1),e.fill(),e.stroke()}e.restore()}}function nb(e,t,n){let r,i,o;let a=[];this.update=t=>{r=t,i=e.getEntities();let{grid:s,voteSet:l}=r,{densityProfile:c}=s.voterGeom,h=Math.floor((i.length-1)/3)+1;n.setHeight(1/3*h*n.common.height);let u="gaussian"===c;(function(){let{nx:e,ny:t,density:n}=s;a.splice(0);let r=nx(l[0]);for(let o=0;o<i.length;o++){let s=document.createElement("canvas");s.width=e,s.height=t;let c=s.getContext("2d"),h=c.createImageData(e,t),{data:d}=h,{colorRGBA:p}=i[o],[f,m,g]=p,y=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){let a=l[y][r][o]*(u?n[y]:1)*255;d[(t+i*e)*4+0]=f,d[(t+i*e)*4+1]=m,d[(t+i*e)*4+2]=g,d[(t+i*e)*4+3]=a,y+=1}a.push(s),c.putImageData(h,0,0)}})(),function(){let{nx:e,ny:t,density:n}=s,r=i.map(e=>e.colorRGBA),a=document.createElement("canvas");a.width=e,a.height=t;let c=a.getContext("2d"),h=c.createImageData(e,t),{data:d}=h,p=nx(l[0]),f=0;for(let i=0;i<t;i++)for(let t=0;t<e;t++){let[o,a,s]=t7(l[f][p],r),c=(u?n[f]:1)*255;d[(t+i*e)*4+0]=o,d[(t+i*e)*4+1]=a,d[(t+i*e)*4+2]=s,d[(t+i*e)*4+3]=c,f+=1}o=a,c.putImageData(h,0,0)}()},this.render=function(){let{width:e,voterGeom:s}=r.grid,{x:l,y:c,w:h,densityProfile:u}=s;(function(){let{ctx:n}=t,{darkMode:r}=t.common;n.save(),n.beginPath(),n.arc(l,c,.5*e,0,2*Math.PI),n.clip();let i=o;n.imageSmoothingEnabled=!1;let a={x:l-.5*e+0,y:c-.5*e+0,w:1*e,h:1*e};n.drawImage(i,a.x,a.y,a.w,a.h),"gaussian"===u&&(n.setLineDash([1,9]),n.lineWidth=5),n.strokeStyle="#555",r&&(n.strokeStyle="#ddd"),n.beginPath(),n.arc(l,c,.5*h,0,2*Math.PI),n.stroke(),n.restore()})(),function(){let{ctx:t}=n,{darkMode:r}=n.common,o=i.length;for(let n=0;n<o;n++){t.save();let i={w:1/3,h:1/3,x:n%3*100,y:100*Math.floor(n/3)},o={x:l*i.w+i.x,y:c*i.h+i.y,r:h*i.w*.5},s={x:l*i.w+i.x,y:c*i.h+i.y,r:e*i.w*.5};t.beginPath(),t.arc(s.x,s.y,s.r,0,2*Math.PI),t.clip(),t.beginPath(),t.rect(i.x,i.y,100,100),t.clip();let d=a[n],p={x:l*i.w-e*i.w*.5+i.x,y:c*i.w-e*i.w*.5+i.y,w:e*i.w,h:e*i.h};t.drawImage(d,p.x,p.y,p.w,p.h),"gaussian"===u&&(t.setLineDash([1/3,3]),t.lineWidth=5/3),t.strokeStyle="#555",r&&(t.strokeStyle="#ddd"),t.beginPath(),t.arc(o.x,o.y,o.r,0,2*Math.PI),t.stroke(),t.restore()}}()}}function nC(e,t,n,r,i){let o;let{dimensions:a}=i,s=1===a?n_:nb;e.setRenderer(()=>new s(t,n,r));let l=new ng;this.enter=function(){2===a&&r.show()},this.exit=function(){r.hide()},this.update=function(n){let{error:r}=n;if(void 0!==r)return;let{votesByGeom:i}=n.votes;e.updateGraphic(i);let{socialChoiceMethod:a}=n.electionOptions;if(o="minimax"===a){let e=t.getEntities();l.update(n,e)}},this.render=function(){if(1===a&&e.renderBackground(),2===a&&o){let{ctx:e}=n;l.render(e)}e.render()}}function nS(){let e=this;e.list=[],e.updateNewG=t=>{e.add(t)},e.add=t=>{let n={};t.voterShape?(n.g=t.graphic.circle,n.r=t.graphic,n.o=t.voterShape,n.p={isCircle:!0}):t.candidate?(n.g=t.graphic.square,n.r=t.graphic,n.o=t.candidate,n.p={isSquare:!0}):t.canDn?(n.g=t.graphic.square,n.r=t.graphic,n.o=t.canDn,n.p={isSquare:!0}):(n.g=t.graphic.circle,n.r=t.graphic,n.o=t.testVoter,n.p={isCircle:!0}),e.list.push(n)}}function nP(e,t,n,r,i){let o,a;let s={},l=e.list,c=n.tooltips,h=function(e){if(null!==e.target.closest(".tooltipBox"))return;let t=f(e),n=e.isTouch?10:0,r=l.length,h=[];for(let e=0;e<r;e++){let r=l[e];(r.o.exists||i.showGhosts)&&m(r,t,n)&&h.push(e)}if(h.length>0){let e=v(h.map(e=>{let n=l[e];return(n.r.x-t.x)**2+(n.r.y-t.y)**2})),n=h[e],r=l[n];s.iDragging=n,s.isDragging=!0,s.offX=r.r.x-t.x,s.offY=r.r.y-t.y,r.g.pickUp(),c.dataset.cursor="grabbing"}o=!0,a={...t}},u=function(e){let t=f(e);if(s.isDragging){var h,u,d,p,g,y;e.isTouch&&(e.preventDefault(),e.stopPropagation());let i=l[s.iDragging],o=n.width,a=n.height;i.r.setXYView({x:(h=t.x+s.offX,u=0,d=o,h<0?u:h>d?d:h),y:(p=t.y+s.offY,g=0,y=a,p<0?g:p>y?y:p)}),r.add(["draggables"])}else{let e=l.length;for(let n=0;n<e;n++){let e=l[n];if((i.showGhosts||e.o.exists)&&m(e,t,0)){c.dataset.cursor="grab";return}}c.dataset.cursor=""}!function(e){if(o){let t=Math.abs(a.x-e.x),n=Math.abs(a.y-e.y);t>5&&(o=!1),n>5&&(o=!1)}}(t)},d=function(){o&&(o=!1,s.isDragging?l[s.iDragging].r.click():t.clickEmpty(a)),void 0!==s.iDragging&&l[s.iDragging].g.drop(),s={}};function p(e){return e.isTouch=!0,e}function f(e){let t=n.wrap.getBoundingClientRect(),r=e.isTouch?e.changedTouches[0]:e;return{x:r.clientX-t.left,y:r.clientY-t.top}}function m(e,t,n){let r=e.r.x-t.x,i=e.r.y-t.y;if(e.p.isCircle){let{r:t}=e.g;return r*r+i*i<(t+n)*(t+n)}if(e.p.isSquare){let{w:t,h:o}=e.g;return Math.abs(r)<.5*t+n&&Math.abs(i)<.5*o+n}return!1}this.eventHandlers={start:h,move:u,end:d,touchmove:e=>{u(p(e))},touchstart:e=>{h(p(e))},touchend:e=>{let t=p(e);u(t),d(t),null===e.target.closest(".tooltipBox")&&e.preventDefault()}}}function nk(e,t,n){let r=this;r.dragm=new nS,r.clickDrag=new nP(r.dragm,r,e,t,n),r.enter=()=>{e.eventHandlers.set(r.clickDrag.eventHandlers)},r.exit=()=>{},r.update=()=>{if(t.checkNone())return;e.clear();let[n,r]=[150,150];J("Not Yet Implemented",n,r,20,2,"#222",1,e.ctx)},r.render=()=>{},r.renderForeground=()=>{},r.testVoteView=()=>null}function nM(e){let t=this;t.voterShape=e,t.setRenderer=n=>{t.renderer=n(e)}}function nA(e){let t=this,n=[];t.list=n,t.rendererMaker=()=>({render:()=>{}}),e.attachNewE(t),t.updateNewE=e=>{t.newVoterShape(e)},t.newVoterShape=function(e){let r=new nM(e);n.push(r),r.setRenderer(t.rendererMaker)},t.getVoterShapes=()=>n.filter(e=>e.voterShape.exists).map(e=>e.voterShape),t.getVoterRenderers=()=>n.filter(e=>e.voterShape.exists),t.setRenderer=e=>{t.rendererMaker=e,n.forEach(t=>t.setRenderer(e))},t.updateGraphic=e=>{let n=t.getVoterRenderers();void 0===e?n.forEach(e=>e.renderer.update()):n.forEach((t,n)=>t.renderer.update(e[n]))},t.render=()=>{n.forEach(e=>{e.voterShape.exists&&e.renderer.render()})},t.renderBackground=()=>{n.forEach(e=>{e.voterShape.exists&&e.renderer.renderBackground()})}}function nE(e){return e.some(e=>e.strategy.some(e=>"closest"!==e.actionName&&0!==e.actionWeight))}function nT(e,t,n,r,i,o,a,s,l){let c;let h=this;s.viewModes.one.attach(h),nk.call(h,t,i,l);let{candidateList:u,voterShapeList:d}=e,p=new nA(d);function f(){let e=a.getOptions(),{voteCasterName:r}=nn(e,o),{dimensions:i}=o,s=d.getGeoms(i).some(e=>"gaussian"===e.densityProfile)&&2===i,l=function(e,t,n){let r;let{sequenceOptions:i}=e,{sequenceName:o}=e.sequenceOptions,{resultsPhaseBySeq:a}=n,s=a[o],l=t.getVoterStrategyListByPhase(i)[s];if("closedPrimary"===o){let{resultsPartyBySeq:e}=n,t=e[s];r=nE(l.filter(e=>e.party===t))}else r=nE(l);return r}(e,d,o);c=new(!0===e.useGeography?nl:s||l||"score"===r||"scoreFull"===r?nC:"ranking"===r||"pairwise"===r?nw:nu)(p,u,t,n,o)}f(),h.enter=()=>{f(),c.enter()},h.exit=()=>{c.exit()},h.update=e=>{if(!i.checkNone()){if(i.check(["numDistricts","numTracts","dimensions","socialChoiceMethod","densityProfile","strategyRules","resultsPhase","resultsParty","sequenceName"])&&(h.exit(),h.enter()),!0===a.getOptions().useGeography){let{geoResults:t}=e;c.update(t)}else{let t=nr(e.geoResults.scResultsByDistrict[0],o);c.update(t)}h.clear(),h.render()}},h.render=()=>{c.render()},h.clear=()=>{t.clear(),n.clear()}}function nN(e,t,n,r,i){let{width:o}=n,a=Array(o).fill(0),s=0,{dimensions:l}=i,c=1===l?na:ns;e.setRenderer(e=>new c(e,n)),t.setRenderer(e=>new c(e,n)),this.update=function(e){r.checkAny()&&(a.fill(0),s=0);let{pointsChanged:t,samplingPointsList:n,samplingPointsCount:i}=e;t&&function(e,t){let n=e.length;for(let i=0;i<n;i++){let n=e[i][0],l=t[i];for(let e=0;e<o;e++){var r;a[e]+=((r=e-n)>20||r<-20?0:(1-(.05*r)**2)*.05)*l}s+=h*l}}(n,i)};let h=4/3;this.render=()=>{(function(){let{ctx:e}=n;e.save(),e.beginPath(),function(e){let t=1/s;e.moveTo(0,200);let r=[];for(let n=0;n<=o;n+=1){let i=200-1e4*a[n]*t;r.push(i),e.lineTo(n,i)}e.lineTo(n.width,200),e.lineTo(0,200)}(e),e.strokeStyle="#ccc",e.stroke(),e.fillStyle="#ccc",e.fill(),e.restore()})(),e.render(),t.render()}}function nD(e,t){let n;if(void 0===t)for(let t of e)null!=t&&(n<t||void 0===n&&t>=t)&&(n=t);else{let r=-1;for(let i of e)null!=(i=t(i,++r,e))&&(n<i||void 0===n&&i>=i)&&(n=i)}return n}const nO=Math.sqrt(50),nL=Math.sqrt(10),nR=Math.sqrt(2);function nB(e,t,n){let r,i,o;let a=(t-e)/Math.max(0,n),s=Math.floor(Math.log10(a)),l=a/Math.pow(10,s),c=l>=nO?10:l>=nL?5:l>=nR?2:1;return(s<0?(r=Math.round(e*(o=Math.pow(10,-s)/c)),i=Math.round(t*o),r/o<e&&++r,i/o>t&&--i,o=-o):(r=Math.round(e/(o=Math.pow(10,s)*c)),i=Math.round(t/o),r*o<e&&++r,i*o>t&&--i),i<r&&.5<=n&&n<2)?nB(e,t,2*n):[r,i,o]}function nF(e,t,n){if(t=+t,e=+e,!((n=+n)>0))return[];if(e===t)return[e];let r=t<e,[i,o,a]=r?nB(t,e,n):nB(e,t,n);if(!(o>=i))return[];let s=o-i+1,l=Array(s);if(r){if(a<0)for(let e=0;e<s;++e)l[e]=-((o-e)/a);else for(let e=0;e<s;++e)l[e]=(o-e)*a}else if(a<0)for(let e=0;e<s;++e)l[e]=-((i+e)/a);else for(let e=0;e<s;++e)l[e]=(i+e)*a;return l}function nV(e,t,n){return nB(e=+e,t=+t,n=+n)[2]}var nq=Array.prototype.slice;function nG(e,t,n){for(var r=e.width,i=e.height,o=(n<<1)+1,a=0;a<i;++a)for(var s=0,l=0;s<r+n;++s)s<r&&(l+=e.data[s+a*r]),s>=n&&(s>=o&&(l-=e.data[s-o+a*r]),t.data[s-n+a*r]=l/Math.min(s+1,r-1+o-s,o))}function nI(e,t,n){for(var r=e.width,i=e.height,o=(n<<1)+1,a=0;a<r;++a)for(var s=0,l=0;s<i+n;++s)s<i&&(l+=e.data[a+s*r]),s>=n&&(s>=o&&(l-=e.data[a+(s-o)*r]),t.data[a+(s-n)*r]=l/Math.min(s+1,i-1+o-s,o))}var nj=e=>()=>e;function nW(e){return Math.max(1,Math.ceil(Math.log(function(e,t){let n=0;for(let t of e)null!=t&&(t=+t)>=t&&++n;return n}(e))/Math.LN2)+1)}function n$(e,t){return e-t}function nU(){}var nz=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function nH(){var e=1,t=1,n=nW,r=s;function i(e){var t=n(e);if(Array.isArray(t))t=t.slice().sort(n$);else{let n=function(e,t){let n,r;for(let t of e)null!=t&&(void 0===n?t>=t&&(n=r=t):(n>t&&(n=t),r<t&&(r=t)));return[n,r]}(e),r=function(e,t,n){t=+t,e=+e,n=+n;let r=t<e,i=r?nV(t,e,n):nV(e,t,n);return(r?-1:1)*(i<0?-(1/i):i)}(n[0],n[1],t);t=nF(Math.floor(n[0]/r)*r,Math.floor(n[1]/r-1)*r,t)}return t.map(t=>o(e,t))}function o(n,i){var o=[],s=[];return function(n,r,i){var o,s,l,c,h,u,d=[],p=[];for(o=s=-1,nz[(c=n[0]>=r)<<1].forEach(f);++o<e-1;)nz[(l=c)|(c=n[o+1]>=r)<<1].forEach(f);for(nz[c<<0].forEach(f);++s<t-1;){for(o=-1,nz[(c=n[s*e+e]>=r)<<1|(h=n[s*e]>=r)<<2].forEach(f);++o<e-1;)l=c,c=n[s*e+e+o+1]>=r,u=h,nz[l|c<<1|(h=n[s*e+o+1]>=r)<<2|u<<3].forEach(f);nz[c|h<<3].forEach(f)}for(o=-1,nz[(h=n[s*e]>=r)<<2].forEach(f);++o<e-1;)u=h,nz[(h=n[s*e+o+1]>=r)<<2|u<<3].forEach(f);function f(e){var t,n,r=[e[0][0]+o,e[0][1]+s],l=[e[1][0]+o,e[1][1]+s],c=a(r),h=a(l);(t=p[c])?(n=d[h])?(delete p[t.end],delete d[n.start],t===n?(t.ring.push(l),i(t.ring)):d[t.start]=p[n.end]={start:t.start,end:n.end,ring:t.ring.concat(n.ring)}):(delete p[t.end],t.ring.push(l),p[t.end=h]=t):(t=d[h])?(n=p[c])?(delete d[t.start],delete p[n.end],t===n?(t.ring.push(l),i(t.ring)):d[n.start]=p[t.end]={start:n.start,end:t.end,ring:n.ring.concat(t.ring)}):(delete d[t.start],t.ring.unshift(r),d[t.start=c]=t):d[c]=p[h]={start:c,end:h,ring:[r,l]}}nz[h<<3].forEach(f)}(n,i,function(e){r(e,n,i),function(e){for(var t=0,n=e.length,r=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)r+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return r}(e)>0?o.push([e]):s.push(e)}),s.forEach(function(e){for(var t,n=0,r=o.length;n<r;++n)if(-1!==function(e,t){for(var n,r=-1,i=t.length;++r<i;)if(n=function(e,t){for(var n=t[0],r=t[1],i=-1,o=0,a=e.length,s=a-1;o<a;s=o++){var l=e[o],c=l[0],h=l[1],u=e[s],d=u[0],p=u[1];if(function(e,t,n){var r,i,o,a;return(t[0]-e[0])*(n[1]-e[1])==(n[0]-e[0])*(t[1]-e[1])&&(i=e[r=+(e[0]===t[0])],o=n[r],a=t[r],i<=o&&o<=a||a<=o&&o<=i)}(l,u,t))return 0;h>r!=p>r&&n<(d-c)*(r-h)/(p-h)+c&&(i=-i)}return i}(e,t[r]))return n;return 0}((t=o[n])[0],e)){t.push(e);return}}),{type:"MultiPolygon",value:i,coordinates:o}}function a(t){return 2*t[0]+t[1]*(e+1)*4}function s(n,r,i){n.forEach(function(n){var o,a=n[0],s=n[1],l=0|a,c=0|s,h=r[c*e+l];a>0&&a<e&&l===a&&(o=r[c*e+l-1],n[0]=a+(i-o)/(h-o)-.5),s>0&&s<t&&c===s&&(o=r[(c-1)*e+l],n[1]=s+(i-o)/(h-o)-.5)})}return i.contour=o,i.size=function(n){if(!arguments.length)return[e,t];var r=Math.floor(n[0]),o=Math.floor(n[1]);if(!(r>=0&&o>=0))throw Error("invalid size");return e=r,t=o,i},i.thresholds=function(e){return arguments.length?(n="function"==typeof e?e:Array.isArray(e)?nj(nq.call(e)):nj(e),i):n},i.smooth=function(e){return arguments.length?(r=e?s:nU,i):r===s},i}function nX(e){return e[0]}function nY(e){return e[1]}function nJ(){return 1}var nK=e=>e;function nZ(e,t){e&&n0.hasOwnProperty(e.type)&&n0[e.type](e,t)}var nQ={Feature:function(e,t){nZ(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)nZ(n[r].geometry,t)}},n0={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){n1(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)n1(n[r],t,0)},Polygon:function(e,t){n2(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)n2(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)nZ(n[r],t)}};function n1(e,t,n){var r,i=-1,o=e.length-n;for(t.lineStart();++i<o;)r=e[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function n2(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)n1(e[n],t,1);t.polygonEnd()}function n5(e,t){e&&nQ.hasOwnProperty(e.type)?nQ[e.type](e,t):nZ(e,t)}class n3{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){let t=this._partials,n=0;for(let r=0;r<this._n&&r<32;r++){let i=t[r],o=e+i,a=Math.abs(e)<Math.abs(i)?e-(o-i):i-(o-e);a&&(t[n++]=a),e=o}return t[n]=e,this._n=n+1,this}valueOf(){let e=this._partials,t=this._n,n,r,i,o=0;if(t>0){for(o=e[--t];t>0&&(o=(n=o)+(r=e[--t]),!(i=r-(o-n))););t>0&&(i<0&&e[t-1]<0||i>0&&e[t-1]>0)&&(n=o+(r=2*i),r==n-o&&(o=n))}return o}}var n4=2*Math.PI,n6=Math.abs,n8=Math.sqrt;function n9(){}var n7,re,rt,rn,rr,ri,ro,ra,rs,rl=new n3,rc=new n3,rh={point:n9,lineStart:n9,lineEnd:n9,polygonStart:function(){rh.lineStart=ru,rh.lineEnd=rf},polygonEnd:function(){rh.lineStart=rh.lineEnd=rh.point=n9,rl.add(n6(rc)),rc=new n3},result:function(){var e=rl/2;return rl=new n3,e}};function ru(){rh.point=rd}function rd(e,t){rh.point=rp,ri=ra=e,ro=rs=t}function rp(e,t){rc.add(rs*e-ra*t),ra=e,rs=t}function rf(){rp(ri,ro)}var rm,rg,ry,rv,rw=1/0,rx=1/0,r_=-1/0,rb=r_,rC={point:function(e,t){e<rw&&(rw=e),e>r_&&(r_=e),t<rx&&(rx=t),t>rb&&(rb=t)},lineStart:n9,lineEnd:n9,polygonStart:n9,polygonEnd:n9,result:function(){var e=[[rw,rx],[r_,rb]];return r_=rb=-(rx=rw=1/0),e}},rS=0,rP=0,rk=0,rM=0,rA=0,rE=0,rT=0,rN=0,rD=0,rO={point:rL,lineStart:rR,lineEnd:rV,polygonStart:function(){rO.lineStart=rq,rO.lineEnd=rG},polygonEnd:function(){rO.point=rL,rO.lineStart=rR,rO.lineEnd=rV},result:function(){var e=rD?[rT/rD,rN/rD]:rE?[rM/rE,rA/rE]:rk?[rS/rk,rP/rk]:[NaN,NaN];return rS=rP=rk=rM=rA=rE=rT=rN=rD=0,e}};function rL(e,t){rS+=e,rP+=t,++rk}function rR(){rO.point=rB}function rB(e,t){rO.point=rF,rL(ry=e,rv=t)}function rF(e,t){var n=e-ry,r=t-rv,i=n8(n*n+r*r);rM+=i*(ry+e)/2,rA+=i*(rv+t)/2,rE+=i,rL(ry=e,rv=t)}function rV(){rO.point=rL}function rq(){rO.point=rI}function rG(){rj(rm,rg)}function rI(e,t){rO.point=rj,rL(rm=ry=e,rg=rv=t)}function rj(e,t){var n=e-ry,r=t-rv,i=n8(n*n+r*r);rM+=i*(ry+e)/2,rA+=i*(rv+t)/2,rE+=i,rT+=(i=rv*e-ry*t)*(ry+e),rN+=i*(rv+t),rD+=3*i,rL(ry=e,rv=t)}function rW(e){this._context=e}rW.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,n4)}},result:n9};var r$,rU,rz,rH,rX,rY=new n3,rJ={point:n9,lineStart:function(){rJ.point=rK},lineEnd:function(){r$&&rZ(rU,rz),rJ.point=n9},polygonStart:function(){r$=!0},polygonEnd:function(){r$=null},result:function(){var e=+rY;return rY=new n3,e}};function rK(e,t){rJ.point=rZ,rU=rH=e,rz=rX=t}function rZ(e,t){rH-=e,rX-=t,rY.add(n8(rH*rH+rX*rX)),rH=e,rX=t}class rQ{constructor(n){this._append=null==n?r0:function(n){let r=Math.floor(n);if(!(r>=0))throw RangeError(`invalid digits: ${n}`);if(r>15)return r0;if(r!==e){let n=10**r;e=r,t=function(e){let t=1;this._+=e[0];for(let r=e.length;t<r;++t)this._+=Math.round(arguments[t]*n)/n+e[t]}}return t}(n),this._radius=4.5,this._=""}pointRadius(e){return this._radius=+e,this}polygonStart(){this._line=0}polygonEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){0===this._line&&(this._+="Z"),this._point=NaN}point(e,i){switch(this._point){case 0:this._append`M${e},${i}`,this._point=1;break;case 1:this._append`L${e},${i}`;break;default:if(this._append`M${e},${i}`,this._radius!==n||this._append!==t){let e=this._radius,i=this._;this._="",this._append`m0,${e}a${e},${e} 0 1,1 0,${-2*e}a${e},${e} 0 1,1 0,${2*e}z`,n=e,t=this._append,r=this._,this._=i}this._+=r}}result(){let e=this._;return this._="",e.length?e:null}}function r0(e){let t=1;this._+=e[0];for(let n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function r1(e,t,n,r,i){let o,a;let s=this,{dimensions:l}=i,c=1===l?na:ns;e.setRenderer(e=>new c(e,n)),t.setRenderer(e=>new c(e,n));let h=[],u=[];s.update=function(e){r.checkAny()&&(h.splice(0,h.length),u.splice(0,u.length),o=0);let{pointsChanged:t,samplingPointsList:n,samplingPointsCount:i}=e;t&&(s.updatePoints(n,i),s.updateDensity())},s.render=()=>{s.renderCans(),e.render(),t.render()},s.updatePoints=function(e,t){for(let n=0;n<e.length;n++){let r=e[n],i=t[n];h.push(r),u.push(i),o+=i}},s.updateDensity=()=>{let e=o/1e5,t=y(20).map(t=>t*e);a=(function(){var e=nX,t=nY,n=nJ,r=960,i=500,o=20,a=2,s=60,l=270,c=155,h=nj(20);function u(r){var i=new Float32Array(l*c),h=new Float32Array(l*c),u=Math.pow(2,-a);return r.forEach(function(r,o,a){var h=(e(r,o,a)+s)*u,d=(t(r,o,a)+s)*u,p=+n(r,o,a);if(h>=0&&h<l&&d>=0&&d<c){var f=Math.floor(h),m=Math.floor(d),g=h-f-.5,y=d-m-.5;i[f+m*l]+=(1-g)*(1-y)*p,i[f+1+m*l]+=g*(1-y)*p,i[f+1+(m+1)*l]+=g*y*p,i[f+(m+1)*l]+=(1-g)*y*p}}),nG({width:l,height:c,data:i},{width:l,height:c,data:h},o>>a),nI({width:l,height:c,data:h},{width:l,height:c,data:i},o>>a),nG({width:l,height:c,data:i},{width:l,height:c,data:h},o>>a),nI({width:l,height:c,data:h},{width:l,height:c,data:i},o>>a),nG({width:l,height:c,data:i},{width:l,height:c,data:h},o>>a),nI({width:l,height:c,data:h},{width:l,height:c,data:i},o>>a),i}function d(e){var t=u(e),n=h(t),r=Math.pow(2,2*a);return Array.isArray(n)||(n=nF(Number.MIN_VALUE,nD(t)/r,n)),nH().size([l,c]).thresholds(n.map(e=>e*r))(t).map((e,t)=>(e.value=+n[t],p(e)))}function p(e){return e.coordinates.forEach(f),e}function f(e){e.forEach(m)}function m(e){e.forEach(g)}function g(e){e[0]=e[0]*Math.pow(2,a)-s,e[1]=e[1]*Math.pow(2,a)-s}function y(){return l=r+2*(s=3*o)>>a,c=i+2*s>>a,d}return d.contours=function(e){var t=u(e),n=nH().size([l,c]),r=Math.pow(2,2*a),i=e=>{e=+e;var i=p(n.contour(t,e*r));return i.value=e,i};return Object.defineProperty(i,"max",{get:()=>nD(t)/r}),i},d.x=function(t){return arguments.length?(e="function"==typeof t?t:nj(+t),d):e},d.y=function(e){return arguments.length?(t="function"==typeof e?e:nj(+e),d):t},d.weight=function(e){return arguments.length?(n="function"==typeof e?e:nj(+e),d):n},d.size=function(e){if(!arguments.length)return[r,i];var t=+e[0],n=+e[1];if(!(t>=0&&n>=0))throw Error("invalid size");return r=t,i=n,y()},d.cellSize=function(e){if(!arguments.length)return 1<<a;if(!((e=+e)>=1))throw Error("invalid cell size");return a=Math.floor(Math.log(e)/Math.LN2),y()},d.thresholds=function(e){return arguments.length?(h="function"==typeof e?e:Array.isArray(e)?nj(nq.call(e)):nj(e),d):h},d.bandwidth=function(e){if(!arguments.length)return Math.sqrt(o*(o+1));if(!((e=+e)>=0))throw Error("invalid bandwidth");return o=Math.round((Math.sqrt(4*e*e+1)-1)/2),y()},d})().x(e=>e[0]).y(e=>e[1]).weight((e,t)=>u[t]).bandwidth(10).thresholds(t)(h)},s.renderCans=()=>{let{ctx:e}=n,{darkMode:t}=n.common,r=(function(e,t){let n=3,r=4.5,i,o;function a(e){return e&&("function"==typeof r&&o.pointRadius(+r.apply(this,arguments)),n5(e,i(o))),o.result()}return a.area=function(e){return n5(e,i(rh)),rh.result()},a.measure=function(e){return n5(e,i(rJ)),rJ.result()},a.bounds=function(e){return n5(e,i(rC)),rC.result()},a.centroid=function(e){return n5(e,i(rO)),rO.result()},a.projection=function(t){return arguments.length?(i=null==t?(e=null,nK):(e=t).stream,a):e},a.context=function(e){return arguments.length?(o=null==e?(t=null,new rQ(n)):new rW(t=e),"function"!=typeof r&&o.pointRadius(r),a):t},a.pointRadius=function(e){return arguments.length?(r="function"==typeof e?e:(o.pointRadius(+e),+e),a):r},a.digits=function(e){if(!arguments.length)return n;if(null==e)n=null;else{let t=Math.floor(e);if(!(t>=0))throw RangeError(`invalid digits: ${e}`);n=t}return null===t&&(o=new rQ(n)),a},a.projection(e).digits(n).context(t)})().context(e);e.save(),e.lineWidth=.5,e.strokeStyle="#aaa";let i=a.length;for(let n=0;n<i;n++){let i=255-10*n,o=t?255-i+33:i;e.fillStyle=`rgba(${o},${o},${o}, 1)`,e.beginPath(),r(a[n]),e.fill()}e.restore()}}function r2(e){let t=this;t.canDn=e,t.setRenderer=n=>{t.renderer=n(e)}}function r5(e){let t=this,n=[];t.rendererMaker=()=>({render:()=>{}}),e.attachNewE(t),t.updateNewE=e=>{t.newCandidateDn(e)},t.newCandidateDn=function(e){let r=new r2(e);n.push(r),r.setRenderer(t.rendererMaker)},t.getCanDnRenderers=()=>n.filter(e=>e.canDn.exists),t.getCandidateDistributions=()=>t.getCanDnRenderers().map(e=>e.canDn),t.getCandidateDistributionsAll=()=>n.map(e=>e.canDn),t.setRenderer=e=>{t.rendererMaker=e,n.forEach(t=>t.setRenderer(e))},t.render=()=>{n.forEach(e=>{e.canDn.exists&&e.renderer.render()})}}function r3(e,t,n,r,i,o,a){let s;let l=this;o.viewModes.sample.attach(l),nk.call(l,t,r,a);let{candidateDnList:c,voterShapeList:h}=e,u=new nA(h),d=new r5(c);function p(){let{dimensions:e}=i;s=new(1===e?nN:r1)(u,d,t,r,i)}p(),l.enter=()=>{p()},l.exit=()=>{},l.update=e=>{r.check(["dimensions"])&&(l.exit(),l.enter());let{samplingResult:t}=e;s.update(t);let{pointsChanged:n}=t;n&&(l.clear(),l.render())},l.render=()=>{s.render()},l.clear=()=>{t.clear()}}function r4(e){let t=this;function n(t,n){let{ctx:r}=e,{centroids:i,polygonAreas:o}=t,a=i[n];J((1e3*o[n]).toFixed(0),a[0],a[1]+.05,.1,.2,"#222",1,r)}t.renderVoronoi=(e,r,i)=>{t.renderVoronoiGeneral(e,0,0,r,i,null,n)},t.renderVoronoiColors=(e,n,r,i,o,a)=>{t.renderVoronoiGeneral(e,n,r,i,o,a,void 0)},t.renderVoronoiGeneral=(t,n,r,i,o,a,s)=>{let{ctx:l}=e,{voronoi:c,nd:h}=t;l.save(),l.translate(n,r),l.scale(i,o);for(let e=0;e<h;e++)l.beginPath(),l.strokeStyle="#333",l.lineWidth=1/i,c.renderCell(e,l),null!==a&&(l.fillStyle=a[e],l.fill()),l.stroke(),void 0!==s&&s(t,e);l.restore()}}function r6(e,t){let{candidateTallies:n}=e;if(n.bordaFractionAverageByCan){if("minimax"===t){let{winFractionPairwise:t}=e.pairwiseTallies;return function(e){let t=e.length,n=[];for(let r=0;r<t;r++){let i=e[r],o=1;for(let e=0;e<t;e++){if(e===r)continue;let t=i[e];t<o&&(o=t)}n.push(o)}return n}(t)}return n.bordaFractionAverageByCan}return n.voteFractionsByCan?n.voteFractionsByCan:n.firstPreferenceFractions?n.firstPreferenceFractions:n.scoreFractionAverageByCan?n.scoreFractionAverageByCan:null}function r8(e,t,n){let r=document.createElement("canvas");r.width=e,r.height=t;let i=r.getContext("2d"),o=i.createImageData(e,t);this.load=n=>{let{data:r}=o;for(let i=0;i<e;i++)for(let o=0;o<t;o++){let t=n[i][o][0]+.5,a=n[i][o][1]+.5;r[(i+o*e)*4+0]=255*t,r[(i+o*e)*4+1]=(t+a)*200,r[(i+o*e)*4+2]=200*a,r[(i+o*e)*4+3]=255}i.putImageData(o,0,0)},this.loadColors=n=>{let{data:r}=o;for(let i=0;i<t;i++)for(let t=0;t<e;t++){let[o,a,s]=n[t][i];r[(t+i*e)*4+0]=o,r[(t+i*e)*4+1]=a,r[(t+i*e)*4+2]=s,r[(t+i*e)*4+3]=255}i.putImageData(o,0,0)},this.render=(e,t)=>{let{ctx:i}=n;i.save(),i.imageSmoothingEnabled=!1,i.drawImage(r,0,0,e,t),i.restore()}}function r9(e,t,n,r,i){let o;let a=this;a.update=s=>{let{geography:l}=s.geometry;o=l.districtMap,(void 0===a.districtDraw||i.check(["numTracts"]))&&(a.districtDraw=new r4(t),a.mapOfTracts=new r8(l.nx,l.ny,t));let{colorByTract:c,colorOfVoteByDistrict:h,colorOfWinsByDistrict:u}=function(e,t,n,r){let{votesByTract:i,votesByDistrict:o,scResultsByDistrict:a}=e,s=t.getEntities(),l=function(e,t){let n=t.map(e=>e.colorRGBA);return e.map(e=>e.map(e=>t7(r6(e),n)))}(i,s),c=function(e,t,n,r){let i;let{socialChoiceType:o}=nn(n,r);if("singleWinner"===o)i=e.map(e=>t[e.iWinner].color);else{let n=t.map(e=>e.colorRGBA);i=e.map(e=>{let{allocation:t}=e,r=t.reduce((e,t)=>e+t);return ne(t7(t.map(e=>e/r),n))})}return i}(a,s,n,r);return{colorByTract:l,colorOfVoteByDistrict:o.map(e=>ne(t7(r6(e),s.map(e=>e.colorRGBA)))),colorOfWinsByDistrict:c}}(s,e,n.getOptions(),r);a.colorOfVoteByDistrict=h,a.winnerColors=u,a.mapOfTracts.loadColors(c)},a.render=()=>{a.renderTractVotes(),a.renderDistrictWins(),a.renderDistrictVotes()},a.renderTractVotes=()=>{a.mapOfTracts.render(100,100),a.districtDraw.renderVoronoi(o,100,100)},a.renderDistrictWins=()=>{let{renderVoronoiColors:e}=a.districtDraw;e(o,200,0,100,100,a.winnerColors)},a.renderDistrictVotes=()=>{let{renderVoronoiColors:e}=a.districtDraw;e(o,100,0,100,100,a.colorOfVoteByDistrict)}}function r7(e,t,n,r,i,o,a){let s=this;a.viewModes.one.attach(s);let l=new t2(t,a,n,"maps"),{height:c}=t;l.setHeight(c/3),l.hide();let h=new r9(e.candidateList,l,o,i,r),u=!1;s.enter=()=>{o.getOptions().useGeography&&l.show()},s.exit=()=>{l.hide()},s.update=function(e){let t=o.getOptions();r.check(["numDistricts","numTracts"])&&(t.useGeography?l.show():l.hide());let{error:n}=e.geoResults.scResultsByDistrict[0];if(void 0!==n){u=!0;return}u=!1,t.useGeography&&(h.update(e.geoResults),s.clear(),s.render())},s.render=function(){!u&&o.getOptions().useGeography&&h.render()},s.clear=()=>{l.clear()},s.draw=()=>{s.clear(),s.render()}}function ie(e,t){let n=e=>!!e&&!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length),r=r=>{!e.contains(r.target)&&n(e)&&t()&&i()},i=()=>{document.removeEventListener("mousedown",r),document.removeEventListener("touchstart",r)};document.addEventListener("mousedown",r),document.addEventListener("touchstart",r)}function it(e,t){let n=document.createElement("div");function r(){let{x:r,y:i}=e;r>.5*t.width?(n.style.right=`${t.width-r}px`,n.style.left="unset"):(n.style.left=`${r}px`,n.style.right="unset"),i>.5*t.height?(n.style.bottom=`${t.height-i}px`,n.style.top="unset"):(n.style.top=`${i}px`,n.style.bottom="unset")}n.className="tooltipBox",n.style.position="absolute",r(),n.style.border=t.common.darkMode?"1px solid white":"1px solid black",n.style.padding="8px",n.style.background=t.common.darkMode?"#222":"white";let i=!1;return ie(n,()=>!i&&(n.remove(),!0)),{box:n,update:r,setPin:e=>{i=e}}}function ir(e,t,n,r,i,o){let{box:a}=it(e,n);a.innerText="- Properties -";let s={};s.exists=new ii("checkbox","Exists","Exists: ",e=>t.doSetCommand.exists(e?1:0),1===t.exists),a.appendChild(s.exists.div);let{dimensions:l}=i;if(1===l?(t.shape1.w&&(s.w1=new ii("range","Width","Width: ",e=>t.doSetCommand.shape1w(e),t.shape1.w),a.appendChild(s.w1.div)),t.shape1.densityProfile&&(s.densityProfile1=new ii("select","Density Profile","Density Profile: ",e=>t.doSetCommand.shape1densityProfile(e),t.shape1.densityProfile,{choices:["step","gaussian"]}),a.appendChild(s.densityProfile1.div))):(t.shape2.w&&(s.w2=new ii("range","Width","Width: ",e=>t.doSetCommand.shape2w(e),t.shape2.w),a.appendChild(s.w2.div)),t.shape2.densityProfile&&(s.densityProfile2=new ii("select","Density Profile","Density Profile: ",e=>t.doSetCommand.shape2densityProfile(e),t.shape2.densityProfile,{choices:["step","gaussian"]}),a.appendChild(s.densityProfile2.div))),void 0!==t.doSetCommand.color&&(s.color=new ii("color","Color","Color: ",e=>t.doSetCommand.color(e),t.color),a.appendChild(s.color.div)),void 0!==t.doSetCommand.party&&(s.party=new ii("select","Party","Party: ",e=>t.doSetCommand.party([Number(e)]),t.party,{choices:[0,1,2,3,4,5,6,7,8,9]}),a.appendChild(s.party.div)),void 0!==t.doSetCommand.strategy){let{sequenceName:e,sequences:n}=o.getOptions().sequenceOptions,{phases:r}=n[e];s.strategyByPhase={},Object.keys(r).forEach(e=>{let{voteCasterName:n}=r[e],i={};s.strategyByPhase[e]=i;let o=X(t.strategyRules,n,e);if(1===o.length)return;i.actionPDF1=new ii("range","Action PDF 1","",e=>{let r=Number(e),o=1-r;i.actionPDF1.input.value=r,i.actionPDF2.input.value=o;let a=[r,o],s=_(t.strategyRules),l=X(s,n);for(let e=0;e<a.length;e+=1)l[e].actionWeight=a[e];t.doSetCommand.actionWeight(s)},o[0].actionWeight,{min:0,max:1,step:.01}),i.actionPDF2=new ii("range","Action PDF 2","",e=>{let r=Number(e),o=1-r;i.actionPDF1.input.value=o,i.actionPDF2.input.value=r;let a=[o,r],s=_(t.strategyRules),l=X(s,n);for(let e=0;e<a.length;e+=1)l[e].actionWeight=a[e];t.doSetCommand.actionWeight(s)},o[1].actionWeight,{min:0,max:1,step:.01});let l="score"===n?["normalize","normalizeOverFrontrunners"]:["closest","lesserEvil"];i.actionName1=new ii("select","Action 1",`${e}: Strategy 1: `,e=>{let r=_(t.strategyRules);X(r,n)[0].actionName=e,t.doSetCommand.strategy(r)},o[0].actionName,{choices:l}),i.actionName2=new ii("select","Action 2",`${e}: Strategy 2: `,e=>{let r=_(t.strategyRules);X(r,n)[1].actionName=e,t.doSetCommand.strategy(r)},o[1].actionName,{choices:l}),i.actionOptionThreshold=new ii("range","Threshold",`${e}: Threshold: `,e=>{let r=_(t.strategyRules),i=X(r,n);i[0].actionOptions.threshold.mean=Number(e),i[1].actionOptions.threshold.mean=Number(e),t.doSetCommand.actionOptionThreshold(r)},o[0].actionOptions.threshold.mean,{min:0,max:1,step:.01}),a.appendChild(i.actionName1.div),a.appendChild(i.actionPDF1.div),a.appendChild(i.actionName2.div),a.appendChild(i.actionPDF2.div),a.appendChild(i.actionOptionThreshold.div)})}s.showGhosts=new ii("checkbox","Show Ghosts","Show Ghosts: ",e=>r.setShowNonExistingEntities(e),r.showGhosts),a.appendChild(s.showGhosts.div),n.tooltips.appendChild(a)}function ii(e,t,n,r,i,o){let a=this;if(a.div=document.createElement("div"),"select"===e){a.input=document.createElement("select");let{choices:e}=o;for(let t=0;t<e.length;t++){let n=document.createElement("option");n.value=e[t],n.innerText=e[t],a.input.appendChild(n)}a.input.value=i,a.input.addEventListener("input",()=>r(a.input.value))}else a.input=document.createElement("input"),a.input.type=e,a.input.id=t,a.input.name=t,"checkbox"===e?(i&&(a.input.checked=!0),a.input.addEventListener("change",()=>r(a.input.checked))):"range"===e?(a.input.min=1,a.input.max=300,a.input.step=1,void 0!==o&&(void 0!==o.min&&(a.input.min=o.min),void 0!==o.max&&(a.input.max=o.max),void 0!==o.step&&(a.input.step=o.step)),a.input.value=i,a.input.addEventListener("input",()=>r(a.input.value))):"color"===e&&(a.input.value=i,a.input.addEventListener("input",()=>r(a.input.value)));a.label=document.createElement("label"),a.label.for=t,a.label.innerText=n,a.label.style["margin-right"]="4px",a.div.appendChild(a.label),a.div.appendChild(a.input)}function io(e,t){let n=this;n.setXYView=r=>{let{dimensions:i}=t;1===i?e.doSetCommand.shape1x(r.x):e.doSetCommand.shape2p(r),n.updateViewXY()},n.updateViewXY=()=>{let{dimensions:r}=t;1===r?(n.x=e.shape1.x,n.y=250):(n.x=e.shape2.x,n.y=e.shape2.y)}}function ia(e,t,n,r,i){let o=this;o.w=n,o.h=r,o.trueW=n,o.trueH=r,o.angleFraction=0,o.pickUp=function(){o.tweenSq=new tH.Tween(o,i.tweenGroup),o.tweenSq.to({w:o.trueW+10,h:o.trueH+10},100),o.tweenSq.start()},o.drop=function(){o.tweenSq=new tH.Tween(o,i.tweenGroup),o.tweenSq.to({w:o.trueW,h:o.trueH},100),o.tweenSq.start()},o.win=function(){o.tweenSq=new tH.Tween(o,i.tweenGroup),o.tweenSq.to({angleFraction:.25},300),o.tweenSq.start()},o.lose=function(){o.tweenSq=new tH.Tween(o,i.tweenGroup),o.tweenSq.to({angleFraction:-.25},300),o.tweenSq.start()},o.render=function(){let{fctx:n}=i,{darkMode:r}=i.common;n.save(),o.tweenSq&&o.tweenSq.update(),0===t.exists&&(n.globalAlpha=.2),0!==o.angleFraction&&(n.translate(e.x,e.y),n.rotate(o.angleFraction*Math.PI*2),n.translate(-e.x,-e.y)),n.beginPath(),n.fillStyle=t.color,r&&t.darkModeColor&&(n.fillStyle=t.darkModeColor),r&&(n.strokeStyle="white"),n.rect(e.x-.5*o.w-.5,e.y-.5*o.h-.5,o.w+1,o.h+1),n.fill(),n.stroke(),n.restore()}}function is(e,t,n,r,i,o,a){let s=this,l=new ia(s,e,n,r,t);s.square=l,io.call(s,e,o),s.fraction=0,s.setFraction=function(e){s.fraction=e},s.wins=0,s.setWins=e=>{s.wins!==e&&(e>s.wins?l.win():s.wins>e&&l.lose()),s.wins=e},s.renderForeground=function(){l.render();let{exists:n,party:r}=e,{x:i,y:c}=s,{fctx:h}=t,{darkMode:u}=t.common,d=u?"#fff":"#222";if(0===n)return;let p=c-.5*l.h-2;if(J(K(s.fraction),i,p,20,2,d,1,h),void 0!==s.wins){let e=c+.5*l.h+20+2;J(s.wins,i,e,20,2,d,1,h)}let{socialChoiceMethod:f}=nn(a.getOptions(),o);"olprA"===f&&J(`p${r}`,i+.1*l.w,c+8,13,2,d,1,h)},s.click=()=>{ir(s,e,t,i,o)}}function il(e,t,n,r,i,o,a){this.candidate=e,this.graphic=new is(e,t,n,r,i,o,a)}function ic(e,t,n,r,i){let o=this,a=[],s=[];o.attachNewG=e=>{s.push(e)};let l=e=>{s.forEach(t=>t.updateNewG(e))};t.attachNewE(o),o.updateNewE=e=>{o.newCandidate(e)},o.newCandidate=function(t){let o=new il(t,n,21,21,e,r,i);a.push(o),l(o)},o.getCanViews=()=>a.filter(e=>e.candidate.exists),o.getCandidates=()=>o.getCanViews().map(e=>e.candidate),o.getCandidatesAll=()=>a.map(e=>e.candidate),o.setCandidateFractions=e=>{o.getCanViews().forEach((t,n)=>{let r=e[n];t.graphic.setFraction(r)})},o.setCandidateWins=e=>{o.getCanViews().forEach((t,n)=>{let r=e[n];t.graphic.setWins(r)})},o.unsetCandidateWins=()=>{let e=Array(a.length).fill(void 0);o.setCandidateWins(e)},o.updateViewXY=()=>{a.forEach(e=>e.graphic.updateViewXY())},o.renderForeground=()=>{e.showGhosts?o.renderForegroundAll():o.renderForegroundExisting()},o.renderForegroundExisting=()=>{o.getCanViews().forEach(e=>e.graphic.renderForeground())},o.renderForegroundAll=()=>{a.forEach(e=>e.graphic.renderForeground())}}var tH=(c("8PNKb"),c("8PNKb"));function ih(e,t,n,r){let i=this;i.r=n,i.trueR=n,i.pickUp=function(){i.tween=new tH.Tween(i,r.tweenGroup),i.tween.to({r:2*i.trueR},100),i.tween.start()},i.drop=function(){i.tween=new tH.Tween(i,r.tweenGroup),i.tween.to({r:i.trueR},100),i.tween.start()},i.render=function(){let{fctx:n}=r,{darkMode:o}=r.common,{color:a}=t;n.save(),i.tween&&i.tween.update(),0===t.exists&&(n.globalAlpha=.2),n.beginPath(),n.fillStyle=a,o&&(n.strokeStyle="white"),n.arc(e.x,e.y,i.r,0,2*Math.PI),n.fill(),n.stroke(),n.restore()}}function iu(e,t,n,r,i){let o=this,a=new ih(o,e,13,t);o.circle=a,io.call(o,e,r),o.renderForeground=()=>{a.render()},o.setRenderer=t=>{o.renderer=t(e)},o.click=()=>{ir(o,e,t,n,r,i)}}function id(e,t,n,r,i){this.voterShape=e,this.graphic=new iu(e,t,n,r,i)}function ip(e,t,n,r,i){let o=this,a=[];o.list=a;let s=[];o.attachNewG=e=>{s.push(e)};let l=e=>{s.forEach(t=>t.updateNewG(e))};t.attachNewE(o),o.updateNewE=e=>{o.newVoterShape(e)},o.newVoterShape=function(t){let o=new id(t,n,e,r,i);a.push(o),l(o)},o.getVoterShapes=()=>a.filter(e=>e.voterShape.exists).map(e=>e.voterShape),o.getVoterViews=()=>a.filter(e=>e.voterShape.exists),o.updateViewXY=()=>{a.forEach(e=>e.graphic.updateViewXY())},o.renderForeground=()=>{e.showGhosts?o.renderForegroundAll():o.renderForegroundExisting()},o.renderForegroundExisting=()=>{a.forEach(e=>{e.voterShape.exists&&e.graphic.renderForeground()})},o.renderForegroundAll=()=>{a.forEach(e=>{e.graphic.renderForeground()})}}function im(e){let t=document.createElement("div");e.append(t),this.update=(e,n)=>{let r=e=>`<span style="color:${e};">&#9632;</span>`;if(e.ranking)t.innerHTML=e.ranking.map((e,t)=>r(n[t])+e).join("<br />");else{let i=nx(e),o=e[i];t.innerHTML=o.map(K).map((e,t)=>r(n[t])+e).join("<br />")}}}function ig(e,t,n,r,i){let o=this;function a(){e.doSetCommand.exists(0)}o.start=n=>{e.doSetCommand.exists(1),o.setXYView(n),ie(t.wrap,a)};let s=new ih(o,e,9,t);o.circle=s,io.call(o,e,n);let l={};o.update=(t,n)=>{if(void 0===t)return null;let r=n.getEntities(),i=r.map(e=>e.color),a=r.map(e=>e.colorRGBA);o.colorSet=i;let s=nx(t),c=ne(t7(t[s],a));return e.doSetCommand.color(c),l.box&&l.update(t,o.colorSet),t},o.click=()=>{let n=r.testVoteView();null!==n&&(l.box&&l.box.remove(),(l=function(e,t,n){let r=it(e,n),{box:i,setPin:o}=r;i.innerText="Vote",i.style["min-width"]="100px";let a=document.createElement("button");a.style["min-width"]="35px",a.style.float="right",a.style.clear="right",a.onclick=()=>{l()};let s=!0;function l(){o(s=!s),a.innerHTML=s?"&#x1F6AB;":"&#x1F4CC;"}l();let c=document.createElement("button");c.style.float="right",c.style["min-width"]="35px",c.style["font-size"]="10px",c.innerHTML="&#x2573;",c.onclick=()=>{i.remove(),t.doSetCommand.exists(0)},i.appendChild(c),i.appendChild(a);let h=new im(i);return n.tooltips.appendChild(i),{box:i,update:function(e,t,n){r.update(),h.update(e,t,n)}}}(o,e,t)).update(n,o.colorSet))},o.renderForeground=()=>{(e.exists||i.showGhosts)&&s.render()}}function iy(e){let t=this;t.shape1={},t.shape2={},t.setAction={exists(e){t.exists=e},shape2p(n){t.shape2.x=n.x,t.shape2.y=n.y,e.testVoteView()},shape1x(n){t.shape1.x=n,e.testVoteView()},color(e){t.color=e}},t.doSetCommand=t.setAction,t.doSetCommand.shape1x(0),t.doSetCommand.shape2p({x:0,y:0}),t.doSetCommand.color("#999")}function iv(e,t,n,r){this.testVoter=new iy(n),this.graphic=new ig(this.testVoter,e,t,n,r),n.dragm.add(this)}function iw(e,t,n,r,i,o,a,s,l){let c=this;a.viewModes.one.attach(c),nk.call(c,t,r,s);let{candidateList:h,voterShapeList:u}=e,d=new ic(s,h,t,i,o),p=new ip(s,u,t,i,o);d.attachNewG(c.dragm),p.attachNewG(c.dragm),c.testVoterView=new iv(t,i,c,s),c.exit=()=>{d.unsetCandidateWins(),c.testVoterView.testVoter.doSetCommand.exists(0)},c.update=e=>{r.checkNone()||(r.check(["dimensions"])&&(c.exit(),c.enter()),r.check(["draggables","dimensions","mode"])&&(p.updateViewXY(),d.updateViewXY(),c.testVoterView.graphic.updateViewXY()),function(e,t,n,r){let{geoResults:i}=t;if(i.error)return;let o=!0===r.useGeography?i:nr(i.scResultsByDistrict[0],n);if(o.error)return;let a=i.geometry.canPoints.length,s=Array(a),l=Array(a),c=function(e){let{socialChoiceResults:t,votes:n}=e,{allocation:r}=t;if(void 0!==r)return r;let i=r6(n),{iWinner:o}=t,a=Array(i.length).fill(0);return a[o]=1,a}(o),{votes:h}=o,{socialChoiceMethod:u}=o.electionOptions,d=r6(h,u),p=!0===r.useGeography?y(o.geometry.canPoints.length):o.geometry.canLabels;for(let e=0;e<p.length;e++){let t=p[e];s[t]=d[e],l[t]=c[e]}e.setCandidateFractions(s),e.setCandidateWins(l)}(d,e,i,o.getOptions()),c.testVoteView(),c.clearForeground(),c.renderForeground())},c.clickEmpty=e=>{c.testVoterView.graphic.start(e)},c.testVoteView=()=>{let{voteCasterName:e}=nn(o.getOptions(),i),{canPoints:t,voterPoint:n,dimensions:r}=function(e,t,n){let{dimensions:r}=n,i=$([e],r)[0];return{voterPoint:i,canPoints:t.getPoints(r),parties:t.getParties(),dimensions:r}}(c.testVoterView.testVoter,h,i),a=eU[e].castPoint(t,n,r,3);return c.testVoterView.graphic.update(a,h),l.add(["testVote"]),a},c.renderForeground=()=>{p.renderForeground(),d.renderForeground(),c.testVoterView.graphic.renderForeground()},c.clearForeground=()=>{t.clearForeground()}}function ix(e,t,n,r,i,o,a){let s=this,l=new ia(s,e,n,r,t);s.square=l,io.call(s,e,o),s.setWinFraction=e=>{s.winFraction!==e&&(e>s.winFraction?l.win():s.winFraction>e&&l.lose()),s.winFraction=e},s.renderForeground=()=>{l.render();let{party:n}=e,{x:r,y:i}=s,{fctx:c}=t,{darkMode:h}=t.common,u=h?"#fff":"#222",{socialChoiceMethod:d}=nn(a.getOptions(),o);if("olprA"===d&&J(`p${n}`,r+.1*l.w,i+8,13,2,u,1,c),void 0!==s.winFraction){let e=i+.5*l.h+20+2;J(K(s.winFraction),r,e,20,2,u,1,c)}},s.setRenderer=t=>{s.renderer=t(e)},s.click=()=>{ir(s,e,t,i,o)}}function i_(e,t,n,r,i,o,a){this.canDn=e,this.graphic=new ix(e,t,n,r,i,o,a)}function ib(e,t,n,r,i){let o=this,a=[];o.rendererMaker=()=>({render:()=>{}});let s=[];o.attachNewG=e=>{s.push(e)};let l=e=>{s.forEach(t=>t.updateNewG(e))};t.attachNewE(o),o.updateNewE=e=>{o.newCandidateDn(e)},o.newCandidateDn=function(t){let s=new i_(t,n,21,21,e,r,i);a.push(s),s.graphic.setRenderer(o.rendererMaker),l(s)},o.getCanDnViews=()=>a.filter(e=>e.canDn.exists),o.getCandidateDistributions=()=>o.getCanDnViews().map(e=>e.canDn),o.getCandidateDistributionsAll=()=>a.map(e=>e.canDn),o.setCandidateDnWins=e=>{let t=o.getCanDnViews();t.length>1&&t.forEach(t=>{let n=e[t.canDn.party[0]];t.graphic.setWinFraction(n)})},o.updateViewXY=()=>{a.forEach(e=>e.graphic.updateViewXY())},o.render=()=>{a.forEach(e=>{e.canDn.exists&&e.graphic.renderer.render()})},o.setRenderer=e=>{o.rendererMaker=e,a.forEach(t=>t.graphic.setRenderer(e))},o.renderForeground=()=>{e.showGhosts?o.renderForegroundAll():o.renderForegroundExisting()},o.renderForegroundExisting=()=>{a.forEach(e=>{e.canDn.exists&&e.graphic.renderForeground()})},o.renderForegroundAll=()=>{a.forEach(e=>e.graphic.renderForeground())}}function iC(e,t,n,r,i,o,a,s){let l=this;a.viewModes.sample.attach(l),nk.call(l,t,r,s);let{candidateDnList:c,voterShapeList:h}=e,u=new ib(s,c,t,i,o),d=new ip(s,h,t,i,o);u.attachNewG(l.dragm),d.attachNewG(l.dragm),l.update=e=>{let{samplingResult:t}=e;r.check(["draggables","dimensions","mode"])&&(d.updateViewXY(),u.updateViewXY());let{pointsChanged:n,partyWinFraction:i}=t;n&&u.setCandidateDnWins(i),l.clearForeground(),l.renderForeground()},l.clickEmpty=()=>{},l.testVoteView=()=>null,l.renderForeground=()=>{d.renderForeground(),u.renderForeground()},l.clearForeground=()=>{t.clearForeground()}}function iS(e,t){let n=this,r=[];n.attach=e=>{r.push(e)},n.width=e,n.height=t,n.darkMode=!1,n.setDarkMode=e=>{n.darkMode=e;let[t,i]=e?["darkMode","lightMode"]:["lightMode","darkMode"],o=document.getElementsByTagName("html")[0];o.classList.remove(i),o.classList.add(t),r.forEach(t=>{t.setDarkMode(e)})},n.setDarkMode(window.matchMedia("(prefers-color-scheme: dark)").matches),n.showDownloadScreenLink=!1,n.setShowDownloadScreenLink=e=>{n.showDownloadScreenLink=e,r.forEach(t=>{t.setShowDownloadScreenLink(e)})},n.svgMode=!1,n.setSvgMode=e=>{n.svgMode=e,r.forEach(t=>{t.setSvgMode(e)})}}function iP(e,t,n,r,i){i.addMenuItem({label:`Social Choice Method for ${n} Phase:`,explain:"The method of choosing winners from a set of prospective candidates.",options:L.map(({shortName:e,functionName:t,name:n,explain:r})=>({name:e,value:t,explain:r||n})),changeList:["socialChoiceMethod"],getValue:()=>r.sequenceOptionsMan.sequences[e].phases[t].getOptions().socialChoiceMethod,onChoose:n=>{r.sequenceOptionsMan.sequences[e].phases[t].setSocialChoiceMethod(n.value)},checkShow:()=>e===r.getOptions().sequenceOptions.sequenceName})}function ik(e,t,n){let r=this;r.divMenu=document.createElement("div"),n.newElement("menu",r.divMenu),r.addMenuItem=function(n){let i=new t4(e,t,n);i.select(),r.divMenu.appendChild(i.choose.dom)}}function iM(e,t,n,r,i){let o=new t3({label:"Phase of Results to Display:",width:t6(3),data:[{name:"Primary",value:e},{name:"General",value:"general"}],onChoose:n=>{t.setResultsPhase(e,n.value)}});return n.attach({update:function(){e===i.getOptions().sequenceOptions.sequenceName?o.dom.hidden=!1:o.dom.hidden=!0}}),o.highlight("value",t.resultsPhaseBySeq[e]),o}const{compressToEncodedURIComponent:iA,decompressFromEncodedURIComponent:iE}=o(c("426T3")),iT=["candidateDns-exists","candidateDns-party","candidateDns-setNumberAtLeast","candidateDns-shape1D-densityProfile","gaussian","step","candidateDns-shape1D-width","candidateDns-shape1D-x","candidateDns-shape2D-densityProfile","candidateDns-shape2D-point","x","y","candidateDns-shape2D-width","candidates-color","#e05020","#50e020","#2050e0","#e0e020","candidates-exists","candidates-party","candidates-setNumberAtLeast","candidates-shape1D-x","candidates-shape2D-point","voters-exists","voters-party","voters-setNumberAtLeast","voters-shape1D-densityProfile","voters-shape1D-width","voters-shape1D-x","voters-shape2D-densityProfile","voters-shape2D-point","voters-shape2D-width","voters-strategyRules","dimensions","mode","one","sample","numDistricts","numTracts","seedRandom","seeds","sequenceName","general","closedPrimary","socialChoiceMethod-sequence-closedPrimary-phase-closedPrimary","socialChoiceMethod-sequence-closedPrimary-phase-general","socialChoiceMethod-sequence-general-phase-general","socialChoiceMethod-sequence-nonpartisanOpenPrimary-phase-general","socialChoiceMethod-sequence-nonpartisanOpenPrimary-phase-nonpartisanOpenPrimary","allocatedScore","dHondt","huntingtonHill","methodOfEqualShares","minimax","olprA","plurality","randomCandidate","randomVoter","sainteLague","score","sntv","stv","condition","voteCasterName","score","ranking","pairwise","scoreFull","strategy","actionName","normalize","normalizeOverFrontrunners","closest","lesserEvil","actionOptions","threshold","mean","radius","type","actionWeight"],iN={},iD=Object.keys(iT);for(let e=0;e<iD.length;e++){let t=iD[e];iN[iT[t]]=t}function iO(e){return e.has("a")?JSON.parse(decodeURIComponent(e.get("a"))):function e(t,n){if("object"!=typeof t||null===t)return"string"==typeof t&&t.startsWith("$")&&n[t.substring(1)]||t;if(Array.isArray(t))return t.map(t=>e(t,n));let r={},i=Object.keys(t);for(let o=0;o<i.length;o++){let a=i[o];r[a.startsWith("$")&&n[a.substring("$".length)]||a]=e(t[a],n)}return r}(JSON.parse(iE(e.get("c").replace(/\./g,"+").replace(/_/g,"-"))),iT)}const iL={};iL.x=function(){let e;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;let t=["MSXML2.XmlHttp.6.0","MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"];for(let n=0;n<t.length;n++)try{e=new ActiveXObject(t[n]);break}catch(e){}return e},iL.send=function(e,t,n,r,i){let o=i;void 0===o&&(o=!0);let a=iL.x();a.open(n,e,o),a.onreadystatechange=function(){4===a.readyState&&t(a.responseText)},"POST"===n&&a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.send(r)},iL.get=function(e,t,n,r){let i=[],o=Object.keys(t);for(let e=0;e<o.length;e++){let n=o[e];i.push(`${encodeURIComponent(n)}=${encodeURIComponent(t[n])}`)}iL.send(e+(i.length?`?${i.join("&")}`:""),n,"GET",null,r)};var iR="https://script.google.com/macros/s/AKfycbw_t8aLSdKGRFVhAenhPu56Gl-N9fEucx6Ic-H9jtfb55g_1flmiFK7WsHfsx1Dg2LSuQ/exec";const iB=void 0!==window.IPython;function iF(){let e=this;e.div=document.createElement("div");let t=document.createElement("a");t.style.margin="4px",e.div.append(t);let n=document.createElement("button");n.className="button2",n.innerText="X",n.onclick=()=>{e.hide()},e.div.append(n),e.show=()=>{t.hidden=!1,n.hidden=!1},e.hide=()=>{t.hidden=!0,n.hidden=!0},e.setUrl=e=>{t.href=e},e.setFileName=e=>{t.innerText=e,t.download=e},e.setFileName("download")}function iV(){let e=this;e.value="",e.div=document.createElement("div");let t=document.createElement("textarea");t.style.margin="4px",e.div.append(t);let n=document.createElement("button");n.className="button2",n.innerText="X",n.onclick=()=>{e.hide()},e.div.append(n),e.show=()=>{t.hidden=!1,n.hidden=!1},e.hide=()=>{t.hidden=!0,n.hidden=!0},e.setText=n=>{t.value=n,e.value=n}}function iq(e){return JSON.stringify(function e(t){return"object"==typeof t?Array.isArray(t)?t.map(e):Object.keys(t).sort().reduce((n,r)=>{let i=t[r];return n[r]=e(i),n},{}):t}(e),null,"	")}function iG(e,t){let n=new URLSearchParams(e).toString(),r=function(){let e=document.location.href.split("/");return e.slice(0,e.length-1).join("/")}();return`${r}/${t}?${n}`}function iI(e,t,n){let r={};r.c=iA(JSON.stringify(function e(t,n){if("number"==typeof t)return t;if("object"!=typeof t||null===t){let e=n[t];return e?`$${e}`:t}if(Array.isArray(t))return t.map(t=>e(t,n));let r={},i=Object.keys(t);for(let o=0;o<i.length;o++){let a=i[o];r[n[a]?`$${n[a]}`:a]=e(t[a],n)}return r}(e,iN))).replace(/\+/g,".").replace(/-/g,"_");let i=n.value;return""!==i&&(r.name=i),iG(r,t)}function ij(e,t){let n=this;e.attach(n),n.dataStore={},n.update=e=>{t.checkNone()||(n.dataStore=e)}}function iW(e,t,n,r){let{div:i,load:o}=function(e,t){let{changes:n,simOptions:r,pub:i,update:o,init:a}=e,s=new tz(i,r,n),l=new C,c=new t$(tW),{menu:h}=function(e,t,n){let{commander:r,simOptions:i,electionOptionsMan:o,entities:a,changes:s,pub:l}=e,c=new ik(l,s,t);return c.addMenuItem({label:"Mode:",explain:"The simulation mode chooses the kind of analysis to do. Either do one election and see more detail or many and get summary stats.",options:[{name:"Election",value:"one",explain:"See the votes from one election."},{name:"Win Density",value:"sample",explain:"See the winning candidates as a density over many elections. The prospective candidates come from a distribution."}],changeList:["mode"],getValue:()=>i.mode,onChoose:e=>{i.setMode(e.value)}}),c.addMenuItem({label:"Dimensions:",explain:"Set the number of dimensions for policy space. Policy space is where voters make decisions on which candidates to elect. Voters like candidates closer to them. Also, the way this simulation is organized, the 1D position of a candidate or voter is independent from their 2D position. This sim uses just one or the other.",options:[{name:"1D",value:1,explain:"Use only one axis for policy space."},{name:"2D",value:2,explain:"Use two axes for policy space."}],changeList:["dimensions"],getValue:()=>i.dimensions,onChoose:e=>{i.setDimensions(e.value)}}),function(e,t){e.addMenuItem({label:"Sampling Seed:",explain:"The sampling seed can either be constant or random. Setting the seed to random means every time the sampler starts, it will choose a random sampling seed. The seed is used to sample the same candidates each time, no matter if the other settings change. The only way things would be different is if the size of the candidate distributions change or if the number of candidate distributions change.",options:[{name:"Random",value:!0,explain:"New seed for each sampling run."},{name:"Constant",value:!1,explain:"Same seed for each sampling run."}],changeList:["seedRandom"],getValue:()=>t.seedRandom,onChoose:e=>{t.setSeedRandom(e.value)}})}(c,i),c.addMenuItem({label:"Number of Census Tracts:",explain:"Tracts add some geography into the election. Tracts are the pixels of the geography. Voters live in tracts. In each tract, the voters are moved in policy space according to a random algorithm called simplex noise. The main feature is that neighboring tracts are similar to each other. This options sets the number of tracts along one axis. ",options:[{name:"1",value:1},{name:"9",value:9}],changeList:["numTracts"],getValue:()=>o.getOptions().numTracts,onChoose:e=>{o.setNumTracts(e.value)}}),c.addMenuItem({label:"Number of Districts:",explain:"Districts are one way to try to introduce proprtionality into an election. Districts are drawn across tracts. Elections results are summed across the districts. Each district has one or more winners. ",options:[{name:"1",value:1},{name:"9",value:9}],changeList:["numDistricts"],getValue:()=>o.getOptions().numDistricts,onChoose:e=>{o.setNumDistricts(e.value)}}),c.addMenuItem({label:"Election Sequence:",explain:"An election may be composed of phases of casting votes and determining winners. A primary may be closed or open. A closed primary only allows voters of a party to vote. A nonpartisan open primary allows any voter to vote for any candidate. A general follows the primary. ",options:[{name:"General",value:"general",explain:"One general phase."},{name:"Closed P",value:"closedPrimary",explain:"A closed primary followed by a general phase."},{name:"Nonp Open P",value:"nonpartisanOpenPrimary",explain:"A nonpartisan open primary followed by a general phase."}],changeList:["sequenceName"],getValue:()=>o.sequenceOptionsMan.getOptions().sequenceName,onChoose:e=>{o.sequenceOptionsMan.setSequenceName(e.value)}}),iP("general","general","General",o,c),iP("closedPrimary","closedPrimary","Closed Primary",o,c),iP("closedPrimary","general","General",o,c),iP("nonpartisanOpenPrimary","nonpartisanOpenPrimary","Nonpartisan Open Primary",o,c),iP("nonpartisanOpenPrimary","general","General",o,c),!function(e,t,n,r,i){let o=iM("closedPrimary",e,t,n,i),a=function(e,t,n,r,i){let o=new t3({label:"Party of Results to Display:",width:t6(10),data:y(10).map(e=>({name:e,value:e})),onChoose:n=>{t.setResultsParty(e,n.value)}});return n.attach({update:function(){let n=i.getOptions().sequenceOptions.sequenceName,r=e===n,a="general"!==t.resultsPhaseBySeq[n];r&&a?o.dom.hidden=!1:o.dom.hidden=!0}}),o.highlight("value",t.resultsPartyBySeq[e]),o}("closedPrimary",e,t,0,i),s=iM("nonpartisanOpenPrimary",e,t,n,i),l=document.createElement("div");l.appendChild(o.dom),l.appendChild(a.dom),l.appendChild(s.dom),n.newElement("resultsPhaseSelector",l)}(i,l,t,0,o),!function(e,t){let n=document.createElement("button"),r=document.createElement("button");n.className="button2",r.className="button2",n.innerText="Undo",r.innerText="Redo",n.onclick=t.undo,r.onclick=t.redo,e.newElement("undo",n),e.newElement("redo",r)}(t,r),!function(e){let t=document.createElement("div");t.setAttribute("class","button-group-label2"),t.innerText="Sim Controls:",e.newElement("simControlsLabel",t)}(t),!function(e,t,n){let r=function(e,t){let n=document.createElement("button");function r(){n.hidden=!0}return n.className="button2",n.innerText="Add Candidate",n.onclick=()=>{t.addEntityPressed()},r(),e.viewModes.one.attach({enter:function(){n.hidden=!1},exit:r,update:()=>{}}),n}(e,t.candidateList),i=function(e,t){let n=document.createElement("button");function r(){n.hidden=!0}return n.className="button2",n.innerText="Add Candidate Group",n.onclick=()=>{t.addEntityPressed()},r(),e.viewModes.sample.attach({enter:function(){n.hidden=!1},exit:r,update:()=>{}}),n}(e,t.candidateDnList),o=function(e){let t=document.createElement("button");return t.innerText="Add Voter Group",t.className="button2",t.onclick=()=>{e.addEntityPressed()},t}(t.voterShapeList),a=document.createElement("div");a.append(o),a.append(r),a.append(i),n.newElement("addEntities",a)}(n,a,t),!function(e,t,n){let r=document.createElement("div");r.className="warning",r.innerText="Elections with both geographic components and sequence components are not yet implemented. Change number of districts to 1 and number of tracts to 1 or change election sequence to general.",o();let i={enter:()=>{},exit:()=>{},update:()=>{let t=e.getOptions();!0===t.useGeography&&"general"!==t.sequenceOptions.sequenceName?r.hidden=!1:o()}};function o(){r.hidden=!0}t.viewModes.one.attach(i),t.viewModes.sample.attach(i),n.newElement("warning",r)}(o,n,t),{menu:c}}(e,c,s),{nameInput:u}=function(e,t,n){let{commander:r,changes:i,pub:o}=e,a=function(e){let t=document.createElement("label");t.className="button-group-label2",t.innerText="Name: ";let n=document.createElement("input");n.type="text",n.placeholder="",n.set=e=>{n.value=e};let r=document.createElement("div");return r.appendChild(t),r.appendChild(n),e.newElement("name",r),n}(t);return!function(e,t,n,r){let i=document.createElement("button");i.className="button2",i.innerText="Save Long Link";let o=document.createElement("button");o.className="button2",o.innerText="Copy";let a=new iV;a.hide(),i.onclick=()=>{a.show();let e=iI(t.getConfig(),n,r);a.setText(e)},o.onclick=()=>{i.onclick(),navigator.clipboard.writeText(a.value)};let s=document.createElement("div"),l=document.createElement("div");l.appendChild(i),l.appendChild(o),l.appendChild(s),l.appendChild(a.div),e.newElement("saveConfigToLink",l)}(t,r,n,a),!function(e,t,n,r){let i=document.createElement("button");i.className="button2",i.innerText="Publish Short Link";let o=document.createElement("button");o.className="button2",o.innerText="Copy";let a=new iV;a.hide(),i.onclick=()=>{a.show();let e=t.getConfig();a.setText("requesting short link..."),function(e,t,n,r){let i=iI(e,t,n),o=function(e){let t,n=0;for(t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t)|0;return(n+2147483648)%2147483648}(iq(e));iL.get(iR,{shortcode:o,link:i},e=>{""===e||JSON.parse(e).result;{let e=n.value;r(iG(""===e?{b:o}:{b:o,name:e},t));return}})}(e,n,r,e=>{a.setText(e)})},o.onclick=()=>{a.show();let e=a.value;""===e?a.setText("Nothing Copied"):navigator.clipboard.writeText(e)};let s=document.createElement("div"),l=document.createElement("div");l.appendChild(i),l.appendChild(o),l.appendChild(s),l.appendChild(a.div),e.newElement("saveConfigToShortLink",l)}(t,r,n,a),!function(e,t,n){let r=document.createElement("button");r.className="button2",r.innerText="Show Config";let i=document.createElement("button");i.className="button2",i.innerText="Download Config";let o=new iF;o.setFileName("config.json"),o.hide();let a=new iV;a.hide(),r.onclick=()=>{a.show();let e=iq(t.getConfig());a.setText(e)},i.onclick=()=>{r.onclick();let e=`data:text/json;charset=utf-8,${encodeURIComponent(a.value)}`;o.setUrl(e);let t=n.value;""!==t&&o.setFileName(`${t}.json`),o.show()};let s=document.createElement("div"),l=document.createElement("div");l.appendChild(r),l.appendChild(i),l.appendChild(o.div),l.appendChild(s),l.appendChild(a.div),e.newElement("saveConfigToText",l)}(t,r,a),!function(e,t,n){let r=document.createElement("button");r.className="button2",r.innerText="Load Pasted Config";let i=document.createElement("textarea");r.onclick=()=>{if(""===i.value)return;let e=JSON.parse(i.value);t.loadConfig(e)};let o=function(e,t){let n=document.createElement("input");n.type="file",n.accept=".json",n.onchange=()=>{let r=n.files[0],i=new FileReader;i.addEventListener("load",e),i.readAsText(r);let{name:o}=r,a=o.split(".").slice(0,-1).join(".");t.set(a)};let r=document.createElement("button");return r.className="button2",r.innerText="Upload Config",r.onclick=()=>{n.click()},r}(function(e){let{result:n}=e.target,r=JSON.parse(n);t.loadConfig(r)},n),a=document.createElement("div"),s=document.createElement("div");s.appendChild(r),s.appendChild(o),s.appendChild(a),s.appendChild(i),e.newElement("loadConfigText",s)}(t,r,a),!function(e,t,n){let r=document.createElement("button");r.className="button2",r.innerText="Show Data";let i=document.createElement("button");i.className="button2",i.innerText="Download Data";let o=new iF;o.setFileName("data.json"),o.hide();let a=new iV;a.hide(),r.onclick=()=>{a.show();let{dataStore:e}=n,t=iq(e);a.setText(t)},i.onclick=()=>{r.onclick();let e=`data:text/json;charset=utf-8,${encodeURIComponent(a.value)}`;o.setUrl(e);let n=t.value;""!==n&&o.setFileName(`${n}_data.json`),o.show()};let s=document.createElement("div"),l=document.createElement("div");l.appendChild(r),l.appendChild(i),l.appendChild(o.div),l.appendChild(s),l.appendChild(a.div),e.newElement("saveData",l)}(t,a,new ij(o,i)),{nameInput:a}}(e,c,t),{screenMain:d}=function(e,t,n,r,i){let{entities:o,simOptions:a,electionOptionsMan:s,changes:l}=e,c=new iS(300,300),h=new t2(c,t,n,"viz"),u=new t2(c,t,n,"vizMini");u.setHeight(c.height/3),u.hide(),function(e,t,n){let r=new t3({label:"Drawing Mode:",width:t6(3),data:[{name:"Canvas",value:!1},{name:"SVG",value:!0}],onChoose:t=>{e.setSvgMode(t.value),n.rerender()}});r.highlight("value",e.svgMode),t.newElement("svgSwitch",r.dom)}(c,n,t),function(e,t){let n=new t3({label:"Show Link to Download Screen Image/SVG:",width:t6(3),data:[{name:"Yes",value:!0},{name:"No",value:!1}],onChoose:t=>{e.setShowDownloadScreenLink(t.value)}});n.highlight("value",e.svgMode),t.newElement("showDownloadScreenLink",n.dom)}(c,n),function(e,t,n){let r=new t3({label:"Theme:",width:t6(3),data:[{name:"Light",value:!1},{name:"Dark",value:!0}],onChoose:t=>{e.setDarkMode(t.value),n.rerender()}});r.highlight("value",e.darkMode),t.newElement("darkModeSwitch",r.dom)}(c,n,t);let d=new t8(l);return new iw(o,h,i,l,a,s,t,d,r),new iC(o,h,i,l,a,s,t,d),new nT(o,h,u,i,l,a,s,t,d),new r3(o,h,i,l,a,t,d),new ni(c,n,i,l,a,s,t),new r7(o,c,n,l,a,s,t),{screenMain:h}}(e,s,c,l,h);return!function(e,t){e.attach({update:e=>{!t.checkNone()&&(window.votekitStore={},iB&&(Object.assign(window.votekitStore,e),void 0!==window.votekitUpdate&&window.votekitUpdate(window.votekitStore,e)))}})}(i,n),window.requestAnimationFrame(function e(){o(),l.checkNone()&&0===d.tweenGroup.getAll().length||(d.tweenGroup.update(),s.clearForeground(),s.renderForeground(),l.clear()),window.requestAnimationFrame(e)}),{div:c.makeComponent(),load:function(e,t){(function(e,t,n){let{search:r}=e,i=new URLSearchParams(r),o=i.get("name");null!==o&&t.set(o);let a=i.has("a"),s=i.has("b"),l=a||s;if(a){n({yes:l,config:iO(i)});return}if(s){var c;c=i.get("b"),iL.get(iR,{shortcode:c,link:"getTable"},e=>{let{link:t}=JSON.parse(e),{search:r}=new URL(t);n({yes:!0,config:iO(new URLSearchParams(r))})});return}n({yes:l,config:{}})})(e,u,function(e){a(e.yes?e.config:t)})}}}(tj(r),n);return o(e,t),i}iB&&(window.votekitStore={},window.getVotekitStore=()=>{if(iB){let e;e=`votekitData = '${JSON.stringify(window.votekitStore)}'`,window.IPython.notebook.kernel.execute(e)}}),Array.from(document.getElementsByClassName("sandbox")).forEach(e=>{let t=void 0!==e.dataset.config?JSON.parse(e.dataset.config):{},n=void 0!==e.dataset.sandboxurl?e.dataset.sandboxurl:"",r=iW(window.location,t,n);e.parentNode.appendChild(r)}),Array.from(document.getElementsByClassName("double_sandbox")).forEach(e=>{let t=function(e,t){let n=new P,r=document.createElement("button");r.className="button2",r.innerText="linked",r.style["vertical-align"]="middle",r.style["min-width"]="70px",r.style.margin="5px",r.onclick=()=>{"linked"===r.innerText?(r.innerText="unlinked",n.setLinked(!1)):(r.innerText="linked",n.setLinked(!0))};let i=window.location,o=iW(i,e,t,n),a=iW(i,e,t,n);o.style.display="inline-block",a.style.display="inline-block",o.style["vertical-align"]="top",a.style["vertical-align"]="top";let s=document.createElement("div");return s.appendChild(o),s.appendChild(r),s.appendChild(a),s}(void 0!==e.dataset.config?JSON.parse(e.dataset.config):{},void 0!==e.dataset.sandboxurl?e.dataset.sandboxurl:"");e.parentNode.appendChild(t)});
//# sourceMappingURL=addSandboxes.js.map

(()=>{function e(e,t,n,i){Object.defineProperty(e,t,{get:n,set:i,enumerable:!0,configurable:!0})}function t(e){return e&&e.__esModule?e.default:e}var n=globalThis,i={},r={},o=n.parcelRequirede6b;null==o&&((o=function(e){if(e in i)return i[e].exports;if(e in r){var t=r[e];delete r[e];var n={id:e,exports:{}};return i[e]=n,t.call(n.exports,n,n.exports),n.exports}var o=Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){r[e]=t},n.parcelRequirede6b=o);var a=o.register;a("gj6Et",function(e,t){!function(e,t,n){function i(e){var t,n=this,i=(t=4022871197,function(e){e=String(e);for(var n=0;n<e.length;n++){var i=.02519603282416938*(t+=e.charCodeAt(n));t=i>>>0,i-=t,i*=t,t=i>>>0,i-=t,t+=4294967296*i}return(t>>>0)*23283064365386963e-26});n.next=function(){var e=2091639*n.s0+23283064365386963e-26*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=e-(n.c=0|e)},n.c=1,n.s0=i(" "),n.s1=i(" "),n.s2=i(" "),n.s0-=i(e),n.s0<0&&(n.s0+=1),n.s1-=i(e),n.s1<0&&(n.s1+=1),n.s2-=i(e),n.s2<0&&(n.s2+=1)}function r(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function o(e,t){var n=new i(e),o=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+(2097152*a()|0)*11102230246251565e-32},a.quick=a,o&&("object"==typeof o&&r(o,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.alea=o}(0,e,"function"==typeof define&&define)}),a("4gDjz",function(e,t){!function(e,t,n){function i(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var i=0;i<n.length+64;i++)t.x^=0|n.charCodeAt(i),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function o(e,t){var n=new i(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,i=(e+t)/2097152;while(0===i)return i},a.int32=n.next,a.quick=a,o&&("object"==typeof o&&r(o,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor128=o}(0,e,"function"==typeof define&&define)}),a("HLBv4",function(e,t){!function(e,t,n){function i(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^(e^e<<1))|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var i=0;i<n.length+64;i++)t.x^=0|n.charCodeAt(i),i==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function r(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function o(e,t){var n=new i(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,i=(e+t)/2097152;while(0===i)return i},a.int32=n.next,a.quick=a,o&&("object"==typeof o&&r(o,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorwow=o}(0,e,"function"==typeof define&&define)}),a("ktaoY",function(e,t){!function(e,t,n){function i(e){var t=this;t.next=function(){var e,n,i=t.x,r=t.i;return e=i[r],e^=e>>>7,n=e^e<<24^((e=i[r+1&7])^e>>>10)^((e=i[r+3&7])^e>>>3)^((e=i[r+4&7])^e<<7),e=i[r+7&7],e^=e<<13,n^=e^e<<9,i[r]=n,t.i=r+1&7,n},function(e,t){var n,i=[];if(t===(0|t))i[0]=t;else for(n=0,t=""+t;n<t.length;++n)i[7&n]=i[7&n]<<15^t.charCodeAt(n)+i[n+1&7]<<13;for(;i.length<8;)i.push(0);for(n=0;n<8&&0===i[n];++n);for(8==n?i[7]=-1:i[n],e.x=i,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function r(e,t){return t.x=e.x.slice(),t.i=e.i,t}function o(e,t){null==e&&(e=+new Date);var n=new i(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,i=(e+t)/2097152;while(0===i)return i},a.int32=n.next,a.quick=a,o&&(o.x&&r(o,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xorshift7=o}(0,e,"function"==typeof define&&define)}),a("gBs5C",function(e,t){!function(e,t,n){function i(e){var t=this;t.next=function(){var e,n,i=t.w,r=t.X,o=t.i;return t.w=i=i+1640531527|0,n=r[o+34&127],e=r[o=o+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=r[o]=n^e,t.i=o,n+(i^i>>>16)|0},function(e,t){var n,i,r,o,a,s=[],l=128;for(t===(0|t)?(i=t,t=null):(t+="\0",i=0,l=Math.max(l,t.length)),r=0,o=-32;o<l;++o)t&&(i^=t.charCodeAt((o+32)%t.length)),0===o&&(a=i),i^=i<<10,i^=i>>>15,i^=i<<4,i^=i>>>13,o>=0&&(a=a+1640531527|0,r=0==(n=s[127&o]^=i+a)?r+1:0);for(r>=128&&(s[127&(t&&t.length||0)]=-1),r=127,o=512;o>0;--o)i=s[r+34&127],n=s[r=r+1&127],i^=i<<13,n^=n<<17,i^=i>>>15,n^=n>>>12,s[r]=i^n;e.w=a,e.X=s,e.i=r}(t,e)}function r(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function o(e,t){null==e&&(e=+new Date);var n=new i(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,i=(e+t)/2097152;while(0===i)return i},a.int32=n.next,a.quick=a,o&&(o.X&&r(o,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.xor4096=o}(0,e,"function"==typeof define&&define)}),a("ktLSh",function(e,t){!function(e,t,n){function i(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,i=t.d,r=t.a;return e=e<<25^e>>>7^n,n=n-i|0,i=i<<24^i>>>8^r,r=r-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-i|0,t.d=i<<16^n>>>16^r,t.a=r-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var i=0;i<n.length+20;i++)t.b^=0|n.charCodeAt(i),t.next()}function r(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function o(e,t){var n=new i(e),o=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do var e=n.next()>>>11,t=(n.next()>>>0)/4294967296,i=(e+t)/2097152;while(0===i)return i},a.int32=n.next,a.quick=a,o&&("object"==typeof o&&r(o,n),a.state=function(){return r(n,{})}),a}t&&t.exports?t.exports=o:n&&n.amd?n(function(){return o}):this.tychei=o}(0,e,"function"==typeof define&&define)}),a("foUwZ",function(e,t){}),a("79Zf3",function(t,n){e(t.exports,"Group",()=>c),e(t.exports,"Tween",()=>p);var i,r,a=o("ibaza"),s={Linear:{None:function(e){return e}},Quadratic:{In:function(e){return e*e},Out:function(e){return e*(2-e)},InOut:function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)}},Cubic:{In:function(e){return e*e*e},Out:function(e){return--e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)}},Quartic:{In:function(e){return e*e*e*e},Out:function(e){return 1- --e*e*e*e},InOut:function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)}},Quintic:{In:function(e){return e*e*e*e*e},Out:function(e){return--e*e*e*e*e+1},InOut:function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)}},Sinusoidal:{In:function(e){return 1-Math.cos(e*Math.PI/2)},Out:function(e){return Math.sin(e*Math.PI/2)},InOut:function(e){return .5*(1-Math.cos(Math.PI*e))}},Exponential:{In:function(e){return 0===e?0:Math.pow(1024,e-1)},Out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?.5*Math.pow(1024,e-1):.5*(-Math.pow(2,-10*(e-1))+2)}},Circular:{In:function(e){return 1-Math.sqrt(1-e*e)},Out:function(e){return Math.sqrt(1- --e*e)},InOut:function(e){return(e*=2)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)}},Elastic:{In:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI)},Out:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((e-.1)*5*Math.PI)+1},InOut:function(e){return 0===e?0:1===e?1:(e*=2)<1?-.5*Math.pow(2,10*(e-1))*Math.sin((e-1.1)*5*Math.PI):.5*Math.pow(2,-10*(e-1))*Math.sin((e-1.1)*5*Math.PI)+1}},Back:{In:function(e){return e*e*(2.70158*e-1.70158)},Out:function(e){return--e*e*(2.70158*e+1.70158)+1},InOut:function(e){return(e*=2)<1?e*e*(3.5949095*e-2.5949095)*.5:.5*((e-=2)*e*(3.5949095*e+2.5949095)+2)}},Bounce:{In:function(e){return 1-s.Bounce.Out(1-e)},Out:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},InOut:function(e){return e<.5?.5*s.Bounce.In(2*e):.5*s.Bounce.Out(2*e-1)+.5}}};"undefined"==typeof self&&void 0!==a&&a.hrtime?r=function(){var e=a.hrtime();return 1e3*e[0]+e[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?r=self.performance.now.bind(self.performance):r=void 0!==Date.now?Date.now:function(){return new Date().getTime()};var l=r,c=function(){function e(){this._tweens={},this._tweensAddedDuringUpdate={}}return e.prototype.getAll=function(){var e=this;return Object.keys(this._tweens).map(function(t){return e._tweens[t]})},e.prototype.removeAll=function(){this._tweens={}},e.prototype.add=function(e){this._tweens[e.getId()]=e,this._tweensAddedDuringUpdate[e.getId()]=e},e.prototype.remove=function(e){delete this._tweens[e.getId()],delete this._tweensAddedDuringUpdate[e.getId()]},e.prototype.update=function(e,t){void 0===e&&(e=l()),void 0===t&&(t=!1);var n=Object.keys(this._tweens);if(0===n.length)return!1;for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<n.length;i++){var r=this._tweens[n[i]],o=!t;r&&!1===r.update(e,o)&&!t&&delete this._tweens[n[i]]}n=Object.keys(this._tweensAddedDuringUpdate)}return!0},e}(),h={Linear:function(e,t){var n=e.length-1,i=n*t,r=Math.floor(i),o=h.Utils.Linear;return t<0?o(e[0],e[1],i):t>1?o(e[n],e[n-1],n-i):o(e[r],e[r+1>n?n:r+1],i-r)},Bezier:function(e,t){for(var n=0,i=e.length-1,r=Math.pow,o=h.Utils.Bernstein,a=0;a<=i;a++)n+=r(1-t,i-a)*r(t,a)*e[a]*o(i,a);return n},CatmullRom:function(e,t){var n=e.length-1,i=n*t,r=Math.floor(i),o=h.Utils.CatmullRom;return e[0]===e[n]?(t<0&&(r=Math.floor(i=n*(1+t))),o(e[(r-1+n)%n],e[r],e[(r+1)%n],e[(r+2)%n],i-r)):t<0?e[0]-(o(e[0],e[0],e[1],e[1],-i)-e[0]):t>1?e[n]-(o(e[n],e[n],e[n-1],e[n-1],i-n)-e[n]):o(e[r?r-1:0],e[r],e[n<r+1?n:r+1],e[n<r+2?n:r+2],i-r)},Utils:{Linear:function(e,t,n){return(t-e)*n+e},Bernstein:function(e,t){var n=h.Utils.Factorial;return n(e)/n(t)/n(e-t)},Factorial:(i=[1],function(e){var t=1;if(i[e])return i[e];for(var n=e;n>1;n--)t*=n;return i[e]=t,t}),CatmullRom:function(e,t,n,i,r){var o=(n-e)*.5,a=(i-t)*.5,s=r*r;return r*s*(2*t-2*n+o+a)+(-3*t+3*n-2*o-a)*s+o*r+t}}},u=function(){function e(){}return e.nextId=function(){return e._nextId++},e._nextId=0,e}(),d=new c,p=function(){function e(e,t){void 0===t&&(t=d),this._object=e,this._group=t,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=s.Linear.None,this._interpolationFunction=h.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=u.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return e.prototype.getId=function(){return this._id},e.prototype.isPlaying=function(){return this._isPlaying},e.prototype.isPaused=function(){return this._isPaused},e.prototype.to=function(e,t){return this._valuesEnd=Object.create(e),void 0!==t&&(this._duration=t),this},e.prototype.duration=function(e){return this._duration=e,this},e.prototype.start=function(e){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var t in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(t),this._valuesStart[t]=this._valuesStartRepeat[t];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==e?"string"==typeof e?l()+parseFloat(e):e:l(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},e.prototype._setupProperties=function(e,t,n,i){for(var r in n){var o=e[r],a=Array.isArray(o),s=a?"array":typeof o,l=!a&&Array.isArray(n[r]);if("undefined"!==s&&"function"!==s){if(l){var c=n[r];if(0===c.length)continue;c=c.map(this._handleRelativeValue.bind(this,o)),n[r]=[o].concat(c)}if(("object"===s||a)&&o&&!l){for(var h in t[r]=a?[]:{},o)t[r][h]=o[h];i[r]=a?[]:{},this._setupProperties(o,t[r],n[r],i[r])}else void 0===t[r]&&(t[r]=o),a||(t[r]*=1),l?i[r]=n[r].slice().reverse():i[r]=t[r]||0}}},e.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying&&(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object)),this},e.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},e.prototype.pause=function(e){return void 0===e&&(e=l()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=e,this._group&&this._group.remove(this)),this},e.prototype.resume=function(e){return void 0===e&&(e=l()),this._isPaused&&this._isPlaying&&(this._isPaused=!1,this._startTime+=e-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this)),this},e.prototype.stopChainedTweens=function(){for(var e=0,t=this._chainedTweens.length;e<t;e++)this._chainedTweens[e].stop();return this},e.prototype.group=function(e){return this._group=e,this},e.prototype.delay=function(e){return this._delayTime=e,this},e.prototype.repeat=function(e){return this._initialRepeat=e,this._repeat=e,this},e.prototype.repeatDelay=function(e){return this._repeatDelayTime=e,this},e.prototype.yoyo=function(e){return this._yoyo=e,this},e.prototype.easing=function(e){return this._easingFunction=e,this},e.prototype.interpolation=function(e){return this._interpolationFunction=e,this},e.prototype.chain=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._chainedTweens=e,this},e.prototype.onStart=function(e){return this._onStartCallback=e,this},e.prototype.onUpdate=function(e){return this._onUpdateCallback=e,this},e.prototype.onRepeat=function(e){return this._onRepeatCallback=e,this},e.prototype.onComplete=function(e){return this._onCompleteCallback=e,this},e.prototype.onStop=function(e){return this._onStopCallback=e,this},e.prototype.update=function(e,t){if(void 0===e&&(e=l()),void 0===t&&(t=!0),this._isPaused)return!0;var n,i,r=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(e>r)return!1;t&&this.start(e)}if(this._goToEnd=!1,e<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),i=(e-this._startTime)/this._duration,i=0===this._duration||i>1?1:i;var o=this._easingFunction(i);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,o),this._onUpdateCallback&&this._onUpdateCallback(this._object,i),1===i){if(this._repeat>0){for(n in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[n]||(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo&&this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=e+this._repeatDelayTime:this._startTime=e+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object)}else{this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var a=0,s=this._chainedTweens.length;a<s;a++)this._chainedTweens[a].start(this._startTime+this._duration);return this._isPlaying=!1,!1}}return!0},e.prototype._updateProperties=function(e,t,n,i){for(var r in n)if(void 0!==t[r]){var o=t[r]||0,a=n[r],s=Array.isArray(e[r]),l=Array.isArray(a);!s&&l?e[r]=this._interpolationFunction(a,i):"object"==typeof a&&a?this._updateProperties(e[r],o,a,i):"number"==typeof(a=this._handleRelativeValue(o,a))&&(e[r]=o+(a-o)*i)}},e.prototype._handleRelativeValue=function(e,t){return"string"!=typeof t?t:"+"===t.charAt(0)||"-"===t.charAt(0)?e+parseFloat(t):parseFloat(t)},e.prototype._swapEndStartRepeatValues=function(e){var t=this._valuesStartRepeat[e],n=this._valuesEnd[e];"string"==typeof n?this._valuesStartRepeat[e]=this._valuesStartRepeat[e]+parseFloat(n):this._valuesStartRepeat[e]=this._valuesEnd[e],this._valuesEnd[e]=t},e}();u.nextId,d.getAll.bind(d),d.removeAll.bind(d),d.add.bind(d),d.remove.bind(d),d.update.bind(d)}),a("ibaza",function(e,t){var n,i,r,o=e.exports={};function a(){throw Error("setTimeout has not been defined")}function s(){throw Error("clearTimeout has not been defined")}function l(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:a}catch(e){n=a}try{i="function"==typeof clearTimeout?clearTimeout:s}catch(e){i=s}}();var c=[],h=!1,u=-1;function d(){h&&r&&(h=!1,r.length?c=r.concat(c):u=-1,c.length&&p())}function p(){if(!h){var e=l(d);h=!0;for(var t=c.length;t;){for(r=c,c=[];++u<t;)r&&r[u].run();u=-1,t=c.length}r=null,h=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===s||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new f(e,t)),1!==c.length||h||l(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw Error("process.chdir is not supported")},o.umask=function(){return 0}});let s=1/Math.sqrt(2*Math.PI);function l(e,t,n){return s/n*Math.exp(-.5*((e-t)/n)**2)}function c(e,t,n){return e===1/0?1:e===-1/0?0:.5*function(e){let t=e**2;return Math.sqrt(1-Math.exp(-((4/Math.PI+.147*t)/(1+.147*t))*t))*Math.sign(e)}((e-t)/(n*Math.sqrt(2)))+.5}function h(e){let t=u(e),n=[];return t.reduce((e,t,i)=>{let r=e+t;return n[i]=r,r},0),n}function u(e){let t=e.reduce((e,t)=>e+t);return e.map(e=>e/t)}function d(e,t){let n=t();return e.findIndex(e=>e>=n)}function p(e){let t=Array(e);for(let n=0;n<e;n++)t[n]=n;return t}function f(e){let t=1/0,n=null;for(let i=0;i<e.length;i++){let r=e[i];r<t&&(t=r,n=i)}return n}function m(e){let t=-1/0,n=null;for(let i=0;i<e.length;i++){let r=e[i];r>t&&(t=r,n=i)}return n}function g(e){let t=e[0],n=e[0];for(let i=0;i<e.length;i++){let r=e[i];r<t&&(t=r),r>n&&(n=r)}return[t,n]}function y(e){return JSON.parse(JSON.stringify(e))}function v(e){let t=e.length,n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}function w(){let e=["init"];this.add=t=>{t.forEach(t=>e.push(t))},this.check=t=>{let n=0;return t.forEach(t=>{n+=e.includes(t)?1:0}),n>0},this.checkNone=()=>0===e.length,this.checkAny=()=>0!==e.length,this.clear=()=>{e.splice(0,e.length)},this.numChanges=()=>e.length,this.getChanges=()=>y(e)}function x(e){let t=[];this.addSender=n=>{let{name:i,action:r,props:o}=n;t[i]=r;let a=e=>({name:i,value:e,props:o});return{command:a,go:t=>e.do(a(t)),load:t=>e.loadCommands([a(t)])}},this.addSenderForList=n=>{let{name:i,action:r,props:o}=n;t[i]=r;let a=(e,t,n)=>({name:i,id:e,value:t,props:o,currentValue:n});return{command:a,go:(t,n,i)=>e.do(a(t,n,i)),load:(t,n,i)=>e.loadCommands([a(t,n,i)])}},this.execute=e=>{let{name:n,id:i,value:r}=e,o=t[n];void 0!==i?o(i,r):o(r)}}class _{constructor(){this.linked=!0,this.commanders=[],this.protect=!1}setLinked(e){this.linked=e}addCommander(e){this.commanders.push(e)}broadcastDo(e,t){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach(t=>t.passDo(e)),this.protect=!1):t.passDo(e)}broadcastDoCommands(e,t){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach(t=>t.passDoCommands(e)),this.protect=!1):t.passDoCommands(e)}broadcastLoadConfig(e,t){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach(t=>t.passLoadConfig(e)),this.protect=!1):t.passLoadConfig(e)}broadCastLoadCommands(e,t){this.linked&&!1===this.protect?(this.protect=!0,this.commanders.forEach(t=>t.passLoadCommands(e)),this.protect=!1):t.passLoadCommands(e)}}function b(e){let t=this,n={},i=[];t.addSender=e=>{let{name:t,currentValue:r,props:o}=e;void 0!==o&&o.isFirstAction&&(i[t]=!0),n[t]=r},t.addSenderForList=e=>{let{name:t,props:r}=e;return void 0!==r&&r.isFirstAction&&(i[t]=!0),n[t]=[],e=>n[t][e]},t.execute=e=>{let{name:t,id:i,value:r}=e;void 0!==i?n[t][i]=r:n[t]=r},t.makeUndo=e=>{let t;let{name:i,id:r,props:o}=e;return void 0===r?t=n[i]:void 0===(t=n[i][r])&&(t=e.currentValue),{name:i,id:r,value:t,props:o}},t.passLoadConfig=e=>{t.loadConfigPriority(e,"high"),t.loadConfigPriority(e,"low")},t.loadConfigPriority=(t,n)=>{Object.keys(t).forEach(r=>{let o=void 0!==i[r];if("low"===n&&o||"high"===n&&!o)return;let a=t[r];a instanceof Array?a.forEach((t,n)=>{e.execute({name:r,id:n,value:t})}):e.execute({name:r,value:a})})},t.passLoadCommands=t=>{t.forEach(t=>{e.execute(t)})},t.getConfig=()=>structuredClone(n)}function C(e){let t=this,n=[],i=-1;t.clearHistory=()=>{n.splice(0,n.length),i=-1},t.passDo=t=>{let r=e.makeUndo(t);n.splice(i+1,n.length-(i+1)),e.execute(t),t.props&&t.props.combineWithCurrentCommand&&i>-1?n[i].push({command:t,undoCommand:r}):(n.push([{command:t,undoCommand:r}]),i+=1)},t.passDoCommands=t=>{n.splice(i+1,n.length-(i+1));let r=[];t.forEach(t=>{let n=e.makeUndo(t);r.push({command:t,undoCommand:n}),e.execute(t)}),n.push(r),i+=1};let r=setTimeout(()=>null,30);t.undo=()=>{if(-1===i)return;let o=n[i];o.forEach(t=>{e.execute(t.undoCommand)}),i-=1;let{undoCommand:a}=o[0];if(void 0===a.props||!0!==a.props.isChain||-1===i)return;let s=n[i][0];!0===s.undoCommand.props.isChain&&s.undoCommand.name===a.name&&(void 0===a.id||s.undoCommand.id===a.id)&&(clearTimeout(r),r=setTimeout(t.undo,30))},t.redo=()=>{if(i===n.length-1)return;let o=n[i+1];o.forEach(t=>e.execute(t.command)),i+=1;let{command:a}=o[0];if(void 0===a.props||!0!==a.props.isChain||i===n.length-1)return;let s=n[i+1][0];!0===s.command.props.isChain&&s.command.name===a.name&&(void 0===a.id||s.command.id===a.id)&&(clearTimeout(r),r=setTimeout(t.redo,30))}}function S(e){let t=this,n=new x(t),i=new b(t),r=new C(t),o=e||new _;o.addCommander(t),t.addSender=e=>(i.addSender(e),n.addSender(e)),t.addSenderForList=e=>{let t=n.addSenderForList(e);return t.getCurrentValue=i.addSenderForList(e),t},t.execute=e=>{i.execute(e),n.execute(e)},t.makeUndo=i.makeUndo,t.passLoadConfig=i.passLoadConfig,t.passLoadCommands=i.passLoadCommands,t.getConfig=i.getConfig,t.loadConfig=e=>{o.broadcastLoadConfig(e,t)},t.loadCommands=e=>{o.broadCastLoadCommands(e,t)},t.do=e=>{o.broadcastDo(e,t)},t.doCommands=e=>{o.broadcastDoCommands(e,t)},t.passDo=r.passDo,t.passDoCommands=r.passDoCommands,t.undo=r.undo,t.redo=r.redo,t.clearHistory=r.clearHistory}function P(e,t){let n=this;n.init=()=>{n.setMode("one"),n.setDimensions(2),n.seeds=[0],n.setSeedRandom(!0)},n.setMode=t.addSender({name:"mode",currentValue:n.mode,action(t){n.mode=t,e.add(["mode"])}}).go,n.setDimensions=t.addSender({name:"dimensions",currentValue:n.dimensions,action(t){n.dimensions=t,e.add(["dimensions"])}}).go,n.setSeeds=t.addSenderForList({name:"seeds",action(t,i){n.seeds[t]=i,e.add(["seeds"])},props:{combineWithCurrentCommand:!0}}).go,n.setSeedRandom=t.addSender({name:"seedRandom",currentValue:n.seedRandom,action(t){n.seedRandom=t,e.add(["seedRandom"])}}).go,n.resultsPhaseBySeq={general:"general",closedPrimary:"general",nonpartisanOpenPrimary:"general"},n.setResultsPhase=(t,i)=>{n.resultsPhaseBySeq[t]=i,e.add(["resultsPhase"])},n.resultsPartyBySeq={general:void 0,closedPrimary:0,nonpartisanOpenPrimary:void 0},n.setResultsParty=(t,i)=>{n.resultsPartyBySeq[t]=i,e.add(["resultsParty"])},n.init()}function k(e,t,n){let i={usr:4,verbosity:2};this.update=()=>{(e.check(["mode"])||e.check(["numTracts"]))&&("one"===t.mode?1===n.numTracts?(i.verbosity=2,i.usr=4):(i.verbosity=1,i.usr=32):(i.verbosity=0,1===n.numTracts?i.usr=16:i.usr=32))},this.getOptions=()=>({...i})}function M(e,t,n){let i;let{seats:r,threshold:o,seatLimits:a}=t,{voteFractionsByCan:s}=e.candidateTallies,l=s.map(e=>e<o?0:e),c=Array(l.length);for(let e=0;e<l.length;e++)c[e]=0===l[e]?0:1;let h=c.reduce((e,t)=>e+t),u=0===h;if(void 0!==a&&c.map((e,t)=>e*a[t]).reduce((e,t)=>e+t)<r&&(u=!0),u&&(h=(c=(l=v(s)).map(e=>0===e?0:1)).reduce((e,t)=>e+t)),"Huntington-Hill"===n&&(h>r||0===h)){let e=[...l].sort((e,t)=>t-e)[r-1];return{allocation:s.map(t=>t>=e?1:0)}}"huntingtonHill"===n?i=(e,t)=>Math.sqrt(t*(t+1)):"sainteLague"===n?i=(e,t)=>t+.5:"dHondt"===n&&(i=(e,t)=>t+1);let d=Array(r).fill().map(i),f=[],m=[],g=0;for(let e=0;e<l.length;e++){let t=l[e];if(0===t)continue;let n=void 0===a?r:Math.min(a[e],r);for(let i=0;i<n;i++)f[g]=d[i]/t,m[g]=e,g+=1}let y=p(m.length).sort((e,t)=>f[e]-f[t]),w=Array(l.length).fill(0);for(let e=0;e<r;e++){let t=m[y[e]];w[t]+=1}return{allocation:w}}function A(e,t){return M(e,t,"sainteLague")}function E(e,t){let{voteFractionsByCan:n}=e.candidateTallies,{seats:i}=t,r=n.length;if(i>=r)return{allocation:Array(r).fill(1)};let o=p(r).sort((e,t)=>n[t]-n[e]),a=Array(r).fill(0);for(let e=0;e<i;e++)a[o[e]]=1;return{allocation:a}}let T=[{name:"Plurality",shortName:"Plurality",functionName:"plurality",voteCasterName:"plurality",socialChoiceType:"singleWinner",elect:function(e){let{voteFractionsByCan:t}=e.candidateTallies;return{iWinner:m(t)}}},{name:"Random Candidate",shortName:"Rand Cand",functionName:"randomCandidate",voteCasterName:"plurality",socialChoiceType:"singleWinner",elect:function(e){let{voteFractionsByCan:t}=e.candidateTallies;return{iWinner:Math.floor(Math.random()*t.length)}}},{name:"Huntington Hill",shortName:"Huntington",functionName:"huntingtonHill",voteCasterName:"plurality",socialChoiceType:"allocation",elect:function(e,t){return M(e,t,"huntingtonHill")}},{name:"Score",shortName:"Score",functionName:"score",voteCasterName:"score",socialChoiceType:"singleWinner",elect:function(e){let{scoreFractionAverageByCan:t}=e.candidateTallies;return{iWinner:t.indexOf(Math.max(...t))}}},{name:"Single Transferable Vote",shortName:"STV",functionName:"stv",voteCasterName:"ranking",socialChoiceType:"multiWinner",elect:function(e,t){let{firstPreferenceFractions:n}=e.candidateTallies,{voteFractions:i}=e.preferenceTallies,{cansByRankList:r}=e.preferenceLists,{seats:o}=t,a=n.length,s=i.length;if(o>=a)return{allocation:Array(a).fill(1)};let l=1/(o+1),c=!1,h=0,u=[],d=v(n),g=Array(a).fill(!0),y=p(a),w=Array(s).fill(0),x=Array(s).fill(1),_=Array(s).fill(!1);for(;!c&&h<a;){let e;if(0!==h){d=Array(a).fill(0);for(let e=0;e<r.length;e++){if(_[e])continue;let t=w[e],n=r[e][t];for(let t=0;t<n.length;t++){let r=n[t];d[r]+=i[e]*x[e]}}d=d.filter((e,t)=>g[t]),y=p(a).filter(e=>g[e])}let t=m(d),n=y[t],s=d[t],v=1;s>=l?(e=n,v=1-l/s,u.push(n),c=u.length===o):e=y[f(d)],g[e]=!1;for(let t=0;t<r.length;t++){if(_[t])continue;let n=w[t];if(r[t][n].includes(e)){1!==v&&(x[t]*=v);let e=!_[t];for(;e;){w[t]+=1;let n=w[t];if(n===a){_[t]=!0;break}let i=r[t][n];for(let t=0;t<i.length;t++){let n=i[t];e=e&&!g[n]}}}}h+=1}c||console.warn("warning: STV ran over - eliminated all candidates.");let b=Array(a).fill(0);for(let e=0;e<u.length;e++){let t=u[e];b[t]+=1}return{allocation:b}}},{name:"Minimax",shortName:"Minimax",functionName:"minimax",voteCasterName:"pairwise",socialChoiceType:"singleWinner",elect:function(e){let{winFractionPairwise:t}=e.pairwiseTallies,n=t.length,i=Array(n).fill(0),r=.5*n*(n-1),o=Array(n),a=Array(r),s=0;for(let e=0;e<n-1;e++)for(let r=e+1;r<n;r++){let n=t[e][r]-t[r][e];o[s]=Math.abs(n);let l=n<0;i[e]+=l?1:0,i[r]+=l?0:1,a[s]=l?e:r,s+=1}let l=p(r).sort((e,t)=>o[e]-o[t]),c=i.findIndex(e=>0===e),h=0;for(;-1===c;){let e=a[l[h]];i[e]-=1,c=i.findIndex(e=>0===e),h+=1}return{iWinner:c}}},{name:"Open List Proportional Representation",shortName:"OLPR A",functionName:"olprA",voteCasterName:"plurality",socialChoiceType:"multiWinner",elect:function(e,t){let{voteFractionsByCan:n}=e.candidateTallies,{parties:i}=e,{partiesByCan:r,numParties:o}=i,a=n.length,s=Array(o).fill(0),l=Array(o).fill(0);for(let e=0;e<a;e++){let t=r[e];s[t]+=n[e],l[t]+=1}let c={...t};c.seatLimits=l;let h=A({candidateTallies:{voteFractionsByCan:s},numCans:a},c).allocation,u=Array(a).fill(0);for(let e=0;e<o;e++){let t={seats:h[e]},i=p(a).filter(t=>r[t]===e),o=i.map(e=>n[e]),s=o.reduce((e,t)=>e+t,0),l=E({candidateTallies:{voteFractionsByCan:o.map(e=>e/s)},numCans:a},t).allocation;for(let e=0;e<i.length;e++)u[i[e]]=l[e]}return{allocation:u}}},{name:"d'Hondt",shortName:"d'Hondt",functionName:"dHondt",voteCasterName:"plurality",socialChoiceType:"allocation",elect:function(e,t){return M(e,t,"dHondt")}},{name:"Sainte-Lague",shortName:"Sainte-Lague",functionName:"sainteLague",voteCasterName:"plurality",socialChoiceType:"allocation",elect:A},{name:"Allocated Score",shortName:"AllocScore",functionName:"allocatedScore",voteCasterName:"scoreFull",socialChoiceType:"multiWinner",elect:function(e,t){let{voteFractions:n}=e.preferenceTallies,{scoreVotes:i}=e.preferenceLists,{seats:r}=t,o=i[0].length,a=i.length,s=1/r,l=Array(a).fill(1),c=Array(o).fill(0),h=0;for(let e=0;e<o&&!(h>=r);e++){let e=Array(o).fill(0);for(let t=0;t<o;t++)if(1!==c[t])for(let r=0;r<a;r++)e[t]+=l[r]*n[r]*i[r][t];let t=Math.max(...e),r=e.indexOf(t);c[r]=1,h+=1;let u=p(a).sort((e,t)=>i[t][r]-i[e][r]),d=0;for(let e=0;e<a;e++){let t=u[e];if(d+=i[t][r]*l[t]*n[e],l[t]=0,d>=s)break}}return{allocation:c}}},{name:"Method of Equal Shares",shortName:"MES",functionName:"methodOfEqualShares",voteCasterName:"scoreFull",socialChoiceType:"multiWinner",elect:function(e,t){let{voteFractions:n}=e.preferenceTallies,{scoreVotes:i}=e.preferenceLists,{seats:r}=t,o=i[0].length,a=i.length,s=1/r,l=Array(a).fill(1),c=Array(o).fill(0),h=[],u=[],d=0;for(let e=0;e<o&&!(d>=r);e++){let t=Array(o).fill(0);for(let e=0;e<o;e++)if(1!==c[e])for(let r=0;r<a;r++)t[e]+=n[r]*i[r][e];let f=p(o).sort((e,n)=>t[n]-t[e]),m=null,g=1/0;for(let e=0;e<o;e++){let r=f[e];if(1===c[r])continue;let o=s/t[r],h=!0;for(let e=0;e<a;e++){let t=i[e][r];if(l[e]<o*t){h=!1;break}}if(h&&o<g){g=o,m=r;break}let u=[],d=0,p=[];for(let e=0,t=0;e<a;e++){let o=l[e],a=i[e][r];u[e]=o/a,a>0&&(d+=o*n[e],p[t]=e,t+=1)}if(d+1e-4-s<0)continue;let y=p.sort((e,t)=>u[e]-u[t]),v=y.length,w=s,x=t[r],_=null;for(let e=0;e<v;e++){let t=y[e];if(w<x*(_=u[t]))break;w-=n[t]*l[t],x-=n[t]*i[t][r]}w>1e-4&&x>1e-4&&(_=w/x),_<g&&(m=r,g=_)}if(null===m){for(let e=0;e<o;e++){let t=f[e];if(1!==c[t]&&(c[t]=1,(d+=1)>=r))break}break}c[m]=1,d+=1,h[e]=m,u[e]=g;for(let e=0;e<a;e++){let t=g*i[e][m];l[e]=Math.max(0,l[e]-t)}}return{allocation:c,explanation:{winnersByRound:h,winnerMaxCostPerScoreByRound:u,socialChoiceOptions:t}}}},{name:"Random Voter",explain:"Random Voter: Pick a voter and their choice is the winning candidate.",shortName:"Rand Vote",functionName:"randomVoter",voteCasterName:"plurality",socialChoiceType:"singleWinner",elect:function(e){let{voteFractionsByCan:t}=e.candidateTallies;return{iWinner:d(h(t),Math.random)}}},{name:"Single Non-Transferable Vote",shortName:"SNTV",functionName:"sntv",voteCasterName:"plurality",socialChoiceType:"multiWinner",elect:E}],N={},D={};function O(e,t){let n={seats:1,threshold:.1};this.update=()=>{if(e.check(["socialChoiceMethod"])){let{socialChoiceType:e}=t;"allocation"===e?n.seats=5:"multiWinner"===e?n.seats=3:n.seats=1}},this.getOptions=()=>({...n})}function L(e,t,n,i){let r=this,o={socialChoiceMethod:"plurality",voteCasterName:"plurality",socialChoiceType:"singleWinner",socialChoiceOptions:{seats:1,threshold:.1}};r.socialChoiceOptionsMan=new O(n,o),r.setSocialChoiceMethod=i.addSender({name:`socialChoiceMethod-sequence-${e}-phase-${t}`,currentValue:o.socialChoiceMethod,action(e){o.socialChoiceMethod=e;let t=D[e];o.voteCasterName=t.voteCasterName,o.socialChoiceType=t.socialChoiceType,n.add(["socialChoiceMethod"])}}).go,r.init=()=>{r.setSocialChoiceMethod("plurality")},r.update=()=>{r.socialChoiceOptionsMan.update(),o.socialChoiceOptions=r.socialChoiceOptionsMan.getOptions()},r.getOptions=()=>{let e={...o};return e.socialChoiceOptions=r.socialChoiceOptionsMan.getOptions(),e}}function B(e,t){let n=this;n.sequences={general:{phases:{general:new L("general","general",e,t)}},closedPrimary:{phases:{closedPrimary:new L("closedPrimary","closedPrimary",e,t),general:new L("closedPrimary","general",e,t)}},nonpartisanOpenPrimary:{phases:{nonpartisanOpenPrimary:new L("nonpartisanOpenPrimary","nonpartisanOpenPrimary",e,t),general:new L("nonpartisanOpenPrimary","general",e,t)}}},n.finalPhaseBySequence={general:"general",closedPrimary:"general",nonpartisanOpenPrimary:"general"};let i=[];Object.keys(n.sequences).forEach(e=>{let{phases:t}=n.sequences[e];Object.keys(t).forEach(e=>{i.push(t[e])})});let r={};n.init=()=>{n.setSequenceName("general"),i.forEach(e=>{e.init()})},n.setSequenceName=t.addSender({name:"sequenceName",currentValue:r.sequenceName,action(t){r.sequenceName=t,e.add(["sequenceName"])}}).go,n.update=()=>{i.forEach(e=>{e.update()})},n.getOptions=()=>{let e={...r};return e.sequences={},Object.keys(n.sequences).forEach(t=>{e.sequences[t]={phases:{}};let{phases:i}=n.sequences[t];Object.keys(i).forEach(i=>{e.sequences[t].phases[i]=n.sequences[t].phases[i].getOptions()})}),e}}function R(e,t,n){let i=this,r={pollCount:5,numSampleCandidates:5};i.castOptionsMan=new k(e,t,r),i.sequenceOptionsMan=new B(e,n),i.init=()=>{i.sequenceOptionsMan.init(),i.setNumTracts(1),i.setNumDistricts(1)},i.setNumDistricts=n.addSender({name:"numDistricts",currentValue:r.numDistricts,action(t){r.numDistricts=t;let n=t>1,i=r.numTracts>1;r.useGeography=i||n,e.add(["numDistricts"])}}).go,i.setNumTracts=n.addSender({name:"numTracts",currentValue:r.numTracts,action(t){r.numTracts=t;let n=t>1,i=r.numDistricts>1;r.useGeography=n||i,e.add(["numTracts"])}}).go,i.update=()=>{if(i.castOptionsMan.update(),i.sequenceOptionsMan.update(),e.check(["socialChoiceMethod"])){let e=i.sequenceOptionsMan.getOptions(),{sequenceName:t}=e,{finalPhaseBySequence:n}=i.sequenceOptionsMan,o=n[t],{socialChoiceType:a}=e.sequences[t].phases[o];"allocation"===a?r.numSampleCandidates=10:"multiWinner"===a?r.numSampleCandidates=10:r.numSampleCandidates=5}},i.getOptions=()=>{let e={...r};return e.castOptions=i.castOptionsMan.getOptions(),e.sequenceOptions=i.sequenceOptionsMan.getOptions(),e},i.init()}function F(){let e=[],t=0;this.new=function(n){e.push(n);let i=t;return t+=1,i},this.num=()=>t,this.get=t=>e[t],this.getList=()=>e}function V(e,t,n,i,r,o,a,s){let l=this;function c(e){l.strategyRules=e,o.add(["voters","strategyRules"])}l.shape1={},l.shape2={},l.color="#88888888",l.strategyRules=n,l.shape1.densityMax=1,l.shape2.densityMax=1,l.setAction={exists(e){l.exists=e,o.add(["voters","draggables"])},shape2p(e){l.shape2.x=e.x,l.shape2.y=e.y,o.add(["voters","draggables"])},shape1x(e){l.shape1.x=e,o.add(["voters","draggables"])},shape2w(e){l.shape2.w=e,o.add(["voters","width"])},shape1w(e){l.shape1.w=e,o.add(["voters","width"])},shape1densityProfile(e){l.shape1.densityProfile=e,o.add(["voters","densityProfile"])},shape2densityProfile(e){l.shape2.densityProfile=e,o.add(["voters","densityProfile"])},strategy(e){c(e)},actionOptionThreshold(e){c(e)},actionWeight(e){c(e)},party(e){l.party=e,o.add(["party"])}};let h=i.new(l);l.doSetCommand={},Object.keys(l.setAction).forEach(e=>{l.doSetCommand[e]=t=>{let n=s[e].getCurrentValue(h);s[e].go(h,t,n)}});let u={x:e.x,y:e.y},d=[s.exists.command(h,1,0),s.shape2p.command(h,u,u),s.shape1x.command(h,t.x,t.x),s.shape2w.command(h,e.w,e.w),s.shape1w.command(h,t.w,t.w),s.shape1densityProfile.command(h,t.densityProfile,t.densityProfile),s.shape2densityProfile.command(h,e.densityProfile,e.densityProfile),s.strategy.command(h,l.strategyRules,l.strategyRules),s.party.command(h,[h],[h])];a?r.loadCommands(d):r.doCommands(d)}function q(e,t,n,i,r){let o=this;r.forEach(r=>(function(r,a,s){o[r]=t.addSenderForList({action:(t,i)=>{n.setNumberEntities(t+1),e.get(t).setAction[r](i)},name:`${i}-${a}`,props:{isChain:s}})})(...r))}function G(e,t){return 1===t?e.map(e=>e.shape1.x):e.map(e=>[e.shape2.x,e.shape2.y])}function I(e,t,n){let i=this,r=[];i.attachNewE=e=>{r.push(e)};let o=e=>{r.forEach(t=>t.updateNewE(e))};i.addEntity=e=>{o(e);let t=n.num();i.setNumberEntities(t)},i.addEntityPressed=()=>{let e=n.num()+1;i.setNumberEntities(e)},i.setNumberEntities=e.addSender({currentValue:0,name:`${t}-setNumberAtLeast`,props:{isFirstAction:!0},action:e=>{for(;n.num()<e;)i.addDefaultEntity()}}).load,i.getEntities=()=>n.getList().filter(e=>e.exists),i.getGeoms=e=>{var t;return t=i.getEntities(),1===e?t.map(e=>e.shape1):t.map(e=>e.shape2)},i.getPoints=e=>G(i.getEntities(),e)}T.forEach(e=>{N[e.functionName]=e.elect,D[e.functionName]=e});var j=[{condition:{voteCasterName:"score"},strategy:[{actionName:"normalize",actionWeight:1,actionOptions:{threshold:{type:"step",mean:.5,radius:.1}}},{actionName:"normalizeOverFrontrunners",actionWeight:0,actionOptions:{threshold:{type:"step",mean:.5,radius:.1}}}]},{condition:{voteCasterName:"plurality"},strategy:[{actionName:"closest",actionWeight:1,actionOptions:{threshold:{type:"step",mean:.5,radius:.1}}},{actionName:"lesserEvil",actionWeight:0,actionOptions:{threshold:{type:"step",mean:.5,radius:.1}}}]},{condition:{voteCasterName:"ranking"},strategy:[{actionName:"closest",actionWeight:1,actionOptions:{}}]},{condition:{voteCasterName:"pairwise"},strategy:[{actionName:"closest",actionWeight:1,actionOptions:{}}]},{condition:{voteCasterName:"scoreFull"},strategy:[{actionName:"normalize",actionWeight:1,actionOptions:{}}]}];function W(e,t){let n=this,i="voters",r=new F;I.call(n,t,i,r);let o=new q(r,t,n,i,[["exists","exists",!1],["shape2p","shape2D-point",!0],["shape1x","shape1D-x",!0],["shape2w","shape2D-width",!0],["shape1w","shape1D-width",!0],["shape1densityProfile","shape1D-densityProfile",!1],["shape2densityProfile","shape2D-densityProfile",!1],["actionWeight","strategyRules",!0],["strategy","strategyRules",!1],["actionOptionThreshold","strategyRules",!0],["party","party",!1]]);n.addVoterCircle=({shape2:i,shape1:a,strategyRules:s,doLoad:l})=>{let c=new V(i,a,s,r,t,e,l,o);n.addEntity(c)},n.addDefaultEntity=()=>{n.addVoterCircle({shape2:{x:50,y:50,w:200,densityProfile:"step",densityMax:1},shape1:{x:50,w:200,densityProfile:"gaussian",densityMax:1},strategyRules:j,doLoad:!1})},n.getVoterStrategyListByPhase=e=>{let{sequenceName:t,sequences:i}=e,{phases:r}=i[t],o={};return Object.keys(r).forEach(e=>{let{voteCasterName:t}=r[e],i=function(e,t){let i=[],r=n.getEntities();for(let n=0;n<r.length;n+=1){let o=z(r[n].strategyRules,e,t),a=h(u(o.map(e=>e.actionWeight)));i.push({strategy:o,strategyCDF:a})}return i}(t,e);o[e]=i}),o},n.getParties=()=>n.getEntities().map(e=>e.party[0])}function z(e,t,n){for(let i=0;i<e.length;i+=1){let r=e[i];if((void 0===r.condition.phaseName||r.condition.phaseName===n)&&(void 0===r.condition.voteCasterName||r.condition.voteCasterName===t))return r.strategy}}let U=Math.round;function $(e,t,n,i,r,o,a,s,l){s.save(),s.globalAlpha=a,s.textAlign=l||"center",s.font=`${i}px Sans-serif`,s.lineWidth=r,s.fillStyle=o,s.fillText(e,t,n),s.restore()}function H(e){return void 0===e?"":(100*e).toFixed(0)}function X(e,t,n,i,r,o,a,s){let l=this;l.shape1={},l.shape2={},l.setAction={exists(e){l.exists=e,o.add(["draggables"])},shape2p(e){l.shape2.x=e.x,l.shape2.y=e.y,o.add(["draggables"])},shape1x(e){l.shape1.x=e,o.add(["draggables"])},color(e){l.color=e,l.colorRGBA=function(e){let t=e.length,n=[,,,,].fill();if("rgb"===e.slice(0,3).toLowerCase()){let t=e.replace(" ","").split(",");n[0]=parseInt(t[0].slice("a"===t[3].toLowerCase()?5:4),10),n[1]=parseInt(t[1],10),n[2]=parseInt(t[2],10),n[3]=t[3]?parseFloat(t[3]):-1}else{let i;i=t<6?parseInt(String(e[1])+e[1]+e[2]+e[2]+e[3]+e[3]+(t>4?String(e[4])+e[4]:""),16):parseInt(e.slice(1),16),n[0]=i>>16&255,n[1]=i>>8&255,n[2]=255&i,n[3]=9===t||5===t?U((i>>24&255)/255*1e4)/1e4:-1}return n}(e),o.add(["color"])},party(e){l.party=e,o.add(["party"])}};let c=i.new(l);l.doSetCommand={},Object.keys(l.setAction).forEach(e=>{l.doSetCommand[e]=t=>{let n=s[e].getCurrentValue(c);s[e].go(c,t,n)}});let h={x:e.x,y:e.y},u=[s.exists.command(c,1,0),s.shape2p.command(c,h,h),s.shape1x.command(c,t.x,t.x),s.color.command(c,n,n),s.party.command(c,[c],[c])];a?r.loadCommands(u):r.doCommands(u)}function Y(e,t){let n=this,i="candidates",r=new F;I.call(n,t,i,r);let o=new q(r,t,n,i,[["exists","exists",!1],["shape2p","shape2D-point",!0],["shape1x","shape1D-x",!0],["color","color",!1],["party","party",!1]]);n.addCandidate=({shape2:i,shape1:a,color:s,doLoad:l})=>{let c=new X(i,a,s,r,t,e,l,o);n.addEntity(c)},n.addDefaultEntity=()=>{n.addCandidate({shape2:{x:50,y:50},shape1:{x:50},color:function(e){let t=document.createElement("canvas"),n=t.getContext("2d");n.fillStyle=e;let i=n.fillStyle;return t.remove(),i}("yellow"),doLoad:!1})},n.getParties=()=>({partiesByCan:n.getEntities().map(e=>e.party[0]),numParties:10}),n.getRGBAList=()=>n.getEntities().map(e=>e.colorRGBA)}function J(e,t,n,i,r,o,a){let s=this;s.shape2={},s.shape1={},s.color="#ccc",s.darkModeColor="#333",s.setAction={exists(e){s.exists=e,r.add(["draggables"])},shape2p(e){s.shape2.x=e.x,s.shape2.y=e.y,r.add(["draggables"])},shape1x(e){s.shape1.x=e,r.add(["draggables"])},shape2w(e){s.shape2.w=e,r.add(["width"])},shape1w(e){s.shape1.w=e,r.add(["width"])},shape1densityProfile(e){s.shape1.densityProfile=e,r.add(["densityProfile"])},shape2densityProfile(e){s.shape2.densityProfile=e,r.add(["densityProfile"])},party(e){s.party=e,r.add(["party"])}};let l=n.new(s);s.doSetCommand={},Object.keys(s.setAction).forEach(e=>{s.doSetCommand[e]=t=>{let n=a[e].getCurrentValue(l);a[e].go(l,t,n)}});let c={x:e.x,y:e.y},h=[a.exists.command(l,1,0),a.shape2p.command(l,c,c),a.shape1x.command(l,t.x,t.x),a.shape2w.command(l,e.w,e.w),a.shape1w.command(l,t.w,t.w),a.shape1densityProfile.command(l,t.densityProfile,t.densityProfile),a.shape2densityProfile.command(l,e.densityProfile,e.densityProfile),a.party.command(l,[l],[l])];o?i.loadCommands(h):i.doCommands(h)}function K(e,t){let n=this,i="candidateDns",r=new F;I.call(n,t,i,r);let o=new q(r,t,n,i,[["exists","exists",!1],["shape2p","shape2D-point",!0],["shape1x","shape1D-x",!0],["shape2w","shape2D-width",!0],["shape1w","shape1D-width",!0],["shape1densityProfile","shape1D-densityProfile",!1],["shape2densityProfile","shape2D-densityProfile",!1],["party","party",!1]]);n.addCandidateDistribution=({shape2:i,shape1:a,doLoad:s})=>{let l=new J(i,a,r,t,e,s,o);n.addEntity(l)},n.addDefaultEntity=()=>{n.addCandidateDistribution({shape2:{x:50,y:50,w:200,densityProfile:"step"},shape1:{x:50,w:200,densityProfile:"gaussian"},doLoad:!1})},n.getParties=()=>({partiesByCan:n.getEntities().map(e=>e.party[0]),numParties:10})}function Z(e,t){this.candidateList=new Y(e,t,this),this.voterShapeList=new W(e,t,this),this.candidateDnList=new K(e,t,this)}function Q(e){let t={};return Object.keys(e).forEach(n=>{let i=e[n].some(e=>e.strategy.some(e=>"closest"!==e.actionName&&0!==e.actionWeight));t[n]=i}),t}var ee={},et=o("gj6Et"),en=o("4gDjz"),ei=o("HLBv4"),er=o("ktaoY"),eo=o("gBs5C"),ea=o("ktLSh"),es={};function el(e,t){let{canPoints:n,canBorders:i}=t,r=i.voronoiIntervals1D,o="gaussian"===e.densityProfile?eh:ec,a=n.length,s=Array(a),l=0;for(let t=0;t<a;t++){let n=o(e,r[t]);s[t]=n,l+=n}return{countByCan:s,totalVotes:l}}function ec(e,t){let{lower:n,upper:i}=t,{x:r,w:o,densityMax:a}=e,s=.5*o,l=Math.max(n,r-s);return Math.max(0,Math.min(i,r+s)-l)*a}function eh(e,t){let{lower:n,upper:i}=t,{x:r,w:o,densityMax:a}=e,s=o/Math.sqrt(2*Math.PI);return o*(c(i,r,s)-c(n,r,s))*a}function eu(e,t){let n=t.canBorders.voronoiLines2D,{densityMax:i}=e,r=n.length,o=Array(r),a=0;for(let t=0;t<r;t++){let r=function(e,t){let n=0,i=e.x,r=e.y,{w:o}=e,a=.5*o;for(let e=i-a;e<i+a;e+=2){let o;let s=a**2-(e-i)**2,l=r+(o=s>0?Math.sqrt(s):0),c=r-o;for(let n=0;n<t.length;n++){let[i,r,o]=t[n];if(0===r)i*e<-o||(c=1/0);else{let t=-(o+i*e)/r;r<0?c=Math.max(c,t):l=Math.min(l,t)}}let h=l-c;h>0&&(n+=2*h)}return n}(e,n[t])*i;o[t]=r,a+=r}return{countByCan:o,totalVotes:a}}function ed(e,t,n,i,r,o,a){let s=1===n?ep:ef,l=e.length,c=Array(l);for(let n=0;n<l;n++)c[n]=s(e[n],t);let h=function(e,t,n,i){if(void 0===n)return f(e);let{strategyCDF:r,strategy:o}=n,{actionName:a,actionOptions:s}=o[d(r,i[0])];if("lesserEvil"!==a)return f(e);let{mean:l,radius:c}=s.threshold,h=i[1](),{voteFractionsByCan:u,highestScore:m}=t.polling;if(void 0===m)return f(e);let g=(l+c*(2*h-1))*m,y=p(e.length).filter(e=>u[e]>=g),v=e.filter((e,t)=>u[t]>=g);return v.length<=1?f(e):y[f(v)]}(c,r,o,a);if(i<2)return{pluralityVote:h};let u=Array(l).fill(0);return u[h]=1,{pluralityAllocation:u,pluralityVote:h}}function ep(e,t){return(e-t)**2}function ef(e,t){return(e[0]-t[0])**2+(e[1]-t[1])**2}function em(e){let{gridX:t,voterPoints:n,gridPointLength:i}=function(e){let t="gaussian"===e.densityProfile,n=Math.round(e.w*(t?2:1)),i=Array(n),r=Array(n);for(let t=0;t<n;t++){let o=t+.5-.5*n+e.x;i[t]=o,r[t]=o}return{gridX:i,voterPoints:r,gridPointLength:1}}(e),{density:r,voteCounts:o,totalVotes:a}=function(e,t,n){let{x:i,w:r,densityProfile:o,densityMax:a}=e,s=Array(t.length),c=Array(t.length);if("gaussian"!==o){s.fill(a),c.fill(a);let e=c.length*a;return{density:s,voteCounts:c,totalVotes:e}}let h=r/Math.sqrt(2*Math.PI),u=1/l(0,0,h),d=0;for(let e=0;e<t.length;e++){let r=l(t[e],i,h)*u*a;s[e]=r;let o=r*n;c[e]=o,d+=o}return{density:s,voteCounts:c,totalVotes:d}}(e,t,i);return{x:t,density:r,voterPoints:n,voteCounts:o,totalVotes:a,voterGeom:e}}function eg(e,t){let{x:n,y:i,w:r,densityProfile:o}=e,a="gaussian"===o,s=r*(a?2:1),{usr:c}=t,h=Math.round(s/c),u=p(h),d=p(h),f=u.map(e=>(e+.5)*c-.5*s+n),m=d.map(e=>(e+.5)*c-.5*s+i),g=u.length,y=d.length,v=g*y,w=Array(v),x=Array(v),_=Array(v),b=0;for(let e=0;e<d.length;e++)for(let t=0;t<u.length;t++){let n=f[t],i=m[e];w[b]=n,x[b]=i,_[b]=[n,i],b+=1}let{density:C,voteCounts:S,totalVotes:P}=(a?function(e,t,n,i){let{x:r,y:o,w:a,densityMax:s}=e,c=a*ey,h=(1/l(0,0,c))**2,u=t.length,d=Array(u),p=Array(u),f=0;for(let e=0;e<u;e++){let a=t[e],u=n[e],m=l(a,r,c)*l(u,o,c)*h*s;d[e]=m;let g=m*i;p[e]=g,f+=g}return{density:d,voteCounts:p,totalVotes:f}}:function(e,t,n,i){let{x:r,y:o,w:a,densityMax:s}=e,l=t.length,c=Array(l).fill(0),h=Array(l).fill(0),u=0;for(let e=0;e<l;e++)if((t[e]-r)**2+(n[e]-o)**2<(.5*a)**2){c[e]=s;let t=i*s;h[e]=t,u+=t}return{density:c,voteCounts:h,totalVotes:u}})(e,w,x,c*c);return{x:w,y:x,nx:g,ny:y,width:s,voterPoints:_,density:C,voteCounts:S,totalVotes:P,voterGeom:e}}!function(e,t,n){var i,r="random",a=n.pow(256,6),s=n.pow(2,52),l=2*s;function c(o,c,f){var m=[],g=d(function e(t,n){var i,r=[],o=typeof t;if(n&&"object"==o)for(i in t)try{r.push(e(t[i],n-1))}catch(e){}return r.length?r:"string"==o?t:t+"\0"}((c=!0==c?{entropy:!0}:c||{}).entropy?[o,p(t)]:null==o?function(){try{var n;return i&&(n=i.randomBytes)?n=n(256):(n=new Uint8Array(256),(e.crypto||e.msCrypto).getRandomValues(n)),p(n)}catch(n){var r=e.navigator,o=r&&r.plugins;return[+new Date,e,o,e.screen,p(t)]}}():o,3),m),y=new h(m),v=function(){for(var e=y.g(6),t=a,n=0;e<s;)e=(e+n)*256,t*=256,n=y.g(1);for(;e>=l;)e/=2,t/=2,n>>>=1;return(e+n)/t};return v.int32=function(){return 0|y.g(4)},v.quick=function(){return y.g(4)/4294967296},v.double=v,d(p(y.S),t),(c.pass||f||function(e,t,i,o){return(o&&(o.S&&u(o,y),e.state=function(){return u(y,{})}),i)?(n[r]=e,t):e})(v,g,"global"in c?c.global:this==n,c.state)}function h(e){var t,n=e.length,i=this,r=0,o=i.i=i.j=0,a=i.S=[];for(n||(e=[n++]);r<256;)a[r]=r++;for(r=0;r<256;r++)a[r]=a[o=255&o+e[r%n]+(t=a[r])],a[o]=t;(i.g=function(e){for(var t,n=0,r=i.i,o=i.j,a=i.S;e--;)t=a[r=255&r+1],n=256*n+a[255&(a[r]=a[o=255&o+t])+(a[o]=t)];return i.i=r,i.j=o,n})(256)}function u(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function d(e,t){for(var n,i=e+"",r=0;r<i.length;)t[255&r]=255&(n^=19*t[255&r])+i.charCodeAt(r++);return p(t)}function p(e){return String.fromCharCode.apply(0,e)}if(d(n.random(),t),es){es=c;try{i=o("foUwZ")}catch(e){}}else"function"==typeof define&&define.amd?define(function(){return c}):n["seed"+r]=c}("undefined"!=typeof self?self:es,[],Math),es.alea=et,es.xor128=en,es.xorwow=ei,es.xorshift7=er,es.xor4096=eo,es.tychei=ea,ee=es;let ey=1/Math.sqrt(8);function ev(e,t,n,i,r){let{canPoints:o,dimensions:a,information:s}=t,{verbosity:l}=n,c=(1===a?em:eg)(e,n),h=Array(o.length).fill(0),u=0,d=c.x.length,p=Array(d);for(let e=0;e<d;e++){let t=c.voteCounts[e],n=ed(o,c.voterPoints[e],a,l,s,r,i),{pluralityVote:d}=n;h[d]+=t,u+=t,l<2||(p[e]=n)}return l<2?{countByCan:h,totalVotes:u}:{grid:c,voteSet:p,countByCan:h,totalVotes:u}}function ew(e,t,n,i,r,o,a){let s=1===n?ex:e_,l=e.length,c=Array(l);for(let n=0;n<l;n++)c[n]=s(e[n],t);let[h,u]=function(e,t,n,i){if(void 0===n)return g(e);let{strategyCDF:r,strategy:o}=n,{actionName:a,actionOptions:s}=o[d(r,i[0])];if("normalizeOverFrontrunners"!==a)return g(e);let{mean:l,radius:c}=s.threshold,h=i[1](),{scoreFractionAverageByCan:u,highestScore:p}=t.polling;if(void 0===p)return g(e);let f=(l+c*(2*h-1))*p,m=e.filter((e,t)=>u[t]>=f);return m.length<=1?g(e):g(m)}(c,r,o,a),p=Array(l).fill(0);for(let e=0;e<l;e++){let t=c[e];if(t<=h)p[e]=1;else if(t>=u)p[e]=0;else{let n=(t-h)/(u-h);p[e]=0+1*(1-n)}}return{scoreVote:p}}function ex(e,t){return Math.abs(e-t)}function e_(e,t){return Math.sqrt((e[0]-t[0])**2+(e[1]-t[1])**2)}function eb(e,t,n,i){let r=1===n?eC:eS,o=e.length,a=Array(o);for(let n=0;n<o;n++)a[n]=r(e[n],t);let s=p(o).sort((e,t)=>a[e]-a[t]),l=Array(o);for(let e=0;e<o;e++){let t=s[e];l[e]=[t]}if(0===i)return{cansByRank:l};let c=Array(o),h=Array(o),u=Array(o);for(let e=0;e<o;e++){let t=s[e];c[t]=e+1,h[t]=o-e-1,u[t]=(o-e-1)/(o-1)}let d=Array(o);for(let e=0;e<o;e++){d[e]=Array(o).fill(0);for(let t=0;t<o;t++)a[e]!==a[t]&&(d[e][t]=a[e]<a[t]?1:-1)}return{cansByRank:l,ranking:c,netWinsPairwise:d,bordaFractions:u,bordaScores:h}}function eC(e,t){return(e-t)**2}function eS(e,t){return(e[0]-t[0])**2+(e[1]-t[1])**2}function eP(e,t,n){let i,r,o;let{canPoints:a,dimensions:s}=t,{verbosity:l}=n,c=(1===s?em:eg)(e,n),{voteCounts:h,totalVotes:u,voterPoints:d}=c,p=a.length,f=Array(p);l>=2&&(i=Array(p).fill(0),r=Array(p),o=Array(h.length));for(let e=0;e<h.length;e++){let t=h[e],n=eb(a,d[e],s,l);if(f[e]=n.cansByRank,l<2)continue;o[e]=n,r[e]=n.ranking;let{bordaScores:c}=n;for(let e=0;e<p;e++)i[e]+=c[e]*t}if(l<2)return{voteCounts:h,totalVotes:u,cansByRankList:f};let m=i.map(e=>e/(p-1)/u);return{grid:c,voteSet:o,voteCounts:h,totalVotes:u,bordaFractionAverageByCan:m,rankings:r,cansByRankList:f}}function ek(e,t,n){let{intervalBorders:i,rankings:r,cansByRankList:o}=t.canBorders.rankingIntervals1D,{verbosity:a}=n,s=i.length-1,l=Array(s),c=0;for(let t=0;t<s;t++){var h,u;let n=(h=i[t],u=i[t+1],"gaussian"===e.densityProfile?eh(e,{lower:h,upper:u}):ec(e,{lower:h,upper:u}));l[t]=n,c+=n}return a<2?{voteCounts:l,totalVotes:c,cansByRankList:o}:{voteCounts:l,totalVotes:c,cansByRankList:o,rankings:r,intervalBorders:i}}function eM(e){for(var t,n=-1,i=e.length,r=e[i-1],o=0;++n<i;)t=r,r=e[n],o+=t[1]*r[0]-t[0]*r[1];return o/2}function eA(e,t){let[n,i]=e,[r,o]=t,a=r-n,s=o-i;return[a,s,-((n+r)*.5*a+(i+o)*.5*s)]}function eE(e,t){return(e[0]*t[0]+e[1]*t[1]+e[2])/Math.sqrt(e[0]**2+e[1]**2)}function eT(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]<0}function eN(e,t,n){let i;let r=[function(e){let{x:t,y:n,w:i}=e,r=i/2,o=Array(100);for(let e=0;e<100;e++){let i=2*Math.PI*(e/99),a=t+r*Math.cos(i),s=n+r*Math.sin(i);o[e]=[a,s]}return o}(e)],o=t.length,a=[Array(o).fill(0)];for(let e=0;e<o-1;e++)for(let n=e+1;n<o;n++){let i=r.length,o=Array(i),s=Array(i),l=0;for(let c=0;c<i;c++){let i=function(e,t){let n=e.length,i=[],r=[],o=0,a=0,s=e[n-1],l=eT(t,s);for(let c=0;c<n;c++){let n=e[c],h=eT(t,n);if(l&&!h||!l&&h){let e=eE(t,s),l=eE(t,n),c=function(e,t,n,i){let r=-i/(n-i);return r<0&&(r=0),r>1&&(r=1),[r*e[0]+(1-r)*t[0],r*e[1]+(1-r)*t[1]]}(s,n,e,l);i[o]=c,r[a]=c,o+=1,a+=1}h?(r[a]=n,a+=1):(i[o]=n,o+=1),s=n,l=h}return{positive:i,negative:r}}(r[c],eA(t[e],t[n])),h=i.positive;void 0!==h&&h.length>2&&(o[l]=h,s[l]=v(a[c]),s[l][n]+=1,l+=1);let u=i.negative;void 0!==u&&u.length>2&&(o[l]=u,s[l]=v(a[c]),s[l][e]+=1,l+=1)}r=o,a=s}let s=r.length,l=Array(s);if(n>=2){i=Array(s);for(let e=0;e<s;e++)i[e]=Array(o)}for(let e=0;e<s;e++){l[e]=Array(o);for(let t=0;t<o;t++)l[e][t]=[];for(let t=0;t<o;t++){let r=o-a[e][t];l[e][r-1].push(t),n<2||(i[e][t]=r)}}return n<2?{cells:r,cansByRankList:l}:{cells:r,rankings:i,cansByRankList:l}}function eD(e,t,n){let{canPoints:i}=t,{verbosity:r}=n,{densityMax:o}=e,{cells:a,rankings:s,cansByRankList:l}=eN(e,i,r),c=a.length,h=Array(c),u=Array(c),d=0;for(let e=0;e<c;e++){let t=-eM(a[e]);h[e]=t;let n=t*o;u[e]=n,d+=n}return(l=l.filter((e,t)=>Math.abs(h[t])>1e-6),u=u.filter((e,t)=>Math.abs(h[t])>1e-6),r<2)?{voteCounts:u,totalVotes:d,cansByRankList:l}:{voteCounts:u,totalVotes:d,cansByRankList:l,rankings:s=s.filter((e,t)=>Math.abs(h[t])>1e-6),cells:a=a.filter((e,t)=>Math.abs(h[t])>1e-6)}}function eO(e,t){let{canPoints:n}=t,i=Math.PI*(e.w/2)**2,r=n.length,o=Array(r).fill(0);for(let e=0;e<r;e++)o[e]=Array(r).fill(0);for(let t=0;t<r-1;t++)for(let s=t+1;s<r;s++){var a;let r=function(e,t,n){let i=t.w/2;if(e>i)return 0;if(e<-i)return n;let r=e/i;return i**2*(Math.acos(r)-r*Math.sqrt(1-r**2))}(((a=eA(n[t],n[s]))[0]*e.x+a[1]*e.y+a[2])/Math.sqrt(a[0]**2+a[1]**2),e,i),l=i-r;o[t][s]=r,o[s][t]=l}return{winsPairwise:o,totalVotes:i}}function eL(e,t){let{canPoints:n,canBorders:i}=t,{midpoints:r,iLower:o}=i.pairwiseIntervals1D,a=n.length,s=eB(-1/0,1/0,e),l=Array(a).fill(0);for(let e=0;e<a;e++)l[e]=Array(a).fill(0);for(let t=0;t<a-1;t++)for(let n=t+1;n<a;n++){let i=eB(-1/0,r[t][n],e),a=o[t][n]?i:s-i,c=s-a;l[t][n]=a,l[n][t]=c}return{winsPairwise:l,totalVotes:s}}function eB(e,t,n){return"gaussian"===n.densityProfile?eh(n,{lower:e,upper:t}):ec(n,{lower:e,upper:t})}function eR(e,t,n,i){let r=1===n?eF:eV,o=e.length,a=Array(o);for(let n=0;n<o;n++)a[n]=r(e[n],t);let s=Array(o);for(let e=0;e<o;e++){s[e]=Array(o).fill(0);for(let t=0;t<o;t++)a[e]!==a[t]&&(s[e][t]=a[e]<a[t]?1:-1)}if(0===i)return{netWinsPairwise:s};let l=p(o).sort((e,t)=>a[e]-a[t]),c=Array(o),h=Array(o),u=Array(o),d=Array(o);for(let e=0;e<o;e++){let t=l[e];c[t]=e+1,h[t]=o-e-1,u[t]=(o-e-1)/(o-1),d[e]=[t]}return{cansByRank:d,ranking:c,netWinsPairwise:s,bordaFractions:u,bordaScores:h}}function eF(e,t){return(e-t)**2}function eV(e,t){return(e[0]-t[0])**2+(e[1]-t[1])**2}function eq(e,t,n){let i,r;let{canPoints:o,dimensions:a}=t,{verbosity:s}=n,l=(1===a?em:eg)(e,n),{voteCounts:c,totalVotes:h,voterPoints:u}=l,d=c.length,p=o.length,f=Array(p);for(let e=0;e<p;e++)f[e]=Array(p).fill(0);s>=1&&(i=Array(p).fill(0)),s>=2&&(r=Array(d));for(let e=0;e<d;e++){let t=c[e],n=eR(o,u[e],a),{netWinsPairwise:l}=n;for(let e=0;e<p-1;e++)for(let n=e+1;n<p;n++)f[e][n]+=l[e][n]*t;if(s<1)continue;let{bordaScores:h}=n;for(let e=0;e<p;e++)i[e]+=h[e]*t;s<2||(r[e]=n)}let m=f.map(e=>e.map(e=>(e+h)*.5));if(s<1)return{voteCounts:c,totalVotes:h,winsPairwise:m};let g=i.map(e=>e/(p-1)/h);return{grid:l,voteSet:r,winsPairwise:m,totalVotes:h,bordaFractionAverageByCan:g}}function eG(e){let t=e.length,n=p(t).sort((t,n)=>e[t]-e[n]),i=.5*t*(t-1),r=Array(i),o=Array(i),a=0;for(let i=0;i<t-1;i++)for(let s=i+1;s<t;s++){let t=n[i],l=n[s],c=(e[t]+e[l])*.5;r[a]=c,o[a]=[t,l],a+=1}let s=p(i).sort((e,t)=>r[e]-r[t]),l=s.map(e=>r[e]),c=s.map(e=>o[e]),h=Array(t);for(let e=0;e<t;e++)h[n[e]]=e+1;let u=Array(i+1);u[0]=v(h);for(let e=0;e<i;e++){let[t,n]=c[e];h[t]+=1,h[n]-=1,u[e+1]=v(h)}let d=Array(i+1);for(let e=0;e<i+1;e++){d[e]=Array(t);for(let n=0;n<t;n++)d[e][n]=[];let n=u[e];for(let i=0;i<t;i++){let t=n[i];d[e][t-1].push(i)}}let f=v(l);return f.unshift(-1/0),f.push(1/0),{intervalBorders:f,rankings:u,cansByRankList:d}}let eI={plurality:{cast:function(e,n){let{canPoints:i,voterGeoms:r,dimensions:o,parties:a,strategySeed:s,voterStrategyList:l}=e,{verbosity:c}=n,h=r.some(e=>"gaussian"===e.densityProfile)&&2===o,u=l.some(e=>e.strategy.some(e=>"closest"!==e.actionName&&0!==e.actionWeight)),d=h||u?ev:1===o?el:eu,p=i.length,f=[],m=Array(p).fill(0),g=0,y=[t(ee)(`green${s}`),t(ee)(`orange${s}`)];for(let t=0;t<r.length;t++){let i=d(r[t],e,n,y,l[t]),{countByCan:o,totalVotes:a}=i;for(let e=0;e<p;e++)m[e]+=o[e];g+=a,c<2||(f[t]=i)}let v={candidateTallies:{voteFractionsByCan:m.map(e=>e/g)},parties:a,numCans:i.length};return c<2||(v.votesByGeom=f),v},castPoint:ed,makeCanBorders:function(e,t,n){return t.some(e=>"gaussian"===e.densityProfile)&&2===n?{}:1===n?{voronoiIntervals1D:function(e){let t=e.length,n=p(t).sort((t,n)=>e[t]-e[n]),i=Array(t-1);for(let r=0;r<t-1;r++)i[r]=(e[n[r]]+e[n[r+1]])*.5;let r=Array(t);for(let e=0;e<t;e++){let o=0===e?-1/0:i[e-1],a=e===t-1?1/0:i[e];r[n[e]]={lower:o,upper:a}}return r}(e)}:{voronoiLines2D:function(e){let t=e.length,n=Array(t);for(let i=0;i<t;i++){n[i]=[];for(let r=0;r<t;r++){if(i===r)continue;let t=e[i],o=e[r];n[i].push(eA(t,o))}}return n}(e)}}},score:{cast:function(e,n){let{canPoints:i,voterGeoms:r,parties:o,strategySeed:a,voterStrategyList:s}=e,{verbosity:l}=n,c=i.length,h=[],u=Array(c).fill(0),d=0,p=[t(ee)(`green${a}`),t(ee)(`orange${a}`)];for(let t=0;t<r.length;t++){let i=function(e,t,n,i,r){let{canPoints:o,dimensions:a,information:s}=t,{verbosity:l}=n,c=(1===a?em:eg)(e,n),{voteCounts:h,totalVotes:u,voterPoints:d}=c,p=o.length,f=Array(p).fill(0),m=c.x.length,g=Array(m);for(let e=0;e<m;e++){let t=h[e],n=ew(o,d[e],a,l,s,r,i);g[e]=n;let{scoreVote:c}=n;for(let e=0;e<p;e++)f[e]+=c[e]*t}return l<2?{scoreSumByCan:f,totalVotes:u}:{grid:c,voteSet:g,scoreSumByCan:f,totalVotes:u,voterGeom:e}}(r[t],e,n,p,s[t]);h[t]=i;let{totalVotes:o,scoreSumByCan:a}=i;for(let e=0;e<c;e++)u[e]+=a[e];d+=o}let f={candidateTallies:{scoreFractionAverageByCan:u.map(e=>e/(1*d))},parties:o,numCans:i.length};return l<2||(f.votesByGeom=h),f},castPoint:ew},scoreFull:{cast:function(e,t){let{canPoints:n,voterGeoms:i,parties:r}=e,{verbosity:o}=t,a=n.length,s=0,l=[];for(let n=0;n<i.length;n++){let r=function(e,t,n){let{canPoints:i,dimensions:r}=t,{verbosity:o}=n,a=(1===r?em:eg)(e,n),{voteCounts:s,totalVotes:l,voterPoints:c}=a,h=i.length,u=Array(h).fill(0),d=a.x.length,p=Array(d);for(let e=0;e<d;e++){let t=s[e],n=ew(i,c[e],r);p[e]=n;let{scoreVote:o}=n;for(let e=0;e<h;e++)u[e]+=o[e]*t}return o<2?{voteCounts:s,voteSet:p,scoreSumByCan:u,totalVotes:l}:{grid:a,voteCounts:s,voteSet:p,scoreSumByCan:u,totalVotes:l,voterGeom:e}}(i[n],e,t);l[n]=r;let{totalVotes:o}=r;s+=o}let c=1/s,h=Array(a).fill(0),u=[],d=[],p=0;for(let e=0;e<i.length;e++){let{voteCounts:t,voteSet:n,scoreSumByCan:i}=l[e],r=[];for(let e=0;e<n.length;e++)u[p]=n[e].scoreVote,r[e]=p,d[p]=t[e]*c,p+=1;l[e].voteIndex=r;for(let e=0;e<a;e++)h[e]+=i[e]}let f={preferenceLists:{scoreVotes:u},preferenceTallies:{voteFractions:d},candidateTallies:{scoreFractionAverageByCan:h.map(e=>e/(1*s))},parties:r,numCans:n.length};return o<2||(f.votesByGeom=l),f},castPoint:ew},ranking:{cast:function(e,t){let{canPoints:n,voterGeoms:i,dimensions:r,parties:o}=e,{verbosity:a}=t,s=i.some(e=>"gaussian"===e.densityProfile)&&2===r?eP:1===r?ek:eD,l=n.length,c=[],h=[],u=[],d=Array(l).fill(0),p=0,f=[];i.forEach((n,i)=>{let r=s(n,e,t),{rankings:o,cansByRankList:l,voteCounts:m,totalVotes:g}=r,y=c.length,v=m.length;c.length+=v;for(let e=0;e<v;e++)c[y+e]=m[e],u[y+e]=l[e];p+=g;for(let e=0;e<l.length;e++){let t=l[e][0];for(let n=0;n<t.length;n++){let i=t[n];d[i]+=m[e]}}if(!(a<2)){for(let e=0;e<v;e++)h[y+e]=o[e];f[i]=r}});let m=c.map(e=>e/p),g=d.map(e=>e/p),y={cansByRankList:u},v={preferenceLists:y,preferenceTallies:{voteFractions:m},candidateTallies:{firstPreferenceFractions:g},parties:o,numCans:n.length};return a<2||(y.rankings=h,v.votesByGeom=f),v},castPoint:eb,makeCanBorders:function(e,t,n){return t.some(e=>"gaussian"===e.densityProfile)&&2===n||2===n?{}:{rankingIntervals1D:eG(e)}}},pairwise:{cast:function(e,t){let{canPoints:n,voterGeoms:i,dimensions:r,parties:o}=e,{verbosity:a}=t,s=i.some(e=>"gaussian"===e.densityProfile)&&2===r?eq:1===r?eL:eO,l=0,c=n.length,h=Array(c).fill(0);for(let e=0;e<c;e++)h[e]=Array(c).fill(0);let u=[];i.forEach((n,i)=>{let r=s(n,e,t),{winsPairwise:o,totalVotes:d}=r;for(let e=0;e<c;e++)for(let t=0;t<c;t++)h[e][t]+=o[e][t];l+=d,a<2||(u[i]=r)});let d=1/l,p={pairwiseTallies:{winFractionPairwise:h.map(e=>e.map(e=>e*d))},parties:o,numCans:n.length};if(a<1)return p;let f=Array(c).fill(0),m=Array(c),g=d/(c-1);for(let e=0;e<c;e++){for(let t=0;t<c;t++)f[e]+=h[e][t];m[e]=f[e]*g}return p.candidateTallies={bordaFractionAverageByCan:m},a<2||(p.votesByGeom=u),p},castPoint:eR,makeCanBorders:function(e,t,n){let i=t.some(e=>"gaussian"===e.densityProfile)&&2===n;return 2===n||i?{}:{pairwiseIntervals1D:function(e){let t=e.length,n=Array(t-1),i=Array(t-1);for(let r=0;r<t-1;r++){n[r]=Array(t-r-1),i[r]=Array(t-r-1);for(let o=r+1;o<t;o++){let t=e[r],a=e[o],s=.5*(t+a);n[r][o]=s,i[r][o]=t<a}}return{midpoints:n,iLower:i}}(e)}}}};function ej(e,t,n,i){let{makeCanBorders:r}=eI[i];return void 0!==r?r(e,t,n):{}}function eW(e,t){let{socialChoiceOptions:n,socialChoiceMethod:i}=t,r=(0,N[i])(e,n);return void 0===r.allocation&&(r.allocation=function(e,t){let{numCans:n}=e,{iWinner:i}=t,r=Array(n).fill(0);return r[i]=1,r}(e,r)),r}function ez(e,t,n){let i=function(e,t,n){let{voteCasterName:i}=t,{canPoints:r,voterGeoms:o,dimensions:a}=e,s={...e},l=ej(r,o,a,i);return s.canBorders=l,eI[i].cast(s,n)}(e,t,n),r=eW(i,t);return{geometry:e,electionOptions:t,votes:i,socialChoiceResults:r}}function eU(e,t,n){let{castOptions:i}=n,{usePolls:r}=e;return r?function(e,t,n){let{pollCount:i}=n,r=null;for(let o=0;o<i+1;o++){let i={...e},o=function(e){if(null===e||void 0===e.votes.candidateTallies)return{};let{scoreFractionAverageByCan:t}=e.votes.candidateTallies,{voteFractionsByCan:n}=e.votes.candidateTallies;return void 0!==t?{highestScore:Math.max(...t),scoreFractionAverageByCan:t}:void 0!==n?{highestScore:Math.max(...n),voteFractionsByCan:n}:{}}(r);i.information={polling:o};let{castOptions:a}=n;r=ez(i,t,a)}return r}(e,t,n):ez(e,t,i)}function e$(e,t){let n={...t};return n.voterStrategyList=t.voterStrategyListByPhase[e],n.usePolls=t.usePollsByPhase[e],delete n.voterStrategyListByPhase,delete n.usePollsByPhase,n}function eH(e,t,n){return n.sequenceOptions.sequences[e].phases[t]}function eX(e){let t=[];return e.forEach((e,n)=>{e&&t.push(n)}),t}function eY(e,t){let{canPoints:n,voterGeoms:i}=e;if(0===i.length)return{error:"No Voters"};if(0===n.length)return{error:"No Candidates"};let{sequenceName:r}=t.sequenceOptions;return"closedPrimary"===r?function(e,t){let{numParties:n}=e.parties,i=[],r=eH("closedPrimary","closedPrimary",t);for(let o=0;o<n;o++){let{primaryGeometry:n}=function(e,t){let n=e$("closedPrimary",e),i={...n},{voterParties:r}=n;i.voterGeoms=n.voterGeoms.filter((e,n)=>r[n]===t),i.voterStrategyList=n.voterStrategyList.filter((e,n)=>r[n]===t),i.voterParties=n.voterParties.filter((e,n)=>r[n]===t);let{partiesByCan:o}=n.parties,a=p(o.length);return i.canLabels=a.filter((e,n)=>o[n]===t),i.canPoints=n.canPoints.filter((e,n)=>o[n]===t),i.parties={...n.parties},i.parties.numParties=1,i.parties.partiesByCan=i.parties.partiesByCan.filter((e,n)=>o[n]===t),{primaryGeometry:i}}(e,o),{voterGeoms:a,canPoints:s}=n;if(0===a.length||0===s.length)continue;let l=eU(n,r,t);i[o]=l}let{generalGeometry:o,primaryWinners:a}=function(e,t,n){let i=e$("general",e),r={...i},o=[];for(let e=0;e<n;e++){let n=t[e];if(void 0===n)continue;let{allocation:i}=n.socialChoiceResults,{canLabels:r}=n.geometry;if(void 0!==r&&0!==r.length){for(let e=0;e<i.length;e++)if(i[e]){let t=r[e];o.push(t)}}}return r.canPoints=o.map(e=>i.canPoints[e]),r.canLabels=o,{generalGeometry:r,primaryWinners:o}}(e,i,n);return function(e,t,n,i,r){let o=(function(e){let t=[];return e.forEach((e,n)=>{e&&t.push(n)}),t})(t.socialChoiceResults.allocation).map(e=>n[e]),a=Array(i.canPoints.length).fill(0);return o.forEach(e=>{a[e]=1}),{phases:{closedPrimary:e,general:t},phaseNames:["closedPrimary","general"],geometry:i,optionsBag:r,socialChoiceResults:{allocation:a}}}(i,eU(o,eH("closedPrimary","general",t),t),a,e,t)}(e,t):"nonpartisanOpenPrimary"===r?function(e,t){let n=e$("nonpartisanOpenPrimary",e),i=p(e.canPoints.length);n.canLabels=i;let r=eU(n,eH("nonpartisanOpenPrimary","nonpartisanOpenPrimary",t),t),{generalGeometry:o,primaryWinners:a}=function(e,t){let n=e$("general",e),i={...n},{allocation:r}=t.socialChoiceResults,o=eX(r);return i.canPoints=o.map(e=>n.canPoints[e]),i.canLabels=o,i.parties={...n.parties},i.parties.partiesByCan=o.map(e=>n.parties.partiesByCan[e]),{generalGeometry:i,primaryWinners:o}}(e,r);return function(e,t,n,i,r){let o=eX(t.socialChoiceResults.allocation).map(e=>n[e]),a=Array(i.canPoints.length).fill(0);return o.forEach(e=>{a[e]=1}),{phases:{nonpartisanOpenPrimary:e,general:t},phaseNames:["nonpartisanOpenPrimary","general"],geometry:i,optionsBag:r,socialChoiceResults:{allocation:a}}}(r,eU(o,eH("nonpartisanOpenPrimary","general",t),t),a,e,t)}(e,t):function(e,t){let n=e$("general",e),i=p(e.canPoints.length);n.canLabels=i;let r=eU(n,eH("general","general",t),t),{socialChoiceResults:o}=r;return{phases:{general:r},phaseNames:["general"],geometry:e,optionsBag:t,socialChoiceResults:o}}(e,t)}let eJ=1/Math.sqrt(Math.PI/2),eK=1/Math.sqrt(2);function eZ(){let e,n,i;let r=this;r.update=function(e,t,n){return t.checkAny()&&r.startSim(e),r.addSim(e,n)},r.startSim=function(r){n=0,e=Array(10).fill(0);let o=`watermelon${r.samplingSeed}`;i=t(ee)(o)},r.addSim=function(t,r){if(n>5e3)return{pointsChanged:!1};let o=function(e,t,n,i){let{voterGeoms:r,voterParties:o,canDnGeoms:a,dimensions:s,geography:l,canDnCDF:c,strategySeed:h,voterStrategyListByPhase:u,information:p,usePollsByPhase:f}=e,{partiesByCan:m}=e.parties;if(0===r.length||0===a.length)return{pointsChanged:!1};let g=[],y=[],v=Array(10).fill(0);for(let e=0;e<1;e++){let{numSampleCandidates:e}=t,n=[],x=[];for(let t=0;t<e;t++){var w;let e=d(c,i),t=m[e],r=(w=a[e],1===s?function(e,t){let{x:n,w:i,densityProfile:r}=e;return("gaussian"===r?function(e,t,n){var i;return t*eJ*(Math.sqrt(-2*Math.log((i=n)()))*Math.cos(2*Math.PI*i()))+e}:function(e,t,n){return(2*n()-1)*t+e})(n,.5*i,t)}(w,i):function(e,t){let{x:n,y:i,w:r,densityProfile:o}=e;return("gaussian"===o?function(e,t,n,i){let[r,o]=function(e){let t,n,i;do i=(t=2*e()-1)*t+(n=2*e()-1)*n;while(i>1||0===i)let r=Math.sqrt(-(Math.log(i)/i*2));return[r*t,r*n]}(i),a=n*eK;return[e+a*r,t+a*o]}:function(e,t,n,i){let[r,o]=function(e){let t,n,i;do i=(t=2*e()-1)*t+(n=2*e()-1)*n;while(i>1||0===i)return[t,n]}(i);return[e+n*r,t+n*o]})(n,i,.5*r,t)}(w,i));n.push(r),x.push(t)}let{allocation:_}=eY({voterGeoms:r,voterParties:o,canPoints:n,parties:{partiesByCan:x,numParties:10},dimensions:s,geography:l,strategySeed:h,voterStrategyListByPhase:u,information:p,usePollsByPhase:f},t).socialChoiceResults;for(let e=0;e<_.length;e++){let t=_[e];if(0===t)continue;let i=n[e],r=1===s?[i]:i,o=x[e];g.push(r),y.push(t),v[o]+=t}}return{samplingPointsList:g,samplingPointsCount:y,partyWins:v}}(t,r,0,i),{samplingPointsList:a,samplingPointsCount:s,partyWins:l,error:c}=o;if(void 0!==c||!1===o.pointsChanged)return{pointsChanged:!1};let h=s.reduce((e,t)=>e+t);n+=h;for(let t=0;t<l.length;t++)e[t]+=l[t];return{pointsChanged:!0,samplingPointsList:a,samplingPointsCount:s,partyWinFraction:e.map(e=>e/n)}}}function eQ(e,n,i,r,o,a){let{candidateDnList:s,voterShapeList:l}=n,c=new eZ;this.update=()=>{a.update();let n=a.getOptions();r.update(),function(e,n){if(!n.checkAny()||!e.seedRandom||n.check(["init","seeds"]))return;let i=Math.floor(1e4*t(ee)()());e.setSeeds(0,i)}(o,i);let u=function(e,t,n,i,r){let{dimensions:o,seeds:a}=n,{geography:s}=r,{sequenceOptions:l}=i,c=e.getGeoms(o),u=e.getParties(),d=e.getVoterStrategyListByPhase(l),p=Q(d),f=t.getGeoms(o),m=t.getParties(),g=h(1===o?f.map(e=>e.w):f.map(e=>e.w**2));return{voterGeoms:c,voterParties:u,canDnGeoms:f,parties:m,dimensions:o,geography:s,canDnCDF:g,samplingSeed:`apple${a[0]}`,strategySeed:`pumpkin${a[0]}`,voterStrategyListByPhase:d,usePollsByPhase:p}}(l,s,o,n,r),d=c.update(u,i,n);(!0===d.pointsChanged||i.checkAny())&&e.update({samplingResult:d}),i.clear()}}function e0(e){return 1/(e.length*e[0].length)}function e1(e){let t=0;for(let n=0;n<e.length;n++){let[,,i]=e[n];t+=i}return 1/t}function e2(e,t,n,i,r,o){let{voterShapeList:a,candidateList:s}=t;this.update=()=>{if(n.checkNone())return;o.update();let t=o.getOptions();i.update();let l=function(e,t){if(!0===t.useGeography){let{sequenceName:n}=t.sequenceOptions,i="general",r=t.sequenceOptions.sequences[n].phases[i],{castOptions:o}=t;return function(e,t,n){let{canPoints:i,geography:r}=e,o=function(e,t,n){let{canPoints:i,parties:r,dimensions:o,geography:a,strategySeed:s,voterStrategyList:l,information:c}=e,{voterGeomsByTract:h}=a,u=h[0][0],{voteCasterName:d}=t,p=ej(i,u,o,d);return h.map(e=>e.map(e=>eI[d].cast({voterGeoms:e,canPoints:i,parties:r,dimensions:o,canBorders:p,strategySeed:s,voterStrategyList:l,information:c},n)))}(e,t,n),a=function(e,t){let n=t.length,i={};return void 0!==e[0][0].candidateTallies&&(i.candidateTallies=function(e,t){let n=Object.keys(e[0][0].candidateTallies),i={};for(let r=0;r<n.length;r++){let o=n[r],a=function(e,t,n){let i=Array(n).fill(0);t.forEach(t=>t.forEach(t=>{let r=t.candidateTallies[e];for(let e=0;e<n;e++)i[e]+=r[e]}));let r=e0(t);return i.map(e=>e*r)}(o,e,t);i[o]=a}return i}(e,n)),void 0!==e[0][0].pairwiseTallies&&(i.pairwiseTallies=function(e,t){let n=Object.keys(e[0][0].pairwiseTallies),i={};for(let r=0;r<n.length;r++){let o=n[r],a=function(e,t,n){let i=Array(n);for(let e=0;e<n;e++)i[e]=Array(n).fill(0);t.forEach(t=>t.forEach(t=>{let r=t.pairwiseTallies[e];for(let e=0;e<n;e++)for(let t=0;t<n;t++)i[e][t]+=r[e][t]}));let r=e0(t);return i.map(e=>e.map(e=>e*r))}(o,e,t);i[o]=a}return i}(e,n)),void 0!==e[0][0].preferenceLists&&(i.preferenceLists=function(e){let t=Object.keys(e[0][0].preferenceLists),n={};for(let i=0;i<t.length;i++){let r=t[i],o=function(e,t){let n=[];return t.forEach(t=>t.forEach(t=>{let i=t.preferenceLists[e],r=n.length,o=i.length;n.length+=i.length;for(let e=0;e<o;e++)n[r+e]=i[e]})),n}(r,e);n[r]=o}return n}(e),i.preferenceTallies=function(e){let t=Object.keys(e[0][0].preferenceTallies),n={};for(let i=0;i<t.length;i++){let r=t[i],o=function(e,t){let n=[];t.forEach(t=>t.forEach(t=>{let i=t.preferenceTallies[e],r=n.length,o=i.length;n.length+=i.length;for(let e=0;e<o;e++)n[r+e]=i[e]}));let i=e0(t);return n=n.map(e=>e*i)}(r,e);n[r]=o}return n}(e)),i.parties=e[0][0].parties,i}(o,i),s=function(e,t,n){let{census:i}=n,{nd:r}=n.districtMap,o=t.length;return p(r).map(t=>{let n=i[t],r={};return void 0!==e[0][0].candidateTallies&&(r.candidateTallies=function(e,t,n){let i=Object.keys(e[0][0].candidateTallies),r={};for(let o=0;o<i.length;o++){let a=i[o],s=function(e,t,n,i){let r=Array(i).fill(0);for(let o=0;o<n.length;o++){let[a,s,l]=n[o],c=t[a][s].candidateTallies[e];for(let e=0;e<i;e++)r[e]+=c[e]*l}let o=e1(n);return r.map(e=>e*o)}(a,e,t,n);r[a]=s}return r}(e,n,o)),void 0!==e[0][0].pairwiseTallies&&(r.pairwiseTallies=function(e,t,n){let i=Object.keys(e[0][0].pairwiseTallies),r={};for(let o=0;o<i.length;o++){let a=i[o],s=function(e,t,n,i){let r=Array(i);for(let e=0;e<i;e++)r[e]=Array(i).fill(0);for(let o=0;o<n.length;o++){let[a,s,l]=n[o],c=t[a][s].pairwiseTallies[e];for(let e=0;e<i;e++)for(let t=0;t<i;t++)r[e][t]+=c[e][t]*l}let o=e1(n);return r.map(e=>e.map(e=>e*o))}(a,e,t,n);r[a]=s}return r}(e,n,o)),void 0!==e[0][0].preferenceLists&&(r.preferenceLists=function(e,t){let n=Object.keys(e[0][0].preferenceLists),i={};for(let r=0;r<n.length;r++){let o=n[r],a=function(e,t,n){let i=[];for(let r=0;r<n.length;r++){let[o,a]=n[r],s=t[o][a].preferenceLists[e],l=i.length,c=s.length;i.length+=s.length;for(let e=0;e<c;e++)i[l+e]=s[e]}return i}(o,e,t);i[o]=a}return i}(e,n),r.preferenceTallies=function(e,t){let n=Object.keys(e[0][0].preferenceTallies),i={};for(let r=0;r<n.length;r++){let o=n[r],a=function(e,t,n){let i=[],r=e1(n);for(let o=0;o<n.length;o++){let[a,s,l]=n[o],c=t[a][s].preferenceTallies[e].map(e=>e*l*r),h=i.length,u=c.length;i.length+=c.length;for(let e=0;e<u;e++)i[h+e]=c[e]}return i}(o,e,t);i[o]=a}return i}(e,n)),r.parties=e[0][0].parties,r.numCans=o,r})}(o,i,r),l=s.map(e=>eW(e,t)),c=function(e,t,n){let i=t.length,r=Array(i).fill(0);return"singleWinner"===n.socialChoiceType?e.map(e=>e.iWinner).forEach(e=>{r[e]+=1}):e.forEach(e=>{let{allocation:t}=e;for(let e=0;e<i;e++)r[e]+=t[e]}),r}(l,i,t);return{electionOptions:t,geometry:e,votes:a,votesByTract:o,votesByDistrict:s,scResultsByDistrict:l,socialChoiceResults:{allocation:c}}}(e$(i,e),r,o)}return function(e,t){let{canPoints:n,parties:i,voterParties:r,dimensions:o,geography:a,strategySeed:s,usePollsByPhase:l,voterStrategyListByPhase:c,information:h}=e,{voterGeomsByDistrict:u}=a,{nd:d}=a.districtMap;return{scResultsByDistrict:p(d).map(e=>eY({voterGeoms:u[e],voterParties:r,canPoints:n,parties:i,dimensions:o,strategySeed:s,information:h,usePollsByPhase:l,voterStrategyListByPhase:c},t)),geometry:e}}(e,t)}(function(e,t,n,i,r){let{dimensions:o,seeds:a}=n,{geography:s}=r,{sequenceOptions:l}=i,c=e.getGeoms(o),h=e.getParties(),u=e.getVoterStrategyListByPhase(l),d=Q(u),p=t.getPoints(o);return{voterGeoms:c,voterParties:h,canPoints:p,parties:t.getParties(),dimensions:o,geography:s,strategySeed:`pumpkin${a[0]}`,voterStrategyListByPhase:u,information:null,usePollsByPhase:d}}(a,s,r,t,i),t);l.colorRGBAOfCandidates=s.getRGBAList(),e.update({geoResults:l}),n.clear()}}function e5(e,t,n,i,r,o){let a=this;a.modes={one:new e2(e,t,i,n,r,o),sample:new eQ(e,t,i,n,r,o)},a.update=()=>{a.modes[r.mode].update()}}function e3(){let e=[];this.attach=t=>{e.push(t)},this.update=t=>{e.forEach(e=>e.update(t))}}function e4([e,t],[n,i],[r,o]){return(r-n)*(t-i)<(o-i)*(e-n)}function e6([e,t],[n,i],[r,o],[a,s]){let l=n-e,c=i-t,h=a-r,u=s-o,d=(l*(o-t)-c*(r-e))/(c*h-l*u);return[r+d*h,o+d*u]}function e8(e){let[t,n]=e[0],[i,r]=e[e.length-1];return t===i&&n===r}function e9(e,t,n){let{nd:i,polygons:r}=e,o=Array(i).fill().map(()=>[]),a=1/t,s=1/n;for(let e=0;e<t;e++)for(let t=0;t<n;t++){var l,c;let n=[[l=e*a,c=t*s],[l,c+s],[l+a,c+s],[l+a,c]];p(i).forEach(i=>{let a=function(e,t){let n=e8(t),i=e.length-e8(e),r=t.slice();for(let t=0,o=e[i-1],a,s,l;t<i;++t){let i=r.slice(),c=i.length-n;r.length=0,a=e[t],s=i[c-1];for(let e=0;e<c;++e)e4(l=i[e],o,a)?(e4(s,o,a)||r.push(e6(s,l,o,a)),r.push(l)):e4(s,o,a)&&r.push(e6(s,l,o,a)),s=l;n&&r.push(r[0]),o=a}return r.length?r:null}(y(r[i]).reverse(),n);if(null!==a){let n=eM(a);o[i].push([e,t,n])}})}return o}function e7(e){for(var t,n,i=-1,r=e.length,o=0,a=0,s=e[r-1],l=0;++i<r;)t=s,s=e[i],l+=n=t[0]*s[1]-s[0]*t[1],o+=(t[0]+s[0])*n,a+=(t[1]+s[1])*n;return[o/(l*=3),a/l]}function te(e,t,n,i,r){let o,a,s,l;let c=t[0],h=i[0],u=0,d=0;h>c==h>-c?(o=c,c=t[++u]):(o=h,h=i[++d]);let p=0;if(u<e&&d<n)for(h>c==h>-c?(a=c+o,s=o-(a-c),c=t[++u]):(a=h+o,s=o-(a-h),h=i[++d]),o=a,0!==s&&(r[p++]=s);u<e&&d<n;)h>c==h>-c?(l=(a=o+c)-o,s=o-(a-l)+(c-l),c=t[++u]):(l=(a=o+h)-o,s=o-(a-l)+(h-l),h=i[++d]),o=a,0!==s&&(r[p++]=s);for(;u<e;)l=(a=o+c)-o,s=o-(a-l)+(c-l),c=t[++u],o=a,0!==s&&(r[p++]=s);for(;d<n;)l=(a=o+h)-o,s=o-(a-l)+(h-l),h=i[++d],o=a,0!==s&&(r[p++]=s);return(0!==o||0===p)&&(r[p++]=o),p}function tt(e){return new Float64Array(e)}let tn=tt(4),ti=tt(8),tr=tt(12),to=tt(16),ta=tt(4);function ts(e,t,n,i,r,o){let a=(t-o)*(n-r),s=(e-r)*(i-o),l=a-s;if(0===a||0===s||a>0!=s>0)return l;let c=Math.abs(a+s);return Math.abs(l)>=33306690738754716e-32*c?l:-function(e,t,n,i,r,o,a){let s,l,c,h,u,d,p,f,m,g,y,v,w,x,_,b,C,S;let P=e-r,k=n-r,M=t-o,A=i-o;x=P*A,p=(d=134217729*P)-(d-P),f=P-p,m=(d=134217729*A)-(d-A),_=f*(g=A-m)-(x-p*m-f*m-p*g),b=M*k,p=(d=134217729*M)-(d-M),f=M-p,m=(d=134217729*k)-(d-k),y=_-(C=f*(g=k-m)-(b-p*m-f*m-p*g)),u=_-y,tn[0]=_-(y+u)+(u-C),u=(v=x+y)-x,y=(w=x-(v-u)+(y-u))-b,u=w-y,tn[1]=w-(y+u)+(u-b),u=(S=v+y)-v,tn[2]=v-(S-u)+(y-u),tn[3]=S;let E=function(e,t){let n=t[0];for(let e=1;e<4;e++)n+=t[e];return n}(0,tn),T=22204460492503146e-32*a;if(E>=T||-E>=T||(u=e-P,s=e-(P+u)+(u-r),u=n-k,c=n-(k+u)+(u-r),u=t-M,l=t-(M+u)+(u-o),u=i-A,h=i-(A+u)+(u-o),0===s&&0===l&&0===c&&0===h)||(T=11093356479670487e-47*a+33306690738754706e-32*Math.abs(E),(E+=P*h+A*s-(M*c+k*l))>=T||-E>=T))return E;x=s*A,p=(d=134217729*s)-(d-s),f=s-p,m=(d=134217729*A)-(d-A),_=f*(g=A-m)-(x-p*m-f*m-p*g),b=l*k,p=(d=134217729*l)-(d-l),f=l-p,m=(d=134217729*k)-(d-k),y=_-(C=f*(g=k-m)-(b-p*m-f*m-p*g)),u=_-y,ta[0]=_-(y+u)+(u-C),u=(v=x+y)-x,y=(w=x-(v-u)+(y-u))-b,u=w-y,ta[1]=w-(y+u)+(u-b),u=(S=v+y)-v,ta[2]=v-(S-u)+(y-u),ta[3]=S;let N=te(4,tn,4,ta,ti);x=P*h,p=(d=134217729*P)-(d-P),f=P-p,m=(d=134217729*h)-(d-h),_=f*(g=h-m)-(x-p*m-f*m-p*g),b=M*c,p=(d=134217729*M)-(d-M),f=M-p,m=(d=134217729*c)-(d-c),y=_-(C=f*(g=c-m)-(b-p*m-f*m-p*g)),u=_-y,ta[0]=_-(y+u)+(u-C),u=(v=x+y)-x,y=(w=x-(v-u)+(y-u))-b,u=w-y,ta[1]=w-(y+u)+(u-b),u=(S=v+y)-v,ta[2]=v-(S-u)+(y-u),ta[3]=S;let D=te(N,ti,4,ta,tr);x=s*h,p=(d=134217729*s)-(d-s),f=s-p,m=(d=134217729*h)-(d-h),_=f*(g=h-m)-(x-p*m-f*m-p*g),b=l*c,p=(d=134217729*l)-(d-l),f=l-p,m=(d=134217729*c)-(d-c),y=_-(C=f*(g=c-m)-(b-p*m-f*m-p*g)),u=_-y,ta[0]=_-(y+u)+(u-C),u=(v=x+y)-x,y=(w=x-(v-u)+(y-u))-b,u=w-y,ta[1]=w-(y+u)+(u-b),u=(S=v+y)-v,ta[2]=v-(S-u)+(y-u),ta[3]=S;let O=te(D,tr,4,ta,to);return to[O-1]}(e,t,n,i,r,o,c)}tt(4),tt(4),tt(4),tt(4),tt(4),tt(4),tt(4),tt(4),tt(4),tt(8),tt(8),tt(8),tt(4),tt(8),tt(8),tt(8),tt(12),tt(192),tt(192),tt(4),tt(4),tt(4),tt(4),tt(4),tt(4),tt(4),tt(4),tt(8),tt(8),tt(8),tt(8),tt(8),tt(8),tt(8),tt(8),tt(8),tt(4),tt(4),tt(4),tt(8),tt(16),tt(16),tt(16),tt(32),tt(32),tt(48),tt(64),tt(1152),tt(1152),tt(4),tt(4),tt(4),tt(4),tt(4),tt(4),tt(4),tt(4),tt(4),tt(4),tt(24),tt(24),tt(24),tt(24),tt(24),tt(24),tt(24),tt(24),tt(24),tt(24),tt(1152),tt(1152),tt(1152),tt(1152),tt(1152),tt(2304),tt(2304),tt(3456),tt(5760),tt(8),tt(8),tt(8),tt(16),tt(24),tt(48),tt(48),tt(96),tt(192),tt(384),tt(384),tt(384),tt(768),tt(96),tt(96),tt(96),tt(1152);let tl=new Uint32Array(512);class tc{static from(e,t=tp,n=tf){let i=e.length,r=new Float64Array(2*i);for(let o=0;o<i;o++){let i=e[o];r[2*o]=t(i),r[2*o+1]=n(i)}return new tc(r)}constructor(e){let t=e.length>>1;if(t>0&&"number"!=typeof e[0])throw Error("Expected coords to contain numbers.");this.coords=e;let n=Math.max(2*t-5,0);this._triangles=new Uint32Array(3*n),this._halfedges=new Int32Array(3*n),this._hashSize=Math.ceil(Math.sqrt(t)),this._hullPrev=new Uint32Array(t),this._hullNext=new Uint32Array(t),this._hullTri=new Uint32Array(t),this._hullHash=new Int32Array(this._hashSize).fill(-1),this._ids=new Uint32Array(t),this._dists=new Float64Array(t),this.update()}update(){let e,t,n;let{coords:i,_hullPrev:r,_hullNext:o,_hullTri:a,_hullHash:s}=this,l=i.length>>1,c=1/0,h=1/0,u=-1/0,d=-1/0;for(let e=0;e<l;e++){let t=i[2*e],n=i[2*e+1];t<c&&(c=t),n<h&&(h=n),t>u&&(u=t),n>d&&(d=n),this._ids[e]=e}let p=(c+u)/2,f=(h+d)/2,m=1/0;for(let t=0;t<l;t++){let n=th(p,f,i[2*t],i[2*t+1]);n<m&&(e=t,m=n)}let g=i[2*e],y=i[2*e+1];m=1/0;for(let n=0;n<l;n++){if(n===e)continue;let r=th(g,y,i[2*n],i[2*n+1]);r<m&&r>0&&(t=n,m=r)}let v=i[2*t],w=i[2*t+1],x=1/0;for(let r=0;r<l;r++){if(r===e||r===t)continue;let o=function(e,t,n,i,r,o){let a=n-e,s=i-t,l=r-e,c=o-t,h=a*a+s*s,u=l*l+c*c,d=.5/(a*c-s*l),p=(c*h-s*u)*d,f=(a*u-l*h)*d;return p*p+f*f}(g,y,v,w,i[2*r],i[2*r+1]);o<x&&(n=r,x=o)}let _=i[2*n],b=i[2*n+1];if(x===1/0){for(let e=0;e<l;e++)this._dists[e]=i[2*e]-i[0]||i[2*e+1]-i[1];tu(this._ids,this._dists,0,l-1);let e=new Uint32Array(l),t=0;for(let n=0,i=-1/0;n<l;n++){let r=this._ids[n];this._dists[r]>i&&(e[t++]=r,i=this._dists[r])}this.hull=e.subarray(0,t),this.triangles=new Uint32Array(0),this.halfedges=new Uint32Array(0);return}if(0>ts(g,y,v,w,_,b)){let e=t,i=v,r=w;t=n,v=_,w=b,n=e,_=i,b=r}let C=function(e,t,n,i,r,o){let a=n-e,s=i-t,l=r-e,c=o-t,h=a*a+s*s,u=l*l+c*c,d=.5/(a*c-s*l);return{x:e+(c*h-s*u)*d,y:t+(a*u-l*h)*d}}(g,y,v,w,_,b);this._cx=C.x,this._cy=C.y;for(let e=0;e<l;e++)this._dists[e]=th(i[2*e],i[2*e+1],C.x,C.y);tu(this._ids,this._dists,0,l-1),this._hullStart=e;let S=3;o[e]=r[n]=t,o[t]=r[e]=n,o[n]=r[t]=e,a[e]=0,a[t]=1,a[n]=2,s.fill(-1),s[this._hashKey(g,y)]=e,s[this._hashKey(v,w)]=t,s[this._hashKey(_,b)]=n,this.trianglesLen=0,this._addTriangle(e,t,n,-1,-1,-1);for(let l=0,c,h;l<this._ids.length;l++){let u=this._ids[l],d=i[2*u],p=i[2*u+1];if(l>0&&2220446049250313e-31>=Math.abs(d-c)&&2220446049250313e-31>=Math.abs(p-h)||(c=d,h=p,u===e||u===t||u===n))continue;let f=0;for(let e=0,t=this._hashKey(d,p);e<this._hashSize&&(-1===(f=s[(t+e)%this._hashSize])||f===o[f]);e++);let m=f=r[f],g;for(;g=o[m],ts(d,p,i[2*m],i[2*m+1],i[2*g],i[2*g+1])>=0;)if((m=g)===f){m=-1;break}if(-1===m)continue;let y=this._addTriangle(m,u,o[m],-1,-1,a[m]);a[u]=this._legalize(y+2),a[m]=y,S++;let v=o[m];for(;g=o[v],0>ts(d,p,i[2*v],i[2*v+1],i[2*g],i[2*g+1]);)y=this._addTriangle(v,u,g,a[u],-1,a[v]),a[u]=this._legalize(y+2),o[v]=v,S--,v=g;if(m===f)for(;0>ts(d,p,i[2*(g=r[m])],i[2*g+1],i[2*m],i[2*m+1]);)y=this._addTriangle(g,u,m,-1,a[m],a[g]),this._legalize(y+2),a[g]=y,o[m]=m,S--,m=g;this._hullStart=r[u]=m,o[m]=r[v]=u,o[u]=v,s[this._hashKey(d,p)]=u,s[this._hashKey(i[2*m],i[2*m+1])]=m}this.hull=new Uint32Array(S);for(let e=0,t=this._hullStart;e<S;e++)this.hull[e]=t,t=o[t];this.triangles=this._triangles.subarray(0,this.trianglesLen),this.halfedges=this._halfedges.subarray(0,this.trianglesLen)}_hashKey(e,t){return Math.floor(function(e,t){let n=e/(Math.abs(e)+Math.abs(t));return(t>0?3-n:1+n)/4}(e-this._cx,t-this._cy)*this._hashSize)%this._hashSize}_legalize(e){let{_triangles:t,_halfedges:n,coords:i}=this,r=0,o=0;for(;;){let a=n[e],s=e-e%3;if(o=s+(e+2)%3,-1===a){if(0===r)break;e=tl[--r];continue}let l=a-a%3,c=s+(e+1)%3,h=l+(a+2)%3,u=t[o],d=t[e],p=t[c],f=t[h];if(function(e,t,n,i,r,o,a,s){let l=e-a,c=t-s,h=n-a,u=i-s,d=r-a,p=o-s,f=h*h+u*u,m=d*d+p*p;return l*(u*m-f*p)-c*(h*m-f*d)+(l*l+c*c)*(h*p-u*d)<0}(i[2*u],i[2*u+1],i[2*d],i[2*d+1],i[2*p],i[2*p+1],i[2*f],i[2*f+1])){t[e]=f,t[a]=u;let i=n[h];if(-1===i){let t=this._hullStart;do{if(this._hullTri[t]===h){this._hullTri[t]=e;break}t=this._hullPrev[t]}while(t!==this._hullStart)}this._link(e,i),this._link(a,n[o]),this._link(o,h);let s=l+(a+1)%3;r<tl.length&&(tl[r++]=s)}else{if(0===r)break;e=tl[--r]}}return o}_link(e,t){this._halfedges[e]=t,-1!==t&&(this._halfedges[t]=e)}_addTriangle(e,t,n,i,r,o){let a=this.trianglesLen;return this._triangles[a]=e,this._triangles[a+1]=t,this._triangles[a+2]=n,this._link(a,i),this._link(a+1,r),this._link(a+2,o),this.trianglesLen+=3,a}}function th(e,t,n,i){let r=e-n,o=t-i;return r*r+o*o}function tu(e,t,n,i){if(i-n<=20)for(let r=n+1;r<=i;r++){let i=e[r],o=t[i],a=r-1;for(;a>=n&&t[e[a]]>o;)e[a+1]=e[a--];e[a+1]=i}else{let r=n+i>>1,o=n+1,a=i;td(e,r,o),t[e[n]]>t[e[i]]&&td(e,n,i),t[e[o]]>t[e[i]]&&td(e,o,i),t[e[n]]>t[e[o]]&&td(e,n,o);let s=e[o],l=t[s];for(;;){do o++;while(t[e[o]]<l)do a--;while(t[e[a]]>l)if(a<o)break;td(e,o,a)}e[n+1]=e[a],e[a]=s,i-o+1>=a-n?(tu(e,t,o,i),tu(e,t,n,a-1)):(tu(e,t,n,a-1),tu(e,t,o,i))}}function td(e,t,n){let i=e[t];e[t]=e[n],e[n]=i}function tp(e){return e[0]}function tf(e){return e[1]}class tm{constructor(){this._x0=this._y0=this._x1=this._y1=null,this._=""}moveTo(e,t){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._+="Z")}lineTo(e,t){this._+=`L${this._x1=+e},${this._y1=+t}`}arc(e,t,n){e=+e,t=+t;let i=e+(n=+n),r=t;if(n<0)throw Error("negative radius");null===this._x1?this._+=`M${i},${r}`:(Math.abs(this._x1-i)>1e-6||Math.abs(this._y1-r)>1e-6)&&(this._+="L"+i+","+r),n&&(this._+=`A${n},${n},0,1,1,${e-n},${t}A${n},${n},0,1,1,${this._x1=i},${this._y1=r}`)}rect(e,t,n,i){this._+=`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${+n}v${+i}h${-n}Z`}value(){return this._||null}}class tg{constructor(){this._=[]}moveTo(e,t){this._.push([e,t])}closePath(){this._.push(this._[0].slice())}lineTo(e,t){this._.push([e,t])}value(){return this._.length?this._:null}}class ty{constructor(e,[t,n,i,r]=[0,0,960,500]){if(!((i=+i)>=(t=+t))||!((r=+r)>=(n=+n)))throw Error("invalid bounds");this.delaunay=e,this._circumcenters=new Float64Array(2*e.points.length),this.vectors=new Float64Array(2*e.points.length),this.xmax=i,this.xmin=t,this.ymax=r,this.ymin=n,this._init()}update(){return this.delaunay.update(),this._init(),this}_init(){let{delaunay:{points:e,hull:t,triangles:n},vectors:i}=this,r=this.circumcenters=this._circumcenters.subarray(0,n.length/3*2);for(let t=0,i=0,o=n.length,a,s;t<o;t+=3,i+=2){let o=2*n[t],l=2*n[t+1],c=2*n[t+2],h=e[o],u=e[o+1],d=e[l],p=e[l+1],f=e[c],m=e[c+1],g=d-h,y=p-u,v=f-h,w=m-u,x=(g*w-y*v)*2;if(1e-9>Math.abs(x)){let t=1e9,i=2*n[0];t*=Math.sign((e[i]-h)*w-(e[i+1]-u)*v),a=(h+f)/2-t*w,s=(u+m)/2+t*v}else{let e=1/x,t=g*g+y*y,n=v*v+w*w;a=h+(w*t-y*n)*e,s=u+(g*n-v*t)*e}r[i]=a,r[i+1]=s}let o=t[t.length-1],a,s=4*o,l,c=e[2*o],h,u=e[2*o+1];i.fill(0);for(let n=0;n<t.length;++n)o=t[n],a=s,l=c,h=u,s=4*o,c=e[2*o],u=e[2*o+1],i[a+2]=i[s]=h-u,i[a+3]=i[s+1]=c-l}render(e){let t=null==e?e=new tm:void 0,{delaunay:{halfedges:n,inedges:i,hull:r},circumcenters:o,vectors:a}=this;if(r.length<=1)return null;for(let t=0,i=n.length;t<i;++t){let i=n[t];if(i<t)continue;let r=2*Math.floor(t/3),a=2*Math.floor(i/3),s=o[r],l=o[r+1],c=o[a],h=o[a+1];this._renderSegment(s,l,c,h,e)}let s,l=r[r.length-1];for(let t=0;t<r.length;++t){s=l;let n=2*Math.floor(i[l=r[t]]/3),c=o[n],h=o[n+1],u=4*s,d=this._project(c,h,a[u+2],a[u+3]);d&&this._renderSegment(c,h,d[0],d[1],e)}return t&&t.value()}renderBounds(e){let t=null==e?e=new tm:void 0;return e.rect(this.xmin,this.ymin,this.xmax-this.xmin,this.ymax-this.ymin),t&&t.value()}renderCell(e,t){let n=null==t?t=new tm:void 0,i=this._clip(e);if(null===i||!i.length)return;t.moveTo(i[0],i[1]);let r=i.length;for(;i[0]===i[r-2]&&i[1]===i[r-1]&&r>1;)r-=2;for(let e=2;e<r;e+=2)(i[e]!==i[e-2]||i[e+1]!==i[e-1])&&t.lineTo(i[e],i[e+1]);return t.closePath(),n&&n.value()}*cellPolygons(){let{delaunay:{points:e}}=this;for(let t=0,n=e.length/2;t<n;++t){let e=this.cellPolygon(t);e&&(e.index=t,yield e)}}cellPolygon(e){let t=new tg;return this.renderCell(e,t),t.value()}_renderSegment(e,t,n,i,r){let o;let a=this._regioncode(e,t),s=this._regioncode(n,i);0===a&&0===s?(r.moveTo(e,t),r.lineTo(n,i)):(o=this._clipSegment(e,t,n,i,a,s))&&(r.moveTo(o[0],o[1]),r.lineTo(o[2],o[3]))}contains(e,t,n){return(t=+t)==t&&(n=+n)==n&&this.delaunay._step(e,t,n)===e}*neighbors(e){let t=this._clip(e);if(t)for(let n of this.delaunay.neighbors(e)){let e=this._clip(n);if(e){e:for(let i=0,r=t.length;i<r;i+=2)for(let o=0,a=e.length;o<a;o+=2)if(t[i]==e[o]&&t[i+1]==e[o+1]&&t[(i+2)%r]==e[(o+a-2)%a]&&t[(i+3)%r]==e[(o+a-1)%a]){yield n;break e}}}}_cell(e){let{circumcenters:t,delaunay:{inedges:n,halfedges:i,triangles:r}}=this,o=n[e];if(-1===o)return null;let a=[],s=o;do{let n=Math.floor(s/3);if(a.push(t[2*n],t[2*n+1]),r[s=s%3==2?s-2:s+1]!==e)break;s=i[s]}while(s!==o&&-1!==s)return a}_clip(e){if(0===e&&1===this.delaunay.hull.length)return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];let t=this._cell(e);if(null===t)return null;let{vectors:n}=this,i=4*e;return n[i]||n[i+1]?this._clipInfinite(e,t,n[i],n[i+1],n[i+2],n[i+3]):this._clipFinite(e,t)}_clipFinite(e,t){let n=t.length,i=null,r,o,a=t[n-2],s=t[n-1],l,c=this._regioncode(a,s),h,u=0;for(let d=0;d<n;d+=2)if(r=a,o=s,a=t[d],s=t[d+1],l=c,c=this._regioncode(a,s),0===l&&0===c)h=u,u=0,i?i.push(a,s):i=[a,s];else{let t,n,d,p,f;if(0===l){if(null===(t=this._clipSegment(r,o,a,s,l,c)))continue;[n,d,p,f]=t}else{if(null===(t=this._clipSegment(a,s,r,o,c,l)))continue;[p,f,n,d]=t,h=u,u=this._edgecode(n,d),h&&u&&this._edge(e,h,u,i,i.length),i?i.push(n,d):i=[n,d]}h=u,u=this._edgecode(p,f),h&&u&&this._edge(e,h,u,i,i.length),i?i.push(p,f):i=[p,f]}if(i)h=u,u=this._edgecode(i[0],i[1]),h&&u&&this._edge(e,h,u,i,i.length);else if(this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2))return[this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax,this.xmin,this.ymin];return i}_clipSegment(e,t,n,i,r,o){for(;;){if(0===r&&0===o)return[e,t,n,i];if(r&o)return null;let a,s,l=r||o;8&l?(a=e+(n-e)*(this.ymax-t)/(i-t),s=this.ymax):4&l?(a=e+(n-e)*(this.ymin-t)/(i-t),s=this.ymin):2&l?(s=t+(i-t)*(this.xmax-e)/(n-e),a=this.xmax):(s=t+(i-t)*(this.xmin-e)/(n-e),a=this.xmin),r?(e=a,t=s,r=this._regioncode(e,t)):(n=a,i=s,o=this._regioncode(n,i))}}_clipInfinite(e,t,n,i,r,o){let a=Array.from(t),s;if((s=this._project(a[0],a[1],n,i))&&a.unshift(s[0],s[1]),(s=this._project(a[a.length-2],a[a.length-1],r,o))&&a.push(s[0],s[1]),a=this._clipFinite(e,a))for(let t=0,n=a.length,i,r=this._edgecode(a[n-2],a[n-1]);t<n;t+=2)i=r,r=this._edgecode(a[t],a[t+1]),i&&r&&(t=this._edge(e,i,r,a,t),n=a.length);else this.contains(e,(this.xmin+this.xmax)/2,(this.ymin+this.ymax)/2)&&(a=[this.xmin,this.ymin,this.xmax,this.ymin,this.xmax,this.ymax,this.xmin,this.ymax]);return a}_edge(e,t,n,i,r){for(;t!==n;){let n,o;switch(t){case 5:t=4;continue;case 4:t=6,n=this.xmax,o=this.ymin;break;case 6:t=2;continue;case 2:t=10,n=this.xmax,o=this.ymax;break;case 10:t=8;continue;case 8:t=9,n=this.xmin,o=this.ymax;break;case 9:t=1;continue;case 1:t=5,n=this.xmin,o=this.ymin}(i[r]!==n||i[r+1]!==o)&&this.contains(e,n,o)&&(i.splice(r,0,n,o),r+=2)}if(i.length>4)for(let e=0;e<i.length;e+=2){let t=(e+2)%i.length,n=(e+4)%i.length;(i[e]===i[t]&&i[t]===i[n]||i[e+1]===i[t+1]&&i[t+1]===i[n+1])&&(i.splice(t,2),e-=2)}return r}_project(e,t,n,i){let r=1/0,o,a,s;if(i<0){if(t<=this.ymin)return null;(o=(this.ymin-t)/i)<r&&(s=this.ymin,a=e+(r=o)*n)}else if(i>0){if(t>=this.ymax)return null;(o=(this.ymax-t)/i)<r&&(s=this.ymax,a=e+(r=o)*n)}if(n>0){if(e>=this.xmax)return null;(o=(this.xmax-e)/n)<r&&(a=this.xmax,s=t+(r=o)*i)}else if(n<0){if(e<=this.xmin)return null;(o=(this.xmin-e)/n)<r&&(a=this.xmin,s=t+(r=o)*i)}return[a,s]}_edgecode(e,t){return(e===this.xmin?1:e===this.xmax?2:0)|(t===this.ymin?4:t===this.ymax?8:0)}_regioncode(e,t){return(e<this.xmin?1:e>this.xmax?2:0)|(t<this.ymin?4:t>this.ymax?8:0)}}let tv=2*Math.PI,tw=Math.pow;function tx(e){return e[0]}function t_(e){return e[1]}class tb{static from(e,t=tx,n=t_,i){return new tb("length"in e?function(e,t,n,i){let r=e.length,o=new Float64Array(2*r);for(let a=0;a<r;++a){let r=e[a];o[2*a]=t.call(i,r,a,e),o[2*a+1]=n.call(i,r,a,e)}return o}(e,t,n,i):Float64Array.from(function*(e,t,n,i){let r=0;for(let o of e)yield t.call(i,o,r,e),yield n.call(i,o,r,e),++r}(e,t,n,i)))}constructor(e){this._delaunator=new tc(e),this.inedges=new Int32Array(e.length/2),this._hullIndex=new Int32Array(e.length/2),this.points=this._delaunator.coords,this._init()}update(){return this._delaunator.update(),this._init(),this}_init(){let e=this._delaunator,t=this.points;if(e.hull&&e.hull.length>2&&function(e){let{triangles:t,coords:n}=e;for(let e=0;e<t.length;e+=3){let i=2*t[e],r=2*t[e+1],o=2*t[e+2];if((n[o]-n[i])*(n[r+1]-n[i+1])-(n[r]-n[i])*(n[o+1]-n[i+1])>1e-10)return!1}return!0}(e)){this.collinear=Int32Array.from({length:t.length/2},(e,t)=>t).sort((e,n)=>t[2*e]-t[2*n]||t[2*e+1]-t[2*n+1]);let e=this.collinear[0],r=this.collinear[this.collinear.length-1],o=[t[2*e],t[2*e+1],t[2*r],t[2*r+1]],a=1e-8*Math.hypot(o[3]-o[1],o[2]-o[0]);for(let e=0,r=t.length/2;e<r;++e){var n,i;let r=[(n=t[2*e])+Math.sin(n+(i=t[2*e+1]))*a,i+Math.cos(n-i)*a];t[2*e]=r[0],t[2*e+1]=r[1]}this._delaunator=new tc(t)}else delete this.collinear;let r=this.halfedges=this._delaunator.halfedges,o=this.hull=this._delaunator.hull,a=this.triangles=this._delaunator.triangles,s=this.inedges.fill(-1),l=this._hullIndex.fill(-1);for(let e=0,t=r.length;e<t;++e){let t=a[e%3==2?e-2:e+1];(-1===r[e]||-1===s[t])&&(s[t]=e)}for(let e=0,t=o.length;e<t;++e)l[o[e]]=e;o.length<=2&&o.length>0&&(this.triangles=new Int32Array(3).fill(-1),this.halfedges=new Int32Array(3).fill(-1),this.triangles[0]=o[0],s[o[0]]=1,2===o.length&&(s[o[1]]=0,this.triangles[1]=o[1],this.triangles[2]=o[1]))}voronoi(e){return new ty(this,e)}*neighbors(e){let{inedges:t,hull:n,_hullIndex:i,halfedges:r,triangles:o,collinear:a}=this;if(a){let t=a.indexOf(e);t>0&&(yield a[t-1]),t<a.length-1&&(yield a[t+1]);return}let s=t[e];if(-1===s)return;let l=s,c=-1;do{if(yield c=o[l],o[l=l%3==2?l-2:l+1]!==e)return;if(-1===(l=r[l])){let t=n[(i[e]+1)%n.length];t!==c&&(yield t);return}}while(l!==s)}find(e,t,n=0){let i;if((e=+e)!=e||(t=+t)!=t)return -1;let r=n;for(;(i=this._step(n,e,t))>=0&&i!==n&&i!==r;)n=i;return i}_step(e,t,n){let{inedges:i,hull:r,_hullIndex:o,halfedges:a,triangles:s,points:l}=this;if(-1===i[e]||!l.length)return(e+1)%(l.length>>1);let c=e,h=tw(t-l[2*e],2)+tw(n-l[2*e+1],2),u=i[e],d=u;do{let i=s[d],u=tw(t-l[2*i],2)+tw(n-l[2*i+1],2);if(u<h&&(h=u,c=i),s[d=d%3==2?d-2:d+1]!==e)break;if(-1===(d=a[d])){if((d=r[(o[e]+1)%r.length])!==i&&tw(t-l[2*d],2)+tw(n-l[2*d+1],2)<h)return d;break}}while(d!==u)return c}render(e){let t=null==e?e=new tm:void 0,{points:n,halfedges:i,triangles:r}=this;for(let t=0,o=i.length;t<o;++t){let o=i[t];if(o<t)continue;let a=2*r[t],s=2*r[o];e.moveTo(n[a],n[a+1]),e.lineTo(n[s],n[s+1])}return this.renderHull(e),t&&t.value()}renderPoints(e,t){void 0!==t||e&&"function"==typeof e.moveTo||(t=e,e=null),t=void 0==t?2:+t;let n=null==e?e=new tm:void 0,{points:i}=this;for(let n=0,r=i.length;n<r;n+=2){let r=i[n],o=i[n+1];e.moveTo(r+t,o),e.arc(r,o,t,0,tv)}return n&&n.value()}renderHull(e){let t=null==e?e=new tm:void 0,{hull:n,points:i}=this,r=2*n[0],o=n.length;e.moveTo(i[r],i[r+1]);for(let t=1;t<o;++t){let r=2*n[t];e.lineTo(i[r],i[r+1])}return e.closePath(),t&&t.value()}hullPolygon(){let e=new tg;return this.renderHull(e),e.value()}renderTriangle(e,t){let n=null==t?t=new tm:void 0,{points:i,triangles:r}=this,o=2*r[e*=3],a=2*r[e+1],s=2*r[e+2];return t.moveTo(i[o],i[o+1]),t.lineTo(i[a],i[a+1]),t.lineTo(i[s],i[s+1]),t.closePath(),n&&n.value()}*trianglePolygons(){let{triangles:e}=this;for(let t=0,n=e.length/3;t<n;++t)yield this.trianglePolygon(t)}trianglePolygon(e){let t=new tg;return this.renderTriangle(e,t),t.value()}}function tC(e){let[t,n,i]=function(e,t,n,i){let r,o,a=Array(n).fill().map(()=>[1*Math.random(),1*Math.random()]),s=!1,l=.01;for(let e=0;e<1e3;e++)if([a,s,r,o]=function(e,t,n,i){let r=tb.from(e).voronoi([0,0,t,n]),o=[...Array(e.length).keys()].map(e=>r.cellPolygon(e)),a=o.map(e7),s=e.every((e,t)=>e**2+a[t]**2<i);return[a,s,r,o]}(a,1,1,l),s)return a;return[a,r,o]}(1,1,e,0),r=i.map(eM).map(e=>-e);return{nd:e,centroids:t,voronoi:n,polygons:i,polygonAreas:r}}let tS=.5*(Math.sqrt(3)-1),tP=(3-Math.sqrt(3))/6,tk=1/3,tM=1/6,tA=(Math.sqrt(5)-1)/4,tE=(5-Math.sqrt(5))/20,tT=new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),tN=new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]);class tD{constructor(e=Math.random){let t="function"==typeof e?e:function(e){let t,n=0,i=0,r=0,o=1,a=(t=4022871197,function(e){e=e.toString();for(let n=0;n<e.length;n++){let i=.02519603282416938*(t+=e.charCodeAt(n));t=i>>>0,i-=t,i*=t,t=i>>>0,i-=t,t+=4294967296*i}return(t>>>0)*23283064365386963e-26});return n=a(" "),i=a(" "),r=a(" "),(n-=a(e))<0&&(n+=1),(i-=a(e))<0&&(i+=1),(r-=a(e))<0&&(r+=1),function(){let e=2091639*n+23283064365386963e-26*o;return n=i,i=r,r=e-(o=0|e)}}(e);this.p=function(e){let t=new Uint8Array(256);for(let e=0;e<256;e++)t[e]=e;for(let n=0;n<255;n++){let i=n+~~(e()*(256-n)),r=t[n];t[n]=t[i],t[i]=r}return t}(t),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(let e=0;e<512;e++)this.perm[e]=this.p[255&e],this.permMod12[e]=this.perm[e]%12}noise2D(e,t){let n,i;let r=this.permMod12,o=this.perm,a=0,s=0,l=0,c=(e+t)*tS,h=Math.floor(e+c),u=Math.floor(t+c),d=(h+u)*tP,p=e-(h-d),f=t-(u-d);p>f?(n=1,i=0):(n=0,i=1);let m=p-n+tP,g=f-i+tP,y=p-1+2*tP,v=f-1+2*tP,w=255&h,x=255&u,_=.5-p*p-f*f;if(_>=0){let e=3*r[w+o[x]];_*=_,a=_*_*(tT[e]*p+tT[e+1]*f)}let b=.5-m*m-g*g;if(b>=0){let e=3*r[w+n+o[x+i]];b*=b,s=b*b*(tT[e]*m+tT[e+1]*g)}let C=.5-y*y-v*v;if(C>=0){let e=3*r[w+1+o[x+1]];C*=C,l=C*C*(tT[e]*y+tT[e+1]*v)}return 70*(a+s+l)}noise3D(e,t,n){let i,r,o,a,s,l,c,h,u,d;let p=this.permMod12,f=this.perm,m=(e+t+n)*tk,g=Math.floor(e+m),y=Math.floor(t+m),v=Math.floor(n+m),w=(g+y+v)*tM,x=e-(g-w),_=t-(y-w),b=n-(v-w);x>=_?_>=b?(s=1,l=0,c=0,h=1,u=1,d=0):(x>=b?(s=1,l=0,c=0):(s=0,l=0,c=1),h=1,u=0,d=1):_<b?(s=0,l=0,c=1,h=0,u=1,d=1):x<b?(s=0,l=1,c=0,h=0,u=1,d=1):(s=0,l=1,c=0,h=1,u=1,d=0);let C=x-s+tM,S=_-l+tM,P=b-c+tM,k=x-h+2*tM,M=_-u+2*tM,A=b-d+2*tM,E=x-1+3*tM,T=_-1+3*tM,N=b-1+3*tM,D=255&g,O=255&y,L=255&v,B=.6-x*x-_*_-b*b;if(B<0)i=0;else{let e=3*p[D+f[O+f[L]]];B*=B,i=B*B*(tT[e]*x+tT[e+1]*_+tT[e+2]*b)}let R=.6-C*C-S*S-P*P;if(R<0)r=0;else{let e=3*p[D+s+f[O+l+f[L+c]]];R*=R,r=R*R*(tT[e]*C+tT[e+1]*S+tT[e+2]*P)}let F=.6-k*k-M*M-A*A;if(F<0)o=0;else{let e=3*p[D+h+f[O+u+f[L+d]]];F*=F,o=F*F*(tT[e]*k+tT[e+1]*M+tT[e+2]*A)}let V=.6-E*E-T*T-N*N;if(V<0)a=0;else{let e=3*p[D+1+f[O+1+f[L+1]]];V*=V,a=V*V*(tT[e]*E+tT[e+1]*T+tT[e+2]*N)}return 32*(i+r+o+a)}noise4D(e,t,n,i){let r,o,a,s,l;let c=this.perm,h=(e+t+n+i)*tA,u=Math.floor(e+h),d=Math.floor(t+h),p=Math.floor(n+h),f=Math.floor(i+h),m=(u+d+p+f)*tE,g=e-(u-m),y=t-(d-m),v=n-(p-m),w=i-(f-m),x=0,_=0,b=0,C=0;g>y?x++:_++,g>v?x++:b++,g>w?x++:C++,y>v?_++:b++,y>w?_++:C++,v>w?b++:C++;let S=x>=3?1:0,P=_>=3?1:0,k=b>=3?1:0,M=C>=3?1:0,A=x>=2?1:0,E=_>=2?1:0,T=b>=2?1:0,N=C>=2?1:0,D=x>=1?1:0,O=_>=1?1:0,L=b>=1?1:0,B=C>=1?1:0,R=g-S+tE,F=y-P+tE,V=v-k+tE,q=w-M+tE,G=g-A+2*tE,I=y-E+2*tE,j=v-T+2*tE,W=w-N+2*tE,z=g-D+3*tE,U=y-O+3*tE,$=v-L+3*tE,H=w-B+3*tE,X=g-1+4*tE,Y=y-1+4*tE,J=v-1+4*tE,K=w-1+4*tE,Z=255&u,Q=255&d,ee=255&p,et=255&f,en=.6-g*g-y*y-v*v-w*w;if(en<0)r=0;else{let e=c[Z+c[Q+c[ee+c[et]]]]%32*4;en*=en,r=en*en*(tN[e]*g+tN[e+1]*y+tN[e+2]*v+tN[e+3]*w)}let ei=.6-R*R-F*F-V*V-q*q;if(ei<0)o=0;else{let e=c[Z+S+c[Q+P+c[ee+k+c[et+M]]]]%32*4;ei*=ei,o=ei*ei*(tN[e]*R+tN[e+1]*F+tN[e+2]*V+tN[e+3]*q)}let er=.6-G*G-I*I-j*j-W*W;if(er<0)a=0;else{let e=c[Z+A+c[Q+E+c[ee+T+c[et+N]]]]%32*4;er*=er,a=er*er*(tN[e]*G+tN[e+1]*I+tN[e+2]*j+tN[e+3]*W)}let eo=.6-z*z-U*U-$*$-H*H;if(eo<0)s=0;else{let e=c[Z+D+c[Q+O+c[ee+L+c[et+B]]]]%32*4;eo*=eo,s=eo*eo*(tN[e]*z+tN[e+1]*U+tN[e+2]*$+tN[e+3]*H)}let ea=.6-X*X-Y*Y-J*J-K*K;if(ea<0)l=0;else{let e=c[Z+1+c[Q+1+c[ee+1+c[et+1]]]]%32*4;ea*=ea,l=ea*ea*(tN[e]*X+tN[e+1]*Y+tN[e+2]*J+tN[e+3]*K)}return 27*(r+o+a+s+l)}}function tO(e,t){return function(e,t,n,i,r,o){let a=new tD("s"),s=new tD("seed"),l=Array(e).fill().map(()=>Array(t).fill().map(()=>[,,].fill(0))),c=0,h=0;tL(e).forEach(n=>{tL(t).forEach(i=>{let r=n/e*2,o=i/t*2,u=a.noise2D(r,o),d=s.noise2D(r,o);l[n][i][0]=u-.5,l[n][i][1]=d-.5,c+=u,h+=d})});let u=c/(e*t)-.5,d=h/(e*t)-.5;return l.forEach(e=>{e.forEach(e=>{e[0]=(e[0]-u)*100,e[1]=(e[1]-d)*100})}),l}(e,t,0,0,0,0)}function tL(e){return[...Array(e).keys()]}function tB(e,t){let n=e.length,i=[];for(let r=0;r<n;r++){let n=e[r],o=[];for(let e=0;e<n.length;e++){let[i,r,a]=n[e],s=t[i][r];for(let e=0;e<s.length;e++){let t={...s[e]};t.densityMax*=a,o.push(t)}}i.push(o)}return i}function tR(e,t,n){return 1===n?t.map(t=>t.map(t=>e.map(e=>{let[n]=t,i={...e};return i.x+=n,i}))):t.map(t=>t.map(t=>e.map(e=>{let[n,i]=t,r={...e};return r.x+=n,r.y+=i,r})))}function tF(e,t,n,i){let r=this;r.init=()=>{let{numTracts:t,numDistricts:o}=n.getOptions(),{dimensions:a}=i,s=e.getGeoms(a);r.geography=function(e,t,n,i){let r=tO(e,e),o=tC(t),a=e9(o,e,e),s=tR(n,r,i),l=tB(a,s);return{nx:e,ny:e,tractNoise:r,districtMap:o,census:a,voterGeomsByTract:s,voterGeomsByDistrict:l}}(t,o,s,a)};let o=!0;r.update=()=>{if(t.checkNone())return;if(o){o=!1,r.init();return}let a=n.getOptions();if(t.check(["numTracts"])){let{numTracts:e}=a;r.geography=function(e,t){let n={...e},i=tO(t,t);return n.nx=t,n.ny=t,n.tractNoise=i,n}(r.geography,e)}if(t.check(["numDistricts"])){let{numDistricts:e}=a;r.geography=function(e,t){let n={...e};return n.districtMap=tC(t),n}(r.geography,e)}if(t.check(["numDistricts","numTracts"])&&(r.geography=function(e){let t={...e},{districtMap:n,nx:i,ny:r}=t;return t.census=e9(n,i,r),t}(r.geography)),t.check(["voters","dimensions","numTracts"])){let{dimensions:t}=i,n=e.getGeoms(t);r.geography=function(e,t,n){let i={...e},{tractNoise:r}=i;return i.voterGeomsByTract=tR(t,r,n),i}(r.geography,n,t)}t.check(["voters","dimensions","numTracts","numDistricts"])&&(r.geography=function(e){let t={...e},{census:n,voterGeomsByTract:i}=t;return t.voterGeomsByDistrict=tB(n,i),t}(r.geography))}}var tV=function(e){let t=new w,n=new S(e),i=new P(t,n),r=new R(t,i,n),o=new Z(t,n),a=new tF(o.voterShapeList,t,r,i),s=new e3,l=new e5(s,o,a,t,i,r);return{changes:t,commander:n,simOptions:i,electionOptionsMan:r,entities:o,districts:a,simMode:l,pub:s,init:function(e){o.candidateList.addCandidate({shape2:{x:50,y:100},shape1:{x:50},color:"#e05020",doLoad:!0}),o.candidateList.addCandidate({shape2:{x:100,y:50},shape1:{x:100},color:"#50e020",doLoad:!0}),o.candidateList.addCandidate({shape2:{x:200,y:250},shape1:{x:200},color:"#2050e0",doLoad:!0}),o.candidateDnList.addCandidateDistribution({shape2:{x:150,y:150,w:200,densityProfile:"step"},shape1:{x:150,w:200,densityProfile:"gaussian"},doLoad:!0}),o.voterShapeList.addVoterCircle({shape2:{x:150,y:150,w:200,densityProfile:"step",densityMax:1},shape1:{x:150,w:200,densityProfile:"gaussian",densityMax:1},strategyRules:j,doLoad:!0}),n.loadConfig(e),n.clearHistory()},update:function(){l.update()}}},tq=["menu","darkModeSwitch","simControlsLabel","addEntities","undo","redo","warning","viz","vizMini","maps","budget","name","resultsPhaseSelector","saveConfigToLink","saveConfigToShortLink","saveConfigToText","loadConfigText","saveData","svgSwitch","showDownloadScreenLink"];function tG(e){let t={},n=[];this.newElement=(i,r)=>{e.includes(i)?t[i]=r:n.push(r)},this.makeComponent=()=>{let i=document.createElement("div");return i.className="sandbox",e.forEach(e=>{let n=t[e];void 0!==n&&i.appendChild(n)}),n.forEach(e=>{i.appendChild(e)}),i}}function tI(){let e=[];this.attach=t=>{e.push(t)},this.enter=()=>{e.forEach(e=>e.enter())},this.exit=()=>{e.forEach(e=>e.exit())},this.update=t=>{e.forEach(e=>e.update(t))},this.render=()=>{e.forEach(e=>{e.render&&e.render()})},this.renderForeground=()=>{e.forEach(e=>{e.renderForeground&&e.renderForeground()})},this.clear=()=>{e.forEach(e=>{e.clear&&e.clear()})},this.clearForeground=()=>{e.forEach(e=>{e.clearForeground&&e.clearForeground()})}}function tj(e,t,n){let i=this;e.attach(i),i.viewModes={one:new tI,sample:new tI};let r=i.viewModes[t.mode];i.update=e=>{n.check(["mode"])&&(r.exit(),(r=i.viewModes[t.mode]).enter()),r.update(e)},i.render=()=>{r.render()},i.renderForeground=()=>{r.renderForeground()},i.clear=()=>{r.clear()},i.clearForeground=()=>{r.clearForeground()},i.rerender=()=>{i.clear(),i.clearForeground(),i.render(),i.renderForeground()}}var tW=o("79Zf3");function tz(){let e=this;e.handlers={start:()=>{},move:()=>{},end:()=>{},touchmove:()=>{},touchstart:()=>{},touchend:()=>{}},e.set=t=>{Object.assign(e.handlers,t)}}function tU(){let e=this;e.background=document.createElement("canvas"),e.background.setAttribute("class","background"),e.ctx=e.background.getContext("2d"),e.foreground=document.createElement("canvas"),e.foreground.setAttribute("class","foreground"),e.fctx=e.foreground.getContext("2d"),e.setSize=(t,n)=>{let i=`${t}px`,r=`${n}px`,o=e.pixelRatio,a=t*o,s=n*o;e.background.width=a,e.background.height=s,e.background.style.width=i,e.background.style.height=r,e.foreground.width=a,e.foreground.height=s,e.foreground.style.width=i,e.foreground.style.height=r,e.ctx.scale(o,o),e.fctx.scale(o,o)},e.setDisplayStyle=t=>{e.background.style.display=t,e.foreground.style.display=t},e.setStrokeStyle=t=>{e.ctx.strokeStyle=t,e.fctx.strokeStyle=t},e.pixelRatio=function(e){let t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/t}(e.ctx)}function t$(e,t){this.div=document.createElement("div");let n=document.createElement("button");n.className="button2",n.innerText="Make SVG",n.onclick=function(){e.setFCtx(e.svg.ctx),t.clear(),t.render(),t.renderForeground();let n=e.svg.ctx.getSerializedSvg(!0),r=`data:image/svg+xml;charset=utf-8,${encodeURIComponent(n)}`;i.href=r,e.setFCtx(e.svg.fctx),t.rerender()};let i=document.createElement("a");i.innerText="vote.svg",i.download="vote.svg",i.style.margin="4px",this.div.append(n),this.div.appendChild(i),this.setShowDownloadScreenLink=e=>{e?(n.hidden=!1,i.hidden=!1):(n.hidden=!0,i.hidden=!0)},this.setShowDownloadScreenLink(e.common.showDownloadScreenLink)}function tH(e,t){var n,i=Object.keys(t);for(n=0;n<i.length;n++)e=e.replace(RegExp("\\{"+i[n]+"\\}","gi"),t[i[n]]);return e}function tX(e){var t,n,i;if(!e)throw Error("cannot create a random attribute name for an undefined object");t="ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",n="";do for(i=0,n="";i<12;i++)n+=t[Math.floor(Math.random()*t.length)];while(e[n])return n}n0=function(e,t){var n,i,r,o={};for(n=0,e=e.split(","),t=t||10;n<e.length;n+=2)i="&"+e[n+1]+";",r=parseInt(e[n],t),o[i]="&#"+r+";";return o["\\xa0"]="&#160;",o}("50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,t9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro",32),nJ={strokeStyle:{svgAttr:"stroke",canvas:"#000000",svg:"none",apply:"stroke"},fillStyle:{svgAttr:"fill",canvas:"#000000",svg:null,apply:"fill"},lineCap:{svgAttr:"stroke-linecap",canvas:"butt",svg:"butt",apply:"stroke"},lineJoin:{svgAttr:"stroke-linejoin",canvas:"miter",svg:"miter",apply:"stroke"},miterLimit:{svgAttr:"stroke-miterlimit",canvas:10,svg:4,apply:"stroke"},lineWidth:{svgAttr:"stroke-width",canvas:1,svg:1,apply:"stroke"},globalAlpha:{svgAttr:"opacity",canvas:1,svg:1,apply:"fill stroke"},font:{canvas:"10px sans-serif"},shadowColor:{canvas:"#000000"},shadowOffsetX:{canvas:0},shadowOffsetY:{canvas:0},shadowBlur:{canvas:0},textAlign:{canvas:"start"},textBaseline:{canvas:"alphabetic"},lineDash:{svgAttr:"stroke-dasharray",canvas:[],svg:null,apply:"stroke"}},(nZ=function(e,t){this.__root=e,this.__ctx=t}).prototype.addColorStop=function(e,t){var n,i=this.__ctx.__createElement("stop");i.setAttribute("offset",e),-1!==t.indexOf("rgba")?(n=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(t),i.setAttribute("stop-color",tH("rgb({r},{g},{b})",{r:n[1],g:n[2],b:n[3]})),i.setAttribute("stop-opacity",n[4])):i.setAttribute("stop-color",t),this.__root.appendChild(i)},nQ=function(e,t){this.__root=e,this.__ctx=t},(nK=function(e){var t,n={width:500,height:500,enableMirroring:!1};if(arguments.length>1?((t=n).width=arguments[0],t.height=arguments[1]):t=e||n,!(this instanceof nK))return new nK(t);this.width=t.width||n.width,this.height=t.height||n.height,this.enableMirroring=void 0!==t.enableMirroring?t.enableMirroring:n.enableMirroring,this.canvas=this,this.__document=t.document||document,t.ctx?this.__ctx=t.ctx:(this.__canvas=this.__document.createElement("canvas"),this.__ctx=this.__canvas.getContext("2d")),this.__setDefaultStyles(),this.__stack=[this.__getStyleState()],this.__groupStack=[],this.__root=this.__document.createElementNS("http://www.w3.org/2000/svg","svg"),this.__root.setAttribute("version",1.1),this.__root.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.__root.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),this.__root.setAttribute("width",this.width),this.__root.setAttribute("height",this.height),this.__ids={},this.__defs=this.__document.createElementNS("http://www.w3.org/2000/svg","defs"),this.__root.appendChild(this.__defs),this.__currentElement=this.__document.createElementNS("http://www.w3.org/2000/svg","g"),this.__root.appendChild(this.__currentElement)}).prototype.__createElement=function(e,t,n){void 0===t&&(t={});var i,r,o=this.__document.createElementNS("http://www.w3.org/2000/svg",e),a=Object.keys(t);for(n&&(o.setAttribute("fill","none"),o.setAttribute("stroke","none")),i=0;i<a.length;i++)r=a[i],o.setAttribute(r,t[r]);return o},nK.prototype.__setDefaultStyles=function(){var e,t,n=Object.keys(nJ);for(e=0;e<n.length;e++)this[t=n[e]]=nJ[t].canvas},nK.prototype.__applyStyleState=function(e){var t,n,i=Object.keys(e);for(t=0;t<i.length;t++)this[n=i[t]]=e[n]},nK.prototype.__getStyleState=function(){var e,t,n={},i=Object.keys(nJ);for(e=0;e<i.length;e++)n[t=i[e]]=this[t];return n},nK.prototype.__applyStyleToCurrentElement=function(e){var t=this.__currentElement,n=this.__currentElementsToStyle;n&&(t.setAttribute(e,""),t=n.element,n.children.forEach(function(t){t.setAttribute(e,"")}));var i,r,o,a,s,l=Object.keys(nJ);for(i=0;i<l.length;i++)if(r=nJ[l[i]],o=this[l[i]],r.apply){if(o instanceof nQ){if(o.__ctx)for(;o.__ctx.__defs.childNodes.length;)a=o.__ctx.__defs.childNodes[0].getAttribute("id"),this.__ids[a]=a,this.__defs.appendChild(o.__ctx.__defs.childNodes[0]);t.setAttribute(r.apply,tH("url(#{id})",{id:o.__root.getAttribute("id")}))}else if(o instanceof nZ)t.setAttribute(r.apply,tH("url(#{id})",{id:o.__root.getAttribute("id")}));else if(-1!==r.apply.indexOf(e)&&r.svg!==o){if(("stroke"===r.svgAttr||"fill"===r.svgAttr)&&-1!==o.indexOf("rgba")){s=/rgba\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d?\.?\d*)\s*\)/gi.exec(o),t.setAttribute(r.svgAttr,tH("rgb({r},{g},{b})",{r:s[1],g:s[2],b:s[3]}));var c=s[4],h=this.globalAlpha;null!=h&&(c*=h),t.setAttribute(r.svgAttr+"-opacity",c)}else{var u=r.svgAttr;if("globalAlpha"===l[i]&&(u=e+"-"+r.svgAttr,t.getAttribute(u)))continue;t.setAttribute(u,o)}}}},nK.prototype.__closestGroupOrSvg=function(e){return"g"===(e=e||this.__currentElement).nodeName||"svg"===e.nodeName?e:this.__closestGroupOrSvg(e.parentNode)},nK.prototype.getSerializedSvg=function(e){var t,n,i,r,o,a=new XMLSerializer().serializeToString(this.__root);if(/xmlns="http:\/\/www\.w3\.org\/2000\/svg".+xmlns="http:\/\/www\.w3\.org\/2000\/svg/gi.test(a)&&(a=a.replace('xmlns="http://www.w3.org/2000/svg','xmlns:xlink="http://www.w3.org/1999/xlink')),e)for(n=0,t=Object.keys(n0);n<t.length;n++)r=n0[i=t[n]],(o=RegExp(i,"gi")).test(a)&&(a=a.replace(o,r));return a},nK.prototype.getSvg=function(){return this.__root},nK.prototype.save=function(){var e=this.__createElement("g"),t=this.__closestGroupOrSvg();this.__groupStack.push(t),t.appendChild(e),this.__currentElement=e,this.__stack.push(this.__getStyleState())},nK.prototype.restore=function(){this.__currentElement=this.__groupStack.pop(),this.__currentElementsToStyle=null,this.__currentElement||(this.__currentElement=this.__root.childNodes[1]);var e=this.__stack.pop();this.__applyStyleState(e)},nK.prototype.__addTransform=function(e){var t=this.__closestGroupOrSvg();if(t.childNodes.length>0){"path"===this.__currentElement.nodeName&&(this.__currentElementsToStyle||(this.__currentElementsToStyle={element:t,children:[]}),this.__currentElementsToStyle.children.push(this.__currentElement),this.__applyCurrentDefaultPath());var n=this.__createElement("g");t.appendChild(n),this.__currentElement=n}var i=this.__currentElement.getAttribute("transform");i?i+=" ":i="",i+=e,this.__currentElement.setAttribute("transform",i)},nK.prototype.scale=function(e,t){void 0===t&&(t=e),this.__addTransform(tH("scale({x},{y})",{x:e,y:t}))},nK.prototype.rotate=function(e){this.__addTransform(tH("rotate({angle},{cx},{cy})",{angle:180*e/Math.PI,cx:0,cy:0}))},nK.prototype.translate=function(e,t){this.__addTransform(tH("translate({x},{y})",{x:e,y:t}))},nK.prototype.transform=function(e,t,n,i,r,o){this.__addTransform(tH("matrix({a},{b},{c},{d},{e},{f})",{a:e,b:t,c:n,d:i,e:r,f:o}))},nK.prototype.beginPath=function(){var e;this.__currentDefaultPath="",this.__currentPosition={},e=this.__createElement("path",{},!0),this.__closestGroupOrSvg().appendChild(e),this.__currentElement=e},nK.prototype.__applyCurrentDefaultPath=function(){var e=this.__currentElement;"path"===e.nodeName?e.setAttribute("d",this.__currentDefaultPath):console.error("Attempted to apply path command to node",e.nodeName)},nK.prototype.__addPathCommand=function(e){this.__currentDefaultPath+=" ",this.__currentDefaultPath+=e},nK.prototype.moveTo=function(e,t){"path"!==this.__currentElement.nodeName&&this.beginPath(),this.__currentPosition={x:e,y:t},this.__addPathCommand(tH("M {x} {y}",{x:e,y:t}))},nK.prototype.closePath=function(){this.__currentDefaultPath&&this.__addPathCommand("Z")},nK.prototype.lineTo=function(e,t){this.__currentPosition={x:e,y:t},this.__currentDefaultPath.indexOf("M")>-1?this.__addPathCommand(tH("L {x} {y}",{x:e,y:t})):this.__addPathCommand(tH("M {x} {y}",{x:e,y:t}))},nK.prototype.bezierCurveTo=function(e,t,n,i,r,o){this.__currentPosition={x:r,y:o},this.__addPathCommand(tH("C {cp1x} {cp1y} {cp2x} {cp2y} {x} {y}",{cp1x:e,cp1y:t,cp2x:n,cp2y:i,x:r,y:o}))},nK.prototype.quadraticCurveTo=function(e,t,n,i){this.__currentPosition={x:n,y:i},this.__addPathCommand(tH("Q {cpx} {cpy} {x} {y}",{cpx:e,cpy:t,x:n,y:i}))};var tY=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]);return[e[0]/t,e[1]/t]};nK.prototype.arcTo=function(e,t,n,i,r){var o=this.__currentPosition&&this.__currentPosition.x,a=this.__currentPosition&&this.__currentPosition.y;if(void 0!==o&&void 0!==a){if(r<0)throw Error("IndexSizeError: The radius provided ("+r+") is negative.");if(o===e&&a===t||e===n&&t===i||0===r){this.lineTo(e,t);return}var s=tY([o-e,a-t]),l=tY([n-e,i-t]);if(s[0]*l[1]==s[1]*l[0]){this.lineTo(e,t);return}var c=Math.acos(Math.abs(s[0]*l[0]+s[1]*l[1])),h=tY([s[0]+l[0],s[1]+l[1]]),u=r/Math.sin(c/2),d=e+u*h[0],p=t+u*h[1],f=[-s[1],s[0]],m=[l[1],-l[0]],g=function(e){var t=e[0];return e[1]>=0?Math.acos(t):-Math.acos(t)},y=g(f),v=g(m);this.lineTo(d+f[0]*r,p+f[1]*r),this.arc(d,p,r,y,v)}},nK.prototype.stroke=function(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","fill stroke markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("stroke")},nK.prototype.fill=function(){"path"===this.__currentElement.nodeName&&this.__currentElement.setAttribute("paint-order","stroke fill markers"),this.__applyCurrentDefaultPath(),this.__applyStyleToCurrentElement("fill")},nK.prototype.rect=function(e,t,n,i){"path"!==this.__currentElement.nodeName&&this.beginPath(),this.moveTo(e,t),this.lineTo(e+n,t),this.lineTo(e+n,t+i),this.lineTo(e,t+i),this.lineTo(e,t),this.closePath()},nK.prototype.fillRect=function(e,t,n,i){var r;r=this.__createElement("rect",{x:e,y:t,width:n,height:i},!0),this.__closestGroupOrSvg().appendChild(r),this.__currentElement=r,this.__applyStyleToCurrentElement("fill")},nK.prototype.strokeRect=function(e,t,n,i){var r;r=this.__createElement("rect",{x:e,y:t,width:n,height:i},!0),this.__closestGroupOrSvg().appendChild(r),this.__currentElement=r,this.__applyStyleToCurrentElement("stroke")},nK.prototype.__clearCanvas=function(){for(var e=this.__closestGroupOrSvg().getAttribute("transform"),t=this.__root.childNodes[1],n=t.childNodes,i=n.length-1;i>=0;i--)n[i]&&t.removeChild(n[i]);this.__currentElement=t,this.__groupStack=[],e&&this.__addTransform(e)},nK.prototype.clearRect=function(e,t,n,i){if(0===e&&0===t&&n===this.width&&i===this.height){this.__clearCanvas();return}var r,o=this.__closestGroupOrSvg();r=this.__createElement("rect",{x:e,y:t,width:n,height:i,fill:"#FFFFFF"},!0),o.appendChild(r)},nK.prototype.createLinearGradient=function(e,t,n,i){var r=this.__createElement("linearGradient",{id:tX(this.__ids),x1:e+"px",x2:n+"px",y1:t+"px",y2:i+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(r),new nZ(r,this)},nK.prototype.createRadialGradient=function(e,t,n,i,r,o){var a=this.__createElement("radialGradient",{id:tX(this.__ids),cx:i+"px",cy:r+"px",r:o+"px",fx:e+"px",fy:t+"px",gradientUnits:"userSpaceOnUse"},!1);return this.__defs.appendChild(a),new nZ(a,this)},nK.prototype.__parseFont=function(){var e=/^\s*(?=(?:(?:[-a-z]+\s*){0,2}(italic|oblique))?)(?=(?:(?:[-a-z]+\s*){0,2}(small-caps))?)(?=(?:(?:[-a-z]+\s*){0,2}(bold(?:er)?|lighter|[1-9]00))?)(?:(?:normal|\1|\2|\3)\s*){0,3}((?:xx?-)?(?:small|large)|medium|smaller|larger|[.\d]+(?:\%|in|[cem]m|ex|p[ctx]))(?:\s*\/\s*(normal|[.\d]+(?:\%|in|[cem]m|ex|p[ctx])))?\s*([-,\'\"\sa-z0-9]+?)\s*$/i.exec(this.font),t={style:e[1]||"normal",size:e[4]||"10px",family:e[6]||"sans-serif",weight:e[3]||"normal",decoration:e[2]||"normal",href:null};return"underline"===this.__fontUnderline&&(t.decoration="underline"),this.__fontHref&&(t.href=this.__fontHref),t},nK.prototype.__wrapTextLink=function(e,t){if(e.href){var n=this.__createElement("a");return n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",e.href),n.appendChild(t),n}return t},nK.prototype.__applyText=function(e,t,n,i){var r,o,a,s,l=this.__parseFont(),c=this.__closestGroupOrSvg(),h=this.__createElement("text",{"font-family":l.family,"font-size":l.size,"font-style":l.style,"font-weight":l.weight,"text-decoration":l.decoration,x:t,y:n,"text-anchor":(r=this.textAlign,(o={left:"start",right:"end",center:"middle",start:"start",end:"end"})[r]||o.start),"dominant-baseline":(a=this.textBaseline,(s={alphabetic:"alphabetic",hanging:"hanging",top:"text-before-edge",bottom:"text-after-edge",middle:"central"})[a]||s.alphabetic)},!0);h.appendChild(this.__document.createTextNode(e)),this.__currentElement=h,this.__applyStyleToCurrentElement(i),c.appendChild(this.__wrapTextLink(l,h))},nK.prototype.fillText=function(e,t,n){this.__applyText(e,t,n,"fill")},nK.prototype.strokeText=function(e,t,n){this.__applyText(e,t,n,"stroke")},nK.prototype.measureText=function(e){return this.__ctx.font=this.font,this.__ctx.measureText(e)},nK.prototype.arc=function(e,t,n,i,r,o){if(i!==r){(i%=2*Math.PI)==(r%=2*Math.PI)&&(r=(r+2*Math.PI-.001*(o?-1:1))%(2*Math.PI));var a=e+n*Math.cos(r),s=t+n*Math.sin(r),l=e+n*Math.cos(i),c=t+n*Math.sin(i),h=0,u=r-i;u<0&&(u+=2*Math.PI),h=o?u>Math.PI?0:1:u>Math.PI?1:0,this.lineTo(l,c),this.__addPathCommand(tH("A {rx} {ry} {xAxisRotation} {largeArcFlag} {sweepFlag} {endX} {endY}",{rx:n,ry:n,xAxisRotation:0,largeArcFlag:h,sweepFlag:o?0:1,endX:a,endY:s})),this.__currentPosition={x:a,y:s}}},nK.prototype.clip=function(){var e=this.__closestGroupOrSvg(),t=this.__createElement("clipPath"),n=tX(this.__ids),i=this.__createElement("g");this.__applyCurrentDefaultPath(),e.removeChild(this.__currentElement),t.setAttribute("id",n),t.appendChild(this.__currentElement),this.__defs.appendChild(t),e.setAttribute("clip-path",tH("url(#{id})",{id:n})),e.appendChild(i),this.__currentElement=i},nK.prototype.drawImage=function(){var e,t,n,i,r,o,a,s,l,c,h,u,d,p,f=Array.prototype.slice.call(arguments),m=f[0],g=0,y=0;if(3===f.length)e=f[1],t=f[2],r=m.width,o=m.height,n=r,i=o;else if(5===f.length)e=f[1],t=f[2],n=f[3],i=f[4],r=m.width,o=m.height;else if(9===f.length)g=f[1],y=f[2],r=f[3],o=f[4],e=f[5],t=f[6],n=f[7],i=f[8];else throw Error("Inavlid number of arguments passed to drawImage: "+arguments.length);a=this.__closestGroupOrSvg(),this.__currentElement;var v="translate("+e+", "+t+")";if(m instanceof nK){if((s=m.getSvg().cloneNode(!0)).childNodes&&s.childNodes.length>1){for(l=s.childNodes[0];l.childNodes.length;)p=l.childNodes[0].getAttribute("id"),this.__ids[p]=p,this.__defs.appendChild(l.childNodes[0]);if(c=s.childNodes[1]){var w,x=c.getAttribute("transform");w=x?x+" "+v:v,c.setAttribute("transform",w),a.appendChild(c)}}}else"IMG"===m.nodeName?((h=this.__createElement("image")).setAttribute("width",n),h.setAttribute("height",i),h.setAttribute("preserveAspectRatio","none"),(g||y||r!==m.width||o!==m.height)&&((u=this.__document.createElement("canvas")).width=n,u.height=i,(d=u.getContext("2d")).drawImage(m,g,y,r,o,0,0,n,i),m=u),h.setAttribute("transform",v),h.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===m.nodeName?m.toDataURL():m.getAttribute("src")),a.appendChild(h)):"CANVAS"===m.nodeName&&((h=this.__createElement("image")).setAttribute("width",n),h.setAttribute("height",i),h.setAttribute("preserveAspectRatio","none"),(u=this.__document.createElement("canvas")).width=n,u.height=i,(d=u.getContext("2d")).imageSmoothingEnabled=!1,d.mozImageSmoothingEnabled=!1,d.oImageSmoothingEnabled=!1,d.webkitImageSmoothingEnabled=!1,d.drawImage(m,g,y,r,o,0,0,n,i),m=u,h.setAttribute("transform",v),h.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",m.toDataURL()),a.appendChild(h))},nK.prototype.drawImageSvg=function(){var e,t,n,i,r,o,a,s,l,c,h=Array.prototype.slice.call(arguments),u=h[0];if(3===h.length)e=h[1],t=h[2],r=u.width,o=u.height,n=r,i=o;else if(5===h.length)e=h[1],t=h[2],n=h[3],i=h[4],r=u.width,o=u.height;else if(9===h.length)h[1],h[2],r=h[3],o=h[4],e=h[5],t=h[6],n=h[7],i=h[8];else throw Error("Inavlid number of arguments passed to drawImage: "+arguments.length);a=this.__closestGroupOrSvg(),this.__currentElement;var d="translate("+e+", "+t+")";if(u instanceof SVGSVGElement&&u.childNodes&&u.childNodes.length>1){var p=parseFloat(u.getAttribute("width")),f=parseFloat(u.getAttribute("height"));u.setAttribute("width",n),u.setAttribute("height",i);var m=n/p,g=i/f;for(s=u.childNodes[0];s.childNodes.length;)c=s.childNodes[0].getAttribute("id"),this.__ids[c]=c,this.__defs.appendChild(s.childNodes[0]);if(l=u.childNodes[1]){var y,v=l.getAttribute("transform");y=v?v+" "+d:d,l.setAttribute("transform",y+" scale("+m+", "+g+")"),a.appendChild(l)}}},nK.prototype.createPattern=function(e,t){var n,i=this.__document.createElementNS("http://www.w3.org/2000/svg","pattern"),r=tX(this.__ids);return i.setAttribute("id",r),i.setAttribute("width",e.width),i.setAttribute("height",e.height),"CANVAS"===e.nodeName||"IMG"===e.nodeName?((n=this.__document.createElementNS("http://www.w3.org/2000/svg","image")).setAttribute("width",e.width),n.setAttribute("height",e.height),n.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","CANVAS"===e.nodeName?e.toDataURL():e.getAttribute("src")),i.appendChild(n),this.__defs.appendChild(i)):e instanceof nK&&(i.appendChild(e.__root.childNodes[1]),this.__defs.appendChild(i)),new nQ(i,this)},nK.prototype.setLineDash=function(e){e&&e.length>0?this.lineDash=e.join(","):this.lineDash=null},nK.prototype.drawFocusRing=function(){},nK.prototype.createImageData=function(){},nK.prototype.getImageData=function(){},nK.prototype.putImageData=function(){},nK.prototype.globalCompositeOperation=function(){},nK.prototype.setTransform=function(){};var tJ=nK;function tK(){let e=this;e.ctx=new tJ,e.background=e.ctx.getSvg(),e.background.setAttribute("class","background"),e.fctx=new tJ,e.foreground=e.fctx.getSvg(),e.foreground.setAttribute("class","foreground"),e.setSize=(t,n)=>{let i=`${t}px`,r=`${n}px`;e.ctx.width=t,e.ctx.height=n,e.background.style.width=i,e.background.style.height=r,e.fctx.width=t,e.fctx.height=n,e.foreground.style.width=i,e.foreground.style.height=r},e.setDisplayStyle=t=>{e.background.style.display=t,e.foreground.style.display=t},e.setStrokeStyle=t=>{e.ctx.strokeStyle=t,e.fctx.strokeStyle=t}}function tZ(e,t,n,i){let r=this;r.common=e,r.common.attach(r),r.canvas=new tU,r.svg=new tK,r.download=new t$(r,t),r.setShowDownloadScreenLink=r.download.setShowDownloadScreenLink,r.tweenGroup=new tW.Group,r.tooltips=document.createElement("div"),r.tooltips.setAttribute("class","tooltips");let o=document.createElement("div");r.wrap=document.createElement("div"),r.wrap.setAttribute("class","screenWrap"),r.wrap.appendChild(o),r.wrap.appendChild(r.canvas.background),r.wrap.appendChild(r.canvas.foreground),r.wrap.appendChild(r.svg.background),r.wrap.appendChild(r.svg.foreground),r.wrap.appendChild(r.tooltips),r.outer=document.createElement("div"),r.outer.appendChild(r.wrap),r.outer.appendChild(r.download.div),n.newElement(i,r.outer),r.setSize=(e,t)=>{let n=`${e}px`,i=`${t}px`;r.width=e,r.height=t,r.tooltips.style.width=n,r.tooltips.style.height=i,r.wrap.style.width=n,r.wrap.style.height=i,r.svg.setSize(e,t),r.canvas.setSize(e,t)},r.setWidth=e=>{r.setSize(e,r.height)},r.setHeight=e=>{r.setSize(r.width,e)};let{width:a,height:s}=e;r.setSize(a,s),r.setFCtx=e=>{r.fctx=e},r.clear=function(){r.ctx.clearRect(0,0,r.width,r.height),r.common.darkMode&&r.noBuffers&&(r.ctx.fillStyle="#222",r.ctx.fillRect(0,0,r.width,r.height),r.ctx.fillStyle="white")},r.clearForeground=function(){r.fctx.clearRect(0,0,r.width,r.height)},r.switchToSVG=()=>{r.ctx=r.svg.ctx,r.fctx=r.svg.fctx,r.canvas.setDisplayStyle("none"),r.svg.setDisplayStyle("block"),r.noBuffers=!0},r.switchToCanvas=()=>{r.ctx=r.canvas.ctx,r.fctx=r.canvas.fctx,r.canvas.setDisplayStyle("block"),r.svg.setDisplayStyle("none"),r.noBuffers=!1},r.setSvgMode=e=>{e?r.switchToSVG():r.switchToCanvas()},r.setSvgMode(!1),r.show=()=>{r.outer.style.display="block"},r.hide=()=>{r.outer.style.display="none"},r.setDarkMode=e=>{let t=e?"#ddd":"#222";r.canvas.setStrokeStyle(t),r.svg.setStrokeStyle(t)},r.setDarkMode(e.darkMode),r.eventHandlers=new tz;let{handlers:l}=r.eventHandlers;r.wrap.onmousedown=e=>l.start(e),r.wrap.onmousemove=e=>l.move(e),r.wrap.onmouseup=e=>l.end(e),r.wrap.addEventListener("touchmove",e=>l.touchmove(e)),r.wrap.addEventListener("touchstart",e=>l.touchstart(e)),r.wrap.addEventListener("touchend",e=>l.touchend(e));let c=document.onmouseup;document.onmouseup=e=>{c&&c(e),r.wrap.onmouseup(e)}}function tQ(e,t){let n=this;n.config=e,n.name=e.name,n.nameIsHTML=e.nameIsHTML||!1,n.dom=document.createElement("div"),n.dom.setAttribute("class","button button2");let i=e.margin;i=Math.max(i=i||0,4),n.dom.style.marginRight=`${i}px`,n.draw=function(){n.nameIsHTML?n.dom.innerHTML=n.name:n.dom.innerText=n.name},n.draw(),n.dom.setAttribute("title",e.explain||""),n.onClick=function(){t(n,e)},n.dom.onclick=n.onClick,n.turnOff=function(){n.isOn=!1,n.config.isOn=!1,n.dom.setAttribute("on","no")},n.turnOn=function(){n.isOn=!0,n.config.isOn=!0,n.dom.setAttribute("on","yes")},n.turnOff()}function t0(e){let t=this;t.config=e,void 0===e.data&&(e.data=[],void 0===e.makeData&&(e.makeData=()=>[]),t.makeData=e.makeData,t.buttonConfigs=t.makeData(),t.doMakeData=!0),t.buttonConfigs=e.data,t.labelName=e.label,t.labelIsHTML=e.labelIsHTML||!1,t.onChoose=e.onChoose,t.isCheckbox=e.isCheckbox||!1,t.isCheckboxBool=e.isCheckboxBool||!1,t.justButton=e.justButton||!1,t.buttonHidden=e.buttonHidden||{},t.dom=document.createElement("div"),t.dom.setAttribute("class","button-group"),t.buttonDOMByValue=[],t.init=function(){t.doMakeData&&(t.buttonConfigs=t.makeData()),t.dom.innerHTML="",t.buttons=[],t.buttonsByName={},t.labelDOM=document.createElement("div"),t.labelDOM.setAttribute("class","button-group-label"),t.labelDOM.setAttribute("title",e.explain||""),t.labelTip=document.createElement("div"),t.labelTip.setAttribute("class","label-tip"),t.labelTip.innerText=e.explain||"";let n=!0;t.labelTip.hidden=n,t.labelDOM.onclick=()=>{n=!n,void 0===e.explain&&(n=!0),t.labelTip.hidden=n},t.dom.appendChild(t.labelDOM),t.dom.appendChild(t.labelTip),t.draw(),t.buttonContainer=document.createElement("div"),t.buttonContainer.setAttribute("class","button-group-button-container"),t.dom.appendChild(t.buttonContainer);for(let n=0;n<t.buttonConfigs.length;n++){let i=t.buttonConfigs[n],r=new tQ(i,t.onToggle);t.buttonsByName[i.name]=r,r.dom.style.width=`${e.width}px`,i.width&&(r.dom.style.width=`${i.width}px`),t.buttons.push(r),t.buttonContainer.appendChild(r.dom),t.buttonDOMByValue[i.value]=r.dom}for(let e=0;e<t.buttons.length;e++){let n=t.buttons[e];if(n.config.selected){n.turnOn();break}}t.draw()},t.updateNames=function(){let e=t.makeData();for(let n=0;n<t.buttonConfigs.length;n++)t.buttonConfigs[n].name=e[n].name,t.buttons[n].name=t.buttonConfigs[n].name},t.redraw=function(){t.updateNames(),t.draw()},t.draw=function(){for(let e of(t.labelIsHTML?t.labelDOM.innerHTML=t.labelName:t.labelDOM.innerText=t.labelName,t.buttons))e.draw()},t.configureHidden=function(){for(let[e,n]of Object.entries(t.buttonHidden))t.buttonsByName[e].dom.hidden=n},t.onToggle=function(e,n){if(t.isCheckbox||t.isCheckboxBool)e.isOn?e.turnOff():e.turnOn();else{for(let e=0;e<t.buttons.length;e++)t.buttons[e].turnOff();e.turnOn(),t.justButton&&setTimeout(()=>e.turnOff(),800)}t.onChoose(n)},t.highlight=function(e,n){if(0!==t.buttons.length){for(let e=0;e<t.buttons.length;e++)t.buttons[e].turnOff();if(t.isCheckbox)for(let i in t.buttons){let r=t.buttons[i];n.includes(r.config[e])&&r.turnOn()}else if(t.isCheckboxBool)for(let i in t.buttons){let r=t.buttons[i],o=r.config[e];o in n&&n[o]&&r.turnOn()}else{let i=t.buttons.filter(t=>t.config[e]===n)[0];void 0!==i&&i.turnOn()}}},t.init()}function t1(e,t,n){let{label:i,options:r,changeList:o,getValue:a,onChoose:s,explain:l,checkShow:c}=n,h=this;e.attach(h),h.choose=new t0({label:i,explain:l,width:t2(3),data:r,onChoose:s}),h.update=()=>{t.check(o)&&h.select(),void 0!==c&&(c()?h.choose.dom.hidden=!1:h.choose.dom.hidden=!0)},h.select=function(){h.choose.highlight("value",a())}}function t2(e){return(302-18*(e-1)-10)/e}function t5(e){let t=this;t.setShowNonExistingEntities=n=>{t.showGhosts=n,e.add(["showGhosts"])}}function t3(){this.enter=()=>{},this.exit=()=>{},this.update=function(){},this.render=function(){}}function t4(e,t){let n=e.length,i=[0,0,0],r=0;for(let o=0;o<n;o++){for(let n=0;n<3;n++)i[n]+=e[o]*t[o][n]**2;r+=e[o]}return i.map(e=>Math.round(Math.sqrt(e/r)))}function t6(e){return`rgb(${e[0]},${e[1]},${e[2]})`}function t8(e){let t;let n=!1;this.enter=()=>{e.show()},this.exit=()=>{e.hide()},this.update=function(i,r,o){let{error:a}=r;if(void 0!==a){n=!0;return}n=!1;let s=function(e,t){let{socialChoiceResults:n,votes:i}=t,{colorRGBAOfCandidates:r}=e,{winnersByRound:o,winnerMaxCostPerScoreByRound:a}=n.explanation,{scoreVotes:s}=i.preferenceLists,{votesByGeom:l}=i,c=o.length,h=l.length,u=[],d=[],p=[];for(let e=0;e<h;e++){let{voteIndex:t}=l[e],n=t.length,i=[];i[0]=Array(n).fill(1);let h=[],f=[];for(let e=0;e<c;e++){let l=i[e],u=Array(n),d=Array(n),p=o[e],m=a[e];for(let e=0;e<n;e++){let n=m*s[t[e]][p];d[e]=Math.min(l[e],n),u[e]=Math.max(0,l[e]-n)}h[e]=d,f[e]=r[p],e<c-1&&(i[e+1]=u)}p[e]=f,u[e]=h,d[e]=i}return{costsByGeom:u,budgetsByGeom:d,colorRGBAByGeom:p}}(i,o);t=function(e,t,n){let{socialChoiceResults:i,votes:r}=e,{winnersByRound:o}=i.explanation,{costsByGeom:a,budgetsByGeom:s,colorRGBAByGeom:l}=n,{votesByGeom:c}=r,h=o.length,u=c.length,d=-t.width/3,p=t.width/3,f=[],m=[];for(let e=0;e<u;e++){let{grid:n,voteIndex:i,voterGeom:r}=c[e],{w:o,densityProfile:l}=r,u=r.x,g=n.x,y="gaussian"===l,v=o/Math.sqrt(2*Math.PI),w=i.length,x=s[e],_=a[e],b=[],C=[];for(let e=0;e<h;e++){let n=x[e],i=_[e],r=[],o=[],a=e%3*p,s=(Math.floor(e/3)+1)*p,l=0,c=0*d+s,h=.3333333333333333*Math.max(-1,g[0])+a;r[l]=[h,c],o[l]=[h,c],l+=1;for(let e=0;e<w;e++){let c=g[e];if(c<-1||c>t.width+1)continue;let h=y?Math.exp(-.5*((c-u)/v)**2):1,p=i[e]*h,f=n[e]*h,m=.3333333333333333*c+a,w=f*d+s;r[l]=[m,w];let x=.3333333333333333*c+a,_=p*d+s;o[l]=[x,_],l+=1}let f=.3333333333333333*Math.min(t.width+1,g[w-1])+a;r[l]=[f,c],o[l]=[f,c],r[l+=1]=[h,c],o[l]=[h,c],l+=1,C[e]=o,b[e]=r}f[e]=C,m[e]=b}return{costShapesbyGeom:f,budgetShapesbyGeom:m,colorRGBAByGeom:l}}(o,e,s)},this.render=function(){n||function(e,t){let{costShapesbyGeom:n,budgetShapesbyGeom:i,colorRGBAByGeom:r}=t,o=n.length,{ctx:a}=e;a.save(),a.globalAlpha=.7;for(let e=0;e<o;e++){let t=n[e],o=i[e],s=r[e],l=t.length;for(let e=0;e<l;e++){let n=t[e],i=o[e],r=s[e];a.fillStyle="#cccccc",a.strokeStyle="#555555",a.beginPath(),a.moveTo(i[0][0],i[0][1]);for(let e=1;e<i.length;e++)a.lineTo(i[e][0],i[e][1]);a.fill(),a.stroke(),a.fillStyle=t6(r),a.strokeStyle=t6(t4([.5,.5],[r,[0,0,0]])),a.beginPath(),a.moveTo(n[0][0],n[0][1]);for(let e=1;e<n.length;e++)a.lineTo(n[e][0],n[e][1]);a.fill(),a.stroke()}}a.restore()}(e,t)}}function t9(e,t){let{sequenceName:n,sequences:i}=e.sequenceOptions,{resultsPhaseBySeq:r}=t,o=r[n];return i[n].phases[o]}function t7(e,t){if(e.error)return e;let{sequenceName:n}=e.optionsBag.sequenceOptions,{resultsPhaseBySeq:i}=t,r=i[n];if("closedPrimary"===n&&"closedPrimary"===r){let{resultsPartyBySeq:n}=t,i=n[r],o=e.phases[r][i];return void 0===o?{error:!0}:o}return e.phases[r]}function ne(e,t,n,i,r,o,a){let s;let l=this;a.viewModes.one.attach(l);let c=new tZ(e,a,t,"budget"),{height:h}=e;function u(){let e=o.getOptions(),{useGeography:t}=e,{socialChoiceMethod:n}=t9(e,r),{dimensions:i}=r;s=new("methodOfEqualShares"!==n||t||1!==i?t3:t8)(c)}c.setHeight(h/3),c.hide(),u(),l.enter=()=>{u(),s.enter()},l.exit=()=>{s.exit()},l.update=e=>{if(!i.checkNone()){if(i.check(["numDistricts","numTracts","dimensions","socialChoiceMethod"])&&(l.exit(),l.enter()),!0===o.getOptions().useGeography);else{let{geoResults:t}=e,n=t.scResultsByDistrict[0],i=t7(n,r);s.update(t,n,i)}l.clear(),l.render()}},l.render=()=>{s.render()},l.clear=()=>{c.clear()},l.draw=()=>{l.clear(),l.render()}}function nt(e){let t,n;this.update=e=>{t=e.geometry.geography.voterGeomsByTract,n=e.geometry.dimensions},this.render=()=>{let{ctx:o}=e,{svgMode:a}=e.common;o.save(),1===n?(o.globalAlpha=.3,t.forEach(e=>{e.forEach(e=>{e.forEach(e=>{let{x:t}=e;o.beginPath(),o.moveTo(t,0),o.lineTo(t,100),o.stroke()})})})):t.forEach(e=>{e.forEach(e=>{e.forEach(e=>{let{x:t,y:n}=e;(function(e,t,n,o){if(t){r(e,n,o);return}e.drawImage(i,n-5,o-5,10,10)})(o,a,t,n)})})}),o.restore()};let i=document.createElement("canvas");function r(e,t,n){e.beginPath(),e.fillStyle="#555",e.arc(t,n,1,0,2*Math.PI),e.fill()}i.width=10,i.height=10,r(i.getContext("2d"),5,5)}function nn(e,t){let n=this;n.render=function(){let{ctx:n}=t,{darkMode:i}=t.common,{x:r,w:o,densityProfile:a}=e.shape1;n.save(),n.strokeStyle="#555",i&&(n.strokeStyle="#ddd"),n.beginPath(),"gaussian"===a?function(){let e=o/Math.sqrt(2*Math.PI);n.moveTo(0,200);let i=[];for(let o=0;o<=t.width;o+=1){let t=200-100*Math.exp(-(.5*((o-r)/e)**2));i.push(t),n.lineTo(o,t)}n.lineTo(t.width,200),n.lineTo(0,200)}():n.rect(r-.5*o,100,o,100),n.stroke(),n.restore()},n.renderAt=()=>{n.render()}}function ni(e,t){this.render=function(){let{ctx:n}=t,{darkMode:i}=t.common,{x:r,y:o,w:a,densityProfile:s}=e.shape2;n.save(),"gaussian"===s&&(n.setLineDash([1,9]),n.lineWidth=10),n.beginPath(),n.strokeStyle="#555",i&&(n.strokeStyle="#ddd"),n.arc(r,o,.5*a,0,2*Math.PI),n.stroke(),n.restore()},this.renderAt=function(n,i){let{ctx:r}=t,{darkMode:o}=t.common,{w:a}=e.shape2;r.beginPath(),r.strokeStyle="#555",o&&(r.strokeStyle="#ddd"),r.arc(n,i,.5*a,0,2*Math.PI),r.stroke()},this.renderCenterAt2=function(e,n){let{ctx:i}=t,{darkMode:r}=t.common;i.beginPath(),i.fillStyle="#555",r&&(i.fillStyle="#bbb"),i.arc(e,n,1,0,2*Math.PI),i.fill()}}function nr(e,t,n,i,r){let{dimensions:o}=r,a=1===o?nn:ni;e.setRenderer(e=>new a(e,n));let s=new nt(n);this.enter=()=>{},this.exit=()=>{},this.update=e=>{s.update(e)},this.render=()=>{e.render(),s.render()}}function no(e,t,n){let i,r;this.update=function(){if(void 0===(r=t.getEntities()))return;let e=r.map(e=>[e.shape1.x,0]);i=tb.from(e).voronoi([0,0,n.width,n.height])},this.render=function(){if(void 0===r)return;let{ctx:t}=n,{x:o,w:a,densityProfile:s}=e.shape1;t.save(),t.beginPath(),c(),t.clip();let l=r.length;for(let e=0;e<l;e++)t.beginPath(),i.renderCell(e,t),t.fillStyle=r[e].color,t.fill(),t.stroke();function c(){"gaussian"===s?function(){let e=a/Math.sqrt(2*Math.PI);t.moveTo(0,200);let i=[];for(let r=0;r<=n.width;r+=1){let n=200-100*Math.exp(-(.5*((r-o)/e)**2));i.push(n),t.lineTo(r,n)}t.lineTo(n.width,200),t.lineTo(0,200)}():t.rect(o-.5*a,100,a,100)}t.beginPath(),c(),t.stroke(),t.restore()}}function na(e,t,n){let i,r;this.update=function(){let e=(r=t.getEntities()).map(e=>[e.shape2.x,e.shape2.y]);i=tb.from(e).voronoi([0,0,n.width,n.height])},this.render=function(){let{ctx:t}=n,{x:o,y:a,w:s}=e.shape2;t.save(),t.beginPath(),t.arc(o,a,.5*s,0,2*Math.PI),t.clip();let l=r.length;for(let e=0;e<l;e++)t.beginPath(),i.renderCell(e,t),t.fillStyle=r[e].color,t.fill(),t.stroke();t.beginPath(),t.arc(o,a,.5*s,0,2*Math.PI),t.stroke(),t.restore()}}function ns(e,t,n,i,r){let{dimensions:o}=r,a=1===o?no:na;e.setRenderer(e=>new a(e,t,n)),this.enter=()=>{},this.exit=()=>{},this.update=function(t){let{error:n}=t;void 0===n&&e.updateGraphic()},this.render=function(){e.render()}}function nl(e,t,n){let i,r,o;this.update=function(e){let{rankings:n}=e,{intervalBorders:a}=e;if(void 0===n||void 0===a){let e=eG((i=t.getEntities()).map(e=>e.shape1.x));n=e.rankings,a=e.intervalBorders}let s=(i=t.getEntities()).length,l=i.map(e=>e.colorRGBA),c=a.length-1;o=Array(c),r=Array(c);for(let e=0;e<c;e++){o[e]=[a[e],a[e+1]];let t=n[e].map(e=>s-e);r[e]=t6(t4(t,l))}},this.render=function(){let{ctx:t}=n,{x:i,w:a,densityProfile:s}=e.shape1;t.save(),t.beginPath(),c(),t.clip();let l=o.length;for(let e=0;e<l;e++)(function(e,t,n,i){let r=Math.max(0,e[0]),o=Math.min(i.width,e[1]),a=i.height;n.beginPath(),n.rect(r,0,o-r,a),n.fillStyle=t,n.fill(),n.stroke()})(o[e],r[e],t,n);function c(){"gaussian"===s?function(){let e=a/Math.sqrt(2*Math.PI);t.moveTo(0,200);let r=[];for(let o=0;o<=n.width;o+=1){let n=200-100*Math.exp(-(.5*((o-i)/e)**2));r.push(n),t.lineTo(o,n)}t.lineTo(n.width,200),t.lineTo(0,200)}():t.rect(i-.5*a,100,a,100)}t.beginPath(),c(),t.stroke(),t.restore()}}function nc(e,t,n){let i,r,o;this.update=function(n){let{rankings:a}=n;if(o=n.cells,void 0===a||void 0===o){let n=(i=t.getEntities()).map(e=>[e.shape2.x,e.shape2.y]),r=eN(e.shape2,n,3);a=r.rankings,o=r.cells}let s=(i=t.getEntities()).length,l=o.length;r=Array(l);let c=i.map(e=>e.colorRGBA);for(let e=0;e<l;e++){let t=a[e].map(e=>s-e);r[e]=t6(t4(t,c))}},this.render=function(){let{ctx:t}=n,{x:i,y:a,w:s}=e.shape2;t.save();let l=o.length;for(let e=0;e<l;e++)t.beginPath(),function(e,t){let n=t.length,i=t[n-1];e.moveTo(i[0],i[1]);for(let i=0;i<n;i++){let n=t[i];e.lineTo(n[0],n[1])}}(t,o[e]),t.fillStyle=r[e],t.strokeStyle=r[e],t.fill(),t.stroke();t.strokeStyle="#222",t.beginPath(),t.arc(i,a,.5*s,0,2*Math.PI),t.stroke(),t.restore()}}function nh(e,t,n,i,r){let{dimensions:o}=r,a=1===o?nl:nc;e.setRenderer(e=>new a(e,t,n)),this.enter=()=>{},this.exit=()=>{},this.update=function(t){let{error:n}=t;if(void 0!==n)return;let{votesByGeom:i}=t.votes;e.updateGraphic(i)},this.render=function(){e.render()}}function nu(e){return e.scoreVote?"scoreVote":e.bordaFractions?"bordaFractions":e.pluralityAllocation?"pluralityAllocation":null}function nd(e,t){let n,i;function r(e,r,o){let{grid:a,voteSet:s}=n,{x:l,w:c,densityProfile:h}=a.voterGeom,u=i.length,d="gaussian"===h,p=a.x,f=c/Math.sqrt(2*Math.PI),m=200/u,g=200-r*m,y=Math.max(-1,p[0]);e.moveTo(y,g);let v=p.length,w=nu(s[0]);for(let n=0;n<v;n+=1){let i=p[n];if(i<-1||i>t.width)continue;let a=g-m*(d?Math.exp(-.5*((i-l)/f)**2):1)*(o?1:s[n][w][r]);e.lineTo(i,a)}let x=Math.min(t.width,p[v-1]);e.lineTo(x,g),e.lineTo(y,g)}this.update=t=>{n=t,i=e.getEntities()},this.renderBackground=function(){let{ctx:e}=t;e.save(),e.globalAlpha=.7;let n=i.length;for(let t=0;t<n;t++)e.strokeStyle="#dddddd",e.beginPath(),r(e,t,!0),e.stroke();e.restore()},this.render=function(){let{ctx:e}=t;e.save(),e.globalAlpha=.7;let n=i.length;for(let t=0;t<n;t++){e.fillStyle=i[t].color;let{colorRGBA:n}=i[t];e.strokeStyle=t6(t4([.5,.5],[n,[0,0,0]])),e.beginPath(),r(e,t,!1),e.fill(),e.stroke()}e.restore()}}function np(e,t,n){let i,r,o;let a=[];this.update=t=>{i=t,r=e.getEntities();let{grid:s,voteSet:l}=i,{densityProfile:c}=s.voterGeom,h=Math.floor((r.length-1)/3)+1;n.setHeight(1/3*h*n.common.height);let u="gaussian"===c;(function(){let{nx:e,ny:t,density:n}=s;a.splice(0);let i=nu(l[0]);for(let o=0;o<r.length;o++){let s=document.createElement("canvas");s.width=e,s.height=t;let c=s.getContext("2d"),h=c.createImageData(e,t),{data:d}=h,{colorRGBA:p}=r[o],[f,m,g]=p,y=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){let a=l[y][i][o]*(u?n[y]:1)*255;d[(t+r*e)*4+0]=f,d[(t+r*e)*4+1]=m,d[(t+r*e)*4+2]=g,d[(t+r*e)*4+3]=a,y+=1}a.push(s),c.putImageData(h,0,0)}})(),function(){let{nx:e,ny:t,density:n}=s,i=r.map(e=>e.colorRGBA),a=document.createElement("canvas");a.width=e,a.height=t;let c=a.getContext("2d"),h=c.createImageData(e,t),{data:d}=h,p=nu(l[0]),f=0;for(let r=0;r<t;r++)for(let t=0;t<e;t++){let[o,a,s]=t4(l[f][p],i),c=(u?n[f]:1)*255;d[(t+r*e)*4+0]=o,d[(t+r*e)*4+1]=a,d[(t+r*e)*4+2]=s,d[(t+r*e)*4+3]=c,f+=1}o=a,c.putImageData(h,0,0)}()},this.render=function(){let{width:e,voterGeom:s}=i.grid,{x:l,y:c,w:h,densityProfile:u}=s;(function(){let{ctx:n}=t,{darkMode:i}=t.common;n.save(),n.beginPath(),n.arc(l,c,.5*e,0,2*Math.PI),n.clip();let r=o;n.imageSmoothingEnabled=!1;let a={x:l-.5*e+0,y:c-.5*e+0,w:1*e,h:1*e};n.drawImage(r,a.x,a.y,a.w,a.h),"gaussian"===u&&(n.setLineDash([1,9]),n.lineWidth=5),n.strokeStyle="#555",i&&(n.strokeStyle="#ddd"),n.beginPath(),n.arc(l,c,.5*h,0,2*Math.PI),n.stroke(),n.restore()})(),function(){let{ctx:t}=n,{darkMode:i}=n.common,o=r.length;for(let n=0;n<o;n++){t.save();let r={w:1/3,h:1/3,x:n%3*100,y:100*Math.floor(n/3)},o={x:l*r.w+r.x,y:c*r.h+r.y,r:h*r.w*.5},s={x:l*r.w+r.x,y:c*r.h+r.y,r:e*r.w*.5};t.beginPath(),t.arc(s.x,s.y,s.r,0,2*Math.PI),t.clip(),t.beginPath(),t.rect(r.x,r.y,100,100),t.clip();let d=a[n],p={x:l*r.w-e*r.w*.5+r.x,y:c*r.w-e*r.w*.5+r.y,w:e*r.w,h:e*r.h};t.drawImage(d,p.x,p.y,p.w,p.h),"gaussian"===u&&(t.setLineDash([1/3,3]),t.lineWidth=5/3),t.strokeStyle="#555",i&&(t.strokeStyle="#ddd"),t.beginPath(),t.arc(o.x,o.y,o.r,0,2*Math.PI),t.stroke(),t.restore()}}()}}function nf(e,t,n,i,r){let{dimensions:o}=r,a=1===o?nd:np;e.setRenderer(()=>new a(t,n,i)),this.enter=function(){2===o&&i.show()},this.exit=function(){i.hide()},this.update=function(t){let{error:n}=t;if(void 0!==n)return;let{votesByGeom:i}=t.votes;e.updateGraphic(i)},this.render=function(){1===o&&e.renderBackground(),e.render()}}function nm(){let e=this;e.list=[],e.updateNewG=t=>{e.add(t)},e.add=t=>{let n={};t.voterShape?(n.g=t.graphic.circle,n.r=t.graphic,n.o=t.voterShape,n.p={isCircle:!0}):t.candidate?(n.g=t.graphic.square,n.r=t.graphic,n.o=t.candidate,n.p={isSquare:!0}):t.canDn?(n.g=t.graphic.square,n.r=t.graphic,n.o=t.canDn,n.p={isSquare:!0}):(n.g=t.graphic.circle,n.r=t.graphic,n.o=t.testVoter,n.p={isCircle:!0}),e.list.push(n)}}function ng(e,t,n,i,r){let o,a;let s={},l=e.list,c=n.tooltips,h=function(e){if(null!==e.target.closest(".tooltipBox"))return;let t=m(e),n=e.isTouch?10:0,i=l.length,h=[];for(let e=0;e<i;e++){let i=l[e];(i.o.exists||r.showGhosts)&&g(i,t,n)&&h.push(e)}if(h.length>0){let e=f(h.map(e=>{let n=l[e];return(n.r.x-t.x)**2+(n.r.y-t.y)**2})),n=h[e],i=l[n];s.iDragging=n,s.isDragging=!0,s.offX=i.r.x-t.x,s.offY=i.r.y-t.y,i.g.pickUp(),c.dataset.cursor="grabbing"}o=!0,a={...t}},u=function(e){let t=m(e);if(s.isDragging){var h,u,d,p,f,y;e.isTouch&&(e.preventDefault(),e.stopPropagation());let r=l[s.iDragging],o=n.width,a=n.height;r.r.setXYView({x:(h=t.x+s.offX,u=0,d=o,h<0?u:h>d?d:h),y:(p=t.y+s.offY,f=0,y=a,p<0?f:p>y?y:p)}),i.add(["draggables"])}else{let e=l.length;for(let n=0;n<e;n++){let e=l[n];if((r.showGhosts||e.o.exists)&&g(e,t,0)){c.dataset.cursor="grab";return}}c.dataset.cursor=""}!function(e){if(o){let t=Math.abs(a.x-e.x),n=Math.abs(a.y-e.y);t>5&&(o=!1),n>5&&(o=!1)}}(t)},d=function(){o&&(o=!1,s.isDragging?l[s.iDragging].r.click():t.clickEmpty(a)),void 0!==s.iDragging&&l[s.iDragging].g.drop(),s={}};function p(e){return e.isTouch=!0,e}function m(e){let t=n.wrap.getBoundingClientRect(),i=e.isTouch?e.changedTouches[0]:e;return{x:i.clientX-t.left,y:i.clientY-t.top}}function g(e,t,n){let i=e.r.x-t.x,r=e.r.y-t.y;if(e.p.isCircle){let{r:t}=e.g;return i*i+r*r<(t+n)*(t+n)}if(e.p.isSquare){let{w:t,h:o}=e.g;return Math.abs(i)<.5*t+n&&Math.abs(r)<.5*o+n}return!1}this.eventHandlers={start:h,move:u,end:d,touchmove:e=>{u(p(e))},touchstart:e=>{h(p(e))},touchend:e=>{let t=p(e);u(t),d(t),null===e.target.closest(".tooltipBox")&&e.preventDefault()}}}function ny(e,t,n){let i=this;i.dragm=new nm,i.clickDrag=new ng(i.dragm,i,e,t,n),i.enter=()=>{e.eventHandlers.set(i.clickDrag.eventHandlers)},i.exit=()=>{},i.update=()=>{if(t.checkNone())return;e.clear();let[n,i]=[150,150];$("Not Yet Implemented",n,i,20,2,"#222",1,e.ctx)},i.render=()=>{},i.renderForeground=()=>{},i.testVoteView=()=>null}function nv(e){let t=this;t.voterShape=e,t.setRenderer=n=>{t.renderer=n(e)}}function nw(e){let t=this,n=[];t.list=n,t.rendererMaker=()=>({render:()=>{}}),e.attachNewE(t),t.updateNewE=e=>{t.newVoterShape(e)},t.newVoterShape=function(e){let i=new nv(e);n.push(i),i.setRenderer(t.rendererMaker)},t.getVoterShapes=()=>n.filter(e=>e.voterShape.exists).map(e=>e.voterShape),t.getVoterRenderers=()=>n.filter(e=>e.voterShape.exists),t.setRenderer=e=>{t.rendererMaker=e,n.forEach(t=>t.setRenderer(e))},t.updateGraphic=e=>{let n=t.getVoterRenderers();void 0===e?n.forEach(e=>e.renderer.update()):n.forEach((t,n)=>t.renderer.update(e[n]))},t.render=()=>{n.forEach(e=>{e.voterShape.exists&&e.renderer.render()})},t.renderBackground=()=>{n.forEach(e=>{e.voterShape.exists&&e.renderer.renderBackground()})}}function nx(e){return e.some(e=>e.strategy.some(e=>"closest"!==e.actionName&&0!==e.actionWeight))}function n_(e,t,n,i,r,o,a,s,l){let c;let h=this;s.viewModes.one.attach(h),ny.call(h,t,r,l);let{candidateList:u,voterShapeList:d}=e,p=new nw(d);function f(){let e=a.getOptions(),{voteCasterName:i}=t9(e,o),{dimensions:r}=o,s=d.getGeoms(r).some(e=>"gaussian"===e.densityProfile)&&2===r,l=function(e,t,n){let i;let{sequenceOptions:r}=e,{sequenceName:o}=e.sequenceOptions,{resultsPhaseBySeq:a}=n,s=a[o],l=t.getVoterStrategyListByPhase(r)[s];if("closedPrimary"===o){let{resultsPartyBySeq:e}=n,t=e[s];i=nx(l.filter(e=>e.party===t))}else i=nx(l);return i}(e,d,o);c=new(!0===e.useGeography?nr:s||l||"score"===i||"scoreFull"===i?nf:"ranking"===i||"pairwise"===i?nh:ns)(p,u,t,n,o)}f(),h.enter=()=>{f(),c.enter()},h.exit=()=>{c.exit()},h.update=e=>{if(!r.checkNone()){if(r.check(["numDistricts","numTracts","dimensions","socialChoiceMethod","densityProfile","strategyRules","resultsPhase","resultsParty","sequenceName"])&&(h.exit(),h.enter()),!0===a.getOptions().useGeography){let{geoResults:t}=e;c.update(t)}else{let t=t7(e.geoResults.scResultsByDistrict[0],o);c.update(t)}h.clear(),h.render()}},h.render=()=>{c.render()},h.clear=()=>{t.clear(),n.clear()}}function nb(e,t,n,i,r){let{width:o}=n,a=Array(o).fill(0),s=0,{dimensions:l}=r,c=1===l?nn:ni;e.setRenderer(e=>new c(e,n)),t.setRenderer(e=>new c(e,n)),this.update=function(e){i.checkAny()&&(a.fill(0),s=0);let{pointsChanged:t,samplingPointsList:n,samplingPointsCount:r}=e;t&&function(e,t){let n=e.length;for(let r=0;r<n;r++){let n=e[r][0],l=t[r];for(let e=0;e<o;e++){var i;a[e]+=((i=e-n)>20||i<-20?0:(1-(.05*i)**2)*.05)*l}s+=h*l}}(n,r)};let h=4/3;this.render=()=>{(function(){let{ctx:e}=n;e.save(),e.beginPath(),function(e){let t=1/s;e.moveTo(0,200);let i=[];for(let n=0;n<=o;n+=1){let r=200-1e4*a[n]*t;i.push(r),e.lineTo(n,r)}e.lineTo(n.width,200),e.lineTo(0,200)}(e),e.strokeStyle="#ccc",e.stroke(),e.fillStyle="#ccc",e.fill(),e.restore()})(),e.render(),t.render()}}var nC=Math.sqrt(50),nS=Math.sqrt(10),nP=Math.sqrt(2);function nk(e,t,n){var i=Math.abs(t-e)/Math.max(0,n),r=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),o=i/r;return o>=nC?r*=10:o>=nS?r*=5:o>=nP&&(r*=2),t<e?-r:r}var nM=Array.prototype.slice;function nA(e,t,n){for(var i=e.width,r=e.height,o=(n<<1)+1,a=0;a<r;++a)for(var s=0,l=0;s<i+n;++s)s<i&&(l+=e.data[s+a*i]),s>=n&&(s>=o&&(l-=e.data[s-o+a*i]),t.data[s-n+a*i]=l/Math.min(s+1,i-1+o-s,o))}function nE(e,t,n){for(var i=e.width,r=e.height,o=(n<<1)+1,a=0;a<i;++a)for(var s=0,l=0;s<r+n;++s)s<r&&(l+=e.data[a+s*i]),s>=n&&(s>=o&&(l-=e.data[a+(s-o)*i]),t.data[a+(s-n)*i]=l/Math.min(s+1,r-1+o-s,o))}var nT=e=>()=>e;function nN(e){return Math.ceil(Math.log(function(e,t){let n=0;for(let t of e)null!=t&&(t=+t)>=t&&++n;return n}(e))/Math.LN2)+1}function nD(e,t){return e-t}function nO(){}var nL=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function nB(e){return e[0]}function nR(e){return e[1]}function nF(){return 1}var nV=e=>e;function nq(e,t){e&&nI.hasOwnProperty(e.type)&&nI[e.type](e,t)}var nG={Feature:function(e,t){nq(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)nq(n[i].geometry,t)}},nI={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){nj(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)nj(n[i],t,0)},Polygon:function(e,t){nW(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)nW(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)nq(n[i],t)}};function nj(e,t,n){var i,r=-1,o=e.length-n;for(t.lineStart();++r<o;)i=e[r],t.point(i[0],i[1],i[2]);t.lineEnd()}function nW(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)nj(e[n],t,1);t.polygonEnd()}function nz(e,t){e&&nG.hasOwnProperty(e.type)?nG[e.type](e,t):nq(e,t)}class nU{constructor(){this._partials=new Float64Array(32),this._n=0}add(e){let t=this._partials,n=0;for(let i=0;i<this._n&&i<32;i++){let r=t[i],o=e+r,a=Math.abs(e)<Math.abs(r)?e-(o-r):r-(o-e);a&&(t[n++]=a),e=o}return t[n]=e,this._n=n+1,this}valueOf(){let e=this._partials,t=this._n,n,i,r,o=0;if(t>0){for(o=e[--t];t>0&&(o=(n=o)+(i=e[--t]),!(r=i-(o-n))););t>0&&(r<0&&e[t-1]<0||r>0&&e[t-1]>0)&&(n=o+(i=2*r),i==n-o&&(o=n))}return o}}var n$=2*Math.PI,nH=Math.abs,nX=Math.sqrt;function nY(){}var nJ,nK,nZ,nQ,n0,n1,n2,n5,n3,n4=new nU,n6=new nU,n8={point:nY,lineStart:nY,lineEnd:nY,polygonStart:function(){n8.lineStart=n9,n8.lineEnd=it},polygonEnd:function(){n8.lineStart=n8.lineEnd=n8.point=nY,n4.add(nH(n6)),n6=new nU},result:function(){var e=n4/2;return n4=new nU,e}};function n9(){n8.point=n7}function n7(e,t){n8.point=ie,n1=n5=e,n2=n3=t}function ie(e,t){n6.add(n3*e-n5*t),n5=e,n3=t}function it(){ie(n1,n2)}var ii,ir,io,ia,is=1/0,il=1/0,ic=-1/0,ih=ic,iu={point:function(e,t){e<is&&(is=e),e>ic&&(ic=e),t<il&&(il=t),t>ih&&(ih=t)},lineStart:nY,lineEnd:nY,polygonStart:nY,polygonEnd:nY,result:function(){var e=[[is,il],[ic,ih]];return ic=ih=-(il=is=1/0),e}},id=0,ip=0,im=0,ig=0,iy=0,iv=0,iw=0,ix=0,i_=0,ib={point:iC,lineStart:iS,lineEnd:iM,polygonStart:function(){ib.lineStart=iA,ib.lineEnd=iE},polygonEnd:function(){ib.point=iC,ib.lineStart=iS,ib.lineEnd=iM},result:function(){var e=i_?[iw/i_,ix/i_]:iv?[ig/iv,iy/iv]:im?[id/im,ip/im]:[NaN,NaN];return id=ip=im=ig=iy=iv=iw=ix=i_=0,e}};function iC(e,t){id+=e,ip+=t,++im}function iS(){ib.point=iP}function iP(e,t){ib.point=ik,iC(io=e,ia=t)}function ik(e,t){var n=e-io,i=t-ia,r=nX(n*n+i*i);ig+=r*(io+e)/2,iy+=r*(ia+t)/2,iv+=r,iC(io=e,ia=t)}function iM(){ib.point=iC}function iA(){ib.point=iT}function iE(){iN(ii,ir)}function iT(e,t){ib.point=iN,iC(ii=io=e,ir=ia=t)}function iN(e,t){var n=e-io,i=t-ia,r=nX(n*n+i*i);ig+=r*(io+e)/2,iy+=r*(ia+t)/2,iv+=r,iw+=(r=ia*e-io*t)*(io+e),ix+=r*(ia+t),i_+=3*r,iC(io=e,ia=t)}function iD(e){this._context=e}iD.prototype={_radius:4.5,pointRadius:function(e){return this._radius=e,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._context.moveTo(e,t),this._point=1;break;case 1:this._context.lineTo(e,t);break;default:this._context.moveTo(e+this._radius,t),this._context.arc(e,t,this._radius,0,n$)}},result:nY};var iO,iL,iB,iR,iF,iV=new nU,iq={point:nY,lineStart:function(){iq.point=iG},lineEnd:function(){iO&&iI(iL,iB),iq.point=nY},polygonStart:function(){iO=!0},polygonEnd:function(){iO=null},result:function(){var e=+iV;return iV=new nU,e}};function iG(e,t){iq.point=iI,iL=iR=e,iB=iF=t}function iI(e,t){iR-=e,iF-=t,iV.add(nX(iR*iR+iF*iF)),iR=e,iF=t}function ij(){this._string=[]}function iW(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function iz(e,t,n,i,r){let o,a;let s=this,{dimensions:l}=r,c=1===l?nn:ni;e.setRenderer(e=>new c(e,n)),t.setRenderer(e=>new c(e,n));let h=[],u=[];s.update=function(e){i.checkAny()&&(h.splice(0,h.length),u.splice(0,u.length),o=0);let{pointsChanged:t,samplingPointsList:n,samplingPointsCount:r}=e;t&&(s.updatePoints(n,r),s.updateDensity())},s.render=()=>{s.renderCans(),e.render(),t.render()},s.updatePoints=function(e,t){for(let n=0;n<e.length;n++){let i=e[n],r=t[n];h.push(i),u.push(r),o+=r}},s.updateDensity=()=>{let e=o/1e4,t=p(20).map(t=>t*e);a=(function(){var e=nB,t=nR,n=nF,i=960,r=500,o=20,a=2,s=60,l=270,c=155,h=nT(20);function u(i){var r=new Float32Array(l*c),u=new Float32Array(l*c),p=Math.pow(2,-a);i.forEach(function(i,o,a){var h=(e(i,o,a)+s)*p,u=(t(i,o,a)+s)*p,d=+n(i,o,a);if(h>=0&&h<l&&u>=0&&u<c){var f=Math.floor(h),m=Math.floor(u),g=h-f-.5,y=u-m-.5;r[f+m*l]+=(1-g)*(1-y)*d,r[f+1+m*l]+=g*(1-y)*d,r[f+1+(m+1)*l]+=g*y*d,r[f+(m+1)*l]+=(1-g)*y*d}}),nA({width:l,height:c,data:r},{width:l,height:c,data:u},o>>a),nE({width:l,height:c,data:u},{width:l,height:c,data:r},o>>a),nA({width:l,height:c,data:r},{width:l,height:c,data:u},o>>a),nE({width:l,height:c,data:u},{width:l,height:c,data:r},o>>a),nA({width:l,height:c,data:r},{width:l,height:c,data:u},o>>a),nE({width:l,height:c,data:u},{width:l,height:c,data:r},o>>a);var f=h(r);if(!Array.isArray(f)){var m=function(e,t){let n;for(let t of e)null!=t&&(n<t||void 0===n&&t>=t)&&(n=t);return n}(r);f=nk(0,m,f),(f=function(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=0|Math.max(0,Math.ceil((t-e)/n)),o=Array(r);++i<r;)o[i]=e+i*n;return o}(0,Math.floor(m/f)*f,f)).shift()}return(function(){var e=1,t=1,n=nN,i=s;function r(e){var t=n(e);if(Array.isArray(t))t=t.slice().sort(nD);else{let n=function(e,t){let n,i;for(let t of e)null!=t&&(void 0===n?t>=t&&(n=i=t):(n>t&&(n=t),i<t&&(i=t)));return[n,i]}(e),i=nk(n[0],n[1],t);t=function(e,t,n){var i,r,o,a,s,l,c,h=-1;if(n=+n,(e=+e)==(t=+t)&&n>0)return[e];if((a=t<e)&&(s=e,e=t,t=s),0==(r=Math.floor(Math.log(i=(t-e)/Math.max(0,n))/Math.LN10),o=i/Math.pow(10,r),c=r>=0?(o>=nC?10:o>=nS?5:o>=nP?2:1)*Math.pow(10,r):-Math.pow(10,-r)/(o>=nC?10:o>=nS?5:o>=nP?2:1))||!isFinite(c))return[];if(c>0){let n=Math.round(e/c),i=Math.round(t/c);for(n*c<e&&++n,i*c>t&&--i,l=Array(s=i-n+1);++h<s;)l[h]=(n+h)*c}else{let n=Math.round(e*(c=-c)),i=Math.round(t*c);for(n/c<e&&++n,i/c>t&&--i,l=Array(s=i-n+1);++h<s;)l[h]=(n+h)/c}return a&&l.reverse(),l}(Math.floor(n[0]/i)*i,Math.floor(n[1]/i-1)*i,t)}return t.map(t=>o(e,t))}function o(n,r){var o=[],s=[];return function(n,i,r){var o,s,l,c,h,u,d=[],p=[];for(o=s=-1,nL[(c=n[0]>=i)<<1].forEach(f);++o<e-1;)nL[(l=c)|(c=n[o+1]>=i)<<1].forEach(f);for(nL[c<<0].forEach(f);++s<t-1;){for(o=-1,nL[(c=n[s*e+e]>=i)<<1|(h=n[s*e]>=i)<<2].forEach(f);++o<e-1;)l=c,c=n[s*e+e+o+1]>=i,u=h,nL[l|c<<1|(h=n[s*e+o+1]>=i)<<2|u<<3].forEach(f);nL[c|h<<3].forEach(f)}for(o=-1,nL[(h=n[s*e]>=i)<<2].forEach(f);++o<e-1;)u=h,nL[(h=n[s*e+o+1]>=i)<<2|u<<3].forEach(f);function f(e){var t,n,i=[e[0][0]+o,e[0][1]+s],l=[e[1][0]+o,e[1][1]+s],c=a(i),h=a(l);(t=p[c])?(n=d[h])?(delete p[t.end],delete d[n.start],t===n?(t.ring.push(l),r(t.ring)):d[t.start]=p[n.end]={start:t.start,end:n.end,ring:t.ring.concat(n.ring)}):(delete p[t.end],t.ring.push(l),p[t.end=h]=t):(t=d[h])?(n=p[c])?(delete d[t.start],delete p[n.end],t===n?(t.ring.push(l),r(t.ring)):d[n.start]=p[t.end]={start:n.start,end:t.end,ring:n.ring.concat(t.ring)}):(delete d[t.start],t.ring.unshift(i),d[t.start=c]=t):d[c]=p[h]={start:c,end:h,ring:[i,l]}}nL[h<<3].forEach(f)}(n,r,function(e){i(e,n,r),function(e){for(var t=0,n=e.length,i=e[n-1][1]*e[0][0]-e[n-1][0]*e[0][1];++t<n;)i+=e[t-1][1]*e[t][0]-e[t-1][0]*e[t][1];return i}(e)>0?o.push([e]):s.push(e)}),s.forEach(function(e){for(var t,n=0,i=o.length;n<i;++n)if(-1!==function(e,t){for(var n,i=-1,r=t.length;++i<r;)if(n=function(e,t){for(var n=t[0],i=t[1],r=-1,o=0,a=e.length,s=a-1;o<a;s=o++){var l=e[o],c=l[0],h=l[1],u=e[s],d=u[0],p=u[1];if(function(e,t,n){var i,r,o,a;return(t[0]-e[0])*(n[1]-e[1])==(n[0]-e[0])*(t[1]-e[1])&&(r=e[i=+(e[0]===t[0])],o=n[i],a=t[i],r<=o&&o<=a||a<=o&&o<=r)}(l,u,t))return 0;h>i!=p>i&&n<(d-c)*(i-h)/(p-h)+c&&(r=-r)}return r}(e,t[i]))return n;return 0}((t=o[n])[0],e)){t.push(e);return}}),{type:"MultiPolygon",value:r,coordinates:o}}function a(t){return 2*t[0]+t[1]*(e+1)*4}function s(n,i,r){n.forEach(function(n){var o,a=n[0],s=n[1],l=0|a,c=0|s,h=i[c*e+l];a>0&&a<e&&l===a&&(o=i[c*e+l-1],n[0]=a+(r-o)/(h-o)-.5),s>0&&s<t&&c===s&&(o=i[(c-1)*e+l],n[1]=s+(r-o)/(h-o)-.5)})}return r.contour=o,r.size=function(n){if(!arguments.length)return[e,t];var i=Math.floor(n[0]),o=Math.floor(n[1]);if(!(i>=0&&o>=0))throw Error("invalid size");return e=i,t=o,r},r.thresholds=function(e){return arguments.length?(n="function"==typeof e?e:Array.isArray(e)?nT(nM.call(e)):nT(e),r):n},r.smooth=function(e){return arguments.length?(i=e?s:nO,r):i===s},r})().thresholds(f).size([l,c])(r).map(d)}function d(e){return e.value*=Math.pow(2,-2*a),e.coordinates.forEach(p),e}function p(e){e.forEach(f)}function f(e){e.forEach(m)}function m(e){e[0]=e[0]*Math.pow(2,a)-s,e[1]=e[1]*Math.pow(2,a)-s}function g(){return l=i+2*(s=3*o)>>a,c=r+2*s>>a,u}return u.x=function(t){return arguments.length?(e="function"==typeof t?t:nT(+t),u):e},u.y=function(e){return arguments.length?(t="function"==typeof e?e:nT(+e),u):t},u.weight=function(e){return arguments.length?(n="function"==typeof e?e:nT(+e),u):n},u.size=function(e){if(!arguments.length)return[i,r];var t=+e[0],n=+e[1];if(!(t>=0&&n>=0))throw Error("invalid size");return i=t,r=n,g()},u.cellSize=function(e){if(!arguments.length)return 1<<a;if(!((e=+e)>=1))throw Error("invalid cell size");return a=Math.floor(Math.log(e)/Math.LN2),g()},u.thresholds=function(e){return arguments.length?(h="function"==typeof e?e:Array.isArray(e)?nT(nM.call(e)):nT(e),u):h},u.bandwidth=function(e){if(!arguments.length)return Math.sqrt(o*(o+1));if(!((e=+e)>=0))throw Error("invalid bandwidth");return o=Math.round((Math.sqrt(4*e*e+1)-1)/2),g()},u})().x(e=>e[0]).y(e=>e[1]).weight((e,t)=>u[t]).bandwidth(10).thresholds(t)(h)},s.renderCans=()=>{let{ctx:e}=n,{darkMode:t}=n.common,i=(function(e,t){var n,i,r=4.5;function o(e){return e&&("function"==typeof r&&i.pointRadius(+r.apply(this,arguments)),nz(e,n(i))),i.result()}return o.area=function(e){return nz(e,n(n8)),n8.result()},o.measure=function(e){return nz(e,n(iq)),iq.result()},o.bounds=function(e){return nz(e,n(iu)),iu.result()},o.centroid=function(e){return nz(e,n(ib)),ib.result()},o.projection=function(t){return arguments.length?(n=null==t?(e=null,nV):(e=t).stream,o):e},o.context=function(e){return arguments.length?(i=null==e?(t=null,new ij):new iD(t=e),"function"!=typeof r&&i.pointRadius(r),o):t},o.pointRadius=function(e){return arguments.length?(r="function"==typeof e?e:(i.pointRadius(+e),+e),o):r},o.projection(e).context(t)})().context(e);e.save(),e.lineWidth=.5,e.strokeStyle="#aaa";let r=a.length;for(let n=0;n<r;n++){let r=255-10*n,o=t?255-r+33:r;e.fillStyle=`rgba(${o},${o},${o}, 1)`,e.beginPath(),i(a[n]),e.fill()}e.restore()}}function iU(e){let t=this;t.canDn=e,t.setRenderer=n=>{t.renderer=n(e)}}function i$(e){let t=this,n=[];t.rendererMaker=()=>({render:()=>{}}),e.attachNewE(t),t.updateNewE=e=>{t.newCandidateDn(e)},t.newCandidateDn=function(e){let i=new iU(e);n.push(i),i.setRenderer(t.rendererMaker)},t.getCanDnRenderers=()=>n.filter(e=>e.canDn.exists),t.getCandidateDistributions=()=>t.getCanDnRenderers().map(e=>e.canDn),t.getCandidateDistributionsAll=()=>n.map(e=>e.canDn),t.setRenderer=e=>{t.rendererMaker=e,n.forEach(t=>t.setRenderer(e))},t.render=()=>{n.forEach(e=>{e.canDn.exists&&e.renderer.render()})}}function iH(e,t,n,i,r,o,a){let s;let l=this;o.viewModes.sample.attach(l),ny.call(l,t,i,a);let{candidateDnList:c,voterShapeList:h}=e,u=new nw(h),d=new i$(c);function p(){let{dimensions:e}=r;s=new(1===e?nb:iz)(u,d,t,i,r)}p(),l.enter=()=>{p()},l.exit=()=>{},l.update=e=>{i.check(["dimensions"])&&(l.exit(),l.enter());let{samplingResult:t}=e;s.update(t);let{pointsChanged:n}=t;n&&(l.clear(),l.render())},l.render=()=>{s.render()},l.clear=()=>{t.clear()}}function iX(e){let t=this;function n(t,n){let{ctx:i}=e,{centroids:r,polygonAreas:o}=t,a=r[n];$((1e3*o[n]).toFixed(0),a[0],a[1]+.05,.1,.2,"#222",1,i)}t.renderVoronoi=(e,i,r)=>{t.renderVoronoiGeneral(e,0,0,i,r,null,n)},t.renderVoronoiColors=(e,n,i,r,o,a)=>{t.renderVoronoiGeneral(e,n,i,r,o,a,void 0)},t.renderVoronoiGeneral=(t,n,i,r,o,a,s)=>{let{ctx:l}=e,{voronoi:c,nd:h}=t;l.save(),l.translate(n,i),l.scale(r,o);for(let e=0;e<h;e++)l.beginPath(),l.strokeStyle="#333",l.lineWidth=1/r,c.renderCell(e,l),null!==a&&(l.fillStyle=a[e],l.fill()),l.stroke(),void 0!==s&&s(t,e);l.restore()}}function iY(e){let{candidateTallies:t}=e;return t.bordaFractionAverageByCan?t.bordaFractionAverageByCan:t.voteFractionsByCan?t.voteFractionsByCan:t.firstPreferenceFractions?t.firstPreferenceFractions:t.scoreFractionAverageByCan?t.scoreFractionAverageByCan:null}function iJ(e,t,n){let i=document.createElement("canvas");i.width=e,i.height=t;let r=i.getContext("2d"),o=r.createImageData(e,t);this.load=n=>{let{data:i}=o;for(let r=0;r<e;r++)for(let o=0;o<t;o++){let t=n[r][o][0]+.5,a=n[r][o][1]+.5;i[(r+o*e)*4+0]=255*t,i[(r+o*e)*4+1]=(t+a)*200,i[(r+o*e)*4+2]=200*a,i[(r+o*e)*4+3]=255}r.putImageData(o,0,0)},this.loadColors=n=>{let{data:i}=o;for(let r=0;r<t;r++)for(let t=0;t<e;t++){let[o,a,s]=n[t][r];i[(t+r*e)*4+0]=o,i[(t+r*e)*4+1]=a,i[(t+r*e)*4+2]=s,i[(t+r*e)*4+3]=255}r.putImageData(o,0,0)},this.render=(e,t)=>{let{ctx:r}=n;r.save(),r.imageSmoothingEnabled=!1,r.drawImage(i,0,0,e,t),r.restore()}}function iK(e,t,n,i,r){let o;let a=this;a.update=s=>{let{geography:l}=s.geometry;o=l.districtMap,(void 0===a.districtDraw||r.check(["numTracts"]))&&(a.districtDraw=new iX(t),a.mapOfTracts=new iJ(l.nx,l.ny,t));let{colorByTract:c,colorOfVoteByDistrict:h,colorOfWinsByDistrict:u}=function(e,t,n,i){let{votesByTract:r,votesByDistrict:o,scResultsByDistrict:a}=e,s=t.getEntities(),l=function(e,t){let n=t.map(e=>e.colorRGBA);return e.map(e=>e.map(e=>t4(iY(e),n)))}(r,s),c=function(e,t,n,i){let r;let{socialChoiceType:o}=t9(n,i);if("singleWinner"===o)r=e.map(e=>t[e.iWinner].color);else{let n=t.map(e=>e.colorRGBA);r=e.map(e=>{let{allocation:t}=e,i=t.reduce((e,t)=>e+t);return t6(t4(t.map(e=>e/i),n))})}return r}(a,s,n,i);return{colorByTract:l,colorOfVoteByDistrict:o.map(e=>t6(t4(iY(e),s.map(e=>e.colorRGBA)))),colorOfWinsByDistrict:c}}(s,e,n.getOptions(),i);a.colorOfVoteByDistrict=h,a.winnerColors=u,a.mapOfTracts.loadColors(c)},a.render=()=>{a.renderTractVotes(),a.renderDistrictWins(),a.renderDistrictVotes()},a.renderTractVotes=()=>{a.mapOfTracts.render(100,100),a.districtDraw.renderVoronoi(o,100,100)},a.renderDistrictWins=()=>{let{renderVoronoiColors:e}=a.districtDraw;e(o,200,0,100,100,a.winnerColors)},a.renderDistrictVotes=()=>{let{renderVoronoiColors:e}=a.districtDraw;e(o,100,0,100,100,a.colorOfVoteByDistrict)}}function iZ(e,t,n,i,r,o,a){let s=this;a.viewModes.one.attach(s);let l=new tZ(t,a,n,"maps"),{height:c}=t;l.setHeight(c/3),l.hide();let h=new iK(e.candidateList,l,o,r,i),u=!1;s.enter=()=>{o.getOptions().useGeography&&l.show()},s.exit=()=>{l.hide()},s.update=function(e){let t=o.getOptions();i.check(["numDistricts","numTracts"])&&(t.useGeography?l.show():l.hide());let{error:n}=e.geoResults.scResultsByDistrict[0];if(void 0!==n){u=!0;return}u=!1,t.useGeography&&(h.update(e.geoResults),s.clear(),s.render())},s.render=function(){!u&&o.getOptions().useGeography&&h.render()},s.clear=()=>{l.clear()},s.draw=()=>{s.clear(),s.render()}}function iQ(e,t){let n=e=>!!e&&!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length),i=i=>{!e.contains(i.target)&&n(e)&&t()&&r()},r=()=>{document.removeEventListener("mousedown",i),document.removeEventListener("touchstart",i)};document.addEventListener("mousedown",i),document.addEventListener("touchstart",i)}function i0(e,t){let n=document.createElement("div");function i(){let{x:i,y:r}=e;i>.5*t.width?(n.style.right=`${t.width-i}px`,n.style.left="unset"):(n.style.left=`${i}px`,n.style.right="unset"),r>.5*t.height?(n.style.bottom=`${t.height-r}px`,n.style.top="unset"):(n.style.top=`${r}px`,n.style.bottom="unset")}n.className="tooltipBox",n.style.position="absolute",i(),n.style.border=t.common.darkMode?"1px solid white":"1px solid black",n.style.padding="8px",n.style.background=t.common.darkMode?"#222":"white";let r=!1;return iQ(n,()=>!r&&(n.remove(),!0)),{box:n,update:i,setPin:e=>{r=e}}}function i1(e,t,n,i,r,o){let{box:a}=i0(e,n);a.innerText="- Properties -";let s={};s.exists=new i2("checkbox","Exists","Exists: ",e=>t.doSetCommand.exists(e?1:0),1===t.exists),a.appendChild(s.exists.div);let{dimensions:l}=r;if(1===l?(t.shape1.w&&(s.w1=new i2("range","Width","Width: ",e=>t.doSetCommand.shape1w(e),t.shape1.w),a.appendChild(s.w1.div)),t.shape1.densityProfile&&(s.densityProfile1=new i2("select","Density Profile","Density Profile: ",e=>t.doSetCommand.shape1densityProfile(e),t.shape1.densityProfile,{choices:["step","gaussian"]}),a.appendChild(s.densityProfile1.div))):(t.shape2.w&&(s.w2=new i2("range","Width","Width: ",e=>t.doSetCommand.shape2w(e),t.shape2.w),a.appendChild(s.w2.div)),t.shape2.densityProfile&&(s.densityProfile2=new i2("select","Density Profile","Density Profile: ",e=>t.doSetCommand.shape2densityProfile(e),t.shape2.densityProfile,{choices:["step","gaussian"]}),a.appendChild(s.densityProfile2.div))),void 0!==t.doSetCommand.color&&(s.color=new i2("color","Color","Color: ",e=>t.doSetCommand.color(e),t.color),a.appendChild(s.color.div)),void 0!==t.doSetCommand.party&&(s.party=new i2("select","Party","Party: ",e=>t.doSetCommand.party([Number(e)]),t.party,{choices:[0,1,2,3,4,5,6,7,8,9]}),a.appendChild(s.party.div)),void 0!==t.doSetCommand.strategy){let{sequenceName:e,sequences:n}=o.getOptions().sequenceOptions,{phases:i}=n[e];s.strategyByPhase={},Object.keys(i).forEach(e=>{let{voteCasterName:n}=i[e],r={};s.strategyByPhase[e]=r,r.actionPDF1=new i2("range","Action PDF 1","",e=>{let i=Number(e),o=1-i;r.actionPDF1.input.value=i,r.actionPDF2.input.value=o;let a=[i,o],s=y(t.strategyRules),l=z(s,n);for(let e=0;e<a.length;e+=1)l[e].actionWeight=a[e];t.doSetCommand.actionWeight(s)},z(t.strategyRules,n,e)[0].actionWeight,{min:0,max:1,step:.01}),r.actionPDF2=new i2("range","Action PDF 2","",e=>{let i=Number(e),o=1-i;r.actionPDF1.input.value=o,r.actionPDF2.input.value=i;let a=[o,i],s=y(t.strategyRules),l=z(s,n);for(let e=0;e<a.length;e+=1)l[e].actionWeight=a[e];t.doSetCommand.actionWeight(s)},z(t.strategyRules,n,e)[1].actionWeight,{min:0,max:1,step:.01});let o="score"===n?["normalize","normalizeOverFrontrunners"]:["closest","lesserEvil"];r.actionName1=new i2("select","Action 1",`${e}: Strategy 1: `,e=>{let i=y(t.strategyRules);z(i,n)[0].actionName=e,t.doSetCommand.strategy(i)},z(t.strategyRules,n,e)[0].actionName,{choices:o}),r.actionName2=new i2("select","Action 2",`${e}: Strategy 2: `,e=>{let i=y(t.strategyRules);z(i,n)[1].actionName=e,t.doSetCommand.strategy(i)},z(t.strategyRules,n,e)[1].actionName,{choices:o}),r.actionOptionThreshold=new i2("range","Threshold",`${e}: Threshold: `,e=>{let i=y(t.strategyRules),r=z(i,n);r[0].actionOptions.threshold.mean=Number(e),r[1].actionOptions.threshold.mean=Number(e),t.doSetCommand.actionOptionThreshold(i)},z(t.strategyRules,n,e)[0].actionOptions.threshold.mean,{min:0,max:1,step:.01}),a.appendChild(r.actionName1.div),a.appendChild(r.actionPDF1.div),a.appendChild(r.actionName2.div),a.appendChild(r.actionPDF2.div),a.appendChild(r.actionOptionThreshold.div)})}s.showGhosts=new i2("checkbox","Show Ghosts","Show Ghosts: ",e=>i.setShowNonExistingEntities(e),i.showGhosts),a.appendChild(s.showGhosts.div),n.tooltips.appendChild(a)}function i2(e,t,n,i,r,o){let a=this;if(a.div=document.createElement("div"),"select"===e){a.input=document.createElement("select");let{choices:e}=o;for(let t=0;t<e.length;t++){let n=document.createElement("option");n.value=e[t],n.innerText=e[t],a.input.appendChild(n)}a.input.value=r,a.input.addEventListener("input",()=>i(a.input.value))}else a.input=document.createElement("input"),a.input.type=e,a.input.id=t,a.input.name=t,"checkbox"===e?(r&&(a.input.checked=!0),a.input.addEventListener("change",()=>i(a.input.checked))):"range"===e?(a.input.min=1,a.input.max=300,a.input.step=1,void 0!==o&&(void 0!==o.min&&(a.input.min=o.min),void 0!==o.max&&(a.input.max=o.max),void 0!==o.step&&(a.input.step=o.step)),a.input.value=r,a.input.addEventListener("input",()=>i(a.input.value))):"color"===e&&(a.input.value=r,a.input.addEventListener("input",()=>i(a.input.value)));a.label=document.createElement("label"),a.label.for=t,a.label.innerText=n,a.label.style["margin-right"]="4px",a.div.appendChild(a.label),a.div.appendChild(a.input)}function i5(e,t){let n=this;n.setXYView=i=>{let{dimensions:r}=t;1===r?e.doSetCommand.shape1x(i.x):e.doSetCommand.shape2p(i),n.updateViewXY()},n.updateViewXY=()=>{let{dimensions:i}=t;1===i?(n.x=e.shape1.x,n.y=250):(n.x=e.shape2.x,n.y=e.shape2.y)}}function i3(e,t,n,i,r){let o=this;o.w=n,o.h=i,o.trueW=n,o.trueH=i,o.angleFraction=0,o.pickUp=function(){o.tweenSq=new tW.Tween(o,r.tweenGroup),o.tweenSq.to({w:o.trueW+10,h:o.trueH+10},100),o.tweenSq.start()},o.drop=function(){o.tweenSq=new tW.Tween(o,r.tweenGroup),o.tweenSq.to({w:o.trueW,h:o.trueH},100),o.tweenSq.start()},o.win=function(){o.tweenSq=new tW.Tween(o,r.tweenGroup),o.tweenSq.to({angleFraction:.25},300),o.tweenSq.start()},o.lose=function(){o.tweenSq=new tW.Tween(o,r.tweenGroup),o.tweenSq.to({angleFraction:-.25},300),o.tweenSq.start()},o.render=function(){let{fctx:n}=r,{darkMode:i}=r.common;n.save(),o.tweenSq&&o.tweenSq.update(),0===t.exists&&(n.globalAlpha=.2),0!==o.angleFraction&&(n.translate(e.x,e.y),n.rotate(o.angleFraction*Math.PI*2),n.translate(-e.x,-e.y)),n.beginPath(),n.fillStyle=t.color,i&&t.darkModeColor&&(n.fillStyle=t.darkModeColor),i&&(n.strokeStyle="white"),n.rect(e.x-.5*o.w-.5,e.y-.5*o.h-.5,o.w+1,o.h+1),n.fill(),n.stroke(),n.restore()}}function i4(e,t,n,i,r,o,a){let s=this,l=new i3(s,e,n,i,t);s.square=l,i5.call(s,e,o),s.fraction=0,s.setFraction=function(e){s.fraction=e},s.wins=0,s.setWins=e=>{s.wins!==e&&(e>s.wins?l.win():s.wins>e&&l.lose()),s.wins=e},s.renderForeground=function(){l.render();let{exists:n,party:i}=e,{x:r,y:c}=s,{fctx:h}=t,{darkMode:u}=t.common,d=u?"#fff":"#222";if(0===n)return;let p=c-.5*l.h-2;if($(H(s.fraction),r,p,20,2,d,1,h),void 0!==s.wins){let e=c+.5*l.h+20+2;$(s.wins,r,e,20,2,d,1,h)}let{socialChoiceMethod:f}=t9(a.getOptions(),o);"olprA"===f&&$(`p${i}`,r+.1*l.w,c+8,13,2,d,1,h)},s.click=()=>{i1(s,e,t,r,o)}}function i6(e,t,n,i,r,o,a){this.candidate=e,this.graphic=new i4(e,t,n,i,r,o,a)}function i8(e,t,n,i,r){let o=this,a=[],s=[];o.attachNewG=e=>{s.push(e)};let l=e=>{s.forEach(t=>t.updateNewG(e))};t.attachNewE(o),o.updateNewE=e=>{o.newCandidate(e)},o.newCandidate=function(t){let o=new i6(t,n,21,21,e,i,r);a.push(o),l(o)},o.getCanViews=()=>a.filter(e=>e.candidate.exists),o.getCandidates=()=>o.getCanViews().map(e=>e.candidate),o.getCandidatesAll=()=>a.map(e=>e.candidate),o.setCandidateFractions=e=>{o.getCanViews().forEach((t,n)=>{let i=e[n];t.graphic.setFraction(i)})},o.setCandidateWins=e=>{o.getCanViews().forEach((t,n)=>{let i=e[n];t.graphic.setWins(i)})},o.unsetCandidateWins=()=>{let e=Array(a.length).fill(void 0);o.setCandidateWins(e)},o.updateViewXY=()=>{a.forEach(e=>e.graphic.updateViewXY())},o.renderForeground=()=>{e.showGhosts?o.renderForegroundAll():o.renderForegroundExisting()},o.renderForegroundExisting=()=>{o.getCanViews().forEach(e=>e.graphic.renderForeground())},o.renderForegroundAll=()=>{a.forEach(e=>e.graphic.renderForeground())}}ij.prototype={_radius:4.5,_circle:iW(4.5),pointRadius:function(e){return(e=+e)!==this._radius&&(this._radius=e,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(e,t){switch(this._point){case 0:this._string.push("M",e,",",t),this._point=1;break;case 1:this._string.push("L",e,",",t);break;default:null==this._circle&&(this._circle=iW(this._radius)),this._string.push("M",e,",",t,this._circle)}},result:function(){if(!this._string.length)return null;var e=this._string.join("");return this._string=[],e}};var tW=(o("79Zf3"),o("79Zf3"));function i9(e,t,n,i){let r=this;r.r=n,r.trueR=n,r.pickUp=function(){r.tween=new tW.Tween(r,i.tweenGroup),r.tween.to({r:2*r.trueR},100),r.tween.start()},r.drop=function(){r.tween=new tW.Tween(r,i.tweenGroup),r.tween.to({r:r.trueR},100),r.tween.start()},r.render=function(){let{fctx:n}=i,{darkMode:o}=i.common,{color:a}=t;n.save(),r.tween&&r.tween.update(),0===t.exists&&(n.globalAlpha=.2),n.beginPath(),n.fillStyle=a,o&&(n.strokeStyle="white"),n.arc(e.x,e.y,r.r,0,2*Math.PI),n.fill(),n.stroke(),n.restore()}}function i7(e,t,n,i,r){let o=this,a=new i9(o,e,13,t);o.circle=a,i5.call(o,e,i),o.renderForeground=()=>{a.render()},o.setRenderer=t=>{o.renderer=t(e)},o.click=()=>{i1(o,e,t,n,i,r)}}function re(e,t,n,i,r){this.voterShape=e,this.graphic=new i7(e,t,n,i,r)}function rt(e,t,n,i,r){let o=this,a=[];o.list=a;let s=[];o.attachNewG=e=>{s.push(e)};let l=e=>{s.forEach(t=>t.updateNewG(e))};t.attachNewE(o),o.updateNewE=e=>{o.newVoterShape(e)},o.newVoterShape=function(t){let o=new re(t,n,e,i,r);a.push(o),l(o)},o.getVoterShapes=()=>a.filter(e=>e.voterShape.exists).map(e=>e.voterShape),o.getVoterViews=()=>a.filter(e=>e.voterShape.exists),o.updateViewXY=()=>{a.forEach(e=>e.graphic.updateViewXY())},o.renderForeground=()=>{e.showGhosts?o.renderForegroundAll():o.renderForegroundExisting()},o.renderForegroundExisting=()=>{a.forEach(e=>{e.voterShape.exists&&e.graphic.renderForeground()})},o.renderForegroundAll=()=>{a.forEach(e=>{e.graphic.renderForeground()})}}function rn(e){let t=document.createElement("div");e.append(t),this.update=(e,n)=>{let i=e=>`<span style="color:${e};">&#9632;</span>`;if(e.ranking)t.innerHTML=e.ranking.map((e,t)=>i(n[t])+e).join("<br />");else{let r=nu(e),o=e[r];t.innerHTML=o.map(H).map((e,t)=>i(n[t])+e).join("<br />")}}}function ri(e,t,n,i,r){let o=this;function a(){e.doSetCommand.exists(0)}o.start=n=>{e.doSetCommand.exists(1),o.setXYView(n),iQ(t.wrap,a)};let s=new i9(o,e,9,t);o.circle=s,i5.call(o,e,n);let l={};o.update=(t,n)=>{if(void 0===t)return null;let i=n.getEntities(),r=i.map(e=>e.color),a=i.map(e=>e.colorRGBA);o.colorSet=r;let s=nu(t),c=t6(t4(t[s],a));return e.doSetCommand.color(c),l.box&&l.update(t,o.colorSet),t},o.click=()=>{let n=i.testVoteView();null!==n&&(l.box&&l.box.remove(),(l=function(e,t,n){let i=i0(e,n),{box:r,setPin:o}=i;r.innerText="Vote",r.style["min-width"]="100px";let a=document.createElement("button");a.style["min-width"]="35px",a.style.float="right",a.style.clear="right",a.onclick=()=>{l()};let s=!0;function l(){o(s=!s),a.innerHTML=s?"&#x1F6AB;":"&#x1F4CC;"}l();let c=document.createElement("button");c.style.float="right",c.style["min-width"]="35px",c.style["font-size"]="10px",c.innerHTML="&#x2573;",c.onclick=()=>{r.remove(),t.doSetCommand.exists(0)},r.appendChild(c),r.appendChild(a);let h=new rn(r);return n.tooltips.appendChild(r),{box:r,update:function(e,t,n){i.update(),h.update(e,t,n)}}}(o,e,t)).update(n,o.colorSet))},o.renderForeground=()=>{(e.exists||r.showGhosts)&&s.render()}}function rr(e){let t=this;t.shape1={},t.shape2={},t.setAction={exists(e){t.exists=e},shape2p(n){t.shape2.x=n.x,t.shape2.y=n.y,e.testVoteView()},shape1x(n){t.shape1.x=n,e.testVoteView()},color(e){t.color=e}},t.doSetCommand=t.setAction,t.doSetCommand.shape1x(0),t.doSetCommand.shape2p({x:0,y:0}),t.doSetCommand.color("#999")}function ro(e,t,n,i){this.testVoter=new rr(n),this.graphic=new ri(this.testVoter,e,t,n,i),n.dragm.add(this)}function ra(e,t,n,i,r,o,a,s,l){let c=this;a.viewModes.one.attach(c),ny.call(c,t,i,s);let{candidateList:h,voterShapeList:u}=e,d=new i8(s,h,t,r,o),f=new rt(s,u,t,r,o);d.attachNewG(c.dragm),f.attachNewG(c.dragm),c.testVoterView=new ro(t,r,c,s),c.exit=()=>{d.unsetCandidateWins(),c.testVoterView.testVoter.doSetCommand.exists(0)},c.update=e=>{i.checkNone()||(i.check(["dimensions"])&&(c.exit(),c.enter()),i.check(["draggables","dimensions","mode"])&&(f.updateViewXY(),d.updateViewXY(),c.testVoterView.graphic.updateViewXY()),function(e,t,n,i){let{geoResults:r}=t;if(r.error)return;let o=!0===i.useGeography?r:t7(r.scResultsByDistrict[0],n);if(o.error)return;let a=r.geometry.canPoints.length,s=Array(a),l=Array(a),c=function(e){let{socialChoiceResults:t,votes:n}=e,{allocation:i}=t;if(void 0!==i)return i;let r=iY(n),{iWinner:o}=t,a=Array(r.length).fill(0);return a[o]=1,a}(o),{votes:h}=o,u=iY(h),d=!0===i.useGeography?p(o.geometry.canPoints.length):o.geometry.canLabels;for(let e=0;e<d.length;e++){let t=d[e];s[t]=u[e],l[t]=c[e]}e.setCandidateFractions(s),e.setCandidateWins(l)}(d,e,r,o.getOptions()),c.testVoteView(),c.clearForeground(),c.renderForeground())},c.clickEmpty=e=>{c.testVoterView.graphic.start(e)},c.testVoteView=()=>{let{voteCasterName:e}=t9(o.getOptions(),r),{canPoints:t,voterPoint:n,dimensions:i}=function(e,t,n){let{dimensions:i}=n,r=G([e],i)[0];return{voterPoint:r,canPoints:t.getPoints(i),parties:t.getParties(),dimensions:i}}(c.testVoterView.testVoter,h,r),a=eI[e].castPoint(t,n,i,3);return c.testVoterView.graphic.update(a,h),l.add(["testVote"]),a},c.renderForeground=()=>{f.renderForeground(),d.renderForeground(),c.testVoterView.graphic.renderForeground()},c.clearForeground=()=>{t.clearForeground()}}function rs(e,t,n,i,r,o,a){let s=this,l=new i3(s,e,n,i,t);s.square=l,i5.call(s,e,o),s.setWinFraction=e=>{s.winFraction!==e&&(e>s.winFraction?l.win():s.winFraction>e&&l.lose()),s.winFraction=e},s.renderForeground=()=>{l.render();let{party:n}=e,{x:i,y:r}=s,{fctx:c}=t,{darkMode:h}=t.common,u=h?"#fff":"#222",{socialChoiceMethod:d}=t9(a.getOptions(),o);if("olprA"===d&&$(`p${n}`,i+.1*l.w,r+8,13,2,u,1,c),void 0!==s.winFraction){let e=r+.5*l.h+20+2;$(H(s.winFraction),i,e,20,2,u,1,c)}},s.setRenderer=t=>{s.renderer=t(e)},s.click=()=>{i1(s,e,t,r,o)}}function rl(e,t,n,i,r,o,a){this.canDn=e,this.graphic=new rs(e,t,n,i,r,o,a)}function rc(e,t,n,i,r){let o=this,a=[];o.rendererMaker=()=>({render:()=>{}});let s=[];o.attachNewG=e=>{s.push(e)};let l=e=>{s.forEach(t=>t.updateNewG(e))};t.attachNewE(o),o.updateNewE=e=>{o.newCandidateDn(e)},o.newCandidateDn=function(t){let s=new rl(t,n,21,21,e,i,r);a.push(s),s.graphic.setRenderer(o.rendererMaker),l(s)},o.getCanDnViews=()=>a.filter(e=>e.canDn.exists),o.getCandidateDistributions=()=>o.getCanDnViews().map(e=>e.canDn),o.getCandidateDistributionsAll=()=>a.map(e=>e.canDn),o.setCandidateDnWins=e=>{let t=o.getCanDnViews();t.length>1&&t.forEach(t=>{let n=e[t.canDn.party[0]];t.graphic.setWinFraction(n)})},o.updateViewXY=()=>{a.forEach(e=>e.graphic.updateViewXY())},o.render=()=>{a.forEach(e=>{e.canDn.exists&&e.graphic.renderer.render()})},o.setRenderer=e=>{o.rendererMaker=e,a.forEach(t=>t.graphic.setRenderer(e))},o.renderForeground=()=>{e.showGhosts?o.renderForegroundAll():o.renderForegroundExisting()},o.renderForegroundExisting=()=>{a.forEach(e=>{e.canDn.exists&&e.graphic.renderForeground()})},o.renderForegroundAll=()=>{a.forEach(e=>e.graphic.renderForeground())}}function rh(e,t,n,i,r,o,a,s){let l=this;a.viewModes.sample.attach(l),ny.call(l,t,i,s);let{candidateDnList:c,voterShapeList:h}=e,u=new rc(s,c,t,r,o),d=new rt(s,h,t,r,o);u.attachNewG(l.dragm),d.attachNewG(l.dragm),l.update=e=>{let{samplingResult:t}=e;i.check(["draggables","dimensions","mode"])&&(d.updateViewXY(),u.updateViewXY());let{pointsChanged:n,partyWinFraction:r}=t;n&&u.setCandidateDnWins(r),l.clearForeground(),l.renderForeground()},l.clickEmpty=()=>{},l.testVoteView=()=>null,l.renderForeground=()=>{d.renderForeground(),u.renderForeground()},l.clearForeground=()=>{t.clearForeground()}}function ru(e,t){let n=this,i=[];n.attach=e=>{i.push(e)},n.width=e,n.height=t,n.darkMode=!1,n.setDarkMode=e=>{n.darkMode=e;let[t,r]=e?["darkMode","lightMode"]:["lightMode","darkMode"],o=document.getElementsByTagName("html")[0];o.classList.remove(r),o.classList.add(t),i.forEach(t=>{t.setDarkMode(e)})},n.setDarkMode(window.matchMedia("(prefers-color-scheme: dark)").matches),n.showDownloadScreenLink=!1,n.setShowDownloadScreenLink=e=>{n.showDownloadScreenLink=e,i.forEach(t=>{t.setShowDownloadScreenLink(e)})},n.svgMode=!1,n.setSvgMode=e=>{n.svgMode=e,i.forEach(t=>{t.setSvgMode(e)})}}function rd(e,t,n,i,r){r.addMenuItem({label:`Social Choice Method for ${n} Phase:`,explain:"The method of choosing winners from a set of prospective candidates.",options:T.map(({shortName:e,functionName:t,name:n,explain:i})=>({name:e,value:t,explain:i||n})),changeList:["socialChoiceMethod"],getValue:()=>i.sequenceOptionsMan.sequences[e].phases[t].getOptions().socialChoiceMethod,onChoose:n=>{i.sequenceOptionsMan.sequences[e].phases[t].setSocialChoiceMethod(n.value)},checkShow:()=>e===i.getOptions().sequenceOptions.sequenceName})}function rp(e,t,n){let i=this;i.divMenu=document.createElement("div"),n.newElement("menu",i.divMenu),i.addMenuItem=function(n){let r=new t1(e,t,n);r.select(),i.divMenu.appendChild(r.choose.dom)}}function rf(e,t,n,i,r){let o=new t0({label:"Phase of Results to Display:",width:t2(3),data:[{name:"Primary",value:e},{name:"General",value:"general"}],onChoose:n=>{t.setResultsPhase(e,n.value)}});return n.attach({update:function(){e===r.getOptions().sequenceOptions.sequenceName?o.dom.hidden=!1:o.dom.hidden=!0}}),o.highlight("value",t.resultsPhaseBySeq[e]),o}function rm(e){return JSON.parse(decodeURIComponent(e.get("a")))}let rg={};rg.x=function(){let e;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;let t=["MSXML2.XmlHttp.6.0","MSXML2.XmlHttp.5.0","MSXML2.XmlHttp.4.0","MSXML2.XmlHttp.3.0","MSXML2.XmlHttp.2.0","Microsoft.XmlHttp"];for(let n=0;n<t.length;n++)try{e=new ActiveXObject(t[n]);break}catch(e){}return e},rg.send=function(e,t,n,i,r){let o=r;void 0===o&&(o=!0);let a=rg.x();a.open(n,e,o),a.onreadystatechange=function(){4===a.readyState&&t(a.responseText)},"POST"===n&&a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.send(i)},rg.get=function(e,t,n,i){let r=[],o=Object.keys(t);for(let e=0;e<o.length;e++){let n=o[e];r.push(`${encodeURIComponent(n)}=${encodeURIComponent(t[n])}`)}rg.send(e+(r.length?`?${r.join("&")}`:""),n,"GET",null,i)};var ry="https://script.google.com/macros/s/AKfycbw_t8aLSdKGRFVhAenhPu56Gl-N9fEucx6Ic-H9jtfb55g_1flmiFK7WsHfsx1Dg2LSuQ/exec";let rv=void 0!==window.IPython;function rw(){let e=this;e.div=document.createElement("div");let t=document.createElement("a");t.style.margin="4px",e.div.append(t);let n=document.createElement("button");n.className="button2",n.innerText="X",n.onclick=()=>{e.hide()},e.div.append(n),e.show=()=>{t.hidden=!1,n.hidden=!1},e.hide=()=>{t.hidden=!0,n.hidden=!0},e.setUrl=e=>{t.href=e},e.setFileName=e=>{t.innerText=e,t.download=e},e.setFileName("download")}function rx(){let e=this;e.value="",e.div=document.createElement("div");let t=document.createElement("textarea");t.style.margin="4px",e.div.append(t);let n=document.createElement("button");n.className="button2",n.innerText="X",n.onclick=()=>{e.hide()},e.div.append(n),e.show=()=>{t.hidden=!1,n.hidden=!1},e.hide=()=>{t.hidden=!0,n.hidden=!0},e.setText=n=>{t.value=n,e.value=n}}function r_(e){return JSON.stringify(function e(t){return"object"==typeof t?Array.isArray(t)?t.map(e):Object.keys(t).sort().reduce((n,i)=>{let r=t[i];return n[i]=e(r),n},{}):t}(e),null,"	")}function rb(e,t){let n=new URLSearchParams(e).toString(),i=function(){let e=document.location.href.split("/");return e.slice(0,e.length-1).join("/")}();return`${i}/${t}?${n}`}function rC(e,t,n){let i=encodeURIComponent(JSON.stringify(e)),r=n.value;return rb(""===r?{a:i}:{a:i,name:r},t)}function rS(e,t,n,i){let r=rC(e,t,n),o=function(e){let t,n=0;for(t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t)|0;return(n+2147483648)%2147483648}(r_(e));rg.get(ry,{shortcode:o,link:r},e=>{if(""!==e&&"success"===JSON.parse(e).result){let e=n.value;i(rb(""===e?{b:o}:{b:o,name:e},t));return}i("Bad. The link didn't publish. The short link won't work.")})}function rP(e,t){let n=this;e.attach(n),n.dataStore={},n.update=e=>{t.checkNone()||(n.dataStore=e)}}function rk(e,t,n,i){let{div:r,load:o}=function(e,t){let{changes:n,simOptions:i,pub:r,update:o,init:a}=e,s=new tj(r,i,n),l=new w,c=new tG(tq),{menu:h}=function(e,t,n){let{commander:i,simOptions:r,electionOptionsMan:o,entities:a,changes:s,pub:l}=e,c=new rp(l,s,t);return c.addMenuItem({label:"Mode:",explain:"The simulation mode chooses the kind of analysis to do. Either do one election and see more detail or many and get summary stats.",options:[{name:"Election",value:"one",explain:"See the votes from one election."},{name:"Win Density",value:"sample",explain:"See the winning candidates as a density over many elections. The prospective candidates come from a distribution."}],changeList:["mode"],getValue:()=>r.mode,onChoose:e=>{r.setMode(e.value)}}),c.addMenuItem({label:"Dimensions:",explain:"Set the number of dimensions for policy space. Policy space is where voters make decisions on which candidates to elect. Voters like candidates closer to them. Also, the way this simulation is organized, the 1D position of a candidate or voter is independent from their 2D position. This sim uses just one or the other.",options:[{name:"1D",value:1,explain:"Use only one axis for policy space."},{name:"2D",value:2,explain:"Use two axes for policy space."}],changeList:["dimensions"],getValue:()=>r.dimensions,onChoose:e=>{r.setDimensions(e.value)}}),function(e,t){e.addMenuItem({label:"Sampling Seed:",explain:"The sampling seed can either be constant or random. Setting the seed to random means every time the sampler starts, it will choose a random sampling seed. The seed is used to sample the same candidates each time, no matter if the other settings change. The only way things would be different is if the size of the candidate distributions change or if the number of candidate distributions change.",options:[{name:"Random",value:!0,explain:"New seed for each sampling run."},{name:"Constant",value:!1,explain:"Same seed for each sampling run."}],changeList:["seedRandom"],getValue:()=>t.seedRandom,onChoose:e=>{t.setSeedRandom(e.value)}})}(c,r),c.addMenuItem({label:"Number of Census Tracts:",explain:"Tracts add some geography into the election. Tracts are the pixels of the geography. Voters live in tracts. In each tract, the voters are moved in policy space according to a random algorithm called simplex noise. The main feature is that neighboring tracts are similar to each other. This options sets the number of tracts along one axis. ",options:[{name:"1",value:1},{name:"9",value:9}],changeList:["numTracts"],getValue:()=>o.getOptions().numTracts,onChoose:e=>{o.setNumTracts(e.value)}}),c.addMenuItem({label:"Number of Districts:",explain:"Districts are one way to try to introduce proprtionality into an election. Districts are drawn across tracts. Elections results are summed across the districts. Each district has one or more winners. ",options:[{name:"1",value:1},{name:"9",value:9}],changeList:["numDistricts"],getValue:()=>o.getOptions().numDistricts,onChoose:e=>{o.setNumDistricts(e.value)}}),c.addMenuItem({label:"Election Sequence:",explain:"An election may be composed of phases of casting votes and determining winners. A primary may be closed or open. A closed primary only allows voters of a party to vote. A nonpartisan open primary allows any voter to vote for any candidate. A general follows the primary. ",options:[{name:"General",value:"general",explain:"One general phase."},{name:"Closed P",value:"closedPrimary",explain:"A closed primary followed by a general phase."},{name:"Nonp Open P",value:"nonpartisanOpenPrimary",explain:"A nonpartisan open primary followed by a general phase."}],changeList:["sequenceName"],getValue:()=>o.sequenceOptionsMan.getOptions().sequenceName,onChoose:e=>{o.sequenceOptionsMan.setSequenceName(e.value)}}),rd("general","general","General",o,c),rd("closedPrimary","closedPrimary","Closed Primary",o,c),rd("closedPrimary","general","General",o,c),rd("nonpartisanOpenPrimary","nonpartisanOpenPrimary","Nonpartisan Open Primary",o,c),rd("nonpartisanOpenPrimary","general","General",o,c),!function(e,t,n,i,r){let o=rf("closedPrimary",e,t,n,r),a=function(e,t,n,i,r){let o=new t0({label:"Party of Results to Display:",width:t2(10),data:p(10).map(e=>({name:e,value:e})),onChoose:n=>{t.setResultsParty(e,n.value)}});return n.attach({update:function(){let n=r.getOptions().sequenceOptions.sequenceName,i=e===n,a="general"!==t.resultsPhaseBySeq[n];i&&a?o.dom.hidden=!1:o.dom.hidden=!0}}),o.highlight("value",t.resultsPartyBySeq[e]),o}("closedPrimary",e,t,0,r),s=rf("nonpartisanOpenPrimary",e,t,n,r),l=document.createElement("div");l.appendChild(o.dom),l.appendChild(a.dom),l.appendChild(s.dom),n.newElement("resultsPhaseSelector",l)}(r,l,t,0,o),!function(e,t){let n=document.createElement("button"),i=document.createElement("button");n.className="button2",i.className="button2",n.innerText="Undo",i.innerText="Redo",n.onclick=t.undo,i.onclick=t.redo,e.newElement("undo",n),e.newElement("redo",i)}(t,i),!function(e){let t=document.createElement("div");t.setAttribute("class","button-group-label2"),t.innerText="Sim Controls:",e.newElement("simControlsLabel",t)}(t),!function(e,t,n){let i=function(e,t){let n=document.createElement("button");function i(){n.hidden=!0}return n.className="button2",n.innerText="Add Candidate",n.onclick=()=>{t.addEntityPressed()},i(),e.viewModes.one.attach({enter:function(){n.hidden=!1},exit:i,update:()=>{}}),n}(e,t.candidateList),r=function(e,t){let n=document.createElement("button");function i(){n.hidden=!0}return n.className="button2",n.innerText="Add Candidate Group",n.onclick=()=>{t.addEntityPressed()},i(),e.viewModes.sample.attach({enter:function(){n.hidden=!1},exit:i,update:()=>{}}),n}(e,t.candidateDnList),o=function(e){let t=document.createElement("button");return t.innerText="Add Voter Group",t.className="button2",t.onclick=()=>{e.addEntityPressed()},t}(t.voterShapeList),a=document.createElement("div");a.append(o),a.append(i),a.append(r),n.newElement("addEntities",a)}(n,a,t),!function(e,t,n){let i=document.createElement("div");i.className="warning",i.innerText="Elections with both geographic components and sequence components are not yet implemented. Change number of districts to 1 and number of tracts to 1 or change election sequence to general.",o();let r={enter:()=>{},exit:()=>{},update:()=>{let t=e.getOptions();!0===t.useGeography&&"general"!==t.sequenceOptions.sequenceName?i.hidden=!1:o()}};function o(){i.hidden=!0}t.viewModes.one.attach(r),t.viewModes.sample.attach(r),n.newElement("warning",i)}(o,n,t),{menu:c}}(e,c,s),{nameInput:u}=function(e,t,n){let{commander:i,changes:r,pub:o}=e,a=function(e){let t=document.createElement("label");t.className="button-group-label2",t.innerText="Name: ";let n=document.createElement("input");n.type="text",n.placeholder="",n.set=e=>{n.value=e};let i=document.createElement("div");return i.appendChild(t),i.appendChild(n),e.newElement("name",i),n}(t);return!function(e,t,n,i){let r=document.createElement("button");r.className="button2",r.innerText="Save Long Link";let o=document.createElement("button");o.className="button2",o.innerText="Copy";let a=new rx;a.hide(),r.onclick=()=>{a.show();let e=rC(t.getConfig(),n,i);a.setText(e)},o.onclick=()=>{r.onclick(),navigator.clipboard.writeText(a.value)};let s=document.createElement("div"),l=document.createElement("div");l.appendChild(r),l.appendChild(o),l.appendChild(s),l.appendChild(a.div),e.newElement("saveConfigToLink",l)}(t,i,n,a),!function(e,t,n,i){let r=document.createElement("button");r.className="button2",r.innerText="Publish Short Link";let o=document.createElement("button");o.className="button2",o.innerText="Copy";let a=new rx;a.hide();let s="requesting short link...";r.onclick=()=>{a.show();let e=t.getConfig();a.setText(s),rS(e,n,i,e=>{a.setText(e)})},o.onclick=()=>{a.show();let e=t.getConfig();a.setText(s),rS(e,n,i,e=>{navigator.clipboard.writeText(e)})};let l=document.createElement("div"),c=document.createElement("div");c.appendChild(r),c.appendChild(o),c.appendChild(l),c.appendChild(a.div),e.newElement("saveConfigToShortLink",c)}(t,i,n,a),!function(e,t,n){let i=document.createElement("button");i.className="button2",i.innerText="Show Config";let r=document.createElement("button");r.className="button2",r.innerText="Download Config";let o=new rw;o.setFileName("config.json"),o.hide();let a=new rx;a.hide(),i.onclick=()=>{a.show();let e=r_(t.getConfig());a.setText(e)},r.onclick=()=>{i.onclick();let e=`data:text/json;charset=utf-8,${encodeURIComponent(a.value)}`;o.setUrl(e);let t=n.value;""!==t&&o.setFileName(`${t}.json`),o.show()};let s=document.createElement("div"),l=document.createElement("div");l.appendChild(i),l.appendChild(r),l.appendChild(o.div),l.appendChild(s),l.appendChild(a.div),e.newElement("saveConfigToText",l)}(t,i,a),!function(e,t,n){let i=document.createElement("button");i.className="button2",i.innerText="Load Pasted Config";let r=document.createElement("textarea");i.onclick=()=>{if(""===r.value)return;let e=JSON.parse(r.value);t.loadConfig(e)};let o=function(e,t){let n=document.createElement("input");n.type="file",n.accept=".json",n.onchange=()=>{let i=n.files[0],r=new FileReader;r.addEventListener("load",e),r.readAsText(i);let{name:o}=i,a=o.split(".").slice(0,-1).join(".");t.set(a)};let i=document.createElement("button");return i.className="button2",i.innerText="Upload Config",i.onclick=()=>{n.click()},i}(function(e){let{result:n}=e.target,i=JSON.parse(n);t.loadConfig(i)},n),a=document.createElement("div"),s=document.createElement("div");s.appendChild(i),s.appendChild(o),s.appendChild(a),s.appendChild(r),e.newElement("loadConfigText",s)}(t,i,a),!function(e,t,n){let i=document.createElement("button");i.className="button2",i.innerText="Show Data";let r=document.createElement("button");r.className="button2",r.innerText="Download Data";let o=new rw;o.setFileName("data.json"),o.hide();let a=new rx;a.hide(),i.onclick=()=>{a.show();let{dataStore:e}=n,t=r_(e);a.setText(t)},r.onclick=()=>{i.onclick();let e=`data:text/json;charset=utf-8,${encodeURIComponent(a.value)}`;o.setUrl(e);let n=t.value;""!==n&&o.setFileName(`${n}_data.json`),o.show()};let s=document.createElement("div"),l=document.createElement("div");l.appendChild(i),l.appendChild(r),l.appendChild(o.div),l.appendChild(s),l.appendChild(a.div),e.newElement("saveData",l)}(t,a,new rP(o,r)),{nameInput:a}}(e,c,t),{screenMain:d}=function(e,t,n,i,r){let{entities:o,simOptions:a,electionOptionsMan:s,changes:l}=e,c=new ru(300,300),h=new tZ(c,t,n,"viz"),u=new tZ(c,t,n,"vizMini");u.setHeight(c.height/3),u.hide(),function(e,t,n){let i=new t0({label:"Drawing Mode:",width:t2(3),data:[{name:"Canvas",value:!1},{name:"SVG",value:!0}],onChoose:t=>{e.setSvgMode(t.value),n.rerender()}});i.highlight("value",e.svgMode),t.newElement("svgSwitch",i.dom)}(c,n,t),function(e,t){let n=new t0({label:"Show Link to Download Screen Image/SVG:",width:t2(3),data:[{name:"Yes",value:!0},{name:"No",value:!1}],onChoose:t=>{e.setShowDownloadScreenLink(t.value)}});n.highlight("value",e.svgMode),t.newElement("showDownloadScreenLink",n.dom)}(c,n),function(e,t,n){let i=new t0({label:"Theme:",width:t2(3),data:[{name:"Light",value:!1},{name:"Dark",value:!0}],onChoose:t=>{e.setDarkMode(t.value),n.rerender()}});i.highlight("value",e.darkMode),t.newElement("darkModeSwitch",i.dom)}(c,n,t);let d=new t5(l);return new ra(o,h,r,l,a,s,t,d,i),new rh(o,h,r,l,a,s,t,d),new n_(o,h,u,r,l,a,s,t,d),new iH(o,h,r,l,a,t,d),new ne(c,n,r,l,a,s,t),new iZ(o,c,n,l,a,s,t),{screenMain:h}}(e,s,c,l,h);return!function(e,t){e.attach({update:e=>{!t.checkNone()&&(window.votekitStore={},rv&&(Object.assign(window.votekitStore,e),void 0!==window.votekitUpdate&&window.votekitUpdate(window.votekitStore,e)))}})}(r,n),window.requestAnimationFrame(function e(){o(),l.checkNone()&&0===d.tweenGroup.getAll().length||(d.tweenGroup.update(),s.clearForeground(),s.renderForeground(),l.clear()),window.requestAnimationFrame(e)}),{div:c.makeComponent(),load:function(e,t){(function(e,t,n){let{search:i}=e,r=new URLSearchParams(i),o=r.get("name");null!==o&&t.set(o);let a=r.has("a"),s=r.has("b"),l=a||s;if(a){n({yes:l,config:rm(r)});return}if(s){var c;c=r.get("b"),rg.get(ry,{shortcode:c,link:"getTable"},e=>{let{link:t}=JSON.parse(e),{search:i}=new URL(t);n({yes:!0,config:rm(new URLSearchParams(i))})});return}n({yes:l,config:{}})})(e,u,function(e){a(e.yes?e.config:t)})}}}(tV(i),n);return o(e,t),r}rv&&(window.votekitStore={},window.getVotekitStore=()=>{if(rv){let e;e=`votekitData = '${JSON.stringify(window.votekitStore)}'`,window.IPython.notebook.kernel.execute(e)}}),Array.from(document.getElementsByClassName("sandbox")).forEach(e=>{let t=void 0!==e.dataset.config?JSON.parse(e.dataset.config):{},n=void 0!==e.dataset.sandboxurl?e.dataset.sandboxurl:"",i=rk(window.location,t,n);e.parentNode.appendChild(i)}),Array.from(document.getElementsByClassName("double_sandbox")).forEach(e=>{let t=function(e,t){let n=new _,i=document.createElement("button");i.className="button2",i.innerText="linked",i.style["vertical-align"]="middle",i.style["min-width"]="70px",i.style.margin="5px",i.onclick=()=>{"linked"===i.innerText?(i.innerText="unlinked",n.setLinked(!1)):(i.innerText="linked",n.setLinked(!0))};let r=window.location,o=rk(r,e,t,n),a=rk(r,e,t,n);o.style.display="inline-block",a.style.display="inline-block",o.style["vertical-align"]="top",a.style["vertical-align"]="top";let s=document.createElement("div");return s.appendChild(o),s.appendChild(i),s.appendChild(a),s}(void 0!==e.dataset.config?JSON.parse(e.dataset.config):{},void 0!==e.dataset.sandboxurl?e.dataset.sandboxurl:"");e.parentNode.appendChild(t)})})();
//# sourceMappingURL=addSandboxes.js.map
